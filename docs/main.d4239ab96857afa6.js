(self.webpackChunkostoo=self.webpackChunkostoo||[]).push([[179],{787:(Ff,uu,hu)=>{"use strict";function gi(n){return"function"==typeof n}function Gd(n){const t=n(s=>{Error.call(s),s.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}const Nf=Gd(n=>function(t){n(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((s,c)=>`${c+1}) ${s.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t});function d(n,e){if(n){const t=n.indexOf(e);0<=t&&n.splice(t,1)}}class Ue{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;const{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(const p of t)p.remove(this);else t.remove(this);const{initialTeardown:s}=this;if(gi(s))try{s()}catch(p){e=p instanceof Nf?p.errors:[p]}const{_finalizers:c}=this;if(c){this._finalizers=null;for(const p of c)try{Jt(p)}catch(y){e=e??[],y instanceof Nf?e=[...e,...y.errors]:e.push(y)}}if(e)throw new Nf(e)}}add(e){var t;if(e&&e!==this)if(this.closed)Jt(e);else{if(e instanceof Ue){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(t=this._finalizers)&&void 0!==t?t:[]).push(e)}}_hasParent(e){const{_parentage:t}=this;return t===e||Array.isArray(t)&&t.includes(e)}_addParent(e){const{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e}_removeParent(e){const{_parentage:t}=this;t===e?this._parentage=null:Array.isArray(t)&&d(t,e)}remove(e){const{_finalizers:t}=this;t&&d(t,e),e instanceof Ue&&e._removeParent(this)}}Ue.EMPTY=(()=>{const n=new Ue;return n.closed=!0,n})();const Bo=Ue.EMPTY;function eo(n){return n instanceof Ue||n&&"closed"in n&&gi(n.remove)&&gi(n.add)&&gi(n.unsubscribe)}function Jt(n){gi(n)?n():n.unsubscribe()}const Wt={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},xi={setTimeout(n,e,...t){const{delegate:s}=xi;return s?.setTimeout?s.setTimeout(n,e,...t):setTimeout(n,e,...t)},clearTimeout(n){const{delegate:e}=xi;return(e?.clearTimeout||clearTimeout)(n)},delegate:void 0};function Ji(n){xi.setTimeout(()=>{const{onUnhandledError:e}=Wt;if(!e)throw n;e(n)})}function Vo(){}const Kl=Os("C",void 0,void 0);function Os(n,e,t){return{kind:n,value:e,error:t}}let to=null;function et(n){if(Wt.useDeprecatedSynchronousErrorHandling){const e=!to;if(e&&(to={errorThrown:!1,error:null}),n(),e){const{errorThrown:t,error:s}=to;if(to=null,t)throw s}}else n()}class ps extends Ue{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,eo(e)&&e.add(this)):this.destination=sn}static create(e,t,s){return new va(e,t,s)}next(e){this.isStopped?ba(function jo(n){return Os("N",n,void 0)}(e),this):this._next(e)}error(e){this.isStopped?ba(function Yl(n){return Os("E",void 0,n)}(e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?ba(Kl,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const du=Function.prototype.bind;function on(n,e){return du.call(n,e)}class bi{constructor(e){this.partialObserver=e}next(e){const{partialObserver:t}=this;if(t.next)try{t.next(e)}catch(s){xa(s)}}error(e){const{partialObserver:t}=this;if(t.error)try{t.error(e)}catch(s){xa(s)}else xa(e)}complete(){const{partialObserver:e}=this;if(e.complete)try{e.complete()}catch(t){xa(t)}}}class va extends ps{constructor(e,t,s){let c;if(super(),gi(e)||!e)c={next:e??void 0,error:t??void 0,complete:s??void 0};else{let p;this&&Wt.useDeprecatedNextContext?(p=Object.create(e),p.unsubscribe=()=>this.unsubscribe(),c={next:e.next&&on(e.next,p),error:e.error&&on(e.error,p),complete:e.complete&&on(e.complete,p)}):c=e}this.destination=new bi(c)}}function xa(n){Wt.useDeprecatedSynchronousErrorHandling?function no(n){Wt.useDeprecatedSynchronousErrorHandling&&to&&(to.errorThrown=!0,to.error=n)}(n):Ji(n)}function ba(n,e){const{onStoppedNotification:t}=Wt;t&&xi.setTimeout(()=>t(n,e))}const sn={closed:!0,next:Vo,error:function Ql(n){throw n},complete:Vo},wa="function"==typeof Symbol&&Symbol.observable||"@@observable";function Fs(n){return n}let _n=(()=>{class n{constructor(t){t&&(this._subscribe=t)}lift(t){const s=new n;return s.source=this,s.operator=t,s}subscribe(t,s,c){const p=function fs(n){return n&&n instanceof ps||function Jl(n){return n&&gi(n.next)&&gi(n.error)&&gi(n.complete)}(n)&&eo(n)}(t)?t:new va(t,s,c);return et(()=>{const{operator:y,source:w}=this;p.add(y?y.call(p,w):w?this._subscribe(p):this._trySubscribe(p))}),p}_trySubscribe(t){try{return this._subscribe(t)}catch(s){t.error(s)}}forEach(t,s){return new(s=Ta(s))((c,p)=>{const y=new va({next:w=>{try{t(w)}catch(C){p(C),y.unsubscribe()}},error:p,complete:c});this.subscribe(y)})}_subscribe(t){var s;return null===(s=this.source)||void 0===s?void 0:s.subscribe(t)}[wa](){return this}pipe(...t){return function Ns(n){return 0===n.length?Fs:1===n.length?n[0]:function(t){return n.reduce((s,c)=>c(s),t)}}(t)(this)}toPromise(t){return new(t=Ta(t))((s,c)=>{let p;this.subscribe(y=>p=y,y=>c(y),()=>s(p))})}}return n.create=e=>new n(e),n})();function Ta(n){var e;return null!==(e=n??Wt.Promise)&&void 0!==e?e:Promise}const Uo=Gd(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let $o=(()=>{class n extends _n{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){const s=new zs(this,this);return s.operator=t,s}_throwIfClosed(){if(this.closed)throw new Uo}next(t){et(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const s of this.currentObservers)s.next(t)}})}error(t){et(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;const{observers:s}=this;for(;s.length;)s.shift().error(t)}})}complete(){et(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){const{hasError:s,isStopped:c,observers:p}=this;return s||c?Bo:(this.currentObservers=null,p.push(t),new Ue(()=>{this.currentObservers=null,d(p,t)}))}_checkFinalizedStatuses(t){const{hasError:s,thrownError:c,isStopped:p}=this;s?t.error(c):p&&t.complete()}asObservable(){const t=new _n;return t.source=this,t}}return n.create=(e,t)=>new zs(e,t),n})();class zs extends $o{constructor(e,t){super(),this.destination=e,this.source=t}next(e){var t,s;null===(s=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===s||s.call(t,e)}error(e){var t,s;null===(s=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===s||s.call(t,e)}complete(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)}_subscribe(e){var t,s;return null!==(s=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==s?s:Bo}}function io(n){return e=>{if(function Br(n){return gi(n?.lift)}(e))return e.lift(function(t){try{return n(t,this)}catch(s){this.error(s)}});throw new TypeError("Unable to lift unknown Observable type")}}function Bs(n,e,t,s,c){return new Vr(n,e,t,s,c)}class Vr extends ps{constructor(e,t,s,c,p,y){super(e),this.onFinalize=p,this.shouldUnsubscribe=y,this._next=t?function(w){try{t(w)}catch(C){e.error(C)}}:super._next,this._error=c?function(w){try{c(w)}catch(C){e.error(C)}finally{this.unsubscribe()}}:super._error,this._complete=s?function(){try{s()}catch(w){e.error(w)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:t}=this;super.unsubscribe(),!t&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}}}function oo(n){return this instanceof oo?(this.v=n,this):new oo(n)}function Us(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c,s=t.apply(n,e||[]),p=[];return c={},y("next"),y("throw"),y("return"),c[Symbol.asyncIterator]=function(){return this},c;function y(X){s[X]&&(c[X]=function(ie){return new Promise(function(fe,De){p.push([X,ie,fe,De])>1||w(X,ie)})})}function w(X,ie){try{!function C(X){X.value instanceof oo?Promise.resolve(X.value.v).then(A,F):V(p[0][2],X)}(s[X](ie))}catch(fe){V(p[0][3],fe)}}function A(X){w("next",X)}function F(X){w("throw",X)}function V(X,ie){X(ie),p.shift(),p.length&&w(p[0][0],p[0][1])}}function oc(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,e=n[Symbol.asyncIterator];return e?e.call(n):(n=function ms(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],s=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&s>=n.length&&(n=void 0),{value:n&&n[s++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(n),t={},s("next"),s("throw"),s("return"),t[Symbol.asyncIterator]=function(){return this},t);function s(p){t[p]=n[p]&&function(y){return new Promise(function(w,C){!function c(p,y,w,C){Promise.resolve(C).then(function(A){p({value:A,done:w})},y)}(w,C,(y=n[p](y)).done,y.value)})}}}const cc=n=>n&&"number"==typeof n.length&&"function"!=typeof n;function Sa(n){return gi(n?.then)}function $s(n){return gi(n[wa])}function Ma(n){return Symbol.asyncIterator&&gi(n?.[Symbol.asyncIterator])}function so(n){return new TypeError(`You provided ${null!==n&&"object"==typeof n?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const ul=function Gs(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function ee(n){return gi(n?.[ul])}function z(n){return Us(this,arguments,function*(){const t=n.getReader();try{for(;;){const{value:s,done:c}=yield oo(t.read());if(c)return yield oo(void 0);yield yield oo(s)}}finally{t.releaseLock()}})}function U(n){return gi(n?.getReader)}function Y(n){if(n instanceof _n)return n;if(null!=n){if($s(n))return function oe(n){return new _n(e=>{const t=n[wa]();if(gi(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(n);if(cc(n))return function de(n){return new _n(e=>{for(let t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}(n);if(Sa(n))return function ve(n){return new _n(e=>{n.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,Ji)})}(n);if(Ma(n))return pe(n);if(ee(n))return function ye(n){return new _n(e=>{for(const t of n)if(e.next(t),e.closed)return;e.complete()})}(n);if(U(n))return function we(n){return pe(z(n))}(n)}throw so(n)}function pe(n){return new _n(e=>{(function je(n,e){var t,s,c,p;return function js(n,e,t,s){return new(t||(t=Promise))(function(p,y){function w(F){try{A(s.next(F))}catch(V){y(V)}}function C(F){try{A(s.throw(F))}catch(V){y(V)}}function A(F){F.done?p(F.value):function c(p){return p instanceof t?p:new t(function(y){y(p)})}(F.value).then(w,C)}A((s=s.apply(n,e||[])).next())})}(this,void 0,void 0,function*(){try{for(t=oc(n);!(s=yield t.next()).done;)if(e.next(s.value),e.closed)return}catch(y){c={error:y}}finally{try{s&&!s.done&&(p=t.return)&&(yield p.call(t))}finally{if(c)throw c.error}}e.complete()})})(n,e).catch(t=>e.error(t))})}function it(n,e,t,s=0,c=!1){const p=e.schedule(function(){t(),c?n.add(this.schedule(null,s)):this.unsubscribe()},s);if(n.add(p),!c)return p}function Et(n,e,t=1/0){return gi(e)?Et((s,c)=>function pu(n,e){return io((t,s)=>{let c=0;t.subscribe(Bs(s,p=>{s.next(n.call(e,p,c++))}))})}((p,y)=>e(s,p,c,y))(Y(n(s,c))),t):("number"==typeof e&&(t=e),io((s,c)=>function We(n,e,t,s,c,p,y,w){const C=[];let A=0,F=0,V=!1;const X=()=>{V&&!C.length&&!A&&e.complete()},ie=De=>A<s?fe(De):C.push(De),fe=De=>{p&&e.next(De),A++;let Ne=!1;Y(t(De,F++)).subscribe(Bs(e,qe=>{c?.(qe),p?ie(qe):e.next(qe)},()=>{Ne=!0},void 0,()=>{if(Ne)try{for(A--;C.length&&A<s;){const qe=C.shift();y?it(e,y,()=>fe(qe)):fe(qe)}X()}catch(qe){e.error(qe)}}))};return n.subscribe(Bs(e,ie,()=>{V=!0,X()})),()=>{w?.()}}(s,c,n,t)))}const gt=new _n(n=>n.complete());function xt(n){return n[n.length-1]}function gs(n,e=0){return io((t,s)=>{t.subscribe(Bs(s,c=>it(s,n,()=>s.next(c),e),()=>it(s,n,()=>s.complete(),e),c=>it(s,n,()=>s.error(c),e)))})}function jr(n,e=0){return io((t,s)=>{s.add(n.schedule(()=>t.subscribe(s),e))})}function Hd(n,e){if(!n)throw new Error("Iterable cannot be null");return new _n(t=>{it(t,e,()=>{const s=n[Symbol.asyncIterator]();it(t,e,()=>{s.next().then(c=>{c.done?t.complete():t.next(c.value)})},0,!0)})})}function pr(...n){const e=function Wn(n){return function Dn(n){return n&&gi(n.schedule)}(xt(n))?n.pop():void 0}(n),t=function Wo(n,e){return"number"==typeof xt(n)?n.pop():e}(n,1/0),s=n;return s.length?1===s.length?Y(s[0]):function bt(n=1/0){return Et(Fs,n)}(t)(function qd(n,e){return e?function _u(n,e){if(null!=n){if($s(n))return function Re(n,e){return Y(n).pipe(jr(e),gs(e))}(n,e);if(cc(n))return function _i(n,e){return new _n(t=>{let s=0;return e.schedule(function(){s===n.length?t.complete():(t.next(n[s++]),t.closed||this.schedule())})})}(n,e);if(Sa(n))return function _s(n,e){return Y(n).pipe(jr(e),gs(e))}(n,e);if(Ma(n))return Hd(n,e);if(ee(n))return function ys(n,e){return new _n(t=>{let s;return it(t,e,()=>{s=n[ul](),it(t,e,()=>{let c,p;try{({value:c,done:p}=s.next())}catch(y){return void t.error(y)}p?t.complete():t.next(c)},0,!0)}),()=>gi(s?.return)&&s.return()})}(n,e);if(U(n))return function Ur(n,e){return Hd(z(n),e)}(n,e)}throw so(n)}(n,e):Y(n)}(s,e)):gt}function ln(n,e,...t){if(!0===e)return void n();if(!1===e)return;const s=new va({next:()=>{s.unsubscribe(),n()}});return e(...t).subscribe(s)}function _t(n){for(let e in n)if(n[e]===_t)return e;throw Error("Could not find renamed property on target object.")}function In(n){if("string"==typeof n)return n;if(Array.isArray(n))return"["+n.map(In).join(", ")+"]";if(null==n)return""+n;if(n.overriddenName)return`${n.overriddenName}`;if(n.name)return`${n.name}`;const e=n.toString();if(null==e)return""+e;const t=e.indexOf("\n");return-1===t?e:e.substring(0,t)}function Xt(n,e){return null==n||""===n?null===e?"":e:null==e||""===e?n:n+" "+e}const uc=_t({__forward_ref__:_t});function Hs(n){return n.__forward_ref__=Hs,n.toString=function(){return In(this())},n}function kt(n){return function wi(n){return"function"==typeof n&&n.hasOwnProperty(uc)&&n.__forward_ref__===Hs}(n)?n():n}class rt extends Error{constructor(e,t){super(function qs(n,e){return`NG0${Math.abs(n)}${e?": "+e.trim():""}`}(e,t)),this.code=e}}function jt(n){return"string"==typeof n?n:null==n?"":String(n)}function Zs(n,e){throw new rt(-201,!1)}function Bi(n,e){null==n&&function Ut(n,e,t,s){throw new Error(`ASSERTION ERROR: ${n}`+(null==s?"":` [Expected=> ${t} ${s} ${e} <=Actual]`))}(e,n,null,"!=")}function Sn(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function Hr(n){return{providers:n.providers||[],imports:n.imports||[]}}function hl(n){return fc(n,Aa)||fc(n,mc)}function fc(n,e){return n.hasOwnProperty(e)?n[e]:null}function vs(n){return n&&(n.hasOwnProperty(Ti)||n.hasOwnProperty(gc))?n[Ti]:null}const Aa=_t({\u0275prov:_t}),Ti=_t({\u0275inj:_t}),mc=_t({ngInjectableDef:_t}),gc=_t({ngInjectorDef:_t});var $t=(()=>(($t=$t||{})[$t.Default=0]="Default",$t[$t.Host=1]="Host",$t[$t.Self=2]="Self",$t[$t.SkipSelf=4]="SkipSelf",$t[$t.Optional=8]="Optional",$t))();let vu;function qr(n){const e=vu;return vu=n,e}function _c(n,e,t){const s=hl(n);return s&&"root"==s.providedIn?void 0===s.value?s.value=s.factory():s.value:t&$t.Optional?null:void 0!==e?e:void Zs(In(n))}function Zo(n){return{toString:n}.toString()}var ao=(()=>((ao=ao||{})[ao.OnPush=0]="OnPush",ao[ao.Default=1]="Default",ao))(),Vi=(()=>{return(n=Vi||(Vi={}))[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",Vi;var n})();const Ct=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),Ks={},yn=[],Pa=_t({\u0275cmp:_t}),La=_t({\u0275dir:_t}),fl=_t({\u0275pipe:_t}),Tu=_t({\u0275mod:_t}),lo=_t({\u0275fac:_t}),bo=_t({__NG_ELEMENT_ID__:_t});let ml=0;function Zn(n){return Zo(()=>{const t=!0===n.standalone,s={},c={type:n.type,providersResolver:null,decls:n.decls,vars:n.vars,factory:null,template:n.template||null,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:s,inputs:null,outputs:null,exportAs:n.exportAs||null,onPush:n.changeDetection===ao.OnPush,directiveDefs:null,pipeDefs:null,standalone:t,dependencies:t&&n.dependencies||null,getStandaloneInjector:null,selectors:n.selectors||yn,viewQuery:n.viewQuery||null,features:n.features||null,data:n.data||{},encapsulation:n.encapsulation||Vi.Emulated,id:"c"+ml++,styles:n.styles||yn,_:null,setInput:null,schemas:n.schemas||null,tView:null},p=n.dependencies,y=n.features;return c.inputs=Fh(n.inputs,s),c.outputs=Fh(n.outputs),y&&y.forEach(w=>w(c)),c.directiveDefs=p?()=>("function"==typeof p?p():p).map(vc).filter(dn):null,c.pipeDefs=p?()=>("function"==typeof p?p():p).map(mr).filter(dn):null,c})}function vc(n){return Vn(n)||nr(n)}function dn(n){return null!==n}function fr(n){return Zo(()=>({type:n.type,bootstrap:n.bootstrap||yn,declarations:n.declarations||yn,imports:n.imports||yn,exports:n.exports||yn,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null}))}function Fh(n,e){if(null==n)return Ks;const t={};for(const s in n)if(n.hasOwnProperty(s)){let c=n[s],p=c;Array.isArray(c)&&(p=c[1],c=c[0]),t[c]=s,e&&(e[c]=p)}return t}const Pi=Zn;function Vn(n){return n[Pa]||null}function nr(n){return n[La]||null}function mr(n){return n[fl]||null}function rr(n){return Array.isArray(n)&&"object"==typeof n[1]}function Eo(n){return Array.isArray(n)&&!0===n[1]}function zh(n){return 0!=(8&n.flags)}function Iu(n){return 2==(2&n.flags)}function xl(n){return 1==(1&n.flags)}function Xr(n){return null!==n.template}function np(n){return 0!=(256&n[2])}function Mr(n,e){return n.hasOwnProperty(lo)?n[lo]:null}class ku{constructor(e,t,s){this.previousValue=e,this.currentValue=t,this.firstChange=s}isFirstChange(){return this.firstChange}}function Fa(){return Na}function Na(n){return n.type.prototype.ngOnChanges&&(n.setInput=at),Ec}function Ec(){const n=El(this),e=n?.current;if(e){const t=n.previous;if(t===Ks)n.previous=e;else for(let s in e)t[s]=e[s];n.current=null,this.ngOnChanges(e)}}function at(n,e,t,s){const c=El(n)||function op(n,e){return n[Kr]=e}(n,{previous:Ks,current:null}),p=c.current||(c.current={}),y=c.previous,w=this.declaredInputs[t],C=y[w];p[w]=new ku(C&&C.currentValue,e,y===Ks),n[s]=e}Fa.ngInherit=!0;const Kr="__ngSimpleChanges__";function El(n){return n[Kr]||null}function ni(n){for(;Array.isArray(n);)n=n[0];return n}function Tc(n,e){return ni(e[n])}function Li(n,e){return ni(e[n.index])}function Il(n,e){return n.data[e]}function or(n,e){const t=e[n];return rr(t)?t:t[0]}function Cc(n){return 64==(64&n[2])}function Xo(n,e){return null==e?null:n[e]}function Gh(n){n[18]=0}function Sl(n,e){n[5]+=e;let t=n,s=n[3];for(;null!==s&&(1===e&&1===t[5]||-1===e&&0===t[5]);)s[5]+=e,t=s,s=s[3]}const Ot={lFrame:Kh(null),bindingsEnabled:!0};function Hh(){return Ot.bindingsEnabled}function Je(){return Ot.lFrame.lView}function vn(){return Ot.lFrame.tView}function Pr(n){return Ot.lFrame.contextLView=n,n[8]}function Lr(n){return Ot.lFrame.contextLView=null,n}function Xn(){let n=qh();for(;null!==n&&64===n.type;)n=n.parent;return n}function qh(){return Ot.lFrame.currentTNode}function Di(n,e){const t=Ot.lFrame;t.currentTNode=n,t.isParent=e}function Ml(){return Ot.lFrame.isParent}function lt(){Ot.lFrame.isParent=!1}function Gi(){const n=Ot.lFrame;let e=n.bindingRootIndex;return-1===e&&(e=n.bindingRootIndex=n.tView.bindingStartIndex),e}function ta(){return Ot.lFrame.bindingIndex++}function Ic(n,e){const t=Ot.lFrame;t.bindingIndex=t.bindingRootIndex=n,Vu(e)}function Vu(n){Ot.lFrame.currentDirectiveIndex=n}function Zh(){return Ot.lFrame.currentQueryIndex}function ju(n){Ot.lFrame.currentQueryIndex=n}function up(n){const e=n[1];return 2===e.type?e.declTNode:1===e.type?n[6]:null}function Xh(n,e,t){if(t&$t.SkipSelf){let c=e,p=n;for(;!(c=c.parent,null!==c||t&$t.Host||(c=up(p),null===c||(p=p[15],10&c.type))););if(null===c)return!1;e=c,n=p}const s=Ot.lFrame=$u();return s.currentTNode=e,s.lView=n,!0}function Uu(n){const e=$u(),t=n[1];Ot.lFrame=e,e.currentTNode=t.firstChild,e.lView=n,e.tView=t,e.contextLView=n,e.bindingIndex=t.bindingStartIndex,e.inI18n=!1}function $u(){const n=Ot.lFrame,e=null===n?null:n.child;return null===e?Kh(n):e}function Kh(n){const e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return null!==n&&(n.child=e),e}function Yh(){const n=Ot.lFrame;return Ot.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}const Gu=Yh;function ja(){const n=Yh();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function u(){return Ot.lFrame.selectedIndex}function g(n){Ot.lFrame.selectedIndex=n}function v(){const n=Ot.lFrame;return Il(n.tView,n.selectedIndex)}function B(n,e){for(let t=e.directiveStart,s=e.directiveEnd;t<s;t++){const p=n.data[t].type.prototype,{ngAfterContentInit:y,ngAfterContentChecked:w,ngAfterViewInit:C,ngAfterViewChecked:A,ngOnDestroy:F}=p;y&&(n.contentHooks||(n.contentHooks=[])).push(-t,y),w&&((n.contentHooks||(n.contentHooks=[])).push(t,w),(n.contentCheckHooks||(n.contentCheckHooks=[])).push(t,w)),C&&(n.viewHooks||(n.viewHooks=[])).push(-t,C),A&&((n.viewHooks||(n.viewHooks=[])).push(t,A),(n.viewCheckHooks||(n.viewCheckHooks=[])).push(t,A)),null!=F&&(n.destroyHooks||(n.destroyHooks=[])).push(t,F)}}function $(n,e,t){K(n,e,3,t)}function Z(n,e,t,s){(3&n[2])===t&&K(n,e,t,s)}function W(n,e){let t=n[2];(3&t)===e&&(t&=2047,t+=1,n[2]=t)}function K(n,e,t,s){const p=s??-1,y=e.length-1;let w=0;for(let C=void 0!==s?65535&n[18]:0;C<y;C++)if("number"==typeof e[C+1]){if(w=e[C],null!=s&&w>=s)break}else e[C]<0&&(n[18]+=65536),(w<p||-1==p)&&(q(n,t,e,C),n[18]=(4294901760&n[18])+C+2),C++}function q(n,e,t,s){const c=t[s]<0,p=t[s+1],w=n[c?-t[s]:t[s]];if(c){if(n[2]>>11<n[18]>>16&&(3&n[2])===e){n[2]+=2048;try{p.call(w)}finally{}}}else try{p.call(w)}finally{}}const H=-1;class J{constructor(e,t,s){this.factory=e,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=s}}function Ze(n,e,t){let s=0;for(;s<t.length;){const c=t[s];if("number"==typeof c){if(0!==c)break;s++;const p=t[s++],y=t[s++],w=t[s++];n.setAttribute(e,y,w,p)}else{const p=c,y=t[++s];Le(p)?n.setProperty(e,p,y):n.setAttribute(e,p,y),s++}}return s}function xe(n){return 3===n||4===n||6===n}function Le(n){return 64===n.charCodeAt(0)}function Ce(n,e){if(null!==e&&0!==e.length)if(null===n||0===n.length)n=e.slice();else{let t=-1;for(let s=0;s<e.length;s++){const c=e[s];"number"==typeof c?t=c:0===t||He(n,t,c,null,-1===t||2===t?e[++s]:null)}}return n}function He(n,e,t,s,c){let p=0,y=n.length;if(-1===e)y=-1;else for(;p<n.length;){const w=n[p++];if("number"==typeof w){if(w===e){y=-1;break}if(w>e){y=p-1;break}}}for(;p<n.length;){const w=n[p];if("number"==typeof w)break;if(w===t){if(null===s)return void(null!==c&&(n[p+1]=c));if(s===n[p+1])return void(n[p+2]=c)}p++,null!==s&&p++,null!==c&&p++}-1!==y&&(n.splice(y,0,e),p=y+1),n.splice(p++,0,t),null!==s&&n.splice(p++,0,s),null!==c&&n.splice(p++,0,c)}function Pe(n){return n!==H}function Fe(n){return 32767&n}function ge(n,e){let t=function Qe(n){return n>>16}(n),s=e;for(;t>0;)s=s[15],t--;return s}let Ie=!0;function ht(n){const e=Ie;return Ie=n,e}let Zt=0;const mt={};function xn(n,e){const t=kn(n,e);if(-1!==t)return t;const s=e[1];s.firstCreatePass&&(n.injectorIndex=e.length,pn(s.data,n),pn(e,null),pn(s.blueprint,null));const c=Cn(n,e),p=n.injectorIndex;if(Pe(c)){const y=Fe(c),w=ge(c,e),C=w[1].data;for(let A=0;A<8;A++)e[p+A]=w[y+A]|C[y+A]}return e[p+8]=c,p}function pn(n,e){n.push(0,0,0,0,0,0,0,0,e)}function kn(n,e){return-1===n.injectorIndex||n.parent&&n.parent.injectorIndex===n.injectorIndex||null===e[n.injectorIndex+8]?-1:n.injectorIndex}function Cn(n,e){if(n.parent&&-1!==n.parent.injectorIndex)return n.parent.injectorIndex;let t=0,s=null,c=e;for(;null!==c;){if(s=Ll(c),null===s)return H;if(t++,c=c[15],-1!==s.injectorIndex)return s.injectorIndex|t<<16}return H}function Hi(n,e,t){!function ut(n,e,t){let s;"string"==typeof t?s=t.charCodeAt(0)||0:t.hasOwnProperty(bo)&&(s=t[bo]),null==s&&(s=t[bo]=Zt++);const c=255&s;e.data[n+(c>>5)]|=1<<c}(n,e,t)}function ar(n,e,t){if(t&$t.Optional||void 0!==n)return n;Zs()}function Do(n,e,t,s){if(t&$t.Optional&&void 0===s&&(s=null),0==(t&($t.Self|$t.Host))){const c=n[9],p=qr(void 0);try{return c?c.get(e,s,t&$t.Optional):_c(e,s,t&$t.Optional)}finally{qr(p)}}return ar(s,0,t)}function $n(n,e,t,s=$t.Default,c){if(null!==n){if(1024&e[2]){const y=function Qo(n,e,t,s,c){let p=n,y=e;for(;null!==p&&null!==y&&1024&y[2]&&!(256&y[2]);){const w=Nn(p,y,t,s|$t.Self,mt);if(w!==mt)return w;let C=p.parent;if(!C){const A=y[21];if(A){const F=A.get(t,mt,s);if(F!==mt)return F}C=Ll(y),y=y[15]}p=C}return c}(n,e,t,s,mt);if(y!==mt)return y}const p=Nn(n,e,t,s,mt);if(p!==mt)return p}return Do(e,t,s,c)}function Nn(n,e,t,s,c){const p=function Gn(n){if("string"==typeof n)return n.charCodeAt(0)||0;const e=n.hasOwnProperty(bo)?n[bo]:void 0;return"number"==typeof e?e>=0?255&e:cr:e}(t);if("function"==typeof p){if(!Xh(e,n,s))return s&$t.Host?ar(c,0,s):Do(e,t,s,c);try{const y=p(s);if(null!=y||s&$t.Optional)return y;Zs()}finally{Gu()}}else if("number"==typeof p){let y=null,w=kn(n,e),C=H,A=s&$t.Host?e[16][6]:null;for((-1===w||s&$t.SkipSelf)&&(C=-1===w?Cn(n,e):e[w+8],C!==H&&Pl(s,!1)?(y=e[1],w=Fe(C),e=ge(C,e)):w=-1);-1!==w;){const F=e[1];if(lr(p,w,F.data)){const V=bn(w,e,t,y,s,A);if(V!==mt)return V}C=e[w+8],C!==H&&Pl(s,e[1].data[w+8]===A)&&lr(p,w,e)?(y=F,w=Fe(C),e=ge(C,e)):w=-1}}return c}function bn(n,e,t,s,c,p){const y=e[1],w=y.data[n+8],F=ii(w,y,t,null==s?Iu(w)&&Ie:s!=y&&0!=(3&w.type),c&$t.Host&&p===w);return null!==F?yi(e,y,F,w):mt}function ii(n,e,t,s,c){const p=n.providerIndexes,y=e.data,w=1048575&p,C=n.directiveStart,F=p>>20,X=c?w+F:n.directiveEnd;for(let ie=s?w:w+F;ie<X;ie++){const fe=y[ie];if(ie<C&&t===fe||ie>=C&&fe.type===t)return ie}if(c){const ie=y[C];if(ie&&Xr(ie)&&ie.type===t)return C}return null}function yi(n,e,t,s){let c=n[t];const p=e.data;if(function Q(n){return n instanceof J}(c)){const y=c;y.resolving&&function hc(n,e){const t=e?`. Dependency path: ${e.join(" > ")} > ${n}`:"";throw new rt(-200,`Circular dependency in DI detected for ${n}${t}`)}(function Tn(n){return"function"==typeof n?n.name||n.toString():"object"==typeof n&&null!=n&&"function"==typeof n.type?n.type.name||n.type.toString():jt(n)}(p[t]));const w=ht(y.canSeeViewProviders);y.resolving=!0;const C=y.injectImpl?qr(y.injectImpl):null;Xh(n,s,$t.Default);try{c=n[t]=y.factory(void 0,p,n,s),e.firstCreatePass&&t>=s.directiveStart&&function k(n,e,t){const{ngOnChanges:s,ngOnInit:c,ngDoCheck:p}=e.type.prototype;if(s){const y=Na(e);(t.preOrderHooks||(t.preOrderHooks=[])).push(n,y),(t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(n,y)}c&&(t.preOrderHooks||(t.preOrderHooks=[])).push(0-n,c),p&&((t.preOrderHooks||(t.preOrderHooks=[])).push(n,p),(t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(n,p))}(t,p[t],e)}finally{null!==C&&qr(C),ht(w),y.resolving=!1,Gu()}}return c}function lr(n,e,t){return!!(t[e+(n>>5)]&1<<n)}function Pl(n,e){return!(n&$t.Self||n&$t.Host&&e)}class kr{constructor(e,t){this._tNode=e,this._lView=t}get(e,t,s){return $n(this._tNode,this._lView,e,s,t)}}function cr(){return new kr(Xn(),Je())}function Ll(n){const e=n[1],t=e.type;return 2===t?e.declTNode:1===t?n[6]:null}const ia="__parameters__";function Mc(n,e,t){return Zo(()=>{const s=function Qh(n){return function(...t){if(n){const s=n(...t);for(const c in s)this[c]=s[c]}}}(e);function c(...p){if(this instanceof c)return s.apply(this,p),this;const y=new c(...p);return w.annotation=y,w;function w(C,A,F){const V=C.hasOwnProperty(ia)?C[ia]:Object.defineProperty(C,ia,{value:[]})[ia];for(;V.length<=F;)V.push(null);return(V[F]=V[F]||[]).push(y),C}}return t&&(c.prototype=Object.create(t.prototype)),c.prototype.ngMetadataName=n,c.annotationCls=c,c})}class wn{constructor(e,t){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=Sn({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function Rr(n,e){void 0===e&&(e=n);for(let t=0;t<n.length;t++){let s=n[t];Array.isArray(s)?(e===n&&(e=n.slice(0,t)),Rr(s,e)):e!==n&&e.push(s)}return e}function _r(n,e){n.forEach(t=>Array.isArray(t)?_r(t,e):e(t))}function Jh(n,e,t){e>=n.length?n.push(t):n.splice(e,0,t)}function ed(n,e){return e>=n.length-1?n.pop():n.splice(e,1)[0]}function Hu(n,e){const t=[];for(let s=0;s<n;s++)t.push(e);return t}function Ci(n,e,t){let s=Io(n,e);return s>=0?n[1|s]=t:(s=~s,function hv(n,e,t,s){let c=n.length;if(c==e)n.push(t,s);else if(1===c)n.push(s,n[0]),n[0]=t;else{for(c--,n.push(n[c-1],n[c]);c>e;)n[c]=n[c-2],c--;n[e]=t,n[e+1]=s}}(n,s,e,t)),s}function Co(n,e){const t=Io(n,e);if(t>=0)return n[1|t]}function Io(n,e){return function Rl(n,e,t){let s=0,c=n.length>>t;for(;c!==s;){const p=s+(c-s>>1),y=n[p<<t];if(e===y)return p<<t;y>e?c=p:s=p+1}return~(c<<t)}(n,e,1)}const ai={},St="__NG_DI_FLAG__",Ts="ngTempTokenPath",fn=/\n/gm,mp="__source";let po;function Jr(n){const e=po;return po=n,e}function Jo(n,e=$t.Default){if(void 0===po)throw new rt(-203,!1);return null===po?_c(n,void 0,e):po.get(n,e&$t.Optional?null:void 0,e)}function Bt(n,e=$t.Default){return(function xu(){return vu}()||Jo)(kt(n),e)}function es(n){const e=[];for(let t=0;t<n.length;t++){const s=kt(n[t]);if(Array.isArray(s)){if(0===s.length)throw new rt(900,!1);let c,p=$t.Default;for(let y=0;y<s.length;y++){const w=s[y],C=Wu(w);"number"==typeof C?-1===C?c=w.token:p|=C:c=w}e.push(Bt(c,p))}else e.push(Bt(s))}return e}function qu(n,e){return n[St]=e,n.prototype[St]=e,n}function Wu(n){return n[St]}const gp=qu(Mc("Optional"),8),nd=qu(Mc("SkipSelf"),4);var Wi=(()=>((Wi=Wi||{})[Wi.Important=1]="Important",Wi[Wi.DashCase=2]="DashCase",Wi))();const Oc=new Map;let Mo=0;const om="__ngContext__";function Nr(n,e){rr(e)?(n[om]=e[20],function Or(n){Oc.set(n[20],n)}(e)):n[om]=e}function Dp(n,e){return undefined(n,e)}function sd(n){const e=n[3];return Eo(e)?e[3]:e}function Cp(n){return aa(n[13])}function ad(n){return aa(n[4])}function aa(n){for(;null!==n&&!Eo(n);)n=n[4];return n}function th(n,e,t,s,c){if(null!=s){let p,y=!1;Eo(s)?p=s:rr(s)&&(y=!0,s=s[0]);const w=ni(s);0===n&&null!==t?null==c?s_(e,t,w):ns(e,t,w,c||null,!0):1===n&&null!==t?ns(e,t,w,c||null,!0):2===n?function ym(n,e,t){const s=Bc(n,e);s&&function Mp(n,e,t,s){n.removeChild(e,t,s)}(n,s,e,t)}(e,w,y):3===n&&e.destroyNode(w),null!=p&&function Rp(n,e,t,s,c){const p=t[7];p!==ni(t)&&th(e,n,s,p,c);for(let w=10;w<t.length;w++){const C=t[w];dd(C[1],C,n,e,s,p)}}(e,n,p,t,c)}}function dm(n,e,t){return n.createElement(e,t)}function i_(n,e){const t=n[9],s=t.indexOf(e),c=e[3];512&e[2]&&(e[2]&=-513,Sl(c,-1)),t.splice(s,1)}function pm(n,e){if(n.length<=10)return;const t=10+e,s=n[t];if(s){const c=s[17];null!==c&&c!==n&&i_(c,s),e>0&&(n[t-1][4]=s[4]);const p=ed(n,10+e);!function cd(n,e){dd(n,e,e[11],2,null,null),e[0]=null,e[6]=null}(s[1],s);const y=p[19];null!==y&&y.detachView(p[1]),s[3]=null,s[4]=null,s[2]&=-65}return s}function r_(n,e){if(!(128&e[2])){const t=e[11];t.destroyNode&&dd(n,e,t,3,null,null),function zc(n){let e=n[13];if(!e)return fm(n[1],n);for(;e;){let t=null;if(rr(e))t=e[13];else{const s=e[10];s&&(t=s)}if(!t){for(;e&&!e[4]&&e!==n;)rr(e)&&fm(e[1],e),e=e[3];null===e&&(e=n),rr(e)&&fm(e[1],e),t=e&&e[4]}e=t}}(e)}}function fm(n,e){if(!(128&e[2])){e[2]&=-65,e[2]|=128,function Iv(n,e){let t;if(null!=n&&null!=(t=n.destroyHooks))for(let s=0;s<t.length;s+=2){const c=e[t[s]];if(!(c instanceof J)){const p=t[s+1];if(Array.isArray(p))for(let y=0;y<p.length;y+=2){const w=c[p[y]],C=p[y+1];try{C.call(w)}finally{}}else try{p.call(c)}finally{}}}}(n,e),function Cv(n,e){const t=n.cleanup,s=e[7];let c=-1;if(null!==t)for(let p=0;p<t.length-1;p+=2)if("string"==typeof t[p]){const y=t[p+1],w="function"==typeof y?y(e):ni(e[y]),C=s[c=t[p+2]],A=t[p+3];"boolean"==typeof A?w.removeEventListener(t[p],C,A):A>=0?s[c=A]():s[c=-A].unsubscribe(),p+=2}else{const y=s[c=t[p+1]];t[p].call(y)}if(null!==s){for(let p=c+1;p<s.length;p++)(0,s[p])();e[7]=null}}(n,e),1===e[1].type&&e[11].destroy();const t=e[17];if(null!==t&&Eo(e[3])){t!==e[3]&&i_(t,e);const s=e[19];null!==s&&s.detachView(n)}!function rm(n){Oc.delete(n[20])}(e)}}function Sp(n,e,t){return function o_(n,e,t){let s=e;for(;null!==s&&40&s.type;)s=(e=s).parent;if(null===s)return t[0];if(2&s.flags){const c=n.data[s.directiveStart].encapsulation;if(c===Vi.None||c===Vi.Emulated)return null}return Li(s,t)}(n,e.parent,t)}function ns(n,e,t,s,c){n.insertBefore(e,t,s,c)}function s_(n,e,t){n.appendChild(e,t)}function di(n,e,t,s,c){null!==s?ns(n,e,t,s,c):s_(n,e,t)}function Bc(n,e){return n.parentNode(e)}function nh(n,e,t){return gm(n,e,t)}let wm,gm=function mm(n,e,t){return 40&n.type?Li(n,t):null};function ih(n,e,t,s){const c=Sp(n,s,e),p=e[11],w=nh(s.parent||e[6],s,e);if(null!=c)if(Array.isArray(t))for(let C=0;C<t.length;C++)di(p,c,t[C],w,!1);else di(p,c,t,w,!1)}function Lp(n,e){if(null!==e){const t=e.type;if(3&t)return Li(e,n);if(4&t)return jc(-1,n[e.index]);if(8&t){const s=e.child;if(null!==s)return Lp(n,s);{const c=n[e.index];return Eo(c)?jc(-1,c):ni(c)}}if(32&t)return Dp(e,n)()||ni(n[e.index]);{const s=_m(n,e);return null!==s?Array.isArray(s)?s[0]:Lp(sd(n[16]),s):Lp(n,e.next)}}return null}function _m(n,e){return null!==e?n[16][6].projection[e.projection]:null}function jc(n,e){const t=10+n+1;if(t<e.length){const s=e[t],c=s[1].firstChild;if(null!==c)return Lp(s,c)}return e[7]}function hd(n,e,t,s,c,p,y){for(;null!=t;){const w=s[t.index],C=t.type;if(y&&0===e&&(w&&Nr(ni(w),s),t.flags|=4),64!=(64&t.flags))if(8&C)hd(n,e,t.child,s,c,p,!1),th(e,n,c,w,p);else if(32&C){const A=Dp(t,s);let F;for(;F=A();)th(e,n,c,F,p);th(e,n,c,w,p)}else 16&C?kp(n,e,s,t,c,p):th(e,n,c,w,p);t=y?t.projectionNext:t.next}}function dd(n,e,t,s,c,p){hd(t,s,n.firstChild,e,c,p,!1)}function kp(n,e,t,s,c,p){const y=t[16],C=y[6].projection[s.projection];if(Array.isArray(C))for(let A=0;A<C.length;A++)th(e,n,c,C[A],p);else hd(n,e,C,y[3],c,p,!0)}function a_(n,e,t){n.setAttribute(e,"style",t)}function xm(n,e,t){""===t?n.removeAttribute(e,"class"):n.setAttribute(e,"class",t)}const y_=new wn("ENVIRONMENT_INITIALIZER"),ch=new wn("INJECTOR",-1),Mm=new wn("INJECTOR_DEF_TYPES");class Am{get(e,t=ai){if(t===ai){const s=new Error(`NullInjectorError: No provider for ${In(e)}!`);throw s.name="NullInjectorError",s}return t}}function Hn(...n){return{\u0275providers:qp(0,n)}}function qp(n,...e){const t=[],s=new Set;let c;return _r(e,p=>{const y=p;Wp(y,t,[],s)&&(c||(c=[]),c.push(y))}),void 0!==c&&Pm(c,t),t}function Pm(n,e){for(let t=0;t<n.length;t++){const{providers:c}=n[t];_r(c,p=>{e.push(p)})}}function Wp(n,e,t,s){if(!(n=kt(n)))return!1;let c=null,p=vs(n);const y=!p&&Vn(n);if(p||y){if(y&&!y.standalone)return!1;c=n}else{const C=n.ngModule;if(p=vs(C),!p)return!1;c=C}const w=s.has(c);if(y){if(w)return!1;if(s.add(c),y.dependencies){const C="function"==typeof y.dependencies?y.dependencies():y.dependencies;for(const A of C)Wp(A,e,t,s)}}else{if(!p)return!1;{if(null!=p.imports&&!w){let A;s.add(c);try{_r(p.imports,F=>{Wp(F,e,t,s)&&(A||(A=[]),A.push(F))})}finally{}void 0!==A&&Pm(A,e)}if(!w){const A=Mr(c)||(()=>new c);e.push({provide:c,useFactory:A,deps:yn},{provide:Mm,useValue:c,multi:!0},{provide:y_,useValue:()=>Bt(c),multi:!0})}const C=p.providers;null==C||w||_r(C,F=>{e.push(F)})}}return c!==n&&void 0!==n.providers}const uh=_t({provide:String,useValue:_t});function Zp(n){return null!==n&&"object"==typeof n&&uh in n}function Gc(n){return"function"==typeof n}const Lm=new wn("Set Injector scope."),Xp={},Kv={};let km;function Kp(){return void 0===km&&(km=new Am),km}class Ga{}class Hc extends Ga{constructor(e,t,s,c){super(),this.parent=t,this.source=s,this.scopes=c,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Nl(e,y=>this.processProvider(y)),this.records.set(ch,Fl(void 0,this)),c.has("environment")&&this.records.set(Ga,Fl(void 0,this));const p=this.records.get(Lm);null!=p&&"string"==typeof p.value&&this.scopes.add(p.value),this.injectorDefTypes=new Set(this.get(Mm.multi,yn,$t.Self))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const e of this._ngOnDestroyHooks)e.ngOnDestroy();for(const e of this._onDestroyHooks)e()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(e){this._onDestroyHooks.push(e)}runInContext(e){this.assertNotDestroyed();const t=Jr(this),s=qr(void 0);try{return e()}finally{Jr(t),qr(s)}}get(e,t=ai,s=$t.Default){this.assertNotDestroyed();const c=Jr(this),p=qr(void 0);try{if(!(s&$t.SkipSelf)){let w=this.records.get(e);if(void 0===w){const C=function Lo(n){return"function"==typeof n||"object"==typeof n&&n instanceof wn}(e)&&hl(e);w=C&&this.injectableDefInScope(C)?Fl(Yp(e),Xp):null,this.records.set(e,w)}if(null!=w)return this.hydrate(e,w)}return(s&$t.Self?Kp():this.parent).get(e,t=s&$t.Optional&&t===ai?null:t)}catch(y){if("NullInjectorError"===y.name){if((y[Ts]=y[Ts]||[]).unshift(In(e)),c)throw y;return function Xf(n,e,t,s){const c=n[Ts];throw e[mp]&&c.unshift(e[mp]),n.message=function jg(n,e,t,s=null){n=n&&"\n"===n.charAt(0)&&"\u0275"==n.charAt(1)?n.slice(2):n;let c=In(e);if(Array.isArray(e))c=e.map(In).join(" -> ");else if("object"==typeof e){let p=[];for(let y in e)if(e.hasOwnProperty(y)){let w=e[y];p.push(y+":"+("string"==typeof w?JSON.stringify(w):In(w)))}c=`{${p.join(", ")}}`}return`${t}${s?"("+s+")":""}[${c}]: ${n.replace(fn,"\n  ")}`}("\n"+n.message,c,t,s),n.ngTokenPath=c,n[Ts]=null,n}(y,e,"R3InjectorError",this.source)}throw y}finally{qr(p),Jr(c)}}resolveInjectorInitializers(){const e=Jr(this),t=qr(void 0);try{const s=this.get(y_.multi,yn,$t.Self);for(const c of s)c()}finally{Jr(e),qr(t)}}toString(){const e=[],t=this.records;for(const s of t.keys())e.push(In(s));return`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new rt(205,!1)}processProvider(e){let t=Gc(e=kt(e))?e:kt(e&&e.provide);const s=function Qv(n){return Zp(n)?Fl(void 0,n.useValue):Fl(function b_(n,e,t){let s;if(Gc(n)){const c=kt(n);return Mr(c)||Yp(c)}if(Zp(n))s=()=>kt(n.useValue);else if(function x_(n){return!(!n||!n.useFactory)}(n))s=()=>n.useFactory(...es(n.deps||[]));else if(function v_(n){return!(!n||!n.useExisting)}(n))s=()=>Bt(kt(n.useExisting));else{const c=kt(n&&(n.useClass||n.provide));if(!function Rm(n){return!!n.deps}(n))return Mr(c)||Yp(c);s=()=>new c(...es(n.deps))}return s}(n),Xp)}(e);if(Gc(e)||!0!==e.multi)this.records.get(t);else{let c=this.records.get(t);c||(c=Fl(void 0,Xp,!0),c.factory=()=>es(c.multi),this.records.set(t,c)),t=e,c.multi.push(e)}this.records.set(t,s)}hydrate(e,t){return t.value===Xp&&(t.value=Kv,t.value=t.factory()),"object"==typeof t.value&&t.value&&function w_(n){return null!==n&&"object"==typeof n&&"function"==typeof n.ngOnDestroy}(t.value)&&this._ngOnDestroyHooks.add(t.value),t.value}injectableDefInScope(e){if(!e.providedIn)return!1;const t=kt(e.providedIn);return"string"==typeof t?"any"===t||this.scopes.has(t):this.injectorDefTypes.has(t)}}function Yp(n){const e=hl(n),t=null!==e?e.factory:Mr(n);if(null!==t)return t;if(n instanceof wn)throw new rt(204,!1);if(n instanceof Function)return function Yv(n){const e=n.length;if(e>0)throw Hu(e,"?"),new rt(204,!1);const t=function Qd(n){const e=n&&(n[Aa]||n[mc]);if(e){const t=function pl(n){if(n.hasOwnProperty("name"))return n.name;const e=(""+n).match(/^function\s*([^\s(]+)/);return null===e?"":e[1]}(n);return console.warn(`DEPRECATED: DI is instantiating a token "${t}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${t}" class.`),e}return null}(n);return null!==t?()=>t.factory(n):()=>new n}(n);throw new rt(204,!1)}function Fl(n,e,t=!1){return{factory:n,value:e,multi:t?[]:void 0}}function yd(n){return!!n.\u0275providers}function Nl(n,e){for(const t of n)Array.isArray(t)?Nl(t,e):yd(t)?Nl(t.\u0275providers,e):e(t)}class vd{}class t0{resolveComponentFactory(e){throw function Jv(n){const e=Error(`No component factory found for ${In(n)}. Did you add it to @NgModule.entryComponents?`);return e.ngComponent=n,e}(e)}}let xd=(()=>{class n{}return n.NULL=new t0,n})();function E_(){return zl(Xn(),Je())}function zl(n,e){return new Cs(Li(n,e))}let Cs=(()=>{class n{constructor(t){this.nativeElement=t}}return n.__NG_ELEMENT_ID__=E_,n})();function n0(n){return n instanceof Cs?n.nativeElement:n}class ko{}let Qp=(()=>{class n{}return n.__NG_ELEMENT_ID__=()=>function T_(){const n=Je(),t=or(Xn().index,n);return(rr(t)?t:n)[11]}(),n})(),D_=(()=>{class n{}return n.\u0275prov=Sn({token:n,providedIn:"root",factory:()=>null}),n})();class Jp{constructor(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}}const o0=new Jp("14.2.12"),Nm={};function qc(n){return n.ngOriginalError}class Wc{constructor(){this._console=console}handleError(e){const t=this._findOriginalError(e);this._console.error("ERROR",e),t&&this._console.error("ORIGINAL ERROR",t)}_findOriginalError(e){let t=e&&qc(e);for(;t&&qc(t);)t=qc(t);return t||null}}function P_(n,e,t){let s=n.length;for(;;){const c=n.indexOf(e,t);if(-1===c)return c;if(0===c||n.charCodeAt(c-1)<=32){const p=e.length;if(c+p===s||n.charCodeAt(c+p)<=32)return c}t=c+1}}const L_="ng-template";function Bm(n,e,t){let s=0;for(;s<n.length;){let c=n[s++];if(t&&"class"===c){if(c=n[s],-1!==P_(c.toLowerCase(),e,0))return!0}else if(1===c){for(;s<n.length&&"string"==typeof(c=n[s++]);)if(c.toLowerCase()===e)return!0;return!1}}return!1}function k_(n){return 4===n.type&&n.value!==L_}function Bl(n,e,t){return e===(4!==n.type||t?n.value:L_)}function R_(n,e,t){let s=4;const c=n.attrs||[],p=function u0(n){for(let e=0;e<n.length;e++)if(xe(n[e]))return e;return n.length}(c);let y=!1;for(let w=0;w<e.length;w++){const C=e[w];if("number"!=typeof C){if(!y)if(4&s){if(s=2|1&s,""!==C&&!Bl(n,C,t)||""===C&&1===e.length){if(os(s))return!1;y=!0}}else{const A=8&s?C:e[++w];if(8&s&&null!==n.attrs){if(!Bm(n.attrs,A,t)){if(os(s))return!1;y=!0}continue}const V=rf(8&s?"class":C,c,k_(n),t);if(-1===V){if(os(s))return!1;y=!0;continue}if(""!==A){let X;X=V>p?"":c[V+1].toLowerCase();const ie=8&s?X:null;if(ie&&-1!==P_(ie,A,0)||2&s&&A!==X){if(os(s))return!1;y=!0}}}}else{if(!y&&!os(s)&&!os(C))return!1;if(y&&os(C))continue;y=!1,s=C|1&s}}return os(s)||y}function os(n){return 0==(1&n)}function rf(n,e,t,s){if(null===e)return-1;let c=0;if(s||!t){let p=!1;for(;c<e.length;){const y=e[c];if(y===n)return c;if(3===y||6===y)p=!0;else{if(1===y||2===y){let w=e[++c];for(;"string"==typeof w;)w=e[++c];continue}if(4===y)break;if(0===y){c+=4;continue}}c+=p?1:2}return-1}return function O_(n,e){let t=n.indexOf(4);if(t>-1)for(t++;t<n.length;){const s=n[t];if("number"==typeof s)return-1;if(s===e)return t;t++}return-1}(e,n)}function of(n,e,t=!1){for(let s=0;s<e.length;s++)if(R_(n,e[s],t))return!0;return!1}function F_(n,e){e:for(let t=0;t<e.length;t++){const s=e[t];if(n.length===s.length){for(let c=0;c<n.length;c++)if(n[c]!==s[c])continue e;return!0}}return!1}function dh(n,e){return n?":not("+e.trim()+")":e}function Wa(n){let e=n[0],t=1,s=2,c="",p=!1;for(;t<n.length;){let y=n[t];if("string"==typeof y)if(2&s){const w=n[++t];c+="["+y+(w.length>0?'="'+w+'"':"")+"]"}else 8&s?c+="."+y:4&s&&(c+=" "+y);else""!==c&&!os(y)&&(e+=dh(p,c),c=""),s=y,p=p||!os(s);t++}return""!==c&&(e+=dh(p,c)),e}const Gt={};function Rt(n){Ro(vn(),Je(),u()+n,!1)}function Ro(n,e,t,s){if(!s)if(3==(3&e[2])){const p=n.preOrderCheckHooks;null!==p&&$(e,p,t)}else{const p=n.preOrderHooks;null!==p&&Z(e,p,0,t)}g(t)}function bd(n,e=null,t=null,s){const c=af(n,e,t,s);return c.resolveInjectorInitializers(),c}function af(n,e=null,t=null,s,c=new Set){const p=[t||yn,Hn(n)];return s=s||("object"==typeof n?void 0:In(n)),new Hc(p,e||Kp(),s||null,c)}let ss=(()=>{class n{static create(t,s){if(Array.isArray(t))return bd({name:""},s,t,"");{const c=t.name??"";return bd({name:c},t.parent,t.providers,c)}}}return n.THROW_IF_NOT_FOUND=ai,n.NULL=new Am,n.\u0275prov=Sn({token:n,providedIn:"any",factory:()=>Bt(ch)}),n.__NG_ELEMENT_ID__=-1,n})();function zt(n,e=$t.Default){const t=Je();return null===t?Bt(n,e):$n(Xn(),t,kt(n),e)}function uf(n,e){return n<<17|e<<2}function as(n){return n>>17&32767}function yh(n){return 2|n}function ls(n){return(131068&n)>>2}function vh(n,e){return-131069&n|e<<2}function Sd(n){return 1|n}function Is(n,e){const t=n.contentQueries;if(null!==t)for(let s=0;s<t.length;s+=2){const c=t[s],p=t[s+1];if(-1!==p){const y=n.data[p];ju(c),y.contentQueries(2,e[p],p)}}}function mo(n,e,t,s,c,p,y,w,C,A,F){const V=e.blueprint.slice();return V[0]=c,V[2]=76|s,(null!==F||n&&1024&n[2])&&(V[2]|=1024),Gh(V),V[3]=V[15]=n,V[8]=t,V[10]=y||n&&n[10],V[11]=w||n&&n[11],V[12]=C||n&&n[12]||null,V[9]=A||n&&n[9]||null,V[6]=p,V[20]=function od(){return Mo++}(),V[21]=F,V[16]=2==e.type?n[16]:V,V}function cs(n,e,t,s,c){let p=n.data[e];if(null===p)p=function mf(n,e,t,s,c){const p=qh(),y=Ml(),C=n.data[e]=function i(n,e,t,s,c,p){return{type:t,index:s,insertBeforeIndex:null,injectorIndex:e?e.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:c,attrs:p,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,y?p:p&&p.parent,t,e,s,c);return null===n.firstChild&&(n.firstChild=C),null!==p&&(y?null==p.child&&null!==C.parent&&(p.child=C):null===p.next&&(p.next=C)),C}(n,e,t,s,c),function Wh(){return Ot.lFrame.inI18n}()&&(p.flags|=64);else if(64&p.type){p.type=t,p.value=s,p.attrs=c;const y=function Ko(){const n=Ot.lFrame,e=n.currentTNode;return n.isParent?e:e.parent}();p.injectorIndex=null===y?-1:y.injectorIndex}return Di(p,!0),p}function Jc(n,e,t,s){if(0===t)return-1;const c=e.length;for(let p=0;p<t;p++)e.push(s),n.blueprint.push(s),n.data.push(null);return c}function eu(n,e,t){Uu(e);try{const s=n.viewQuery;null!==s&&tn(1,s,t);const c=n.template;null!==c&&eg(n,e,c,1,t),n.firstCreatePass&&(n.firstCreatePass=!1),n.staticContentQueries&&Is(n,e),n.staticViewQueries&&tn(2,n.viewQuery,t);const p=n.components;null!==p&&function Jm(n,e){for(let t=0;t<e.length;t++)nt(n,e[t])}(e,p)}catch(s){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),s}finally{e[2]&=-5,ja()}}function tu(n,e,t,s){const c=e[2];if(128!=(128&c)){Uu(e);try{Gh(e),function zu(n){return Ot.lFrame.bindingIndex=n}(n.bindingStartIndex),null!==t&&eg(n,e,t,2,s);const y=3==(3&c);if(y){const A=n.preOrderCheckHooks;null!==A&&$(e,A,null)}else{const A=n.preOrderHooks;null!==A&&Z(e,A,0,null),W(e,0)}if(function $e(n){for(let e=Cp(n);null!==e;e=ad(e)){if(!e[2])continue;const t=e[9];for(let s=0;s<t.length;s++){const c=t[s],p=c[3];0==(512&c[2])&&Sl(p,1),c[2]|=512}}}(e),function ze(n){for(let e=Cp(n);null!==e;e=ad(e))for(let t=10;t<e.length;t++){const s=e[t],c=s[1];Cc(s)&&tu(c,s,c.template,s[8])}}(e),null!==n.contentQueries&&Is(n,e),y){const A=n.contentCheckHooks;null!==A&&$(e,A)}else{const A=n.contentHooks;null!==A&&Z(e,A,1),W(e,1)}!function Ym(n,e){const t=n.hostBindingOpCodes;if(null!==t)try{for(let s=0;s<t.length;s++){const c=t[s];if(c<0)g(~c);else{const p=c,y=t[++s],w=t[++s];Ic(y,p),w(2,e[p])}}}finally{g(-1)}}(n,e);const w=n.components;null!==w&&function Qm(n,e){for(let t=0;t<e.length;t++)Ke(n,e[t])}(e,w);const C=n.viewQuery;if(null!==C&&tn(2,C,s),y){const A=n.viewCheckHooks;null!==A&&$(e,A)}else{const A=n.viewHooks;null!==A&&Z(e,A,2),W(e,2)}!0===n.firstUpdatePass&&(n.firstUpdatePass=!1),e[2]&=-41,512&e[2]&&(e[2]&=-513,Sl(e[3],-1))}finally{ja()}}}function eg(n,e,t,s,c){const p=u(),y=2&s;try{g(-1),y&&e.length>22&&Ro(n,e,22,!1),t(s,c)}finally{g(p)}}function tg(n,e,t){if(zh(e)){const c=e.directiveEnd;for(let p=e.directiveStart;p<c;p++){const y=n.data[p];y.contentQueries&&y.contentQueries(1,t[p],p)}}}function ng(n,e,t){!Hh()||(function O(n,e,t,s){const c=t.directiveStart,p=t.directiveEnd;n.firstCreatePass||xn(t,e),Nr(s,e);const y=t.initialInputs;for(let w=c;w<p;w++){const C=n.data[w],A=Xr(C);A&&le(e,t,C);const F=yi(e,n,w,t);Nr(F,e),null!==y&&ke(0,w-c,F,C,0,y),A&&(or(t.index,e)[8]=F)}}(n,e,t,Li(t,e)),128==(128&t.flags)&&function N(n,e,t){const s=t.directiveStart,c=t.directiveEnd,p=t.index,y=function Bu(){return Ot.lFrame.currentDirectiveIndex}();try{g(p);for(let w=s;w<c;w++){const C=n.data[w],A=e[w];Vu(w),(null!==C.hostBindings||0!==C.hostVars||null!==C.hostAttrs)&&j(C,A)}}finally{g(-1),Vu(y)}}(n,e,t))}function gf(n,e,t=Li){const s=e.localNames;if(null!==s){let c=e.index+1;for(let p=0;p<s.length;p+=2){const y=s[p+1],w=-1===y?t(e,n):n[y];n[c++]=w}}}function ig(n){const e=n.tView;return null===e||e.incompleteFirstPass?n.tView=rg(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts):e}function rg(n,e,t,s,c,p,y,w,C,A){const F=22+s,V=F+c,X=function og(n,e){const t=[];for(let s=0;s<e;s++)t.push(s<n?null:Gt);return t}(F,V),ie="function"==typeof A?A():A;return X[1]={type:n,blueprint:X,template:t,queries:null,viewQuery:w,declTNode:e,data:X.slice().fill(null,F),bindingStartIndex:F,expandoStartIndex:V,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof p?p():p,pipeRegistry:"function"==typeof y?y():y,firstChild:null,schemas:C,consts:ie,incompleteFirstPass:!1}}function r(n,e,t,s){const c=Kt(e);null===t?c.push(s):(c.push(t),n.firstCreatePass&&Mt(n).push(s,c.length-1))}function o(n,e,t){for(let s in n)if(n.hasOwnProperty(s)){const c=n[s];(t=null===t?{}:t).hasOwnProperty(s)?t[s].push(e,c):t[s]=[e,c]}return t}function l(n,e){const s=e.directiveEnd,c=n.data,p=e.attrs,y=[];let w=null,C=null;for(let A=e.directiveStart;A<s;A++){const F=c[A],V=F.inputs,X=null===p||k_(e)?null:Xe(V,p);y.push(X),w=o(V,A,w),C=o(F.outputs,A,C)}null!==w&&(w.hasOwnProperty("class")&&(e.flags|=16),w.hasOwnProperty("style")&&(e.flags|=32)),e.initialInputs=y,e.inputs=w,e.outputs=C}function _(n,e){const t=or(e,n);16&t[2]||(t[2]|=32)}function S(n,e,t,s){let c=!1;if(Hh()){const p=function G(n,e,t){const s=n.directiveRegistry;let c=null;if(s)for(let p=0;p<s.length;p++){const y=s[p];of(t,y.selectors,!1)&&(c||(c=[]),Hi(xn(t,e),n,y.type),Xr(y)?(ne(n,t),c.unshift(y)):c.push(y))}return c}(n,e,t),y=null===s?null:{"":-1};if(null!==p){c=!0,se(t,n.data.length,p.length);for(let F=0;F<p.length;F++){const V=p[F];V.providersResolver&&V.providersResolver(V)}let w=!1,C=!1,A=Jc(n,e,p.length,null);for(let F=0;F<p.length;F++){const V=p[F];t.mergedAttrs=Ce(t.mergedAttrs,V.hostAttrs),he(n,t,e,A,V),te(A,V,y),null!==V.contentQueries&&(t.flags|=8),(null!==V.hostBindings||null!==V.hostAttrs||0!==V.hostVars)&&(t.flags|=128);const X=V.type.prototype;!w&&(X.ngOnChanges||X.ngOnInit||X.ngDoCheck)&&((n.preOrderHooks||(n.preOrderHooks=[])).push(t.index),w=!0),!C&&(X.ngOnChanges||X.ngDoCheck)&&((n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(t.index),C=!0),A++}l(n,t)}y&&function ae(n,e,t){if(e){const s=n.localNames=[];for(let c=0;c<e.length;c+=2){const p=t[e[c+1]];if(null==p)throw new rt(-301,!1);s.push(e[c],p)}}}(t,s,y)}return t.mergedAttrs=Ce(t.mergedAttrs,t.attrs),c}function P(n,e,t,s,c,p){const y=p.hostBindings;if(y){let w=n.hostBindingOpCodes;null===w&&(w=n.hostBindingOpCodes=[]);const C=~e.index;(function L(n){let e=n.length;for(;e>0;){const t=n[--e];if("number"==typeof t&&t<0)return t}return 0})(w)!=C&&w.push(C),w.push(s,c,y)}}function j(n,e){null!==n.hostBindings&&n.hostBindings(1,e)}function ne(n,e){e.flags|=2,(n.components||(n.components=[])).push(e.index)}function te(n,e,t){if(t){if(e.exportAs)for(let s=0;s<e.exportAs.length;s++)t[e.exportAs[s]]=n;Xr(e)&&(t[""]=n)}}function se(n,e,t){n.flags|=1,n.directiveStart=e,n.directiveEnd=e+t,n.providerIndexes=e}function he(n,e,t,s,c){n.data[s]=c;const p=c.factory||(c.factory=Mr(c.type)),y=new J(p,Xr(c),zt);n.blueprint[s]=y,t[s]=y,P(n,e,0,s,Jc(n,t,c.hostVars,Gt),c)}function le(n,e,t){const s=Li(e,n),c=ig(t),p=n[10],y=ot(n,mo(n,c,null,t.onPush?32:16,s,e,p,p.createRenderer(s,t),null,null,null));n[e.index]=y}function be(n,e,t,s,c,p){const y=Li(n,e);!function Ee(n,e,t,s,c,p,y){if(null==p)n.removeAttribute(e,c,t);else{const w=null==y?jt(p):y(p,s||"",c);n.setAttribute(e,c,w,t)}}(e[11],y,p,n.value,t,s,c)}function ke(n,e,t,s,c,p){const y=p[e];if(null!==y){const w=s.setInput;for(let C=0;C<y.length;){const A=y[C++],F=y[C++],V=y[C++];null!==w?s.setInput(t,V,A,F):t[F]=V}}}function Xe(n,e){let t=null,s=0;for(;s<e.length;){const c=e[s];if(0!==c)if(5!==c){if("number"==typeof c)break;n.hasOwnProperty(c)&&(null===t&&(t=[]),t.push(c,n[c],e[s+1])),s+=2}else s+=2;else s+=4}return t}function Oe(n,e,t,s){return new Array(n,!0,!1,e,null,0,s,t,null,null)}function Ke(n,e){const t=or(e,n);if(Cc(t)){const s=t[1];48&t[2]?tu(s,t,s.template,t[8]):t[5]>0&&Me(t)}}function Me(n){for(let s=Cp(n);null!==s;s=ad(s))for(let c=10;c<s.length;c++){const p=s[c];if(Cc(p))if(512&p[2]){const y=p[1];tu(y,p,y.template,p[8])}else p[5]>0&&Me(p)}const t=n[1].components;if(null!==t)for(let s=0;s<t.length;s++){const c=or(t[s],n);Cc(c)&&c[5]>0&&Me(c)}}function nt(n,e){const t=or(e,n),s=t[1];(function Dt(n,e){for(let t=e.length;t<n.blueprint.length;t++)e.push(n.blueprint[t])})(s,t),eu(s,t,t[8])}function ot(n,e){return n[13]?n[14][4]=e:n[13]=e,n[14]=e,e}function dt(n){for(;n;){n[2]|=32;const e=sd(n);if(np(n)&&!e)return n;n=e}return null}function tt(n,e,t,s=!0){const c=e[10];c.begin&&c.begin();try{tu(n,e,n.template,t)}catch(y){throw s&&Ft(e,y),y}finally{c.end&&c.end()}}function tn(n,e,t){ju(0),e(n,t)}function Kt(n){return n[7]||(n[7]=[])}function Mt(n){return n.cleanup||(n.cleanup=[])}function Ft(n,e){const t=n[9],s=t?t.get(Wc,null):null;s&&s.handleError(e)}function nn(n,e,t,s,c){for(let p=0;p<t.length;){const y=t[p++],w=t[p++],C=e[y],A=n.data[y];null!==A.setInput?A.setInput(C,c,s,w):C[w]=c}}function zn(n,e,t){let s=t?n.styles:null,c=t?n.classes:null,p=0;if(null!==e)for(let y=0;y<e.length;y++){const w=e[y];"number"==typeof w?p=w:1==p?c=Xt(c,w):2==p&&(s=Xt(s,w+": "+e[++y]+";"))}t?n.styles=s:n.stylesWithoutHost=s,t?n.classes=c:n.classesWithoutHost=c}function Rn(n,e,t,s,c=!1){for(;null!==t;){const p=e[t.index];if(null!==p&&s.push(ni(p)),Eo(p))for(let w=10;w<p.length;w++){const C=p[w],A=C[1].firstChild;null!==A&&Rn(C[1],C,A,s)}const y=t.type;if(8&y)Rn(n,e,t.child,s);else if(32&y){const w=Dp(t,e);let C;for(;C=w();)s.push(C)}else if(16&y){const w=_m(e,t);if(Array.isArray(w))s.push(...w);else{const C=sd(e[16]);Rn(C[1],C,w,s,!0)}}t=c?t.projectionNext:t.next}return s}class On{constructor(e,t){this._lView=e,this._cdRefInjectingView=t,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const e=this._lView,t=e[1];return Rn(t,e,t.firstChild,[])}get context(){return this._lView[8]}set context(e){this._lView[8]=e}get destroyed(){return 128==(128&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const e=this._lView[3];if(Eo(e)){const t=e[8],s=t?t.indexOf(this):-1;s>-1&&(pm(e,s),ed(t,s))}this._attachedToViewContainer=!1}r_(this._lView[1],this._lView)}onDestroy(e){r(this._lView[1],this._lView,null,e)}markForCheck(){dt(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-65}reattach(){this._lView[2]|=64}detectChanges(){tt(this._lView[1],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new rt(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function n_(n,e){dd(n,e,e[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new rt(902,!1);this._appRef=e}}class Kn extends On{constructor(e){super(e),this._view=e}detectChanges(){const e=this._view;tt(e[1],e,e[8],!1)}checkNoChanges(){}get context(){return null}}class ri extends xd{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const t=Vn(e);return new oi(t,this.ngModule)}}function Oi(n){const e=[];for(let t in n)n.hasOwnProperty(t)&&e.push({propName:n[t],templateName:t});return e}class vi{constructor(e,t){this.injector=e,this.parentInjector=t}get(e,t,s){const c=this.injector.get(e,Nm,s);return c!==Nm||t===Nm?c:this.parentInjector.get(e,t,s)}}class oi extends vd{constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=function Vm(n){return n.map(Wa).join(",")}(e.selectors),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!t}get inputs(){return Oi(this.componentDef.inputs)}get outputs(){return Oi(this.componentDef.outputs)}create(e,t,s,c){let p=(c=c||this.ngModule)instanceof Ga?c:c?.injector;p&&null!==this.componentDef.getStandaloneInjector&&(p=this.componentDef.getStandaloneInjector(p)||p);const y=p?new vi(e,p):e,w=y.get(ko,null);if(null===w)throw new rt(407,!1);const C=y.get(D_,null),A=w.createRenderer(null,this.componentDef),F=this.componentDef.selectors[0][0]||"div",V=s?function ey(n,e,t){return n.selectRootElement(e,t===Vi.ShadowDom)}(A,s,this.componentDef.encapsulation):dm(A,F,function Fn(n){const e=n.toLowerCase();return"svg"===e?"svg":"math"===e?"math":null}(F)),X=this.componentDef.onPush?288:272,ie=rg(0,null,null,1,0,null,null,null,null,null),fe=mo(null,ie,null,X,null,null,w,A,C,y,null);let De,Ne;Uu(fe);try{const qe=function pi(n,e,t,s,c,p){const y=t[1];t[22]=n;const C=cs(y,22,2,"#host",null),A=C.mergedAttrs=e.hostAttrs;null!==A&&(zn(C,A,!0),null!==n&&(Ze(c,n,A),null!==C.classes&&xm(c,n,C.classes),null!==C.styles&&a_(c,n,C.styles)));const F=s.createRenderer(n,e),V=mo(t,ig(e),null,e.onPush?32:16,t[22],C,s,F,p||null,null,null);return y.firstCreatePass&&(Hi(xn(C,t),y,e.type),ne(y,C),se(C,t.length,1)),ot(t,V),t[22]=V}(V,this.componentDef,fe,w,A);if(V)if(s)Ze(A,V,["ng-version",o0.full]);else{const{attrs:ct,classes:Ve}=function ph(n){const e=[],t=[];let s=1,c=2;for(;s<n.length;){let p=n[s];if("string"==typeof p)2===c?""!==p&&e.push(p,n[++s]):8===c&&t.push(p);else{if(!os(c))break;c=p}s++}return{attrs:e,classes:t}}(this.componentDef.selectors[0]);ct&&Ze(A,V,ct),Ve&&Ve.length>0&&xm(A,V,Ve.join(" "))}if(Ne=Il(ie,22),void 0!==t){const ct=Ne.projection=[];for(let Ve=0;Ve<this.ngContentSelectors.length;Ve++){const vt=t[Ve];ct.push(null!=vt?Array.from(vt):null)}}De=function vr(n,e,t,s){const c=t[1],p=function T(n,e,t){const s=Xn();n.firstCreatePass&&(t.providersResolver&&t.providersResolver(t),he(n,s,e,Jc(n,e,1,null),t),l(n,s));const c=yi(e,n,s.directiveStart,s);Nr(c,e);const p=Li(s,e);return p&&Nr(p,e),c}(c,t,e);if(n[8]=t[8]=p,null!==s)for(const w of s)w(p,e);if(e.contentQueries){const w=Xn();e.contentQueries(1,p,w.directiveStart)}const y=Xn();return!c.firstCreatePass||null===e.hostBindings&&null===e.hostAttrs||(g(y.index),P(t[1],y,0,y.directiveStart,y.directiveEnd,e),j(e,p)),p}(qe,this.componentDef,fe,[Xi]),eu(ie,fe,null)}finally{ja()}return new Ii(this.componentType,De,zl(Ne,fe),fe,Ne)}}class Ii extends class Om{}{constructor(e,t,s,c,p){super(),this.location=s,this._rootLView=c,this._tNode=p,this.instance=t,this.hostView=this.changeDetectorRef=new Kn(c),this.componentType=e}setInput(e,t){const s=this._tNode.inputs;let c;if(null!==s&&(c=s[e])){const p=this._rootLView;nn(p[1],p,c,e,t),_(p,this._tNode.index)}}get injector(){return new kr(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}}function Xi(){const n=Xn();B(Je()[1],n)}let Eh=null;function Ja(){if(!Eh){const n=Ct.Symbol;if(n&&n.iterator)Eh=n.iterator;else{const e=Object.getOwnPropertyNames(Map.prototype);for(let t=0;t<e.length;++t){const s=e[t];"entries"!==s&&"size"!==s&&Map.prototype[s]===Map.prototype.entries&&(Eh=s)}}}return Eh}function Th(n){return!!kd(n)&&(Array.isArray(n)||!(n instanceof Map)&&Ja()in n)}function kd(n){return null!==n&&("function"==typeof n||"object"==typeof n)}function us(n,e,t){return n[e]=t}function Rd(n,e){return n[e]}function Yn(n,e,t){return!Object.is(n[e],t)&&(n[e]=t,!0)}function Ni(n,e,t,s){const c=Yn(n,e,t);return Yn(n,e+1,s)||c}function go(n,e,t,s,c,p){const y=Ni(n,e,t,s);return Ni(n,e+2,c,p)||y}function pa(n,e,t,s){const c=Je();return Yn(c,ta(),e)&&(vn(),be(v(),c,n,e,t,s)),pa}function Pn(n,e,t,s,c,p,y,w){const C=Je(),A=vn(),F=n+22,V=A.firstCreatePass?function mD(n,e,t,s,c,p,y,w,C){const A=e.consts,F=cs(e,n,4,y||null,Xo(A,w));S(e,t,F,Xo(A,C)),B(e,F);const V=F.tViews=rg(2,F,s,c,p,e.directiveRegistry,e.pipeRegistry,null,e.schemas,A);return null!==e.queries&&(e.queries.template(e,F),V.queries=e.queries.embeddedTView(F)),F}(F,A,C,e,t,s,c,p,y):A.data[F];Di(V,!1);const X=C[11].createComment("");ih(A,C,X,V),Nr(X,C),ot(C,C[F]=Oe(X,C,X,V)),xl(V)&&ng(A,C,V),null!=y&&gf(C,V,w)}function Ht(n,e,t){const s=Je();return Yn(s,ta(),e)&&function m(n,e,t,s,c,p,y,w){const C=Li(e,t);let F,A=e.inputs;!w&&null!=A&&(F=A[s])?(nn(n,t,F,s,c),Iu(e)&&_(t,e.index)):3&e.type&&(s=function h(n){return"class"===n?"className":"for"===n?"htmlFor":"formaction"===n?"formAction":"innerHtml"===n?"innerHTML":"readonly"===n?"readOnly":"tabindex"===n?"tabIndex":n}(s),c=null!=y?y(c,e.value||"",s):c,p.setProperty(C,s,c))}(vn(),v(),s,n,e,s[11],t,!1),Ht}function I0(n,e,t,s,c){const y=c?"class":"style";nn(n,t,e.inputs[y],y,s)}function Be(n,e,t,s){const c=Je(),p=vn(),y=22+n,w=c[11],C=c[y]=dm(w,e,function R(){return Ot.lFrame.currentNamespace}()),A=p.firstCreatePass?function yD(n,e,t,s,c,p,y){const w=e.consts,A=cs(e,n,2,c,Xo(w,p));return S(e,t,A,Xo(w,y)),null!==A.attrs&&zn(A,A.attrs,!1),null!==A.mergedAttrs&&zn(A,A.mergedAttrs,!0),null!==e.queries&&e.queries.elementStart(e,A),A}(y,p,c,0,e,t,s):p.data[y];Di(A,!0);const F=A.mergedAttrs;null!==F&&Ze(w,C,F);const V=A.classes;null!==V&&xm(w,C,V);const X=A.styles;return null!==X&&a_(w,C,X),64!=(64&A.flags)&&ih(p,c,C,A),0===function sp(){return Ot.lFrame.elementDepthCount}()&&Nr(C,c),function ap(){Ot.lFrame.elementDepthCount++}(),xl(A)&&(ng(p,c,A),tg(p,A,c)),null!==s&&gf(c,A),Be}function Ge(){let n=Xn();Ml()?lt():(n=n.parent,Di(n,!1));const e=n;!function Nu(){Ot.lFrame.elementDepthCount--}();const t=vn();return t.firstCreatePass&&(B(t,n),zh(n)&&t.queries.elementEnd(n)),null!=e.classesWithoutHost&&function me(n){return 0!=(16&n.flags)}(e)&&I0(t,e,Je(),e.classesWithoutHost,!0),null!=e.stylesWithoutHost&&function Se(n){return 0!=(32&n.flags)}(e)&&I0(t,e,Je(),e.stylesWithoutHost,!1),Ge}function Nt(n,e,t,s){return Be(n,e,t,s),Ge(),Nt}function S0(n,e,t){const s=Je(),c=vn(),p=n+22,y=c.firstCreatePass?function vD(n,e,t,s,c){const p=e.consts,y=Xo(p,s),w=cs(e,n,8,"ng-container",y);return null!==y&&zn(w,y,!0),S(e,t,w,Xo(p,c)),null!==e.queries&&e.queries.elementStart(e,w),w}(p,c,s,e,t):c.data[p];Di(y,!0);const w=s[p]=s[11].createComment("");return ih(c,s,w,y),Nr(w,s),xl(y)&&(ng(c,s,y),tg(c,y,s)),null!=t&&gf(s,y),S0}function M0(){let n=Xn();const e=vn();return Ml()?lt():(n=n.parent,Di(n,!1)),e.firstCreatePass&&(B(e,n),zh(n)&&e.queries.elementEnd(n)),M0}function Df(n,e,t){return S0(n,e,t),M0(),Df}function iu(){return Je()}function A0(n){return!!n&&"function"==typeof n.then}const xD=function j1(n){return!!n&&"function"==typeof n.subscribe};function Fo(n,e,t,s){const c=Je(),p=vn(),y=Xn();return function $1(n,e,t,s,c,p,y,w){const C=xl(s),F=n.firstCreatePass&&Mt(n),V=e[8],X=Kt(e);let ie=!0;if(3&s.type||w){const Ne=Li(s,e),qe=w?w(Ne):Ne,ct=X.length,Ve=w?gn=>w(ni(gn[s.index])):s.index;let vt=null;if(!w&&C&&(vt=function bD(n,e,t,s){const c=n.cleanup;if(null!=c)for(let p=0;p<c.length-1;p+=2){const y=c[p];if(y===t&&c[p+1]===s){const w=e[7],C=c[p+2];return w.length>C?w[C]:null}"string"==typeof y&&(p+=2)}return null}(n,e,c,s.index)),null!==vt)(vt.__ngLastListenerFn__||vt).__ngNextListenerFn__=p,vt.__ngLastListenerFn__=p,ie=!1;else{p=H1(s,e,V,p,!1);const gn=t.listen(qe,c,p);X.push(p,gn),F&&F.push(c,Ve,ct,ct+1)}}else p=H1(s,e,V,p,!1);const fe=s.outputs;let De;if(ie&&null!==fe&&(De=fe[c])){const Ne=De.length;if(Ne)for(let qe=0;qe<Ne;qe+=2){const Bn=e[De[qe]][De[qe+1]].subscribe(p),Mi=X.length;X.push(p,Bn),F&&F.push(c,s.index,Mi,-(Mi+1))}}}(p,c,c[11],y,n,e,0,s),Fo}function G1(n,e,t,s){try{return!1!==t(s)}catch(c){return Ft(n,c),!1}}function H1(n,e,t,s,c){return function p(y){if(y===Function)return s;dt(2&n.flags?or(n.index,e):e);let C=G1(e,0,s,y),A=p.__ngNextListenerFn__;for(;A;)C=G1(e,0,A,y)&&C,A=A.__ngNextListenerFn__;return c&&!1===C&&(y.preventDefault(),y.returnValue=!1),C}}function fi(n=1){return function f(n){return(Ot.lFrame.contextLView=function a(n,e){for(;n>0;)e=e[15],n--;return e}(n,Ot.lFrame.contextLView))[8]}(n)}function wD(n,e){let t=null;const s=function c0(n){const e=n.attrs;if(null!=e){const t=e.indexOf(5);if(0==(1&t))return e[t+1]}return null}(n);for(let c=0;c<e.length;c++){const p=e[c];if("*"!==p){if(null===s?of(n,p,!0):F_(s,p))return c}else t=c}return t}function ag(n){const e=Je()[16][6];if(!e.projection){const s=e.projection=Hu(n?n.length:1,null),c=s.slice();let p=e.child;for(;null!==p;){const y=n?wD(p,n):0;null!==y&&(c[y]?c[y].projectionNext=p:s[y]=p,c[y]=p),p=p.next}}}function Od(n,e=0,t){const s=Je(),c=vn(),p=cs(c,22+n,16,null,t||null);null===p.projection&&(p.projection=e),lt(),64!=(64&p.flags)&&function vm(n,e,t){kp(e[11],0,e,t,Sp(n,t,e),nh(t.parent||e[6],t,e))}(c,s,p)}function tb(n,e,t,s,c){const p=n[t+1],y=null===e;let w=s?as(p):ls(p),C=!1;for(;0!==w&&(!1===C||y);){const F=n[w+1];DD(n[w],e)&&(C=!0,n[w+1]=s?Sd(F):yh(F)),w=s?as(F):ls(F)}C&&(n[t+1]=s?yh(p):Sd(p))}function DD(n,e){return null===n||null==e||(Array.isArray(n)?n[1]:n)===e||!(!Array.isArray(n)||"string"!=typeof e)&&Io(n,e)>=0}const br={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function nb(n){return n.substring(br.key,br.keyEnd)}function ib(n,e){const t=br.textEnd;return t===e?-1:(e=br.keyEnd=function MD(n,e,t){for(;e<t&&n.charCodeAt(e)>32;)e++;return e}(n,br.key=e,t),Cf(n,e,t))}function Cf(n,e,t){for(;e<t&&n.charCodeAt(e)<=32;)e++;return e}function Fd(n){!function nl(n,e,t,s){const c=vn(),p=function To(n){const e=Ot.lFrame,t=e.bindingIndex;return e.bindingIndex=e.bindingIndex+n,t}(2);c.firstUpdatePass&&function hb(n,e,t,s){const c=n.data;if(null===c[t+1]){const p=c[u()],y=ub(n,t);mb(p,s)&&null===e&&!y&&(e=!1),e=function kD(n,e,t,s){const c=function Sc(n){const e=Ot.lFrame.currentDirectiveIndex;return-1===e?null:n[e]}(n);let p=s?e.residualClasses:e.residualStyles;if(null===c)0===(s?e.classBindings:e.styleBindings)&&(t=lg(t=L0(null,n,e,t,s),e.attrs,s),p=null);else{const y=e.directiveStylingLast;if(-1===y||n[y]!==c)if(t=L0(c,n,e,t,s),null===p){let C=function RD(n,e,t){const s=t?e.classBindings:e.styleBindings;if(0!==ls(s))return n[as(s)]}(n,e,s);void 0!==C&&Array.isArray(C)&&(C=L0(null,n,e,C[1],s),C=lg(C,e.attrs,s),function OD(n,e,t,s){n[as(t?e.classBindings:e.styleBindings)]=s}(n,e,s,C))}else p=function FD(n,e,t){let s;const c=e.directiveEnd;for(let p=1+e.directiveStylingLast;p<c;p++)s=lg(s,n[p].hostAttrs,t);return lg(s,e.attrs,t)}(n,e,s)}return void 0!==p&&(s?e.residualClasses=p:e.residualStyles=p),t}(c,p,e,s),function ED(n,e,t,s,c,p){let y=p?e.classBindings:e.styleBindings,w=as(y),C=ls(y);n[s]=t;let F,A=!1;if(Array.isArray(t)){const V=t;F=V[1],(null===F||Io(V,F)>0)&&(A=!0)}else F=t;if(c)if(0!==C){const X=as(n[w+1]);n[s+1]=uf(X,w),0!==X&&(n[X+1]=vh(n[X+1],s)),n[w+1]=function y0(n,e){return 131071&n|e<<17}(n[w+1],s)}else n[s+1]=uf(w,0),0!==w&&(n[w+1]=vh(n[w+1],s)),w=s;else n[s+1]=uf(C,0),0===w?w=s:n[C+1]=vh(n[C+1],s),C=s;A&&(n[s+1]=yh(n[s+1])),tb(n,F,s,!0),tb(n,F,s,!1),function TD(n,e,t,s,c){const p=c?n.residualClasses:n.residualStyles;null!=p&&"string"==typeof e&&Io(p,e)>=0&&(t[s+1]=Sd(t[s+1]))}(e,F,n,s,p),y=uf(w,C),p?e.classBindings=y:e.styleBindings=y}(c,p,e,t,y,s)}}(c,null,p,s);const y=Je();if(t!==Gt&&Yn(y,p,t)){const w=c.data[u()];if(mb(w,s)&&!ub(c,p)){let C=s?w.classesWithoutHost:w.stylesWithoutHost;null!==C&&(t=Xt(C,t||"")),I0(c,w,y,t,s)}else!function zD(n,e,t,s,c,p,y,w){c===Gt&&(c=yn);let C=0,A=0,F=0<c.length?c[0]:null,V=0<p.length?p[0]:null;for(;null!==F||null!==V;){const X=C<c.length?c[C+1]:void 0,ie=A<p.length?p[A+1]:void 0;let De,fe=null;F===V?(C+=2,A+=2,X!==ie&&(fe=V,De=ie)):null===V||null!==F&&F<V?(C+=2,fe=F):(A+=2,fe=V,De=ie),null!==fe&&pb(n,e,t,s,fe,De,y,w),F=C<c.length?c[C]:null,V=A<p.length?p[A]:null}}(c,w,y,y[11],y[p+1],y[p+1]=function ND(n,e,t){if(null==t||""===t)return yn;const s=[],c=function is(n){return n instanceof class zp{constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}?n.changingThisBreaksApplicationSecurity:n}(t);if(Array.isArray(c))for(let p=0;p<c.length;p++)n(s,c[p],!0);else if("object"==typeof c)for(const p in c)c.hasOwnProperty(p)&&n(s,p,c[p]);else"string"==typeof c&&e(s,c);return s}(n,e,t),s,p)}}(Ci,Hl,n,!0)}function Hl(n,e){for(let t=function ID(n){return function ob(n){br.key=0,br.keyEnd=0,br.value=0,br.valueEnd=0,br.textEnd=n.length}(n),ib(n,Cf(n,0,br.textEnd))}(e);t>=0;t=ib(e,t))Ci(n,nb(e),!0)}function ub(n,e){return e>=n.expandoStartIndex}function L0(n,e,t,s,c){let p=null;const y=t.directiveEnd;let w=t.directiveStylingLast;for(-1===w?w=t.directiveStart:w++;w<y&&(p=e[w],s=lg(s,p.hostAttrs,c),p!==n);)w++;return null!==n&&(t.directiveStylingLast=w),s}function lg(n,e,t){const s=t?1:2;let c=-1;if(null!==e)for(let p=0;p<e.length;p++){const y=e[p];"number"==typeof y?c=y:c===s&&(Array.isArray(n)||(n=void 0===n?[]:["",n]),Ci(n,y,!!t||e[++p]))}return void 0===n?null:n}function pb(n,e,t,s,c,p,y,w){if(!(3&e.type))return;const C=n.data,A=C[w+1];ry(function Z_(n){return 1==(1&n)}(A)?fb(C,e,t,c,ls(A),y):void 0)||(ry(p)||function W_(n){return 2==(2&n)}(A)&&(p=fb(C,null,t,c,w,y)),function Mv(n,e,t,s,c){if(e)c?n.addClass(t,s):n.removeClass(t,s);else{let p=-1===s.indexOf("-")?void 0:Wi.DashCase;null==c?n.removeStyle(t,s,p):("string"==typeof c&&c.endsWith("!important")&&(c=c.slice(0,-10),p|=Wi.Important),n.setStyle(t,s,c,p))}}(s,y,Tc(u(),t),c,p))}function fb(n,e,t,s,c,p){const y=null===e;let w;for(;c>0;){const C=n[c],A=Array.isArray(C),F=A?C[1]:C,V=null===F;let X=t[c+1];X===Gt&&(X=V?yn:void 0);let ie=V?Co(X,s):F===s?X:void 0;if(A&&!ry(ie)&&(ie=Co(C,s)),ry(ie)&&(w=ie,y))return w;const fe=n[c+1];c=y?as(fe):ls(fe)}if(null!==e){let C=p?e.residualClasses:e.residualStyles;null!=C&&(w=Co(C,s))}return w}function ry(n){return void 0!==n}function mb(n,e){return 0!=(n.flags&(e?16:32))}function Ye(n,e=""){const t=Je(),s=vn(),c=n+22,p=s.firstCreatePass?cs(s,c,1,e,null):s.data[c],y=t[c]=function ld(n,e){return n.createText(e)}(t[11],e);ih(s,t,y,p),Di(p,!1)}function cg(n){return k0("",n,""),cg}function k0(n,e,t){const s=Je(),c=function _f(n,e,t,s){return Yn(n,ta(),t)?e+jt(t)+s:Gt}(s,n,e,t);return c!==Gt&&function un(n,e,t){const s=Tc(e,n);!function t_(n,e,t){n.setValue(e,t)}(n[11],s,t)}(s,u(),c),k0}const Sf="en-US";let Nb=Sf;class Mf{}class cw extends Mf{constructor(e,t){super(),this._parent=t,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new ri(this);const s=function ir(n,e){const t=n[Tu]||null;if(!t&&!0===e)throw new Error(`Type ${In(n)} does not have '\u0275mod' property.`);return t}(e);this._bootstrapComponents=function qa(n){return n instanceof Function?n():n}(s.bootstrap),this._r3Injector=af(e,t,[{provide:Mf,useValue:this},{provide:xd,useValue:this.componentFactoryResolver}],In(e),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(e)}get injector(){return this._r3Injector}destroy(){const e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}}class V0 extends class oI{}{constructor(e){super(),this.moduleType=e}create(e){return new cw(this.moduleType,e)}}function U0(n,e,t){const s=Gi()+n,c=Je();return c[s]===Gt?us(c,s,t?e.call(t):e()):Rd(c,s)}function _w(n,e,t,s){return function bw(n,e,t,s,c,p){const y=e+t;return Yn(n,y,c)?us(n,y+1,p?s.call(p,c):s(c)):mg(n,y+1)}(Je(),Gi(),n,e,t,s)}function yw(n,e,t,s,c){return function ww(n,e,t,s,c,p,y){const w=e+t;return Ni(n,w,c,p)?us(n,w+2,y?s.call(y,c,p):s(c,p)):mg(n,w+2)}(Je(),Gi(),n,e,t,s,c)}function $0(n,e,t,s,c,p,y){return function Tw(n,e,t,s,c,p,y,w,C){const A=e+t;return go(n,A,c,p,y,w)?us(n,A+4,C?s.call(C,c,p,y,w):s(c,p,y,w)):mg(n,A+4)}(Je(),Gi(),n,e,t,s,c,p,y)}function xw(n,e,t,s){return function Dw(n,e,t,s,c,p){let y=e+t,w=!1;for(let C=0;C<c.length;C++)Yn(n,y++,c[C])&&(w=!0);return w?us(n,y,s.apply(p,c)):mg(n,y)}(Je(),Gi(),n,e,t,s)}function mg(n,e){const t=n[e];return t===Gt?void 0:t}function G0(n){return e=>{setTimeout(n,void 0,e)}}const wr=class MI extends $o{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,t,s){let c=e,p=t||(()=>null),y=s;if(e&&"object"==typeof e){const C=e;c=C.next?.bind(C),p=C.error?.bind(C),y=C.complete?.bind(C)}this.__isAsync&&(p=G0(p),c&&(c=G0(c)),y&&(y=G0(y)));const w=super.subscribe({next:c,error:p,complete:y});return e instanceof Ue&&e.add(w),w}};function AI(){return this._results[Ja()]()}class H0{constructor(e=!1){this._emitDistinctChangesOnly=e,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const t=Ja(),s=H0.prototype;s[t]||(s[t]=AI)}get changes(){return this._changes||(this._changes=new wr)}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,t){return this._results.reduce(e,t)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,t){const s=this;s.dirty=!1;const c=Rr(e);(this._changesDetected=!function Zf(n,e,t){if(n.length!==e.length)return!1;for(let s=0;s<n.length;s++){let c=n[s],p=e[s];if(t&&(c=t(c),p=t(p)),p!==c)return!1}return!0}(s._results,c,t))&&(s._results=c,s.length=c.length,s.last=c[this.length-1],s.first=c[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let ql=(()=>{class n{}return n.__NG_ELEMENT_ID__=kI,n})();const PI=ql,LI=class extends PI{constructor(e,t,s){super(),this._declarationLView=e,this._declarationTContainer=t,this.elementRef=s}createEmbeddedView(e,t){const s=this._declarationTContainer.tViews,c=mo(this._declarationLView,s,e,16,null,s.declTNode,null,null,null,null,t||null);c[17]=this._declarationLView[this._declarationTContainer.index];const y=this._declarationLView[19];return null!==y&&(c[19]=y.createEmbeddedView(s)),eu(s,c,e),new On(c)}};function kI(){return cy(Xn(),Je())}function cy(n,e){return 4&n.type?new LI(e,n,zl(n,e)):null}let Wl=(()=>{class n{}return n.__NG_ELEMENT_ID__=RI,n})();function RI(){return Sw(Xn(),Je())}const OI=Wl,Cw=class extends OI{constructor(e,t,s){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=s}get element(){return zl(this._hostTNode,this._hostLView)}get injector(){return new kr(this._hostTNode,this._hostLView)}get parentInjector(){const e=Cn(this._hostTNode,this._hostLView);if(Pe(e)){const t=ge(e,this._hostLView),s=Fe(e);return new kr(t[1].data[s+8],t)}return new kr(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){const t=Iw(this._lContainer);return null!==t&&t[e]||null}get length(){return this._lContainer.length-10}createEmbeddedView(e,t,s){let c,p;"number"==typeof s?c=s:null!=s&&(c=s.index,p=s.injector);const y=e.createEmbeddedView(t||{},p);return this.insert(y,c),y}createComponent(e,t,s,c,p){const y=e&&!function kl(n){return"function"==typeof n}(e);let w;if(y)w=t;else{const V=t||{};w=V.index,s=V.injector,c=V.projectableNodes,p=V.environmentInjector||V.ngModuleRef}const C=y?e:new oi(Vn(e)),A=s||this.parentInjector;if(!p&&null==C.ngModule){const X=(y?A:this.parentInjector).get(Ga,null);X&&(p=X)}const F=C.create(A,c,void 0,p);return this.insert(F.hostView,w),F}insert(e,t){const s=e._lView,c=s[1];if(function $h(n){return Eo(n[3])}(s)){const F=this.indexOf(e);if(-1!==F)this.detach(F);else{const V=s[3],X=new Cw(V,V[6],V[3]);X.detach(X.indexOf(e))}}const p=this._adjustIndex(t),y=this._lContainer;!function ud(n,e,t,s){const c=10+s,p=t.length;s>0&&(t[c-1][4]=e),s<p-10?(e[4]=t[c],Jh(t,10+s,e)):(t.push(e),e[4]=null),e[3]=t;const y=e[17];null!==y&&t!==y&&function Dv(n,e){const t=n[9];e[16]!==e[3][3][16]&&(n[2]=!0),null===t?n[9]=[e]:t.push(e)}(y,e);const w=e[19];null!==w&&w.insertView(n),e[2]|=64}(c,s,y,p);const w=jc(p,y),C=s[11],A=Bc(C,y[7]);return null!==A&&function Ip(n,e,t,s,c,p){s[0]=c,s[6]=e,dd(n,s,t,1,c,p)}(c,y[6],C,s,A,w),e.attachToViewContainerRef(),Jh(q0(y),p,e),e}move(e,t){return this.insert(e,t)}indexOf(e){const t=Iw(this._lContainer);return null!==t?t.indexOf(e):-1}remove(e){const t=this._adjustIndex(e,-1),s=pm(this._lContainer,t);s&&(ed(q0(this._lContainer),t),r_(s[1],s))}detach(e){const t=this._adjustIndex(e,-1),s=pm(this._lContainer,t);return s&&null!=ed(q0(this._lContainer),t)?new On(s):null}_adjustIndex(e,t=0){return e??this.length+t}};function Iw(n){return n[8]}function q0(n){return n[8]||(n[8]=[])}function Sw(n,e){let t;const s=e[n.index];if(Eo(s))t=s;else{let c;if(8&n.type)c=ni(s);else{const p=e[11];c=p.createComment("");const y=Li(n,e);ns(p,Bc(p,y),c,function Ap(n,e){return n.nextSibling(e)}(p,y),!1)}e[n.index]=t=Oe(s,e,c,n),ot(e,t)}return new Cw(t,n,e)}class W0{constructor(e){this.queryList=e,this.matches=null}clone(){return new W0(this.queryList)}setDirty(){this.queryList.setDirty()}}class Z0{constructor(e=[]){this.queries=e}createEmbeddedView(e){const t=e.queries;if(null!==t){const s=null!==e.contentQueries?e.contentQueries[0]:t.length,c=[];for(let p=0;p<s;p++){const y=t.getByIndex(p);c.push(this.queries[y.indexInDeclarationView].clone())}return new Z0(c)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let t=0;t<this.queries.length;t++)null!==kw(e,t).matches&&this.queries[t].setDirty()}}class Mw{constructor(e,t,s=null){this.predicate=e,this.flags=t,this.read=s}}class X0{constructor(e=[]){this.queries=e}elementStart(e,t){for(let s=0;s<this.queries.length;s++)this.queries[s].elementStart(e,t)}elementEnd(e){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(e)}embeddedTView(e){let t=null;for(let s=0;s<this.length;s++){const c=null!==t?t.length:0,p=this.getByIndex(s).embeddedTView(e,c);p&&(p.indexInDeclarationView=s,null!==t?t.push(p):t=[p])}return null!==t?new X0(t):null}template(e,t){for(let s=0;s<this.queries.length;s++)this.queries[s].template(e,t)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}}class K0{constructor(e,t=-1){this.metadata=e,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(e,t){this.isApplyingToNode(t)&&this.matchTNode(e,t)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,t){this.elementStart(e,t)}embeddedTView(e,t){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,t),new K0(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const t=this._declarationNodeIndex;let s=e.parent;for(;null!==s&&8&s.type&&s.index!==t;)s=s.parent;return t===(null!==s?s.index:-1)}return this._appliesToNextNode}matchTNode(e,t){const s=this.metadata.predicate;if(Array.isArray(s))for(let c=0;c<s.length;c++){const p=s[c];this.matchTNodeWithReadOption(e,t,zI(t,p)),this.matchTNodeWithReadOption(e,t,ii(t,e,p,!1,!1))}else s===ql?4&t.type&&this.matchTNodeWithReadOption(e,t,-1):this.matchTNodeWithReadOption(e,t,ii(t,e,s,!1,!1))}matchTNodeWithReadOption(e,t,s){if(null!==s){const c=this.metadata.read;if(null!==c)if(c===Cs||c===Wl||c===ql&&4&t.type)this.addMatch(t.index,-2);else{const p=ii(t,e,c,!1,!1);null!==p&&this.addMatch(t.index,p)}else this.addMatch(t.index,s)}}addMatch(e,t){null===this.matches?this.matches=[e,t]:this.matches.push(e,t)}}function zI(n,e){const t=n.localNames;if(null!==t)for(let s=0;s<t.length;s+=2)if(t[s]===e)return t[s+1];return null}function VI(n,e,t,s){return-1===t?function BI(n,e){return 11&n.type?zl(n,e):4&n.type?cy(n,e):null}(e,n):-2===t?function jI(n,e,t){return t===Cs?zl(e,n):t===ql?cy(e,n):t===Wl?Sw(e,n):void 0}(n,e,s):yi(n,n[1],t,e)}function Aw(n,e,t,s){const c=e[19].queries[s];if(null===c.matches){const p=n.data,y=t.matches,w=[];for(let C=0;C<y.length;C+=2){const A=y[C];w.push(A<0?null:VI(e,p[A],y[C+1],t.metadata.read))}c.matches=w}return c.matches}function Y0(n,e,t,s){const c=n.queries.getByIndex(t),p=c.matches;if(null!==p){const y=Aw(n,e,c,t);for(let w=0;w<p.length;w+=2){const C=p[w];if(C>0)s.push(y[w/2]);else{const A=p[w+1],F=e[-C];for(let V=10;V<F.length;V++){const X=F[V];X[17]===X[3]&&Y0(X[1],X,A,s)}if(null!==F[9]){const V=F[9];for(let X=0;X<V.length;X++){const ie=V[X];Y0(ie[1],ie,A,s)}}}}}return s}function Dh(n){const e=Je(),t=vn(),s=Zh();ju(s+1);const c=kw(t,s);if(n.dirty&&function Dc(n){return 4==(4&n[2])}(e)===(2==(2&c.metadata.flags))){if(null===c.matches)n.reset([]);else{const p=c.crossesNgTemplate?Y0(t,e,s,[]):Aw(t,e,c,s);n.reset(p,n0),n.notifyOnChanges()}return!0}return!1}function uy(n,e,t){const s=vn();s.firstCreatePass&&(Lw(s,new Mw(n,e,t),-1),2==(2&e)&&(s.staticViewQueries=!0)),Pw(s,Je(),e)}function _g(n,e,t,s){const c=vn();if(c.firstCreatePass){const p=Xn();Lw(c,new Mw(e,t,s),p.index),function $I(n,e){const t=n.contentQueries||(n.contentQueries=[]);e!==(t.length?t[t.length-1]:-1)&&t.push(n.queries.length-1,e)}(c,n),2==(2&t)&&(c.staticContentQueries=!0)}Pw(c,Je(),t)}function Ch(){return function UI(n,e){return n[19].queries[e].queryList}(Je(),Zh())}function Pw(n,e,t){const s=new H0(4==(4&t));r(n,e,s,s.destroy),null===e[19]&&(e[19]=new Z0),e[19].queries.push(new W0(s))}function Lw(n,e,t){null===n.queries&&(n.queries=new X0),n.queries.track(new K0(e,t))}function kw(n,e){return n.queries.getByIndex(e)}function dy(...n){}const Qw=new wn("Application Initializer");let py=(()=>{class n{constructor(t){this.appInits=t,this.resolve=dy,this.reject=dy,this.initialized=!1,this.done=!1,this.donePromise=new Promise((s,c)=>{this.resolve=s,this.reject=c})}runInitializers(){if(this.initialized)return;const t=[],s=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let c=0;c<this.appInits.length;c++){const p=this.appInits[c]();if(A0(p))t.push(p);else if(xD(p)){const y=new Promise((w,C)=>{p.subscribe({complete:w,error:C})});t.push(y)}}Promise.all(t).then(()=>{s()}).catch(c=>{this.reject(c)}),0===t.length&&s(),this.initialized=!0}}return n.\u0275fac=function(t){return new(t||n)(Bt(Qw,8))},n.\u0275prov=Sn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const vg=new wn("AppId",{providedIn:"root",factory:function Jw(){return`${nx()}${nx()}${nx()}`}});function nx(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const eE=new wn("Platform Initializer"),tE=new wn("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),uS=new wn("appBootstrapListener"),nE=new wn("AnimationModuleType"),ru=new wn("LocaleId",{providedIn:"root",factory:()=>function Vg(n,e=$t.Default){return"number"!=typeof e&&(e=0|(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)),Bt(n,e)}(ru,$t.Optional|$t.SkipSelf)||function hS(){return typeof $localize<"u"&&$localize.locale||Sf}()}),gS=(()=>Promise.resolve(0))();function ix(n){typeof Zone>"u"?gS.then(()=>{n&&n.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",n)}class Yi{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:s=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new wr(!1),this.onMicrotaskEmpty=new wr(!1),this.onStable=new wr(!1),this.onError=new wr(!1),typeof Zone>"u")throw new rt(908,!1);Zone.assertZonePatched();const c=this;if(c._nesting=0,c._outer=c._inner=Zone.current,Zone.AsyncStackTaggingZoneSpec){const p=Zone.AsyncStackTaggingZoneSpec;c._inner=c._inner.fork(new p("Angular"))}Zone.TaskTrackingZoneSpec&&(c._inner=c._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(c._inner=c._inner.fork(Zone.longStackTraceZoneSpec)),c.shouldCoalesceEventChangeDetection=!s&&t,c.shouldCoalesceRunChangeDetection=s,c.lastRequestAnimationFrameId=-1,c.nativeRequestAnimationFrame=function _S(){let n=Ct.requestAnimationFrame,e=Ct.cancelAnimationFrame;if(typeof Zone<"u"&&n&&e){const t=n[Zone.__symbol__("OriginalDelegate")];t&&(n=t);const s=e[Zone.__symbol__("OriginalDelegate")];s&&(e=s)}return{nativeRequestAnimationFrame:n,nativeCancelAnimationFrame:e}}().nativeRequestAnimationFrame,function xS(n){const e=()=>{!function vS(n){n.isCheckStableRunning||-1!==n.lastRequestAnimationFrameId||(n.lastRequestAnimationFrameId=n.nativeRequestAnimationFrame.call(Ct,()=>{n.fakeTopEventTask||(n.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{n.lastRequestAnimationFrameId=-1,ox(n),n.isCheckStableRunning=!0,rx(n),n.isCheckStableRunning=!1},void 0,()=>{},()=>{})),n.fakeTopEventTask.invoke()}),ox(n))}(n)};n._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(t,s,c,p,y,w)=>{try{return oE(n),t.invokeTask(c,p,y,w)}finally{(n.shouldCoalesceEventChangeDetection&&"eventTask"===p.type||n.shouldCoalesceRunChangeDetection)&&e(),sE(n)}},onInvoke:(t,s,c,p,y,w,C)=>{try{return oE(n),t.invoke(c,p,y,w,C)}finally{n.shouldCoalesceRunChangeDetection&&e(),sE(n)}},onHasTask:(t,s,c,p)=>{t.hasTask(c,p),s===c&&("microTask"==p.change?(n._hasPendingMicrotasks=p.microTask,ox(n),rx(n)):"macroTask"==p.change&&(n.hasPendingMacrotasks=p.macroTask))},onHandleError:(t,s,c,p)=>(t.handleError(c,p),n.runOutsideAngular(()=>n.onError.emit(p)),!1)})}(c)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Yi.isInAngularZone())throw new rt(909,!1)}static assertNotInAngularZone(){if(Yi.isInAngularZone())throw new rt(909,!1)}run(e,t,s){return this._inner.run(e,t,s)}runTask(e,t,s,c){const p=this._inner,y=p.scheduleEventTask("NgZoneEvent: "+c,e,yS,dy,dy);try{return p.runTask(y,t,s)}finally{p.cancelTask(y)}}runGuarded(e,t,s){return this._inner.runGuarded(e,t,s)}runOutsideAngular(e){return this._outer.run(e)}}const yS={};function rx(n){if(0==n._nesting&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function ox(n){n.hasPendingMicrotasks=!!(n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&-1!==n.lastRequestAnimationFrameId)}function oE(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function sE(n){n._nesting--,rx(n)}class bS{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new wr,this.onMicrotaskEmpty=new wr,this.onStable=new wr,this.onError=new wr}run(e,t,s){return e.apply(t,s)}runGuarded(e,t,s){return e.apply(t,s)}runOutsideAngular(e){return e()}runTask(e,t,s,c){return e.apply(t,s)}}const aE=new wn(""),fy=new wn("");let lx,sx=(()=>{class n{constructor(t,s,c){this._ngZone=t,this.registry=s,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,lx||(function wS(n){lx=n}(c),c.addToWindow(s)),this._watchAngularEvents(),t.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Yi.assertNotInAngularZone(),ix(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())ix(()=>{for(;0!==this._callbacks.length;){let t=this._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb(this._didWork)}this._didWork=!1});else{let t=this.getPendingTasks();this._callbacks=this._callbacks.filter(s=>!s.updateCb||!s.updateCb(t)||(clearTimeout(s.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(t=>({source:t.source,creationLocation:t.creationLocation,data:t.data})):[]}addCallback(t,s,c){let p=-1;s&&s>0&&(p=setTimeout(()=>{this._callbacks=this._callbacks.filter(y=>y.timeoutId!==p),t(this._didWork,this.getPendingTasks())},s)),this._callbacks.push({doneCb:t,timeoutId:p,updateCb:c})}whenStable(t,s,c){if(c&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(t,s,c),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(t){this.registry.registerApplication(t,this)}unregisterApplication(t){this.registry.unregisterApplication(t)}findProviders(t,s,c){return[]}}return n.\u0275fac=function(t){return new(t||n)(Bt(Yi),Bt(ax),Bt(fy))},n.\u0275prov=Sn({token:n,factory:n.\u0275fac}),n})(),ax=(()=>{class n{constructor(){this._applications=new Map}registerApplication(t,s){this._applications.set(t,s)}unregisterApplication(t){this._applications.delete(t)}unregisterAllApplications(){this._applications.clear()}getTestability(t){return this._applications.get(t)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(t,s=!0){return lx?.findTestabilityInTree(this,t,s)??null}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Sn({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})(),Ih=null;const lE=new wn("AllowMultipleToken"),cx=new wn("PlatformDestroyListeners");function uE(n,e,t=[]){const s=`Platform: ${e}`,c=new wn(s);return(p=[])=>{let y=ux();if(!y||y.injector.get(lE,!1)){const w=[...t,...p,{provide:c,useValue:!0}];n?n(w):function DS(n){if(Ih&&!Ih.get(lE,!1))throw new rt(400,!1);Ih=n;const e=n.get(dE);(function cE(n){const e=n.get(eE,null);e&&e.forEach(t=>t())})(n)}(function hE(n=[],e){return ss.create({name:e,providers:[{provide:Lm,useValue:"platform"},{provide:cx,useValue:new Set([()=>Ih=null])},...n]})}(w,s))}return function IS(n){const e=ux();if(!e)throw new rt(401,!1);return e}()}}function ux(){return Ih?.get(dE)??null}let dE=(()=>{class n{constructor(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(t,s){const c=function fE(n,e){let t;return t="noop"===n?new bS:("zone.js"===n?void 0:n)||new Yi(e),t}(s?.ngZone,function pE(n){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!n||!n.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!n||!n.ngZoneRunCoalescing)||!1}}(s)),p=[{provide:Yi,useValue:c}];return c.run(()=>{const y=ss.create({providers:p,parent:this.injector,name:t.moduleType.name}),w=t.create(y),C=w.injector.get(Wc,null);if(!C)throw new rt(402,!1);return c.runOutsideAngular(()=>{const A=c.onError.subscribe({next:F=>{C.handleError(F)}});w.onDestroy(()=>{gy(this._modules,w),A.unsubscribe()})}),function mE(n,e,t){try{const s=t();return A0(s)?s.catch(c=>{throw e.runOutsideAngular(()=>n.handleError(c)),c}):s}catch(s){throw e.runOutsideAngular(()=>n.handleError(s)),s}}(C,c,()=>{const A=w.injector.get(py);return A.runInitializers(),A.donePromise.then(()=>(function zb(n){Bi(n,"Expected localeId to be defined"),"string"==typeof n&&(Nb=n.toLowerCase().replace(/_/g,"-"))}(w.injector.get(ru,Sf)||Sf),this._moduleDoBootstrap(w),w))})})}bootstrapModule(t,s=[]){const c=gE({},s);return function ES(n,e,t){const s=new V0(t);return Promise.resolve(s)}(0,0,t).then(p=>this.bootstrapModuleFactory(p,c))}_moduleDoBootstrap(t){const s=t.injector.get(my);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(c=>s.bootstrap(c));else{if(!t.instance.ngDoBootstrap)throw new rt(403,!1);t.instance.ngDoBootstrap(s)}this._modules.push(t)}onDestroy(t){this._destroyListeners.push(t)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new rt(404,!1);this._modules.slice().forEach(s=>s.destroy()),this._destroyListeners.forEach(s=>s());const t=this._injector.get(cx,null);t&&(t.forEach(s=>s()),t.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return n.\u0275fac=function(t){return new(t||n)(Bt(ss))},n.\u0275prov=Sn({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();function gE(n,e){return Array.isArray(e)?e.reduce(gE,n):{...n,...e}}let my=(()=>{class n{constructor(t,s,c){this._zone=t,this._injector=s,this._exceptionHandler=c,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const p=new _n(w=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{w.next(this._stable),w.complete()})}),y=new _n(w=>{let C;this._zone.runOutsideAngular(()=>{C=this._zone.onStable.subscribe(()=>{Yi.assertNotInAngularZone(),ix(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,w.next(!0))})})});const A=this._zone.onUnstable.subscribe(()=>{Yi.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{w.next(!1)}))});return()=>{C.unsubscribe(),A.unsubscribe()}});this.isStable=pr(p,y.pipe(function st(n={}){const{connector:e=(()=>new $o),resetOnError:t=!0,resetOnComplete:s=!0,resetOnRefCountZero:c=!0}=n;return p=>{let y,w,C,A=0,F=!1,V=!1;const X=()=>{w?.unsubscribe(),w=void 0},ie=()=>{X(),y=C=void 0,F=V=!1},fe=()=>{const De=y;ie(),De?.unsubscribe()};return io((De,Ne)=>{A++,!V&&!F&&X();const qe=C=C??e();Ne.add(()=>{A--,0===A&&!V&&!F&&(w=ln(fe,c))}),qe.subscribe(Ne),!y&&A>0&&(y=new va({next:ct=>qe.next(ct),error:ct=>{V=!0,X(),w=ln(ie,t,ct),qe.error(ct)},complete:()=>{F=!0,X(),w=ln(ie,s),qe.complete()}}),Y(De).subscribe(y))})(p)}}()))}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(t,s){const c=t instanceof vd;if(!this._injector.get(py).done)throw!c&&function Ys(n){const e=Vn(n)||nr(n)||mr(n);return null!==e&&e.standalone}(t),new rt(405,false);let y;y=c?t:this._injector.get(xd).resolveComponentFactory(t),this.componentTypes.push(y.componentType);const w=function TS(n){return n.isBoundToModule}(y)?void 0:this._injector.get(Mf),A=y.create(ss.NULL,[],s||y.selector,w),F=A.location.nativeElement,V=A.injector.get(aE,null);return V?.registerApplication(F),A.onDestroy(()=>{this.detachView(A.hostView),gy(this.components,A),V?.unregisterApplication(F)}),this._loadComponent(A),A}tick(){if(this._runningTick)throw new rt(101,!1);try{this._runningTick=!0;for(let t of this._views)t.detectChanges()}catch(t){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(t))}finally{this._runningTick=!1}}attachView(t){const s=t;this._views.push(s),s.attachToAppRef(this)}detachView(t){const s=t;gy(this._views,s),s.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t),this._injector.get(uS,[]).concat(this._bootstrapListeners).forEach(c=>c(t))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(t=>t()),this._views.slice().forEach(t=>t.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(t){return this._destroyListeners.push(t),()=>gy(this._destroyListeners,t)}destroy(){if(this._destroyed)throw new rt(406,!1);const t=this._injector;t.destroy&&!t.destroyed&&t.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return n.\u0275fac=function(t){return new(t||n)(Bt(Yi),Bt(Ga),Bt(Wc))},n.\u0275prov=Sn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function gy(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}let yE=!0,bE=(()=>{class n{}return n.__NG_ELEMENT_ID__=AS,n})();function AS(n){return function PS(n,e,t){if(Iu(n)&&!t){const s=or(n.index,e);return new On(s,s)}return 47&n.type?new On(e[16],e):null}(Xn(),Je(),16==(16&n))}class TE{constructor(){}supports(e){return Th(e)}create(e){return new NS(e)}}const FS=(n,e)=>e;class NS{constructor(e){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=e||FS}forEachItem(e){let t;for(t=this._itHead;null!==t;t=t._next)e(t)}forEachOperation(e){let t=this._itHead,s=this._removalsHead,c=0,p=null;for(;t||s;){const y=!s||t&&t.currentIndex<CE(s,c,p)?t:s,w=CE(y,c,p),C=y.currentIndex;if(y===s)c--,s=s._nextRemoved;else if(t=t._next,null==y.previousIndex)c++;else{p||(p=[]);const A=w-c,F=C-c;if(A!=F){for(let X=0;X<A;X++){const ie=X<p.length?p[X]:p[X]=0,fe=ie+X;F<=fe&&fe<A&&(p[X]=ie+1)}p[y.previousIndex]=F-A}}w!==C&&e(y,w,C)}}forEachPreviousItem(e){let t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachMovedItem(e){let t;for(t=this._movesHead;null!==t;t=t._nextMoved)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}forEachIdentityChange(e){let t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)e(t)}diff(e){if(null==e&&(e=[]),!Th(e))throw new rt(900,!1);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let c,p,y,t=this._itHead,s=!1;if(Array.isArray(e)){this.length=e.length;for(let w=0;w<this.length;w++)p=e[w],y=this._trackByFn(w,p),null!==t&&Object.is(t.trackById,y)?(s&&(t=this._verifyReinsertion(t,p,y,w)),Object.is(t.item,p)||this._addIdentityChange(t,p)):(t=this._mismatch(t,p,y,w),s=!0),t=t._next}else c=0,function sg(n,e){if(Array.isArray(n))for(let t=0;t<n.length;t++)e(n[t]);else{const t=n[Ja()]();let s;for(;!(s=t.next()).done;)e(s.value)}}(e,w=>{y=this._trackByFn(c,w),null!==t&&Object.is(t.trackById,y)?(s&&(t=this._verifyReinsertion(t,w,y,c)),Object.is(t.item,w)||this._addIdentityChange(t,w)):(t=this._mismatch(t,w,y,c),s=!0),t=t._next,c++}),this.length=c;return this._truncate(t),this.collection=e,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,t,s,c){let p;return null===e?p=this._itTail:(p=e._prev,this._remove(e)),null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(s,null))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,p,c)):null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(s,c))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,p,c)):e=this._addAfter(new zS(t,s),p,c),e}_verifyReinsertion(e,t,s,c){let p=null===this._unlinkedRecords?null:this._unlinkedRecords.get(s,null);return null!==p?e=this._reinsertAfter(p,e._prev,c):e.currentIndex!=c&&(e.currentIndex=c,this._addToMoves(e,c)),e}_truncate(e){for(;null!==e;){const t=e._next;this._addToRemovals(this._unlink(e)),e=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,t,s){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);const c=e._prevRemoved,p=e._nextRemoved;return null===c?this._removalsHead=p:c._nextRemoved=p,null===p?this._removalsTail=c:p._prevRemoved=c,this._insertAfter(e,t,s),this._addToMoves(e,s),e}_moveAfter(e,t,s){return this._unlink(e),this._insertAfter(e,t,s),this._addToMoves(e,s),e}_addAfter(e,t,s){return this._insertAfter(e,t,s),this._additionsTail=null===this._additionsTail?this._additionsHead=e:this._additionsTail._nextAdded=e,e}_insertAfter(e,t,s){const c=null===t?this._itHead:t._next;return e._next=c,e._prev=t,null===c?this._itTail=e:c._prev=e,null===t?this._itHead=e:t._next=e,null===this._linkedRecords&&(this._linkedRecords=new DE),this._linkedRecords.put(e),e.currentIndex=s,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);const t=e._prev,s=e._next;return null===t?this._itHead=s:t._next=s,null===s?this._itTail=t:s._prev=t,e}_addToMoves(e,t){return e.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=e:this._movesTail._nextMoved=e),e}_addToRemovals(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new DE),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,t){return e.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=e:this._identityChangesTail._nextIdentityChange=e,e}}class zS{constructor(e,t){this.item=e,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class BS{constructor(){this._head=null,this._tail=null}add(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,t){let s;for(s=this._head;null!==s;s=s._nextDup)if((null===t||t<=s.currentIndex)&&Object.is(s.trackById,e))return s;return null}remove(e){const t=e._prevDup,s=e._nextDup;return null===t?this._head=s:t._nextDup=s,null===s?this._tail=t:s._prevDup=t,null===this._head}}class DE{constructor(){this.map=new Map}put(e){const t=e.trackById;let s=this.map.get(t);s||(s=new BS,this.map.set(t,s)),s.add(e)}get(e,t){const c=this.map.get(e);return c?c.get(e,t):null}remove(e){const t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function CE(n,e,t){const s=n.previousIndex;if(null===s)return s;let c=0;return t&&s<t.length&&(c=t[s]),s+e+c}class IE{constructor(){}supports(e){return e instanceof Map||kd(e)}create(){return new VS}}class VS{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(e){let t;for(t=this._mapHead;null!==t;t=t._next)e(t)}forEachPreviousItem(e){let t;for(t=this._previousMapHead;null!==t;t=t._nextPrevious)e(t)}forEachChangedItem(e){let t;for(t=this._changesHead;null!==t;t=t._nextChanged)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}diff(e){if(e){if(!(e instanceof Map||kd(e)))throw new rt(900,!1)}else e=new Map;return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t=this._mapHead;if(this._appendAfter=null,this._forEach(e,(s,c)=>{if(t&&t.key===c)this._maybeAddToChanges(t,s),this._appendAfter=t,t=t._next;else{const p=this._getOrCreateRecordForKey(c,s);t=this._insertBeforeOrAppend(t,p)}}),t){t._prev&&(t._prev._next=null),this._removalsHead=t;for(let s=t;null!==s;s=s._nextRemoved)s===this._mapHead&&(this._mapHead=null),this._records.delete(s.key),s._nextRemoved=s._next,s.previousValue=s.currentValue,s.currentValue=null,s._prev=null,s._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(e,t){if(e){const s=e._prev;return t._next=e,t._prev=s,e._prev=t,s&&(s._next=t),e===this._mapHead&&(this._mapHead=t),this._appendAfter=e,e}return this._appendAfter?(this._appendAfter._next=t,t._prev=this._appendAfter):this._mapHead=t,this._appendAfter=t,null}_getOrCreateRecordForKey(e,t){if(this._records.has(e)){const c=this._records.get(e);this._maybeAddToChanges(c,t);const p=c._prev,y=c._next;return p&&(p._next=y),y&&(y._prev=p),c._next=null,c._prev=null,c}const s=new jS(e);return this._records.set(e,s),s.currentValue=t,this._addToAdditions(s),s}_reset(){if(this.isDirty){let e;for(this._previousMapHead=this._mapHead,e=this._previousMapHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._changesHead;null!==e;e=e._nextChanged)e.previousValue=e.currentValue;for(e=this._additionsHead;null!=e;e=e._nextAdded)e.previousValue=e.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(e,t){Object.is(t,e.currentValue)||(e.previousValue=e.currentValue,e.currentValue=t,this._addToChanges(e))}_addToAdditions(e){null===this._additionsHead?this._additionsHead=this._additionsTail=e:(this._additionsTail._nextAdded=e,this._additionsTail=e)}_addToChanges(e){null===this._changesHead?this._changesHead=this._changesTail=e:(this._changesTail._nextChanged=e,this._changesTail=e)}_forEach(e,t){e instanceof Map?e.forEach(t):Object.keys(e).forEach(s=>t(e[s],s))}}class jS{constructor(e){this.key=e,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function SE(){return new vy([new TE])}let vy=(()=>{class n{constructor(t){this.factories=t}static create(t,s){if(null!=s){const c=s.factories.slice();t=t.concat(c)}return new n(t)}static extend(t){return{provide:n,useFactory:s=>n.create(t,s||SE()),deps:[[n,new nd,new gp]]}}find(t){const s=this.factories.find(c=>c.supports(t));if(null!=s)return s;throw new rt(901,!1)}}return n.\u0275prov=Sn({token:n,providedIn:"root",factory:SE}),n})();function ME(){return new xg([new IE])}let xg=(()=>{class n{constructor(t){this.factories=t}static create(t,s){if(s){const c=s.factories.slice();t=t.concat(c)}return new n(t)}static extend(t){return{provide:n,useFactory:s=>n.create(t,s||ME()),deps:[[n,new nd,new gp]]}}find(t){const s=this.factories.find(c=>c.supports(t));if(s)return s;throw new rt(901,!1)}}return n.\u0275prov=Sn({token:n,providedIn:"root",factory:ME}),n})();const GS=uE(null,"core",[]);let HS=(()=>{class n{constructor(t){}}return n.\u0275fac=function(t){return new(t||n)(Bt(my))},n.\u0275mod=fr({type:n}),n.\u0275inj=Hr({}),n})(),xy=null;function bg(){return xy}const rl=new wn("DocumentToken");let Tx=(()=>{class n{constructor(t,s,c,p){this._iterableDiffers=t,this._keyValueDiffers=s,this._ngEl=c,this._renderer=p,this._iterableDiffer=null,this._keyValueDiffer=null,this._initialClasses=[],this._rawClass=null}set klass(t){this._removeClasses(this._initialClasses),this._initialClasses="string"==typeof t?t.split(/\s+/):[],this._applyClasses(this._initialClasses),this._applyClasses(this._rawClass)}set ngClass(t){this._removeClasses(this._rawClass),this._applyClasses(this._initialClasses),this._iterableDiffer=null,this._keyValueDiffer=null,this._rawClass="string"==typeof t?t.split(/\s+/):t,this._rawClass&&(Th(this._rawClass)?this._iterableDiffer=this._iterableDiffers.find(this._rawClass).create():this._keyValueDiffer=this._keyValueDiffers.find(this._rawClass).create())}ngDoCheck(){if(this._iterableDiffer){const t=this._iterableDiffer.diff(this._rawClass);t&&this._applyIterableChanges(t)}else if(this._keyValueDiffer){const t=this._keyValueDiffer.diff(this._rawClass);t&&this._applyKeyValueChanges(t)}}_applyKeyValueChanges(t){t.forEachAddedItem(s=>this._toggleClass(s.key,s.currentValue)),t.forEachChangedItem(s=>this._toggleClass(s.key,s.currentValue)),t.forEachRemovedItem(s=>{s.previousValue&&this._toggleClass(s.key,!1)})}_applyIterableChanges(t){t.forEachAddedItem(s=>{if("string"!=typeof s.item)throw new Error(`NgClass can only toggle CSS classes expressed as strings, got ${In(s.item)}`);this._toggleClass(s.item,!0)}),t.forEachRemovedItem(s=>this._toggleClass(s.item,!1))}_applyClasses(t){t&&(Array.isArray(t)||t instanceof Set?t.forEach(s=>this._toggleClass(s,!0)):Object.keys(t).forEach(s=>this._toggleClass(s,!!t[s])))}_removeClasses(t){t&&(Array.isArray(t)||t instanceof Set?t.forEach(s=>this._toggleClass(s,!1)):Object.keys(t).forEach(s=>this._toggleClass(s,!1)))}_toggleClass(t,s){(t=t.trim())&&t.split(/\s+/g).forEach(c=>{s?this._renderer.addClass(this._ngEl.nativeElement,c):this._renderer.removeClass(this._ngEl.nativeElement,c)})}}return n.\u0275fac=function(t){return new(t||n)(zt(vy),zt(xg),zt(Cs),zt(Qp))},n.\u0275dir=Pi({type:n,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"},standalone:!0}),n})(),Ay=(()=>{class n{constructor(t,s){this._viewContainer=t,this._context=new zM,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=s}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){UE("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){UE("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(t,s){return!0}}return n.\u0275fac=function(t){return new(t||n)(zt(Wl),zt(ql))},n.\u0275dir=Pi({type:n,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),n})();class zM{constructor(){this.$implicit=null,this.ngIf=null}}function UE(n,e){if(e&&!e.createEmbeddedView)throw new Error(`${n} must be a TemplateRef, but received '${In(e)}'.`)}let Ix=(()=>{class n{constructor(t,s,c){this._ngEl=t,this._differs=s,this._renderer=c,this._ngStyle=null,this._differ=null}set ngStyle(t){this._ngStyle=t,!this._differ&&t&&(this._differ=this._differs.find(t).create())}ngDoCheck(){if(this._differ){const t=this._differ.diff(this._ngStyle);t&&this._applyChanges(t)}}_setStyle(t,s){const[c,p]=t.split("."),y=-1===c.indexOf("-")?void 0:Wi.DashCase;null!=s?this._renderer.setStyle(this._ngEl.nativeElement,c,p?`${s}${p}`:s,y):this._renderer.removeStyle(this._ngEl.nativeElement,c,y)}_applyChanges(t){t.forEachRemovedItem(s=>this._setStyle(s.key,null)),t.forEachAddedItem(s=>this._setStyle(s.key,s.currentValue)),t.forEachChangedItem(s=>this._setStyle(s.key,s.currentValue))}}return n.\u0275fac=function(t){return new(t||n)(zt(Cs),zt(xg),zt(Qp))},n.\u0275dir=Pi({type:n,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"},standalone:!0}),n})(),Sx=(()=>{class n{constructor(t){this._viewContainerRef=t,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null,this.ngTemplateOutletInjector=null}ngOnChanges(t){if(t.ngTemplateOutlet||t.ngTemplateOutletInjector){const s=this._viewContainerRef;if(this._viewRef&&s.remove(s.indexOf(this._viewRef)),this.ngTemplateOutlet){const{ngTemplateOutlet:c,ngTemplateOutletContext:p,ngTemplateOutletInjector:y}=this;this._viewRef=s.createEmbeddedView(c,p,y?{injector:y}:void 0)}else this._viewRef=null}else this._viewRef&&t.ngTemplateOutletContext&&this.ngTemplateOutletContext&&(this._viewRef.context=this.ngTemplateOutletContext)}}return n.\u0275fac=function(t){return new(t||n)(zt(Wl))},n.\u0275dir=Pi({type:n,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},standalone:!0,features:[Fa]}),n})(),Bd=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=fr({type:n}),n.\u0275inj=Hr({}),n})();class kx extends class PA extends class ZS{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function WS(n){xy||(xy=n)}(new kx)}onAndCancel(e,t,s){return e.addEventListener(t,s,!1),()=>{e.removeEventListener(t,s,!1)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}getBaseHref(e){const t=function LA(){return Dg=Dg||document.querySelector("base"),Dg?Dg.getAttribute("href"):null}();return null==t?null:function kA(n){Ly=Ly||document.createElement("a"),Ly.setAttribute("href",n);const e=Ly.pathname;return"/"===e.charAt(0)?e:`/${e}`}(t)}resetBaseElement(){Dg=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return function kM(n,e){e=encodeURIComponent(e);for(const t of n.split(";")){const s=t.indexOf("="),[c,p]=-1==s?[t,""]:[t.slice(0,s),t.slice(s+1)];if(c.trim()===e)return decodeURIComponent(p)}return null}(document.cookie,e)}}let Ly,Dg=null;const KE=new wn("TRANSITION_ID"),OA=[{provide:Qw,useFactory:function RA(n,e,t){return()=>{t.get(py).donePromise.then(()=>{const s=bg(),c=e.querySelectorAll(`style[ng-transition="${n}"]`);for(let p=0;p<c.length;p++)s.remove(c[p])})}},deps:[KE,rl,ss],multi:!0}];let NA=(()=>{class n{build(){return new XMLHttpRequest}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Sn({token:n,factory:n.\u0275fac}),n})();const ky=new wn("EventManagerPlugins");let Ry=(()=>{class n{constructor(t,s){this._zone=s,this._eventNameToPlugin=new Map,t.forEach(c=>c.manager=this),this._plugins=t.slice().reverse()}addEventListener(t,s,c){return this._findPluginFor(s).addEventListener(t,s,c)}addGlobalEventListener(t,s,c){return this._findPluginFor(s).addGlobalEventListener(t,s,c)}getZone(){return this._zone}_findPluginFor(t){const s=this._eventNameToPlugin.get(t);if(s)return s;const c=this._plugins;for(let p=0;p<c.length;p++){const y=c[p];if(y.supports(t))return this._eventNameToPlugin.set(t,y),y}throw new Error(`No event manager plugin found for event ${t}`)}}return n.\u0275fac=function(t){return new(t||n)(Bt(ky),Bt(Yi))},n.\u0275prov=Sn({token:n,factory:n.\u0275fac}),n})();class YE{constructor(e){this._doc=e}addGlobalEventListener(e,t,s){const c=bg().getGlobalEventTarget(this._doc,e);if(!c)throw new Error(`Unsupported event target ${c} for event ${t}`);return this.addEventListener(c,t,s)}}let QE=(()=>{class n{constructor(){this._stylesSet=new Set}addStyles(t){const s=new Set;t.forEach(c=>{this._stylesSet.has(c)||(this._stylesSet.add(c),s.add(c))}),this.onStylesAdded(s)}onStylesAdded(t){}getAllStyles(){return Array.from(this._stylesSet)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Sn({token:n,factory:n.\u0275fac}),n})(),Cg=(()=>{class n extends QE{constructor(t){super(),this._doc=t,this._hostNodes=new Map,this._hostNodes.set(t.head,[])}_addStylesToHost(t,s,c){t.forEach(p=>{const y=this._doc.createElement("style");y.textContent=p,c.push(s.appendChild(y))})}addHost(t){const s=[];this._addStylesToHost(this._stylesSet,t,s),this._hostNodes.set(t,s)}removeHost(t){const s=this._hostNodes.get(t);s&&s.forEach(JE),this._hostNodes.delete(t)}onStylesAdded(t){this._hostNodes.forEach((s,c)=>{this._addStylesToHost(t,c,s)})}ngOnDestroy(){this._hostNodes.forEach(t=>t.forEach(JE))}}return n.\u0275fac=function(t){return new(t||n)(Bt(rl))},n.\u0275prov=Sn({token:n,factory:n.\u0275fac}),n})();function JE(n){bg().remove(n)}const Rx={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Ox=/%COMP%/g;function Oy(n,e,t){for(let s=0;s<e.length;s++){let c=e[s];Array.isArray(c)?Oy(n,c,t):(c=c.replace(Ox,n),t.push(c))}return t}function nT(n){return e=>{if("__ngUnwrap__"===e)return n;!1===n(e)&&(e.preventDefault(),e.returnValue=!1)}}let Fy=(()=>{class n{constructor(t,s,c){this.eventManager=t,this.sharedStylesHost=s,this.appId=c,this.rendererByCompId=new Map,this.defaultRenderer=new Fx(t)}createRenderer(t,s){if(!t||!s)return this.defaultRenderer;switch(s.encapsulation){case Vi.Emulated:{let c=this.rendererByCompId.get(s.id);return c||(c=new $A(this.eventManager,this.sharedStylesHost,s,this.appId),this.rendererByCompId.set(s.id,c)),c.applyToHost(t),c}case 1:case Vi.ShadowDom:return new GA(this.eventManager,this.sharedStylesHost,t,s);default:if(!this.rendererByCompId.has(s.id)){const c=Oy(s.id,s.styles,[]);this.sharedStylesHost.addStyles(c),this.rendererByCompId.set(s.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return n.\u0275fac=function(t){return new(t||n)(Bt(Ry),Bt(Cg),Bt(vg))},n.\u0275prov=Sn({token:n,factory:n.\u0275fac}),n})();class Fx{constructor(e){this.eventManager=e,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(e,t){return t?document.createElementNS(Rx[t]||t,e):document.createElement(e)}createComment(e){return document.createComment(e)}createText(e){return document.createTextNode(e)}appendChild(e,t){(rT(e)?e.content:e).appendChild(t)}insertBefore(e,t,s){e&&(rT(e)?e.content:e).insertBefore(t,s)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let s="string"==typeof e?document.querySelector(e):e;if(!s)throw new Error(`The selector "${e}" did not match any elements`);return t||(s.textContent=""),s}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,s,c){if(c){t=c+":"+t;const p=Rx[c];p?e.setAttributeNS(p,t,s):e.setAttribute(t,s)}else e.setAttribute(t,s)}removeAttribute(e,t,s){if(s){const c=Rx[s];c?e.removeAttributeNS(c,t):e.removeAttribute(`${s}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,s,c){c&(Wi.DashCase|Wi.Important)?e.style.setProperty(t,s,c&Wi.Important?"important":""):e.style[t]=s}removeStyle(e,t,s){s&Wi.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,s){e[t]=s}setValue(e,t){e.nodeValue=t}listen(e,t,s){return"string"==typeof e?this.eventManager.addGlobalEventListener(e,t,nT(s)):this.eventManager.addEventListener(e,t,nT(s))}}function rT(n){return"TEMPLATE"===n.tagName&&void 0!==n.content}class $A extends Fx{constructor(e,t,s,c){super(e),this.component=s;const p=Oy(c+"-"+s.id,s.styles,[]);t.addStyles(p),this.contentAttr=function VA(n){return"_ngcontent-%COMP%".replace(Ox,n)}(c+"-"+s.id),this.hostAttr=function jA(n){return"_nghost-%COMP%".replace(Ox,n)}(c+"-"+s.id)}applyToHost(e){super.setAttribute(e,this.hostAttr,"")}createElement(e,t){const s=super.createElement(e,t);return super.setAttribute(s,this.contentAttr,""),s}}class GA extends Fx{constructor(e,t,s,c){super(e),this.sharedStylesHost=t,this.hostEl=s,this.shadowRoot=s.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const p=Oy(c.id,c.styles,[]);for(let y=0;y<p.length;y++){const w=document.createElement("style");w.textContent=p[y],this.shadowRoot.appendChild(w)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,s){return super.insertBefore(this.nodeOrShadowRoot(e),t,s)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}}let HA=(()=>{class n extends YE{constructor(t){super(t)}supports(t){return!0}addEventListener(t,s,c){return t.addEventListener(s,c,!1),()=>this.removeEventListener(t,s,c)}removeEventListener(t,s,c){return t.removeEventListener(s,c)}}return n.\u0275fac=function(t){return new(t||n)(Bt(rl))},n.\u0275prov=Sn({token:n,factory:n.\u0275fac}),n})();const oT=["alt","control","meta","shift"],qA={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},WA={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey};let ZA=(()=>{class n extends YE{constructor(t){super(t)}supports(t){return null!=n.parseEventName(t)}addEventListener(t,s,c){const p=n.parseEventName(s),y=n.eventCallback(p.fullKey,c,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>bg().onAndCancel(t,p.domEventName,y))}static parseEventName(t){const s=t.toLowerCase().split("."),c=s.shift();if(0===s.length||"keydown"!==c&&"keyup"!==c)return null;const p=n._normalizeKey(s.pop());let y="",w=s.indexOf("code");if(w>-1&&(s.splice(w,1),y="code."),oT.forEach(A=>{const F=s.indexOf(A);F>-1&&(s.splice(F,1),y+=A+".")}),y+=p,0!=s.length||0===p.length)return null;const C={};return C.domEventName=c,C.fullKey=y,C}static matchEventFullKeyCode(t,s){let c=qA[t.key]||t.key,p="";return s.indexOf("code.")>-1&&(c=t.code,p="code."),!(null==c||!c)&&(c=c.toLowerCase()," "===c?c="space":"."===c&&(c="dot"),oT.forEach(y=>{y!==c&&(0,WA[y])(t)&&(p+=y+".")}),p+=c,p===s)}static eventCallback(t,s,c){return p=>{n.matchEventFullKeyCode(p,t)&&c.runGuarded(()=>s(p))}}static _normalizeKey(t){return"esc"===t?"escape":t}}return n.\u0275fac=function(t){return new(t||n)(Bt(rl))},n.\u0275prov=Sn({token:n,factory:n.\u0275fac}),n})();const QA=uE(GS,"browser",[{provide:tE,useValue:"browser"},{provide:eE,useValue:function XA(){kx.makeCurrent()},multi:!0},{provide:rl,useFactory:function YA(){return function Lv(n){wm=n}(document),document},deps:[]}]),lT=new wn(""),cT=[{provide:fy,useClass:class FA{addToWindow(e){Ct.getAngularTestability=(s,c=!0)=>{const p=e.findTestabilityInTree(s,c);if(null==p)throw new Error("Could not find testability for element.");return p},Ct.getAllAngularTestabilities=()=>e.getAllTestabilities(),Ct.getAllAngularRootElements=()=>e.getAllRootElements(),Ct.frameworkStabilizers||(Ct.frameworkStabilizers=[]),Ct.frameworkStabilizers.push(s=>{const c=Ct.getAllAngularTestabilities();let p=c.length,y=!1;const w=function(C){y=y||C,p--,0==p&&s(y)};c.forEach(function(C){C.whenStable(w)})})}findTestabilityInTree(e,t,s){return null==t?null:e.getTestability(t)??(s?bg().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null)}},deps:[]},{provide:aE,useClass:sx,deps:[Yi,ax,fy]},{provide:sx,useClass:sx,deps:[Yi,ax,fy]}],uT=[{provide:Lm,useValue:"root"},{provide:Wc,useFactory:function KA(){return new Wc},deps:[]},{provide:ky,useClass:HA,multi:!0,deps:[rl,Yi,tE]},{provide:ky,useClass:ZA,multi:!0,deps:[rl]},{provide:Fy,useClass:Fy,deps:[Ry,Cg,vg]},{provide:ko,useExisting:Fy},{provide:QE,useExisting:Cg},{provide:Cg,useClass:Cg,deps:[rl]},{provide:Ry,useClass:Ry,deps:[ky,Yi]},{provide:class pA{},useClass:NA,deps:[]},[]];let hT=(()=>{class n{constructor(t){}static withServerTransition(t){return{ngModule:n,providers:[{provide:vg,useValue:t.appId},{provide:KE,useExisting:vg},OA]}}}return n.\u0275fac=function(t){return new(t||n)(Bt(lT,12))},n.\u0275mod=fr({type:n}),n.\u0275inj=Hr({providers:[...uT,...cT],imports:[Bd,HS]}),n})();typeof window<"u"&&window;var Bx=hu(898);const mT=["*"];let yo=(()=>{class n{}return n.STARTS_WITH="startsWith",n.CONTAINS="contains",n.NOT_CONTAINS="notContains",n.ENDS_WITH="endsWith",n.EQUALS="equals",n.NOT_EQUALS="notEquals",n.IN="in",n.LESS_THAN="lt",n.LESS_THAN_OR_EQUAL_TO="lte",n.GREATER_THAN="gt",n.GREATER_THAN_OR_EQUAL_TO="gte",n.BETWEEN="between",n.IS="is",n.IS_NOT="isNot",n.BEFORE="before",n.AFTER="after",n.DATE_IS="dateIs",n.DATE_IS_NOT="dateIsNot",n.DATE_BEFORE="dateBefore",n.DATE_AFTER="dateAfter",n})(),Vx=(()=>{class n{constructor(){this.ripple=!1,this.overlayOptions={},this.filterMatchModeOptions={text:[yo.STARTS_WITH,yo.CONTAINS,yo.NOT_CONTAINS,yo.ENDS_WITH,yo.EQUALS,yo.NOT_EQUALS],numeric:[yo.EQUALS,yo.NOT_EQUALS,yo.LESS_THAN,yo.LESS_THAN_OR_EQUAL_TO,yo.GREATER_THAN,yo.GREATER_THAN_OR_EQUAL_TO],date:[yo.DATE_IS,yo.DATE_IS_NOT,yo.DATE_BEFORE,yo.DATE_AFTER]},this.translation={startsWith:"Starts with",contains:"Contains",notContains:"Not contains",endsWith:"Ends with",equals:"Equals",notEquals:"Not equals",noFilter:"No Filter",lt:"Less than",lte:"Less than or equal to",gt:"Greater than",gte:"Greater than or equal to",is:"Is",isNot:"Is not",before:"Before",after:"After",dateIs:"Date is",dateIsNot:"Date is not",dateBefore:"Date is before",dateAfter:"Date is after",clear:"Clear",apply:"Apply",matchAll:"Match All",matchAny:"Match Any",addRule:"Add Rule",removeRule:"Remove Rule",accept:"Yes",reject:"No",choose:"Choose",upload:"Upload",cancel:"Cancel",dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dateFormat:"mm/dd/yy",firstDayOfWeek:0,today:"Today",weekHeader:"Wk",weak:"Weak",medium:"Medium",strong:"Strong",passwordPrompt:"Enter a password",emptyMessage:"No results found",emptyFilterMessage:"No results found"},this.zIndex={modal:1100,overlay:1e3,menu:1e3,tooltip:1100},this.translationSource=new $o,this.translationObserver=this.translationSource.asObservable()}getTranslation(t){return this.translation[t]}setTranslation(t){this.translation={...this.translation,...t},this.translationSource.next(this.translation)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Sn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),l2=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Zn({type:n,selectors:[["p-header"]],ngContentSelectors:mT,decls:1,vars:0,template:function(t,s){1&t&&(ag(),Od(0))},encapsulation:2}),n})(),c2=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Zn({type:n,selectors:[["p-footer"]],ngContentSelectors:mT,decls:1,vars:0,template:function(t,s){1&t&&(ag(),Od(0))},encapsulation:2}),n})(),gT=(()=>{class n{constructor(t){this.template=t}getType(){return this.name}}return n.\u0275fac=function(t){return new(t||n)(zt(ql))},n.\u0275dir=Pi({type:n,selectors:[["","pTemplate",""]],inputs:{type:"type",name:["pTemplate","name"]}}),n})(),u2=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=fr({type:n}),n.\u0275inj=Hr({imports:[Bd]}),n})(),Pt=(()=>{class n{static addClass(t,s){t&&s&&(t.classList?t.classList.add(s):t.className+=" "+s)}static addMultipleClasses(t,s){if(t&&s)if(t.classList){let c=s.trim().split(" ");for(let p=0;p<c.length;p++)t.classList.add(c[p])}else{let c=s.split(" ");for(let p=0;p<c.length;p++)t.className+=" "+c[p]}}static removeClass(t,s){t&&s&&(t.classList?t.classList.remove(s):t.className=t.className.replace(new RegExp("(^|\\b)"+s.split(" ").join("|")+"(\\b|$)","gi")," "))}static hasClass(t,s){return!(!t||!s)&&(t.classList?t.classList.contains(s):new RegExp("(^| )"+s+"( |$)","gi").test(t.className))}static siblings(t){return Array.prototype.filter.call(t.parentNode.children,function(s){return s!==t})}static find(t,s){return Array.from(t.querySelectorAll(s))}static findSingle(t,s){return t?t.querySelector(s):null}static index(t){let s=t.parentNode.childNodes,c=0;for(var p=0;p<s.length;p++){if(s[p]==t)return c;1==s[p].nodeType&&c++}return-1}static indexWithinGroup(t,s){let c=t.parentNode?t.parentNode.childNodes:[],p=0;for(var y=0;y<c.length;y++){if(c[y]==t)return p;c[y].attributes&&c[y].attributes[s]&&1==c[y].nodeType&&p++}return-1}static appendOverlay(t,s,c="self"){"self"!==c&&t&&s&&this.appendChild(t,s)}static alignOverlay(t,s,c="self",p=!0){t&&s&&(p&&(t.style.minWidth||(t.style.minWidth=n.getOuterWidth(s)+"px")),"self"===c?this.relativePosition(t,s):this.absolutePosition(t,s))}static relativePosition(t,s){const c=De=>{if(De)return"relative"===getComputedStyle(De).getPropertyValue("position")?De:c(De.parentElement)},p=t.offsetParent?{width:t.offsetWidth,height:t.offsetHeight}:this.getHiddenElementDimensions(t),y=s.offsetHeight,w=s.getBoundingClientRect(),C=this.getWindowScrollTop(),A=this.getWindowScrollLeft(),F=this.getViewport(),X=c(t)?.getBoundingClientRect()||{top:-1*C,left:-1*A};let ie,fe;w.top+y+p.height>F.height?(ie=w.top-X.top-p.height,t.style.transformOrigin="bottom",w.top+ie<0&&(ie=-1*w.top)):(ie=y+w.top-X.top,t.style.transformOrigin="top"),fe=p.width>F.width?-1*(w.left-X.left):w.left-X.left+p.width>F.width?-1*(w.left-X.left+p.width-F.width):w.left-X.left,t.style.top=ie+"px",t.style.left=fe+"px"}static absolutePosition(t,s){const c=t.offsetParent?{width:t.offsetWidth,height:t.offsetHeight}:this.getHiddenElementDimensions(t),p=c.height,y=c.width,w=s.offsetHeight,C=s.offsetWidth,A=s.getBoundingClientRect(),F=this.getWindowScrollTop(),V=this.getWindowScrollLeft(),X=this.getViewport();let ie,fe;A.top+w+p>X.height?(ie=A.top+F-p,t.style.transformOrigin="bottom",ie<0&&(ie=F)):(ie=w+A.top+F,t.style.transformOrigin="top"),fe=A.left+y>X.width?Math.max(0,A.left+V+C-y):A.left+V,t.style.top=ie+"px",t.style.left=fe+"px"}static getParents(t,s=[]){return null===t.parentNode?s:this.getParents(t.parentNode,s.concat([t.parentNode]))}static getScrollableParents(t){let s=[];if(t){let c=this.getParents(t);const p=/(auto|scroll)/,y=w=>{let C=window.getComputedStyle(w,null);return p.test(C.getPropertyValue("overflow"))||p.test(C.getPropertyValue("overflowX"))||p.test(C.getPropertyValue("overflowY"))};for(let w of c){let C=1===w.nodeType&&w.dataset.scrollselectors;if(C){let A=C.split(",");for(let F of A){let V=this.findSingle(w,F);V&&y(V)&&s.push(V)}}9!==w.nodeType&&y(w)&&s.push(w)}}return s}static getHiddenElementOuterHeight(t){t.style.visibility="hidden",t.style.display="block";let s=t.offsetHeight;return t.style.display="none",t.style.visibility="visible",s}static getHiddenElementOuterWidth(t){t.style.visibility="hidden",t.style.display="block";let s=t.offsetWidth;return t.style.display="none",t.style.visibility="visible",s}static getHiddenElementDimensions(t){let s={};return t.style.visibility="hidden",t.style.display="block",s.width=t.offsetWidth,s.height=t.offsetHeight,t.style.display="none",t.style.visibility="visible",s}static scrollInView(t,s){let c=getComputedStyle(t).getPropertyValue("borderTopWidth"),p=c?parseFloat(c):0,y=getComputedStyle(t).getPropertyValue("paddingTop"),w=y?parseFloat(y):0,C=t.getBoundingClientRect(),F=s.getBoundingClientRect().top+document.body.scrollTop-(C.top+document.body.scrollTop)-p-w,V=t.scrollTop,X=t.clientHeight,ie=this.getOuterHeight(s);F<0?t.scrollTop=V+F:F+ie>X&&(t.scrollTop=V+F-X+ie)}static fadeIn(t,s){t.style.opacity=0;let c=+new Date,p=0,y=function(){p=+t.style.opacity.replace(",",".")+((new Date).getTime()-c)/s,t.style.opacity=p,c=+new Date,+p<1&&(window.requestAnimationFrame&&requestAnimationFrame(y)||setTimeout(y,16))};y()}static fadeOut(t,s){var c=1,w=50/s;let C=setInterval(()=>{(c-=w)<=0&&(c=0,clearInterval(C)),t.style.opacity=c},50)}static getWindowScrollTop(){let t=document.documentElement;return(window.pageYOffset||t.scrollTop)-(t.clientTop||0)}static getWindowScrollLeft(){let t=document.documentElement;return(window.pageXOffset||t.scrollLeft)-(t.clientLeft||0)}static matches(t,s){var c=Element.prototype;return(c.matches||c.webkitMatchesSelector||c.mozMatchesSelector||c.msMatchesSelector||function(y){return-1!==[].indexOf.call(document.querySelectorAll(y),this)}).call(t,s)}static getOuterWidth(t,s){let c=t.offsetWidth;if(s){let p=getComputedStyle(t);c+=parseFloat(p.marginLeft)+parseFloat(p.marginRight)}return c}static getHorizontalPadding(t){let s=getComputedStyle(t);return parseFloat(s.paddingLeft)+parseFloat(s.paddingRight)}static getHorizontalMargin(t){let s=getComputedStyle(t);return parseFloat(s.marginLeft)+parseFloat(s.marginRight)}static innerWidth(t){let s=t.offsetWidth,c=getComputedStyle(t);return s+=parseFloat(c.paddingLeft)+parseFloat(c.paddingRight),s}static width(t){let s=t.offsetWidth,c=getComputedStyle(t);return s-=parseFloat(c.paddingLeft)+parseFloat(c.paddingRight),s}static getInnerHeight(t){let s=t.offsetHeight,c=getComputedStyle(t);return s+=parseFloat(c.paddingTop)+parseFloat(c.paddingBottom),s}static getOuterHeight(t,s){let c=t.offsetHeight;if(s){let p=getComputedStyle(t);c+=parseFloat(p.marginTop)+parseFloat(p.marginBottom)}return c}static getHeight(t){let s=t.offsetHeight,c=getComputedStyle(t);return s-=parseFloat(c.paddingTop)+parseFloat(c.paddingBottom)+parseFloat(c.borderTopWidth)+parseFloat(c.borderBottomWidth),s}static getWidth(t){let s=t.offsetWidth,c=getComputedStyle(t);return s-=parseFloat(c.paddingLeft)+parseFloat(c.paddingRight)+parseFloat(c.borderLeftWidth)+parseFloat(c.borderRightWidth),s}static getViewport(){let t=window,s=document,c=s.documentElement,p=s.getElementsByTagName("body")[0];return{width:t.innerWidth||c.clientWidth||p.clientWidth,height:t.innerHeight||c.clientHeight||p.clientHeight}}static getOffset(t){var s=t.getBoundingClientRect();return{top:s.top+(window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0),left:s.left+(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0)}}static replaceElementWith(t,s){let c=t.parentNode;if(!c)throw"Can't replace element";return c.replaceChild(s,t)}static getUserAgent(){return navigator.userAgent}static isIE(){var t=window.navigator.userAgent;return t.indexOf("MSIE ")>0||(t.indexOf("Trident/")>0?(t.indexOf("rv:"),!0):t.indexOf("Edge/")>0)}static isIOS(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream}static isAndroid(){return/(android)/i.test(navigator.userAgent)}static isTouchDevice(){return"ontouchstart"in window||navigator.maxTouchPoints>0}static appendChild(t,s){if(this.isElement(s))s.appendChild(t);else{if(!s.el||!s.el.nativeElement)throw"Cannot append "+s+" to "+t;s.el.nativeElement.appendChild(t)}}static removeChild(t,s){if(this.isElement(s))s.removeChild(t);else{if(!s.el||!s.el.nativeElement)throw"Cannot remove "+t+" from "+s;s.el.nativeElement.removeChild(t)}}static removeElement(t){"remove"in Element.prototype?t.remove():t.parentNode.removeChild(t)}static isElement(t){return"object"==typeof HTMLElement?t instanceof HTMLElement:t&&"object"==typeof t&&null!==t&&1===t.nodeType&&"string"==typeof t.nodeName}static calculateScrollbarWidth(t){if(t){let s=getComputedStyle(t);return t.offsetWidth-t.clientWidth-parseFloat(s.borderLeftWidth)-parseFloat(s.borderRightWidth)}{if(null!==this.calculatedScrollbarWidth)return this.calculatedScrollbarWidth;let s=document.createElement("div");s.className="p-scrollbar-measure",document.body.appendChild(s);let c=s.offsetWidth-s.clientWidth;return document.body.removeChild(s),this.calculatedScrollbarWidth=c,c}}static calculateScrollbarHeight(){if(null!==this.calculatedScrollbarHeight)return this.calculatedScrollbarHeight;let t=document.createElement("div");t.className="p-scrollbar-measure",document.body.appendChild(t);let s=t.offsetHeight-t.clientHeight;return document.body.removeChild(t),this.calculatedScrollbarWidth=s,s}static invokeElementMethod(t,s,c){t[s].apply(t,c)}static clearSelection(){if(window.getSelection)window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().rangeCount>0&&window.getSelection().getRangeAt(0).getClientRects().length>0&&window.getSelection().removeAllRanges();else if(document.selection&&document.selection.empty)try{document.selection.empty()}catch{}}static getBrowser(){if(!this.browser){let t=this.resolveUserAgent();this.browser={},t.browser&&(this.browser[t.browser]=!0,this.browser.version=t.version),this.browser.chrome?this.browser.webkit=!0:this.browser.webkit&&(this.browser.safari=!0)}return this.browser}static resolveUserAgent(){let t=navigator.userAgent.toLowerCase(),s=/(chrome)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t)||[];return{browser:s[1]||"",version:s[2]||"0"}}static isInteger(t){return Number.isInteger?Number.isInteger(t):"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}static isHidden(t){return!t||null===t.offsetParent}static isVisible(t){return t&&null!=t.offsetParent}static isExist(t){return null!==t&&typeof t<"u"&&t.nodeName&&t.parentNode}static focus(t,s){t&&document.activeElement!==t&&t.focus(s)}static getFocusableElements(t){let s=n.find(t,'button:not([tabindex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden]),\n                [href][clientHeight][clientWidth]:not([tabindex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden]),\n                input:not([tabindex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden]), select:not([tabindex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden]),\n                textarea:not([tabindex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden]), [tabIndex]:not([tabIndex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden]),\n                [contenteditable]:not([tabIndex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden]):not(.p-disabled)'),c=[];for(let p of s)"none"!=getComputedStyle(p).display&&"hidden"!=getComputedStyle(p).visibility&&c.push(p);return c}static generateZIndex(){return this.zindex=this.zindex||999,++this.zindex}static getSelection(){return window.getSelection?window.getSelection().toString():document.getSelection?document.getSelection().toString():document.selection?document.selection.createRange().text:null}static getTargetElement(t,s){if(!t)return null;switch(t){case"document":return document;case"window":return window;case"@next":return s?.nextElementSibling;case"@prev":return s?.previousElementSibling;case"@parent":return s?.parentElement;case"@grandparent":return s?.parentElement.parentElement;default:const c=typeof t;if("string"===c)return document.querySelector(t);if("object"===c&&t.hasOwnProperty("nativeElement"))return this.isExist(t.nativeElement)?t.nativeElement:void 0;const y=(w=t)&&w.constructor&&w.call&&w.apply?t():t;return y&&9===y.nodeType||this.isExist(y)?y:null}var w}}return n.zindex=1e3,n.calculatedScrollbarWidth=null,n.calculatedScrollbarHeight=null,n})();class h2{constructor(e,t=(()=>{})){this.element=e,this.listener=t}bindScrollListener(){this.scrollableParents=Pt.getScrollableParents(this.element);for(let e=0;e<this.scrollableParents.length;e++)this.scrollableParents[e].addEventListener("scroll",this.listener)}unbindScrollListener(){if(this.scrollableParents)for(let e=0;e<this.scrollableParents.length;e++)this.scrollableParents[e].removeEventListener("scroll",this.listener)}destroy(){this.unbindScrollListener(),this.element=null,this.listener=null,this.scrollableParents=null}}let _T=(()=>{class n{constructor(t,s,c){this.el=t,this.zone=s,this.config=c}ngAfterViewInit(){this.config&&this.config.ripple&&this.zone.runOutsideAngular(()=>{this.create(),this.mouseDownListener=this.onMouseDown.bind(this),this.el.nativeElement.addEventListener("mousedown",this.mouseDownListener)})}onMouseDown(t){let s=this.getInk();if(!s||"none"===getComputedStyle(s,null).display)return;if(Pt.removeClass(s,"p-ink-active"),!Pt.getHeight(s)&&!Pt.getWidth(s)){let w=Math.max(Pt.getOuterWidth(this.el.nativeElement),Pt.getOuterHeight(this.el.nativeElement));s.style.height=w+"px",s.style.width=w+"px"}let c=Pt.getOffset(this.el.nativeElement),p=t.pageX-c.left+document.body.scrollTop-Pt.getWidth(s)/2,y=t.pageY-c.top+document.body.scrollLeft-Pt.getHeight(s)/2;s.style.top=y+"px",s.style.left=p+"px",Pt.addClass(s,"p-ink-active"),this.timeout=setTimeout(()=>{let w=this.getInk();w&&Pt.removeClass(w,"p-ink-active")},401)}getInk(){for(let t=0;t<this.el.nativeElement.children.length;t++)if(-1!==this.el.nativeElement.children[t].className.indexOf("p-ink"))return this.el.nativeElement.children[t];return null}resetInk(){let t=this.getInk();t&&Pt.removeClass(t,"p-ink-active")}onAnimationEnd(t){this.timeout&&clearTimeout(this.timeout),Pt.removeClass(t.currentTarget,"p-ink-active")}create(){let t=document.createElement("span");t.className="p-ink",this.el.nativeElement.appendChild(t),this.animationListener=this.onAnimationEnd.bind(this),t.addEventListener("animationend",this.animationListener)}remove(){let t=this.getInk();t&&(this.el.nativeElement.removeEventListener("mousedown",this.mouseDownListener),t.removeEventListener("animationend",this.animationListener),Pt.removeElement(t))}ngOnDestroy(){this.config&&this.config.ripple&&this.remove()}}return n.\u0275fac=function(t){return new(t||n)(zt(Cs),zt(Yi),zt(Vx,8))},n.\u0275dir=Pi({type:n,selectors:[["","pRipple",""]],hostAttrs:[1,"p-ripple","p-element"]}),n})(),yT=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=fr({type:n}),n.\u0275inj=Hr({imports:[Bd]}),n})();function d2(n,e){1&n&&Df(0)}const p2=function(n,e,t,s){return{"p-button-icon":!0,"p-button-icon-left":n,"p-button-icon-right":e,"p-button-icon-top":t,"p-button-icon-bottom":s}};function f2(n,e){if(1&n&&Nt(0,"span",4),2&n){const t=fi();Fd(t.loading?"p-button-loading-icon "+t.loadingIcon:t.icon),Ht("ngClass",$0(4,p2,"left"===t.iconPos&&t.label,"right"===t.iconPos&&t.label,"top"===t.iconPos&&t.label,"bottom"===t.iconPos&&t.label)),pa("aria-hidden",!0)}}function m2(n,e){if(1&n&&(Be(0,"span",5),Ye(1),Ge()),2&n){const t=fi();pa("aria-hidden",t.icon&&!t.label),Rt(1),cg(t.label)}}function g2(n,e){if(1&n&&(Be(0,"span",4),Ye(1),Ge()),2&n){const t=fi();Fd(t.badgeClass),Ht("ngClass",t.badgeStyleClass()),Rt(1),cg(t.badge)}}const _2=function(n,e,t,s,c){return{"p-button p-component":!0,"p-button-icon-only":n,"p-button-vertical":e,"p-disabled":t,"p-button-loading":s,"p-button-loading-label-only":c}},y2=["*"];let v2=(()=>{class n{constructor(){this.type="button",this.iconPos="left",this.loading=!1,this.loadingIcon="pi pi-spinner pi-spin",this.onClick=new wr,this.onFocus=new wr,this.onBlur=new wr}ngAfterContentInit(){this.templates.forEach(t=>{t.getType(),this.contentTemplate=t.template})}badgeStyleClass(){return{"p-badge p-component":!0,"p-badge-no-gutter":this.badge&&1===String(this.badge).length}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Zn({type:n,selectors:[["p-button"]],contentQueries:function(t,s,c){if(1&t&&_g(c,gT,4),2&t){let p;Dh(p=Ch())&&(s.templates=p)}},hostAttrs:[1,"p-element"],inputs:{type:"type",iconPos:"iconPos",icon:"icon",badge:"badge",label:"label",disabled:"disabled",loading:"loading",loadingIcon:"loadingIcon",style:"style",styleClass:"styleClass",badgeClass:"badgeClass",ariaLabel:"ariaLabel"},outputs:{onClick:"onClick",onFocus:"onFocus",onBlur:"onBlur"},ngContentSelectors:y2,decls:6,vars:17,consts:[["pRipple","",3,"ngStyle","disabled","ngClass","click","focus","blur"],[4,"ngTemplateOutlet"],[3,"ngClass","class",4,"ngIf"],["class","p-button-label",4,"ngIf"],[3,"ngClass"],[1,"p-button-label"]],template:function(t,s){1&t&&(ag(),Be(0,"button",0),Fo("click",function(p){return s.onClick.emit(p)})("focus",function(p){return s.onFocus.emit(p)})("blur",function(p){return s.onBlur.emit(p)}),Od(1),Pn(2,d2,1,0,"ng-container",1),Pn(3,f2,1,9,"span",2),Pn(4,m2,2,2,"span",3),Pn(5,g2,2,4,"span",2),Ge()),2&t&&(Fd(s.styleClass),Ht("ngStyle",s.style)("disabled",s.disabled||s.loading)("ngClass",function vw(n,e,t,s,c,p,y,w){const C=Gi()+n,A=Je(),F=go(A,C,t,s,c,p);return Yn(A,C+4,y)||F?us(A,C+5,w?e.call(w,t,s,c,p,y):e(t,s,c,p,y)):Rd(A,C+5)}(11,_2,s.icon&&!s.label,("top"===s.iconPos||"bottom"===s.iconPos)&&s.label,s.disabled||s.loading,s.loading,s.loading&&!s.icon&&s.label)),pa("type",s.type)("aria-label",s.ariaLabel),Rt(2),Ht("ngTemplateOutlet",s.contentTemplate),Rt(1),Ht("ngIf",!s.contentTemplate&&(s.icon||s.loading)),Rt(1),Ht("ngIf",!s.contentTemplate&&s.label),Rt(1),Ht("ngIf",!s.contentTemplate&&s.badge))},dependencies:[Tx,Ay,Sx,Ix,_T],encapsulation:2,changeDetection:0}),n})(),x2=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=fr({type:n}),n.\u0275inj=Hr({imports:[Bd,yT]}),n})();class vT{}const au="*";function w2(n,e){return{type:7,name:n,definitions:e,options:{}}}function xT(n,e=null){return{type:4,styles:e,timings:n}}function bT(n,e=null){return{type:2,steps:n,options:e}}function Ny(n){return{type:6,styles:n,offset:null}}function wT(n,e,t=null){return{type:1,expr:n,animation:e,options:t}}function ET(n,e=null){return{type:8,animation:n,options:e}}function TT(n,e=null){return{type:10,animation:n,options:e}}function DT(n){Promise.resolve().then(n)}class Ig{constructor(e=0,t=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=e+t}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){DT(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(e=>e()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(e){this._position=this.totalTime?e*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(s=>s()),t.length=0}}class CT{constructor(e){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=e;let t=0,s=0,c=0;const p=this.players.length;0==p?DT(()=>this._onFinish()):this.players.forEach(y=>{y.onDone(()=>{++t==p&&this._onFinish()}),y.onDestroy(()=>{++s==p&&this._onDestroy()}),y.onStart(()=>{++c==p&&this._onStart()})}),this.totalTime=this.players.reduce((y,w)=>Math.max(y,w.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this.players.forEach(e=>e.init())}onStart(e){this._onStartFns.push(e)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(e=>e()),this._onStartFns=[])}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(e=>e.play())}pause(){this.players.forEach(e=>e.pause())}restart(){this.players.forEach(e=>e.restart())}finish(){this._onFinish(),this.players.forEach(e=>e.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(e=>e.destroy()),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this.players.forEach(e=>e.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(e){const t=e*this.totalTime;this.players.forEach(s=>{const c=s.totalTime?Math.min(1,t/s.totalTime):1;s.setPosition(c)})}getPosition(){const e=this.players.reduce((t,s)=>null===t||s.totalTime>t.totalTime?s:t,null);return null!=e?e.getPosition():0}beforeDestroy(){this.players.forEach(e=>{e.beforeDestroy&&e.beforeDestroy()})}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(s=>s()),t.length=0}}let E2=(()=>{class n{constructor(t){this.el=t}onkeydown(t){if(!0!==this.pFocusTrapDisabled){t.preventDefault();let s=Pt.getFocusableElements(this.el.nativeElement);if(s&&s.length>0)if(s[0].ownerDocument.activeElement){let c=s.indexOf(s[0].ownerDocument.activeElement);t.shiftKey?-1==c||0===c?s[s.length-1].focus():s[c-1].focus():-1==c||c===s.length-1?s[0].focus():s[c+1].focus()}else s[0].focus()}}}return n.\u0275fac=function(t){return new(t||n)(zt(Cs))},n.\u0275dir=Pi({type:n,selectors:[["","pFocusTrap",""]],hostAttrs:[1,"p-element"],hostBindings:function(t,s){1&t&&Fo("keydown.tab",function(p){return s.onkeydown(p)})("keydown.shift.tab",function(p){return s.onkeydown(p)})},inputs:{pFocusTrapDisabled:"pFocusTrapDisabled"}}),n})(),T2=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=fr({type:n}),n.\u0275inj=Hr({imports:[Bd]}),n})();var ST=0,Sg=function C2(){let n=[];const c=p=>p&&parseInt(p.style.zIndex,10)||0;return{get:c,set:(p,y,w)=>{y&&(y.style.zIndex=String(((p,y)=>{let w=n.length>0?n[n.length-1]:{key:p,value:y},C=w.value+(w.key===p?0:y)+1;return n.push({key:p,value:C}),C})(p,w)))},clear:p=>{p&&((p=>{n=n.filter(y=>y.value!==p)})(c(p)),p.style.zIndex="")},getCurrent:()=>n.length>0?n[n.length-1].value:0}}();const I2=["titlebar"],S2=["content"],M2=["footer"];function A2(n,e){if(1&n){const t=iu();Be(0,"div",11),Fo("mousedown",function(c){return Pr(t),Lr(fi(3).initResize(c))}),Ge()}}function P2(n,e){if(1&n&&(Be(0,"span",18),Ye(1),Ge()),2&n){const t=fi(4);pa("id",t.id+"-label"),Rt(1),cg(t.header)}}function L2(n,e){1&n&&(Be(0,"span",18),Od(1,1),Ge()),2&n&&pa("id",fi(4).id+"-label")}function k2(n,e){1&n&&Df(0)}const R2=function(){return{"p-dialog-header-icon p-dialog-header-maximize p-link":!0}};function O2(n,e){if(1&n){const t=iu();Be(0,"button",19),Fo("click",function(){return Pr(t),Lr(fi(4).maximize())})("keydown.enter",function(){return Pr(t),Lr(fi(4).maximize())}),Nt(1,"span",20),Ge()}if(2&n){const t=fi(4);Ht("ngClass",U0(2,R2)),Rt(1),Ht("ngClass",t.maximized?t.minimizeIcon:t.maximizeIcon)}}const F2=function(){return{"p-dialog-header-icon p-dialog-header-close p-link":!0}};function N2(n,e){if(1&n){const t=iu();Be(0,"button",21),Fo("click",function(c){return Pr(t),Lr(fi(4).close(c))})("keydown.enter",function(c){return Pr(t),Lr(fi(4).close(c))}),Nt(1,"span",22),Ge()}if(2&n){const t=fi(4);Ht("ngClass",U0(4,F2)),pa("aria-label",t.closeAriaLabel)("tabindex",t.closeTabindex),Rt(1),Ht("ngClass",t.closeIcon)}}function z2(n,e){if(1&n){const t=iu();Be(0,"div",12,13),Fo("mousedown",function(c){return Pr(t),Lr(fi(3).initDrag(c))}),Pn(2,P2,2,2,"span",14),Pn(3,L2,2,1,"span",14),Pn(4,k2,1,0,"ng-container",9),Be(5,"div",15),Pn(6,O2,2,3,"button",16),Pn(7,N2,2,5,"button",17),Ge()()}if(2&n){const t=fi(3);Rt(2),Ht("ngIf",!t.headerFacet&&!t.headerTemplate),Rt(1),Ht("ngIf",t.headerFacet),Rt(1),Ht("ngTemplateOutlet",t.headerTemplate),Rt(2),Ht("ngIf",t.maximizable),Rt(1),Ht("ngIf",t.closable)}}function B2(n,e){1&n&&Df(0)}function V2(n,e){1&n&&Df(0)}function j2(n,e){if(1&n&&(Be(0,"div",23,24),Od(2,2),Pn(3,V2,1,0,"ng-container",9),Ge()),2&n){const t=fi(3);Rt(3),Ht("ngTemplateOutlet",t.footerTemplate)}}const U2=function(n,e,t,s){return{"p-dialog p-component":!0,"p-dialog-rtl":n,"p-dialog-draggable":e,"p-dialog-resizable":t,"p-dialog-maximized":s}},$2=function(n,e){return{transform:n,transition:e}},G2=function(n){return{value:"visible",params:n}};function H2(n,e){if(1&n){const t=iu();Be(0,"div",3,4),Fo("@animation.start",function(c){return Pr(t),Lr(fi(2).onAnimationStart(c))})("@animation.done",function(c){return Pr(t),Lr(fi(2).onAnimationEnd(c))}),Pn(2,A2,1,0,"div",5),Pn(3,z2,8,5,"div",6),Be(4,"div",7,8),Od(6),Pn(7,B2,1,0,"ng-container",9),Ge(),Pn(8,j2,4,1,"div",10),Ge()}if(2&n){const t=fi(2);Fd(t.styleClass),Ht("ngClass",$0(15,U2,t.rtl,t.draggable,t.resizable,t.maximized))("ngStyle",t.style)("pFocusTrapDisabled",!1===t.focusTrap)("@animation",_w(23,G2,yw(20,$2,t.transformOptions,t.transitionOptions))),pa("aria-labelledby",t.id+"-label"),Rt(2),Ht("ngIf",t.resizable),Rt(1),Ht("ngIf",t.showHeader),Rt(1),Fd(t.contentStyleClass),Ht("ngClass","p-dialog-content")("ngStyle",t.contentStyle),Rt(3),Ht("ngTemplateOutlet",t.contentTemplate),Rt(1),Ht("ngIf",t.footerFacet||t.footerTemplate)}}const q2=function(n,e,t,s,c,p,y,w,C,A){return{"p-dialog-mask":!0,"p-component-overlay p-component-overlay-enter":n,"p-dialog-mask-scrollblocker":e,"p-dialog-left":t,"p-dialog-right":s,"p-dialog-top":c,"p-dialog-top-left":p,"p-dialog-top-right":y,"p-dialog-bottom":w,"p-dialog-bottom-left":C,"p-dialog-bottom-right":A}};function W2(n,e){if(1&n&&(Be(0,"div",1),Pn(1,H2,9,25,"div",2),Ge()),2&n){const t=fi();Fd(t.maskStyleClass),Ht("ngClass",xw(4,q2,[t.modal,t.modal||t.blockScroll,"left"===t.position,"right"===t.position,"top"===t.position,"topleft"===t.position||"top-left"===t.position,"topright"===t.position||"top-right"===t.position,"bottom"===t.position,"bottomleft"===t.position||"bottom-left"===t.position,"bottomright"===t.position||"bottom-right"===t.position])),Rt(1),Ht("ngIf",t.visible)}}const Z2=["*",[["p-header"]],[["p-footer"]]],X2=["*","p-header","p-footer"],K2=ET([Ny({transform:"{{transform}}",opacity:0}),xT("{{transition}}")]),Y2=ET([xT("{{transition}}",Ny({transform:"{{transform}}",opacity:0}))]);let Q2=(()=>{class n{constructor(t,s,c,p,y){this.el=t,this.renderer=s,this.zone=c,this.cd=p,this.config=y,this.draggable=!0,this.resizable=!0,this.closeOnEscape=!0,this.closable=!0,this.showHeader=!0,this.blockScroll=!1,this.autoZIndex=!0,this.baseZIndex=0,this.minX=0,this.minY=0,this.focusOnShow=!0,this.keepInViewport=!0,this.focusTrap=!0,this.transitionOptions="150ms cubic-bezier(0, 0, 0.2, 1)",this.closeIcon="pi pi-times",this.closeTabindex="-1",this.minimizeIcon="pi pi-window-minimize",this.maximizeIcon="pi pi-window-maximize",this.onShow=new wr,this.onHide=new wr,this.visibleChange=new wr,this.onResizeInit=new wr,this.onResizeEnd=new wr,this.onDragEnd=new wr,this.onMaximize=new wr,this.id=function D2(){return"pr_id_"+ ++ST}(),this._style={},this._position="center",this.transformOptions="scale(0.7)"}get positionLeft(){return 0}set positionLeft(t){console.log("positionLeft property is deprecated.")}get positionTop(){return 0}set positionTop(t){console.log("positionTop property is deprecated.")}get responsive(){return!1}set responsive(t){console.log("Responsive property is deprecated.")}get breakpoint(){return 649}set breakpoint(t){console.log("Breakpoint property is not utilized and deprecated, use breakpoints or CSS media queries instead.")}ngAfterContentInit(){this.templates.forEach(t=>{switch(t.getType()){case"header":this.headerTemplate=t.template;break;case"content":default:this.contentTemplate=t.template;break;case"footer":this.footerTemplate=t.template}})}ngOnInit(){this.breakpoints&&this.createStyle()}get visible(){return this._visible}set visible(t){this._visible=t,this._visible&&!this.maskVisible&&(this.maskVisible=!0)}get style(){return this._style}set style(t){t&&(this._style={...t},this.originalStyle=t)}get position(){return this._position}set position(t){switch(this._position=t,t){case"topleft":case"bottomleft":case"left":this.transformOptions="translate3d(-100%, 0px, 0px)";break;case"topright":case"bottomright":case"right":this.transformOptions="translate3d(100%, 0px, 0px)";break;case"bottom":this.transformOptions="translate3d(0px, 100%, 0px)";break;case"top":this.transformOptions="translate3d(0px, -100%, 0px)";break;default:this.transformOptions="scale(0.7)"}}focus(){let t=Pt.findSingle(this.container,"[autofocus]");t&&this.zone.runOutsideAngular(()=>{setTimeout(()=>t.focus(),5)})}close(t){this.visibleChange.emit(!1),t.preventDefault()}enableModality(){this.closable&&this.dismissableMask&&(this.maskClickListener=this.renderer.listen(this.wrapper,"mousedown",t=>{this.wrapper&&this.wrapper.isSameNode(t.target)&&this.close(t)})),this.modal&&Pt.addClass(document.body,"p-overflow-hidden")}disableModality(){this.wrapper&&(this.dismissableMask&&this.unbindMaskClickListener(),this.modal&&Pt.removeClass(document.body,"p-overflow-hidden"),this.cd.destroyed||this.cd.detectChanges())}maximize(){this.maximized=!this.maximized,!this.modal&&!this.blockScroll&&(this.maximized?Pt.addClass(document.body,"p-overflow-hidden"):Pt.removeClass(document.body,"p-overflow-hidden")),this.onMaximize.emit({maximized:this.maximized})}unbindMaskClickListener(){this.maskClickListener&&(this.maskClickListener(),this.maskClickListener=null)}moveOnTop(){this.autoZIndex&&(Sg.set("modal",this.container,this.baseZIndex+this.config.zIndex.modal),this.wrapper.style.zIndex=String(parseInt(this.container.style.zIndex,10)-1))}createStyle(){if(!this.styleElement){this.styleElement=document.createElement("style"),this.styleElement.type="text/css",document.head.appendChild(this.styleElement);let t="";for(let s in this.breakpoints)t+=`\n                    @media screen and (max-width: ${s}) {\n                        .p-dialog[${this.id}] {\n                            width: ${this.breakpoints[s]} !important;\n                        }\n                    }\n                `;this.styleElement.innerHTML=t}}initDrag(t){Pt.hasClass(t.target,"p-dialog-header-icon")||Pt.hasClass(t.target.parentElement,"p-dialog-header-icon")||this.draggable&&(this.dragging=!0,this.lastPageX=t.pageX,this.lastPageY=t.pageY,this.container.style.margin="0",Pt.addClass(document.body,"p-unselectable-text"))}onKeydown(t){if(this.focusTrap&&9===t.which){t.preventDefault();let s=Pt.getFocusableElements(this.container);if(s&&s.length>0)if(s[0].ownerDocument.activeElement){let c=s.indexOf(s[0].ownerDocument.activeElement);t.shiftKey?-1==c||0===c?s[s.length-1].focus():s[c-1].focus():-1==c||c===s.length-1?s[0].focus():s[c+1].focus()}else s[0].focus()}}onDrag(t){if(this.dragging){let s=Pt.getOuterWidth(this.container),c=Pt.getOuterHeight(this.container),p=t.pageX-this.lastPageX,y=t.pageY-this.lastPageY,w=this.container.getBoundingClientRect(),C=w.left+p,A=w.top+y,F=Pt.getViewport();this.container.style.position="fixed",this.keepInViewport?(C>=this.minX&&C+s<F.width&&(this._style.left=C+"px",this.lastPageX=t.pageX,this.container.style.left=C+"px"),A>=this.minY&&A+c<F.height&&(this._style.top=A+"px",this.lastPageY=t.pageY,this.container.style.top=A+"px")):(this.lastPageX=t.pageX,this.container.style.left=C+"px",this.lastPageY=t.pageY,this.container.style.top=A+"px")}}endDrag(t){this.dragging&&(this.dragging=!1,Pt.removeClass(document.body,"p-unselectable-text"),this.cd.detectChanges(),this.onDragEnd.emit(t))}resetPosition(){this.container.style.position="",this.container.style.left="",this.container.style.top="",this.container.style.margin=""}center(){this.resetPosition()}initResize(t){this.resizable&&(this.resizing=!0,this.lastPageX=t.pageX,this.lastPageY=t.pageY,Pt.addClass(document.body,"p-unselectable-text"),this.onResizeInit.emit(t))}onResize(t){if(this.resizing){let s=t.pageX-this.lastPageX,c=t.pageY-this.lastPageY,p=Pt.getOuterWidth(this.container),y=Pt.getOuterHeight(this.container),w=Pt.getOuterHeight(this.contentViewChild.nativeElement),C=p+s,A=y+c,F=this.container.style.minWidth,V=this.container.style.minHeight,X=this.container.getBoundingClientRect(),ie=Pt.getViewport();(!parseInt(this.container.style.top)||!parseInt(this.container.style.left))&&(C+=s,A+=c),(!F||C>parseInt(F))&&X.left+C<ie.width&&(this._style.width=C+"px",this.container.style.width=this._style.width),(!V||A>parseInt(V))&&X.top+A<ie.height&&(this.contentViewChild.nativeElement.style.height=w+A-y+"px",this._style.height&&(this._style.height=A+"px",this.container.style.height=this._style.height)),this.lastPageX=t.pageX,this.lastPageY=t.pageY}}resizeEnd(t){this.resizing&&(this.resizing=!1,Pt.removeClass(document.body,"p-unselectable-text"),this.onResizeEnd.emit(t))}bindGlobalListeners(){this.draggable&&(this.bindDocumentDragListener(),this.bindDocumentDragEndListener()),this.resizable&&this.bindDocumentResizeListeners(),this.closeOnEscape&&this.closable&&this.bindDocumentEscapeListener()}unbindGlobalListeners(){this.unbindDocumentDragListener(),this.unbindDocumentDragEndListener(),this.unbindDocumentResizeListeners(),this.unbindDocumentEscapeListener()}bindDocumentDragListener(){this.zone.runOutsideAngular(()=>{this.documentDragListener=this.onDrag.bind(this),window.document.addEventListener("mousemove",this.documentDragListener)})}unbindDocumentDragListener(){this.documentDragListener&&(window.document.removeEventListener("mousemove",this.documentDragListener),this.documentDragListener=null)}bindDocumentDragEndListener(){this.zone.runOutsideAngular(()=>{this.documentDragEndListener=this.endDrag.bind(this),window.document.addEventListener("mouseup",this.documentDragEndListener)})}unbindDocumentDragEndListener(){this.documentDragEndListener&&(window.document.removeEventListener("mouseup",this.documentDragEndListener),this.documentDragEndListener=null)}bindDocumentResizeListeners(){this.zone.runOutsideAngular(()=>{this.documentResizeListener=this.onResize.bind(this),this.documentResizeEndListener=this.resizeEnd.bind(this),window.document.addEventListener("mousemove",this.documentResizeListener),window.document.addEventListener("mouseup",this.documentResizeEndListener)})}unbindDocumentResizeListeners(){this.documentResizeListener&&this.documentResizeEndListener&&(window.document.removeEventListener("mousemove",this.documentResizeListener),window.document.removeEventListener("mouseup",this.documentResizeEndListener),this.documentResizeListener=null,this.documentResizeEndListener=null)}bindDocumentEscapeListener(){this.documentEscapeListener=this.renderer.listen(this.el?this.el.nativeElement.ownerDocument:"document","keydown",s=>{27==s.which&&this.close(s)})}unbindDocumentEscapeListener(){this.documentEscapeListener&&(this.documentEscapeListener(),this.documentEscapeListener=null)}appendContainer(){this.appendTo&&("body"===this.appendTo?document.body.appendChild(this.wrapper):Pt.appendChild(this.wrapper,this.appendTo))}restoreAppend(){this.container&&this.appendTo&&this.el.nativeElement.appendChild(this.wrapper)}onAnimationStart(t){switch(t.toState){case"visible":this.container=t.element,this.wrapper=this.container.parentElement,this.appendContainer(),this.moveOnTop(),this.bindGlobalListeners(),this.container.setAttribute(this.id,""),this.modal&&this.enableModality(),!this.modal&&this.blockScroll&&Pt.addClass(document.body,"p-overflow-hidden"),this.focusOnShow&&this.focus();break;case"void":this.wrapper&&this.modal&&Pt.addClass(this.wrapper,"p-component-overlay-leave")}}onAnimationEnd(t){switch(t.toState){case"void":this.onContainerDestroy(),this.onHide.emit({});break;case"visible":this.onShow.emit({})}}onContainerDestroy(){this.unbindGlobalListeners(),this.dragging=!1,this.maskVisible=!1,this.maximized&&(Pt.removeClass(document.body,"p-overflow-hidden"),this.maximized=!1),this.modal&&this.disableModality(),this.blockScroll&&Pt.removeClass(document.body,"p-overflow-hidden"),this.container&&this.autoZIndex&&Sg.clear(this.container),this.container=null,this.wrapper=null,this._style=this.originalStyle?{...this.originalStyle}:{}}destroyStyle(){this.styleElement&&(document.head.removeChild(this.styleElement),this.styleElement=null)}ngOnDestroy(){this.container&&(this.restoreAppend(),this.onContainerDestroy()),this.destroyStyle()}}return n.\u0275fac=function(t){return new(t||n)(zt(Cs),zt(Qp),zt(Yi),zt(bE),zt(Vx))},n.\u0275cmp=Zn({type:n,selectors:[["p-dialog"]],contentQueries:function(t,s,c){if(1&t&&(_g(c,l2,5),_g(c,c2,5),_g(c,gT,4)),2&t){let p;Dh(p=Ch())&&(s.headerFacet=p.first),Dh(p=Ch())&&(s.footerFacet=p.first),Dh(p=Ch())&&(s.templates=p)}},viewQuery:function(t,s){if(1&t&&(uy(I2,5),uy(S2,5),uy(M2,5)),2&t){let c;Dh(c=Ch())&&(s.headerViewChild=c.first),Dh(c=Ch())&&(s.contentViewChild=c.first),Dh(c=Ch())&&(s.footerViewChild=c.first)}},hostAttrs:[1,"p-element"],inputs:{header:"header",draggable:"draggable",resizable:"resizable",positionLeft:"positionLeft",positionTop:"positionTop",contentStyle:"contentStyle",contentStyleClass:"contentStyleClass",modal:"modal",closeOnEscape:"closeOnEscape",dismissableMask:"dismissableMask",rtl:"rtl",closable:"closable",responsive:"responsive",appendTo:"appendTo",breakpoints:"breakpoints",styleClass:"styleClass",maskStyleClass:"maskStyleClass",showHeader:"showHeader",breakpoint:"breakpoint",blockScroll:"blockScroll",autoZIndex:"autoZIndex",baseZIndex:"baseZIndex",minX:"minX",minY:"minY",focusOnShow:"focusOnShow",maximizable:"maximizable",keepInViewport:"keepInViewport",focusTrap:"focusTrap",transitionOptions:"transitionOptions",closeIcon:"closeIcon",closeAriaLabel:"closeAriaLabel",closeTabindex:"closeTabindex",minimizeIcon:"minimizeIcon",maximizeIcon:"maximizeIcon",visible:"visible",style:"style",position:"position"},outputs:{onShow:"onShow",onHide:"onHide",visibleChange:"visibleChange",onResizeInit:"onResizeInit",onResizeEnd:"onResizeEnd",onDragEnd:"onDragEnd",onMaximize:"onMaximize"},ngContentSelectors:X2,decls:1,vars:1,consts:[[3,"class","ngClass",4,"ngIf"],[3,"ngClass"],["pFocusTrap","","role","dialog",3,"ngClass","ngStyle","class","pFocusTrapDisabled",4,"ngIf"],["pFocusTrap","","role","dialog",3,"ngClass","ngStyle","pFocusTrapDisabled"],["container",""],["class","p-resizable-handle","style","z-index: 90;",3,"mousedown",4,"ngIf"],["class","p-dialog-header",3,"mousedown",4,"ngIf"],[3,"ngClass","ngStyle"],["content",""],[4,"ngTemplateOutlet"],["class","p-dialog-footer",4,"ngIf"],[1,"p-resizable-handle",2,"z-index","90",3,"mousedown"],[1,"p-dialog-header",3,"mousedown"],["titlebar",""],["class","p-dialog-title",4,"ngIf"],[1,"p-dialog-header-icons"],["type","button","tabindex","-1","pRipple","",3,"ngClass","click","keydown.enter",4,"ngIf"],["type","button","pRipple","",3,"ngClass","click","keydown.enter",4,"ngIf"],[1,"p-dialog-title"],["type","button","tabindex","-1","pRipple","",3,"ngClass","click","keydown.enter"],[1,"p-dialog-header-maximize-icon",3,"ngClass"],["type","button","pRipple","",3,"ngClass","click","keydown.enter"],[1,"p-dialog-header-close-icon",3,"ngClass"],[1,"p-dialog-footer"],["footer",""]],template:function(t,s){1&t&&(ag(Z2),Pn(0,W2,2,15,"div",0)),2&t&&Ht("ngIf",s.maskVisible)},dependencies:[Tx,Ay,Sx,Ix,E2,_T],styles:[".p-dialog-mask{position:fixed;top:0;left:0;width:100%;height:100%;display:flex;justify-content:center;align-items:center;pointer-events:none}.p-dialog-mask.p-component-overlay{pointer-events:auto}.p-dialog{display:flex;flex-direction:column;pointer-events:auto;max-height:90%;transform:scale(1);position:relative}.p-dialog-content{overflow-y:auto;flex-grow:1}.p-dialog-header{display:flex;align-items:center;justify-content:space-between;flex-shrink:0}.p-dialog-draggable .p-dialog-header{cursor:move}.p-dialog-footer{flex-shrink:0}.p-dialog .p-dialog-header-icons{display:flex;align-items:center}.p-dialog .p-dialog-header-icon{display:flex;align-items:center;justify-content:center;overflow:hidden;position:relative}.p-fluid .p-dialog-footer .p-button{width:auto}.p-dialog-top .p-dialog,.p-dialog-bottom .p-dialog,.p-dialog-left .p-dialog,.p-dialog-right .p-dialog,.p-dialog-top-left .p-dialog,.p-dialog-top-right .p-dialog,.p-dialog-bottom-left .p-dialog,.p-dialog-bottom-right .p-dialog{margin:.75rem;transform:translateZ(0)}.p-dialog-maximized{transition:none;transform:none;width:100vw!important;height:100vh!important;top:0!important;left:0!important;max-height:100%;height:100%}.p-dialog-maximized .p-dialog-content{flex-grow:1}.p-dialog-left{justify-content:flex-start}.p-dialog-right{justify-content:flex-end}.p-dialog-top{align-items:flex-start}.p-dialog-top-left{justify-content:flex-start;align-items:flex-start}.p-dialog-top-right{justify-content:flex-end;align-items:flex-start}.p-dialog-bottom{align-items:flex-end}.p-dialog-bottom-left{justify-content:flex-start;align-items:flex-end}.p-dialog-bottom-right{justify-content:flex-end;align-items:flex-end}.p-dialog .p-resizable-handle{position:absolute;font-size:.1px;display:block;cursor:se-resize;width:12px;height:12px;right:1px;bottom:1px}.p-confirm-dialog .p-dialog-content{display:flex;align-items:center}\n"],encapsulation:2,data:{animation:[w2("animation",[wT("void => visible",[TT(K2)]),wT("visible => void",[TT(Y2)])])]},changeDetection:0}),n})(),J2=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=fr({type:n}),n.\u0275inj=Hr({imports:[Bd,T2,yT,u2]}),n})(),eP=(()=>{class n{constructor(t,s,c){this.el=t,this.zone=s,this.config=c,this.escape=!0,this.fitContent=!0,this._tooltipOptions={tooltipPosition:"right",tooltipEvent:"hover",appendTo:"body",tooltipZIndex:"auto",escape:!0,positionTop:0,positionLeft:0}}get disabled(){return this._disabled}set disabled(t){this._disabled=t,this.deactivate()}ngAfterViewInit(){this.zone.runOutsideAngular(()=>{if("hover"===this.getOption("tooltipEvent"))this.mouseEnterListener=this.onMouseEnter.bind(this),this.mouseLeaveListener=this.onMouseLeave.bind(this),this.clickListener=this.onClick.bind(this),this.el.nativeElement.addEventListener("mouseenter",this.mouseEnterListener),this.el.nativeElement.addEventListener("mouseleave",this.mouseLeaveListener),this.el.nativeElement.addEventListener("click",this.clickListener);else if("focus"===this.getOption("tooltipEvent")){this.focusListener=this.onFocus.bind(this),this.blurListener=this.onBlur.bind(this);let t=this.getTarget(this.el.nativeElement);t.addEventListener("focus",this.focusListener),t.addEventListener("blur",this.blurListener)}})}ngOnChanges(t){t.tooltipPosition&&this.setOption({tooltipPosition:t.tooltipPosition.currentValue}),t.tooltipEvent&&this.setOption({tooltipEvent:t.tooltipEvent.currentValue}),t.appendTo&&this.setOption({appendTo:t.appendTo.currentValue}),t.positionStyle&&this.setOption({positionStyle:t.positionStyle.currentValue}),t.tooltipStyleClass&&this.setOption({tooltipStyleClass:t.tooltipStyleClass.currentValue}),t.tooltipZIndex&&this.setOption({tooltipZIndex:t.tooltipZIndex.currentValue}),t.escape&&this.setOption({escape:t.escape.currentValue}),t.showDelay&&this.setOption({showDelay:t.showDelay.currentValue}),t.hideDelay&&this.setOption({hideDelay:t.hideDelay.currentValue}),t.life&&this.setOption({life:t.life.currentValue}),t.positionTop&&this.setOption({positionTop:t.positionTop.currentValue}),t.positionLeft&&this.setOption({positionLeft:t.positionLeft.currentValue}),t.disabled&&this.setOption({disabled:t.disabled.currentValue}),t.text&&(this.setOption({tooltipLabel:t.text.currentValue}),this.active&&(t.text.currentValue?this.container&&this.container.offsetParent?(this.updateText(),this.align()):this.show():this.hide())),t.tooltipOptions&&(this._tooltipOptions={...this._tooltipOptions,...t.tooltipOptions.currentValue},this.deactivate(),this.active&&(this.getOption("tooltipLabel")?this.container&&this.container.offsetParent?(this.updateText(),this.align()):this.show():this.hide()))}onMouseEnter(t){!this.container&&!this.showTimeout&&this.activate()}onMouseLeave(t){this.deactivate()}onFocus(t){this.activate()}onBlur(t){this.deactivate()}onClick(t){this.deactivate()}activate(){if(this.active=!0,this.clearHideTimeout(),this.getOption("showDelay")?this.showTimeout=setTimeout(()=>{this.show()},this.getOption("showDelay")):this.show(),this.getOption("life")){let t=this.getOption("showDelay")?this.getOption("life")+this.getOption("showDelay"):this.getOption("life");this.hideTimeout=setTimeout(()=>{this.hide()},t)}}deactivate(){this.active=!1,this.clearShowTimeout(),this.getOption("hideDelay")?(this.clearHideTimeout(),this.hideTimeout=setTimeout(()=>{this.hide()},this.getOption("hideDelay"))):this.hide()}create(){this.container&&(this.clearHideTimeout(),this.remove()),this.container=document.createElement("div");let t=document.createElement("div");t.className="p-tooltip-arrow",this.container.appendChild(t),this.tooltipText=document.createElement("div"),this.tooltipText.className="p-tooltip-text",this.updateText(),this.getOption("positionStyle")&&(this.container.style.position=this.getOption("positionStyle")),this.container.appendChild(this.tooltipText),"body"===this.getOption("appendTo")?document.body.appendChild(this.container):"target"===this.getOption("appendTo")?Pt.appendChild(this.container,this.el.nativeElement):Pt.appendChild(this.container,this.getOption("appendTo")),this.container.style.display="inline-block",this.fitContent&&(this.container.style.width="fit-content")}show(){!this.getOption("tooltipLabel")||this.getOption("disabled")||(this.create(),this.align(),Pt.fadeIn(this.container,250),"auto"===this.getOption("tooltipZIndex")?Sg.set("tooltip",this.container,this.config.zIndex.tooltip):this.container.style.zIndex=this.getOption("tooltipZIndex"),this.bindDocumentResizeListener(),this.bindScrollListener())}hide(){"auto"===this.getOption("tooltipZIndex")&&Sg.clear(this.container),this.remove()}updateText(){this.getOption("escape")?(this.tooltipText.innerHTML="",this.tooltipText.appendChild(document.createTextNode(this.getOption("tooltipLabel")))):this.tooltipText.innerHTML=this.getOption("tooltipLabel")}align(){switch(this.getOption("tooltipPosition")){case"top":this.alignTop(),this.isOutOfBounds()&&(this.alignBottom(),this.isOutOfBounds()&&(this.alignRight(),this.isOutOfBounds()&&this.alignLeft()));break;case"bottom":this.alignBottom(),this.isOutOfBounds()&&(this.alignTop(),this.isOutOfBounds()&&(this.alignRight(),this.isOutOfBounds()&&this.alignLeft()));break;case"left":this.alignLeft(),this.isOutOfBounds()&&(this.alignRight(),this.isOutOfBounds()&&(this.alignTop(),this.isOutOfBounds()&&this.alignBottom()));break;case"right":this.alignRight(),this.isOutOfBounds()&&(this.alignLeft(),this.isOutOfBounds()&&(this.alignTop(),this.isOutOfBounds()&&this.alignBottom()))}}getHostOffset(){if("body"===this.getOption("appendTo")||"target"===this.getOption("appendTo")){let t=this.el.nativeElement.getBoundingClientRect();return{left:t.left+Pt.getWindowScrollLeft(),top:t.top+Pt.getWindowScrollTop()}}return{left:0,top:0}}alignRight(){this.preAlign("right");let t=this.getHostOffset(),s=t.left+Pt.getOuterWidth(this.el.nativeElement),c=t.top+(Pt.getOuterHeight(this.el.nativeElement)-Pt.getOuterHeight(this.container))/2;this.container.style.left=s+this.getOption("positionLeft")+"px",this.container.style.top=c+this.getOption("positionTop")+"px"}alignLeft(){this.preAlign("left");let t=this.getHostOffset(),s=t.left-Pt.getOuterWidth(this.container),c=t.top+(Pt.getOuterHeight(this.el.nativeElement)-Pt.getOuterHeight(this.container))/2;this.container.style.left=s+this.getOption("positionLeft")+"px",this.container.style.top=c+this.getOption("positionTop")+"px"}alignTop(){this.preAlign("top");let t=this.getHostOffset(),s=t.left+(Pt.getOuterWidth(this.el.nativeElement)-Pt.getOuterWidth(this.container))/2,c=t.top-Pt.getOuterHeight(this.container);this.container.style.left=s+this.getOption("positionLeft")+"px",this.container.style.top=c+this.getOption("positionTop")+"px"}alignBottom(){this.preAlign("bottom");let t=this.getHostOffset(),s=t.left+(Pt.getOuterWidth(this.el.nativeElement)-Pt.getOuterWidth(this.container))/2,c=t.top+Pt.getOuterHeight(this.el.nativeElement);this.container.style.left=s+this.getOption("positionLeft")+"px",this.container.style.top=c+this.getOption("positionTop")+"px"}setOption(t){this._tooltipOptions={...this._tooltipOptions,...t}}getOption(t){return this._tooltipOptions[t]}getTarget(t){return Pt.hasClass(t,"p-inputwrapper")?Pt.findSingle(t,"input"):t}preAlign(t){this.container.style.left="-999px",this.container.style.top="-999px";let s="p-tooltip p-component p-tooltip-"+t;this.container.className=this.getOption("tooltipStyleClass")?s+" "+this.getOption("tooltipStyleClass"):s}isOutOfBounds(){let t=this.container.getBoundingClientRect(),s=t.top,c=t.left,p=Pt.getOuterWidth(this.container),y=Pt.getOuterHeight(this.container),w=Pt.getViewport();return c+p>w.width||c<0||s<0||s+y>w.height}onWindowResize(t){this.hide()}bindDocumentResizeListener(){this.zone.runOutsideAngular(()=>{this.resizeListener=this.onWindowResize.bind(this),window.addEventListener("resize",this.resizeListener)})}unbindDocumentResizeListener(){this.resizeListener&&(window.removeEventListener("resize",this.resizeListener),this.resizeListener=null)}bindScrollListener(){this.scrollHandler||(this.scrollHandler=new h2(this.el.nativeElement,()=>{this.container&&this.hide()})),this.scrollHandler.bindScrollListener()}unbindScrollListener(){this.scrollHandler&&this.scrollHandler.unbindScrollListener()}unbindEvents(){if("hover"===this.getOption("tooltipEvent"))this.el.nativeElement.removeEventListener("mouseenter",this.mouseEnterListener),this.el.nativeElement.removeEventListener("mouseleave",this.mouseLeaveListener),this.el.nativeElement.removeEventListener("click",this.clickListener);else if("focus"===this.getOption("tooltipEvent")){let t=this.getTarget(this.el.nativeElement);t.removeEventListener("focus",this.focusListener),t.removeEventListener("blur",this.blurListener)}this.unbindDocumentResizeListener()}remove(){this.container&&this.container.parentElement&&("body"===this.getOption("appendTo")?document.body.removeChild(this.container):"target"===this.getOption("appendTo")?this.el.nativeElement.removeChild(this.container):Pt.removeChild(this.container,this.getOption("appendTo"))),this.unbindDocumentResizeListener(),this.unbindScrollListener(),this.clearTimeouts(),this.container=null,this.scrollHandler=null}clearShowTimeout(){this.showTimeout&&(clearTimeout(this.showTimeout),this.showTimeout=null)}clearHideTimeout(){this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=null)}clearTimeouts(){this.clearShowTimeout(),this.clearHideTimeout()}ngOnDestroy(){this.unbindEvents(),this.container&&Sg.clear(this.container),this.remove(),this.scrollHandler&&(this.scrollHandler.destroy(),this.scrollHandler=null)}}return n.\u0275fac=function(t){return new(t||n)(zt(Cs),zt(Yi),zt(Vx))},n.\u0275dir=Pi({type:n,selectors:[["","pTooltip",""]],hostAttrs:[1,"p-element"],inputs:{tooltipPosition:"tooltipPosition",tooltipEvent:"tooltipEvent",appendTo:"appendTo",positionStyle:"positionStyle",tooltipStyleClass:"tooltipStyleClass",tooltipZIndex:"tooltipZIndex",escape:"escape",showDelay:"showDelay",hideDelay:"hideDelay",life:"life",positionTop:"positionTop",positionLeft:"positionLeft",fitContent:"fitContent",text:["pTooltip","text"],disabled:["tooltipDisabled","disabled"],tooltipOptions:"tooltipOptions"},features:[Fa]}),n})(),tP=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=fr({type:n}),n.\u0275inj=Hr({imports:[Bd]}),n})(),nP=(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Zn({type:n,selectors:[["app-intro"]],decls:10,vars:0,consts:[["src","../../luisdebenito/assets/hello.gif",1,"img"]],template:function(t,s){1&t&&(Be(0,"h1"),Ye(1,"Welcome to my world!"),Ge(),Be(2,"p"),Ye(3," Hello there! Thanks for getting in here. My name is Luis de Benito, and this is the best way I found to tell my story without you falling asleep while reading it. So sit back, press the right arrow, and enjoy!\n"),Ge(),Be(4,"p")(5,"i"),Ye(6,"I strongly recommend to press the play button before going on"),Ge()(),Nt(7,"img",0),Be(8,"p"),Ye(9," PD: You can press the contact button at any time if you want to tell me how silly I am\n"),Ge())}}),n})(),iP=(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Zn({type:n,selectors:[["app-segovia"]],decls:10,vars:0,consts:[["src","../../luisdebenito/assets/segovia.jpg",1,"img"],["src","../../luisdebenito/assets/segovia1.jpg",1,"img"]],template:function(t,s){1&t&&(Be(0,"h1"),Ye(1,"Childhood in Segovia"),Ge(),Be(2,"p"),Ye(3," Back in 1995, my parents decided to make my first commit in this town, and I spent here the first 17 years of my life. Such a lovely city.\n"),Ge(),Nt(4,"img",0),Be(5,"p"),Ye(6,"I walked by those years mostly playing tennis and studying"),Ge(),Nt(7,"img",1),Be(8,"p"),Ye(9," I was never a social animal, but thanks to my parents and the influence of some friends, I started building my personality. Outgoing, adventurous, frequent traveller and active as heck (I am learning to stand still doing nothing for more than an hour)\n"),Ge())}}),n})(),rP=(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Zn({type:n,selectors:[["app-dublin"]],decls:5,vars:0,consts:[["src","../../luisdebenito/assets/dublin.jpg",1,"img"]],template:function(t,s){1&t&&(Be(0,"h1"),Ye(1,"Dublin"),Ge(),Be(2,"p"),Ye(3," And there we went! At the age of 14 I spent a month studying english in Dublin, my parents never gave me the option of not studying it, which I cannot be other than extremly thankful\n"),Ge(),Nt(4,"img",0))}}),n})(),oP=(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Zn({type:n,selectors:[["app-iowa"]],decls:5,vars:0,consts:[["src","../../luisdebenito/assets/iowa.jpg",1,"img"]],template:function(t,s){1&t&&(Be(0,"h1"),Ye(1,"Iowa"),Ge(),Be(2,"p"),Ye(3," Lucky me, after coming back from Ireland almost fluent, I got the chance to spend a whole quarter in Ames, Iowa. I consider that journey as my turning point, from a shy, insecure guy to what I am now\n"),Ge(),Nt(4,"img",0))}}),n})(),sP=(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Zn({type:n,selectors:[["app-madrid1"]],decls:19,vars:0,consts:[["src","../../luisdebenito/assets/uni1.jpg",1,"img"],["src","../../luisdebenito/assets/unitenis.jpg",1,"img"]],template:function(t,s){1&t&&(Be(0,"h1"),Ye(1,"University in Madrid"),Ge(),Be(2,"p"),Ye(3," After a good childhood in the fields, it was my time to move to the big city. I got into UPM (Universidad Polit\xe9cnica de Madrid) to study "),Be(4,"b"),Ye(5,"Electronic and Automatic Industrial Engineering"),Ge()(),Nt(6,"img",0),Be(7,"p"),Ye(8," Uni was nice, 4 interesting years in which I worked in "),Be(9,"b"),Ye(10,"Hacklab BQ"),Ge(),Ye(11," almost from the beginning, got into the sports club (we won a few tournaments), the mountain club, and even I got the chance to work for "),Be(12,"b"),Ye(13,"Nintendo"),Ge(),Ye(14,", such a crazy experience!\n"),Ge(),Nt(15,"img",1),Be(16,"p")(17,"i"),Ye(18,"I was sick the day we got the trophies, don't judge my face"),Ge()())}}),n})(),aP=(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Zn({type:n,selectors:[["app-rusia"]],decls:64,vars:0,consts:[["src","../../luisdebenito/assets/rusia.jpg",1,"img"]],template:function(t,s){1&t&&(Be(0,"h1"),Ye(1,"Travelling"),Ge(),Be(2,"p"),Ye(3,"As I already said before, travelling is an important part of my life."),Ge(),Be(4,"p"),Ye(5,"This is a list of the places I have been to"),Ge(),Be(6,"ul")(7,"li"),Ye(8,"Andorra \u{1f1e6}\u{1f1e9}"),Ge(),Be(9,"li"),Ye(10,"Austria \u{1f1e6}\u{1f1f9}"),Ge(),Be(11,"li"),Ye(12,"Belgium \u{1f1e7}\u{1f1ea}"),Ge(),Be(13,"li"),Ye(14,"Croatia \u{1f1ed}\u{1f1f7}"),Ge(),Be(15,"li"),Ye(16,"Denmark \u{1f1e9}\u{1f1f0}"),Ge(),Be(17,"li"),Ye(18,"England \u{1f1ec}\u{1f1e7}"),Ge(),Be(19,"li"),Ye(20,"France \u{1f1eb}\u{1f1f7}"),Ge(),Be(21,"li"),Ye(22,"Germany \u{1f1e9}\u{1f1ea}"),Ge(),Be(23,"li"),Ye(24,"Hungary \u{1f1ed}\u{1f1fa}"),Ge(),Be(25,"li"),Ye(26,"India \u{1f1ee}\u{1f1f3}"),Ge(),Be(27,"li"),Ye(28,"Ireland \u{1f1ee}\u{1f1ea}"),Ge(),Be(29,"li"),Ye(30,"Italy \u{1f1ee}\u{1f1f9}"),Ge(),Be(31,"li"),Ye(32,"Malta \u{1f1f2}\u{1f1f9}"),Ge(),Be(33,"li"),Ye(34,"Monaco \u{1f1f2}\u{1f1e8}"),Ge(),Be(35,"li"),Ye(36,"Morocco \u{1f1f2}\u{1f1e6}"),Ge(),Be(37,"li"),Ye(38,"Netherlands \u{1f1f3}\u{1f1f1}"),Ge(),Be(39,"li"),Ye(40,"Northern Ireland \u{1f1ec}\u{1f1e7}"),Ge(),Be(41,"li"),Ye(42,"Poland \u{1f1f5}\u{1f1f1}"),Ge(),Be(43,"li"),Ye(44,"Portugal \u{1f1f5}\u{1f1f9}"),Ge(),Be(45,"li"),Ye(46,"Russia \u{1f1f7}\u{1f1fa}"),Ge(),Be(47,"li"),Ye(48,"San Marino \u{1f1f8}\u{1f1f2}"),Ge(),Be(49,"li"),Ye(50,"Slovenia \u{1f1f8}\u{1f1ee}"),Ge(),Be(51,"li"),Ye(52,"Scotland \u{1f1ec}\u{1f1e7}"),Ge(),Be(53,"li"),Ye(54,"Spain \u{1f1ea}\u{1f1f8}"),Ge(),Be(55,"li"),Ye(56,"Sweden \u{1f1f8}\u{1f1ea}"),Ge(),Be(57,"li"),Ye(58,"Turkey \u{1f1f9}\u{1f1f7}"),Ge(),Be(59,"li"),Ye(60,"USA \u{1f1fa}\u{1f1f8}"),Ge()(),Nt(61,"img",0),Be(62,"p"),Ye(63," I decided to put Russia as the location for travelling, ask me why, funny story\n"),Ge())},styles:["ul[_ngcontent-%COMP%]{list-style-type:none;columns:2;-webkit-columns:2;-moz-columns:2}"]}),n})(),lP=(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Zn({type:n,selectors:[["app-madrid2"]],decls:10,vars:0,consts:[["src","../../luisdebenito/assets/uni.JPG",1,"img"],["src","../../luisdebenito/assets/zarco.png",1,"img"]],template:function(t,s){1&t&&(Be(0,"h1"),Ye(1,"Graduation"),Ge(),Be(2,"p"),Ye(3,"Back to the story. I graduated!!"),Ge(),Nt(4,"img",0),Be(5,"p"),Ye(6," I enjoyed doing the final project quite a lot, so I started working as a freelance engineer to apply what I did into a few companies. It was my first job as an engineer and I got 5 years of experience in a few months\n"),Ge(),Nt(7,"img",1),Be(8,"i"),Ye(9,"Zarco is the name of the program I developed, in honor of my cat"),Ge())}}),n})(),cP=(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Zn({type:n,selectors:[["app-malta"]],decls:7,vars:0,consts:[["src","../../luisdebenito/assets/malt.jpg",1,"img"]],template:function(t,s){1&t&&(Be(0,"h1"),Ye(1,"Malta"),Ge(),Be(2,"p"),Ye(3," I did not go on Erasmus, and I wanted to have an international experience, so thanks to an NGO and workaway.com, I went to Malta for a month to start a project\n"),Ge(),Nt(4,"img",0),Be(5,"p"),Ye(6," We created a workshop to handcraft musical instruments from trash in Ghana\n"),Ge())}}),n})(),uP=(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Zn({type:n,selectors:[["app-venecia"]],decls:10,vars:0,consts:[["src","../../luisdebenito/assets/italy.jpg",1,"img"]],template:function(t,s){1&t&&(Be(0,"h1"),Ye(1,"Treviso | Conegliano | Venezia | Italia"),Ge(),Be(2,"i"),Ye(3,"Volevo imparare, ho imparato"),Ge(),Be(4,"p"),Ye(5," I was hired by Electrolux as a "),Be(6,"b"),Ye(7,"Tools Development Engineer in the GEP"),Ge(),Ye(8,". Long name, amazing experience. I got the chance to learn Italian and meet people from all around the world. I lived on my second and third languages for a year and a half, and it was incredible\n"),Ge(),Nt(9,"img",0))}}),n})(),hP=(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Zn({type:n,selectors:[["app-suecia"]],decls:5,vars:0,consts:[["src","../../luisdebenito/assets/suecia.jpg",1,"img"]],template:function(t,s){1&t&&(Be(0,"h1"),Ye(1,"Stockholm"),Ge(),Be(2,"p"),Ye(3," Electrolux gave me the chance to work in the headquarters for a bit, in Stockholm, where I got to meet my fellow teammates from the GEP\n"),Ge(),Nt(4,"img",0))}}),n})(),dP=(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Zn({type:n,selectors:[["app-germany"]],decls:5,vars:0,consts:[["src","../../luisdebenito/assets/germany.jpg",1,"img"]],template:function(t,s){1&t&&(Be(0,"h1"),Ye(1,"Germany"),Ge(),Be(2,"p"),Ye(3,"I also worked in Rothenburg"),Ge(),Nt(4,"img",0))},styles:[".mmcontainer[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;max-height:100px}.mmcontainer[_ngcontent-%COMP%]   .box[_ngcontent-%COMP%]{transform-style:preserve-3d;animation:roll 2s ease-in-out infinite alternate}.mmcontainer[_ngcontent-%COMP%]   .box[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:linear-gradient(90deg,rgba(0,0,0,.1),rgba(0,0,0,.5) 90%,transparent);text-transform:uppercase;line-height:.76em;position:absolute;color:red;font-size:3.5em;white-space:nowrap;font-weight:700;padding:0 10px;transform-style:preserve-3d;text-shadow:0 10px 15px rgba(0,0,0,.3);transform:translate(-50%,-50%) rotateX(calc(var(--i) * 22.5deg)) translateZ(109px)}.mmcontainer[_ngcontent-%COMP%]   .box[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-style:initial}.mmcontainer[_ngcontent-%COMP%]   .box[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]:nth-child(1){color:#000}.mmcontainer[_ngcontent-%COMP%]   .box[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]:nth-child(2){color:#ff0}@keyframes roll{0%{transform:perspective(500px) rotateX(0) rotate(5deg)}to{transform:perspective(50px) rotateX(360deg) rotate(5deg)}}.mt-5[_ngcontent-%COMP%]{margin-top:200px}"]}),n})(),pP=(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Zn({type:n,selectors:[["app-india"]],decls:7,vars:0,consts:[["src","../../luisdebenito/assets/india.JPG",1,"img"]],template:function(t,s){1&t&&(Be(0,"h1"),Ye(1,"India"),Ge(),Be(2,"p"),Ye(3,"I was invited to a wedding in India!"),Ge(),Nt(4,"img",0),Be(5,"p"),Ye(6," I made some good friends in Italy, and one of them invited me to his old tradicitonal fancy beautiful stunning wedding. (Bless you Rahul \u2764)\n"),Ge())}}),n})(),fP=(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Zn({type:n,selectors:[["app-coruna"]],decls:9,vars:0,consts:[["src","../../luisdebenito/assets/inditex.png",1,"img"]],template:function(t,s){1&t&&(Be(0,"h1"),Ye(1,"A Coru\xf1a"),Ge(),Be(2,"p"),Ye(3," After enjoying my time around the world, I decided it was time to come back to Spain, and start building a carreer in here, and\n"),Ge(),Nt(4,"img",0),Be(5,"p"),Ye(6," trusted me to work between Forl\xec(Italy) and A Coru\xf1a(Spain) as a "),Be(7,"b"),Ye(8,"Data Engineer"),Ge()())}}),n})(),mP=(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Zn({type:n,selectors:[["app-forli"]],decls:7,vars:0,consts:[["src","../../luisdebenito/assets/forli.jpg",1,"img"]],template:function(t,s){1&t&&(Be(0,"h1"),Ye(1,"Forl\xec"),Ge(),Be(2,"p"),Ye(3,"So there I was"),Ge(),Nt(4,"img",0),Be(5,"p"),Ye(6," back and forth between the two mediterranean countries, but then something happened, and a bug called Covid came destroying our program. Inditex, as many other companies that depended on retail services, had to tell me goodbye.\n"),Ge())}}),n})(),gP=(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Zn({type:n,selectors:[["app-santiuste"]],decls:23,vars:0,consts:[["src","../../luisdebenito/assets/santiuste1.jpg",1,"img"],["src","../../luisdebenito/assets/santiuste.jpg",1,"img"],["src","../../luisdebenito/assets/puebleo.jpeg",1,"img"],["src","../../luisdebenito/assets/giunti.png",1,"img"]],template:function(t,s){1&t&&(Be(0,"h1"),Ye(1,"Santiuste de San Juan Bautista"),Ge(),Be(2,"p"),Ye(3," Sad, but with a mind full of energy, I went to where it all started: "),Be(4,"b"),Ye(5,'"Mi pueblo"'),Ge()(),Nt(6,"img",0),Be(7,"p"),Ye(8," I have spent at least one month a year since I am a child in here, where my grandparents used to live, where I have my childhood friends, and where I find peace.\n"),Ge(),Nt(9,"img",1),Be(10,"p"),Ye(11," Here, I decided to spend the pandemic working in a social network called "),Be(12,"b"),Ye(13,"Puebleo"),Ge(),Ye(14,", to improve the situation of rural places in Spain. (it evolved to puebloo.es)\n"),Ge(),Nt(15,"img",2),Be(16,"p"),Ye(17,"After three months, I got hired in"),Ge(),Nt(18,"img",3),Be(19,"p"),Ye(20,"as a remote "),Be(21,"b"),Ye(22,"Senior Software Engineer"),Ge()())}}),n})(),_P=(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Zn({type:n,selectors:[["app-madrid3"]],decls:16,vars:0,consts:[["src","../../luisdebenito/assets/nexplore.jpeg",1,"img"],["src","../../luisdebenito/assets/forrest.jpg",1,"img"]],template:function(t,s){1&t&&(Be(0,"h1"),Ye(1,"Madrid"),Ge(),Be(2,"p"),Ye(3," And we arrive to the end, two years ago I was hired as a remote "),Be(4,"b"),Ye(5,"Senior Software Engineer"),Ge(),Ye(6," in\n"),Ge(),Nt(7,"img",0),Be(8,"p"),Ye(9,"and I decided to move back to Madrid"),Ge(),Be(10,"p")(11,"i"),Ye(12,"Now, I am waiting to take the bus number 9 to go find Jenny, she says she has something important to tell me"),Ge()(),Nt(13,"img",1),Be(14,"p"),Ye(15," I cound not resist the chance to mention my favorite movie, and the day I got into forrest skin.\n"),Ge())}}),n})(),yP=(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Zn({type:n,selectors:[["app-final"]],decls:27,vars:0,consts:[["src","../../luisdebenito/assets/radio.jpg",1,"img"],["src","../../luisdebenito/assets/snow.jpg",1,"img"],["src","../../luisdebenito/assets/bike.jpg",1,"img"],["src","../../luisdebenito/assets/camper.jpeg",1,"img"],["src","../../luisdebenito/assets/code.jpeg",1,"img"],[1,"jumping"],[1,"colors"],[1,"backgroundMoving"],[1,"flipY"]],template:function(t,s){1&t&&(Be(0,"h1"),Ye(1,"The end, almost..."),Ge(),Be(2,"p"),Ye(3," Last but not least, some crazy achievements (if you can call them that) I am quite proud of\n"),Ge(),Be(4,"p"),Ye(5,"I did an interview in the radio (no kidding)"),Ge(),Nt(6,"img",0),Be(7,"p"),Ye(8,"I created my own version of a snowboard (ski+skate)"),Ge(),Nt(9,"img",1),Be(10,"p"),Ye(11,"I also built my own bike"),Ge(),Nt(12,"img",2),Be(13,"p"),Ye(14,"I am campering my van"),Ge(),Nt(15,"img",3),Be(16,"p"),Ye(17,"And I am such a nerd, had to include a bit of code"),Ge(),Nt(18,"img",4),Be(19,"h1",5),Ye(20,"Thanks for arriving to the end"),Ge(),Be(21,"h1",6),Ye(22,"I hope you enjoyed a bit of my world"),Ge(),Be(23,"h1",7),Ye(24,"DO NOT FORGET TO CLICK ON THE CONTACT BUTTON"),Ge(),Be(25,"h1",8),Ye(26,"Song: kokoroko, Abusey Junction"),Ge())}}),n})();function vP(n,e){1&n&&Nt(0,"app-intro")}function xP(n,e){1&n&&Nt(0,"app-segovia")}function bP(n,e){1&n&&Nt(0,"app-dublin")}function wP(n,e){1&n&&Nt(0,"app-iowa")}function EP(n,e){1&n&&Nt(0,"app-madrid1")}function TP(n,e){1&n&&Nt(0,"app-rusia")}function DP(n,e){1&n&&Nt(0,"app-madrid2")}function CP(n,e){1&n&&Nt(0,"app-malta")}function IP(n,e){1&n&&Nt(0,"app-venecia")}function SP(n,e){1&n&&Nt(0,"app-suecia")}function MP(n,e){1&n&&Nt(0,"app-germany")}function AP(n,e){1&n&&Nt(0,"app-india")}function PP(n,e){1&n&&Nt(0,"app-coruna")}function LP(n,e){1&n&&Nt(0,"app-forli")}function kP(n,e){1&n&&Nt(0,"app-santiuste")}function RP(n,e){1&n&&Nt(0,"app-madrid3")}function OP(n,e){1&n&&Nt(0,"app-final")}function FP(n,e){if(1&n){const t=iu();Be(0,"p-button",22),Fo("click",function(){return Pr(t),Lr(fi(2).playAudio())}),Ge()}}function NP(n,e){if(1&n){const t=iu();Be(0,"p-button",23),Fo("click",function(){return Pr(t),Lr(fi(2).pauseAudio())}),Ge()}}function zP(n,e){if(1&n){const t=iu();Be(0,"div",12)(1,"div",13)(2,"div",14),Pn(3,vP,1,0,"app-intro",15),Pn(4,xP,1,0,"app-segovia",15),Pn(5,bP,1,0,"app-dublin",15),Pn(6,wP,1,0,"app-iowa",15),Pn(7,EP,1,0,"app-madrid1",15),Pn(8,TP,1,0,"app-rusia",15),Pn(9,DP,1,0,"app-madrid2",15),Pn(10,CP,1,0,"app-malta",15),Pn(11,IP,1,0,"app-venecia",15),Pn(12,SP,1,0,"app-suecia",15),Pn(13,MP,1,0,"app-germany",15),Pn(14,AP,1,0,"app-india",15),Pn(15,PP,1,0,"app-coruna",15),Pn(16,LP,1,0,"app-forli",15),Pn(17,kP,1,0,"app-santiuste",15),Pn(18,RP,1,0,"app-madrid3",15),Pn(19,OP,1,0,"app-final",15),Ge()(),Be(20,"div",16)(21,"p-button",17),Fo("click",function(){return Pr(t),Lr(fi().back())}),Ge(),Pn(22,FP,1,0,"p-button",18),Pn(23,NP,1,0,"p-button",19),Be(24,"p-button",20),Fo("click",function(){return Pr(t),Lr(fi().showContact=!0)}),Ge(),Be(25,"p-button",21),Fo("click",function(){return Pr(t),Lr(fi().next())}),Ge()()()}if(2&n){const t=fi();Rt(3),Ht("ngIf",0==t.selected),Rt(1),Ht("ngIf",1==t.selected),Rt(1),Ht("ngIf",2==t.selected),Rt(1),Ht("ngIf",3==t.selected),Rt(1),Ht("ngIf",4==t.selected),Rt(1),Ht("ngIf",5==t.selected),Rt(1),Ht("ngIf",6==t.selected),Rt(1),Ht("ngIf",7==t.selected),Rt(1),Ht("ngIf",8==t.selected),Rt(1),Ht("ngIf",9==t.selected),Rt(1),Ht("ngIf",10==t.selected),Rt(1),Ht("ngIf",11==t.selected),Rt(1),Ht("ngIf",12==t.selected),Rt(1),Ht("ngIf",13==t.selected),Rt(1),Ht("ngIf",14==t.selected),Rt(1),Ht("ngIf",15==t.selected),Rt(1),Ht("ngIf",16==t.selected),Rt(2),Ht("disabled",t.selected<=0),Rt(1),Ht("ngIf",!t.playing),Rt(1),Ht("ngIf",t.playing),Rt(2),Ht("disabled",t.locations.length-1<=t.selected)}}let BP=(()=>{class n{constructor(){this.title="ostoo",this.mapbox=Bx,this.style="mapbox://styles/mapbox/navigation-night-v1",this.showContact=!1,this.selected=0,this.playing=!1,this.locations=[{lt:[0,0]},{lt:[40.951807,-4.105901]},{lt:[53.338793,-6.281146]},{lt:[42.025309,-93.626722]},{lt:[40.429561,-3.713232]},{lt:[59.891037,30.319812]},{lt:[40.4054236,-3.7012379]},{lt:[35.965471,14.391707]},{lt:[45.508237,12.267826]},{lt:[59.333226,18.06828]},{lt:[49.373385,10.180248]},{lt:[17.469947,78.422454]},{lt:[43.365726,-8.411274]},{lt:[44.221248,12.05746]},{lt:[41.15907,-4.570329]},{lt:[40.429492,-3.713082]},{lt:[0,0]}],this.moving=!1,this.mapbox.accessToken="pk.eyJ1Ijoid3lra3NzIiwiYSI6ImNqMjR6aTdmdzAwNHMzMnBvbjBucjlqNm8ifQ.6GjGpofWBVaIuSnhdXQb5w"}ngOnInit(){this.map=new Bx.Map({container:"map",style:this.style,zoom:10,center:[0,0],interactive:!1}),this.initMap(),this.audio=new Audio,this.audio.src="../../../luisdebenito/assets/song.mp3",this.audio.load()}playAudio(){try{this.audio.play(),this.playing=!0}catch{}}pauseAudio(){try{this.audio.pause(),this.playing=!1}catch{}}initMap(){this.drawLocations()}generateRandomColor(){return"#"+Math.floor(16777215*Math.random()).toString(16)}drawLocations(){this.locations.forEach(t=>{0!=t.lt[0]&&new Bx.Marker({color:this.generateRandomColor()}).setLngLat([t.lt[1],t.lt[0]]).addTo(this.map)})}back(){this.selected<=0||(this.selected--,this.fly())}next(){this.selected>=this.locations.length-1||(this.selected++,this.fly())}fly(){this.moving=!0,this.map.flyTo({center:[this.locations[this.selected].lt[1],this.locations[this.selected].lt[0]],essential:!0,speed:1.3,curve:2.2});let t=!1;this.map.on("moveend",()=>{t||(this.moving=!1),t=!0})}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Zn({type:n,selectors:[["app-root"]],decls:20,vars:5,consts:[["id","map",1,"container"],["class","modal","id","mdl",4,"ngIf"],["header","Contact me",3,"visible","modal","draggable","resizable","visibleChange"],[1,"centered"],[1,"pi","pi-linkedin"],["target","_blank","href","https://www.linkedin.com/in/luis-de-benito/"],[1,"pi","pi-envelope"],["target","_blank","href","mailTo:luisdebenito7@gmail.com"],[1,"pi","pi-youtube"],["target","_blank","href","https://www.youtube.com/channel/UCmuxk8hIRsCvwbSldWEwV9g"],[1,"pi","pi-instagram"],["target","_blank","href","https://www.instagram.com/luis.bq_/"],["id","mdl",1,"modal"],[1,"container"],[1,"inContainer"],[4,"ngIf"],[1,"footer"],["pTooltip","Go back","icon","pi pi-arrow-circle-left",1,"button",3,"disabled","click"],["class","button","pTooltip","Play song","tooltipPosition","top","icon","pi pi-play",3,"click",4,"ngIf"],["class","button","pTooltip","Pause song","tooltipPosition","top","icon","pi pi-volume-up pi-spin",3,"click",4,"ngIf"],["pTooltip","Contact me","tooltipPosition","top","icon","pi pi-phone",1,"button",3,"click"],["pTooltip","Go forward","tooltipPosition","top","icon","pi pi-arrow-circle-right",1,"button",3,"disabled","click"],["pTooltip","Play song","tooltipPosition","top","icon","pi pi-play",1,"button",3,"click"],["pTooltip","Pause song","tooltipPosition","top","icon","pi pi-volume-up pi-spin",1,"button",3,"click"]],template:function(t,s){1&t&&(Nt(0,"div",0),Pn(1,zP,26,21,"div",1),Be(2,"p-dialog",2),Fo("visibleChange",function(p){return s.showContact=p}),Be(3,"div",3)(4,"p"),Nt(5,"i",4),Be(6,"a",5),Ye(7,"Luis dB.P."),Ge()(),Be(8,"p"),Nt(9,"i",6),Be(10,"a",7),Ye(11,"luisdebenito7@gmail.com"),Ge()(),Be(12,"p"),Nt(13,"i",8),Be(14,"a",9),Ye(15,"Do NOT click here"),Ge()(),Be(16,"p"),Nt(17,"i",10),Be(18,"a",11),Ye(19,"@luis.bq_"),Ge()()()()),2&t&&(Rt(1),Ht("ngIf",!s.moving),Rt(1),Ht("visible",s.showContact)("modal",!0)("draggable",!1)("resizable",!1))},dependencies:[Ay,v2,Q2,eP,nP,iP,rP,oP,sP,aP,lP,cP,uP,hP,dP,pP,fP,mP,gP,_P,yP],styles:[".container[_ngcontent-%COMP%], .container[_ngcontent-%COMP%]   .map[_ngcontent-%COMP%]{height:100%}.container[_ngcontent-%COMP%]     .mapboxgl-control-container{display:none}.container[_ngcontent-%COMP%]     .customRoom:hover{cursor:pointer}.addRoom[_ngcontent-%COMP%]{position:fixed;right:20px;bottom:20px;background-color:#3f51b5;height:70px;width:70px;border-radius:50%}.addRoom[_ngcontent-%COMP%]:hover{cursor:pointer}.modal[_ngcontent-%COMP%]{background-color:#544008;color:#f0f7ee;border:5px solid #F0F7EE;border-radius:20px;height:98%;position:fixed;z-index:800;top:1%}.modal[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]{width:100%;height:10%;position:absolute;bottom:0;display:flex;justify-content:space-between}.modal[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]{margin:5px 3%}.modal[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]     .button>button{background-color:#e8fccf;border-radius:6px;border-width:0;box-sizing:border-box;color:#544008;outline:none;padding:10px;font-size:25px;font-weight:700;cursor:pointer}.modal[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]{width:100%;height:89%;max-height:89%;overflow-y:auto;position:absolute;top:0}.modal[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .inContainer[_ngcontent-%COMP%]{text-align:center}@media (max-width: 800px){.inContainer[_ngcontent-%COMP%]{margin:20px 3%}.modal[_ngcontent-%COMP%]{width:95%;left:1%}}@media (min-width: 800px){.inContainer[_ngcontent-%COMP%]{margin:20px 20%}.modal[_ngcontent-%COMP%]{width:68%;right:16%}}.centered[_ngcontent-%COMP%]{text-align:left;padding-left:10px}.centered[_ngcontent-%COMP%]   p[_ngcontent-%COMP%] > i[_ngcontent-%COMP%]{margin:15px;font-size:25px}"]}),n})();function MT(n){return new rt(3e3,!1)}function xL(){return typeof window<"u"&&typeof window.document<"u"}function Ux(){return typeof process<"u"&&"[object process]"==={}.toString.call(process)}function Mh(n){switch(n.length){case 0:return new Ig;case 1:return n[0];default:return new CT(n)}}function AT(n,e,t,s,c=new Map,p=new Map){const y=[],w=[];let C=-1,A=null;if(s.forEach(F=>{const V=F.get("offset"),X=V==C,ie=X&&A||new Map;F.forEach((fe,De)=>{let Ne=De,qe=fe;if("offset"!==De)switch(Ne=e.normalizePropertyName(Ne,y),qe){case"!":qe=c.get(De);break;case au:qe=p.get(De);break;default:qe=e.normalizeStyleValue(De,Ne,qe,y)}ie.set(Ne,qe)}),X||w.push(ie),A=ie,C=V}),y.length)throw function lL(n){return new rt(3502,!1)}();return w}function $x(n,e,t,s){switch(e){case"start":n.onStart(()=>s(t&&Gx(t,"start",n)));break;case"done":n.onDone(()=>s(t&&Gx(t,"done",n)));break;case"destroy":n.onDestroy(()=>s(t&&Gx(t,"destroy",n)))}}function Gx(n,e,t){const p=Hx(n.element,n.triggerName,n.fromState,n.toState,e||n.phaseName,t.totalTime??n.totalTime,!!t.disabled),y=n._data;return null!=y&&(p._data=y),p}function Hx(n,e,t,s,c="",p=0,y){return{element:n,triggerName:e,fromState:t,toState:s,phaseName:c,totalTime:p,disabled:!!y}}function Ms(n,e,t){let s=n.get(e);return s||n.set(e,s=t),s}function PT(n){const e=n.indexOf(":");return[n.substring(1,e),n.slice(e+1)]}let qx=(n,e)=>!1,LT=(n,e,t)=>[],kT=null;function Wx(n){const e=n.parentNode||n.host;return e===kT?null:e}(Ux()||typeof Element<"u")&&(xL()?(kT=(()=>document.documentElement)(),qx=(n,e)=>{for(;e;){if(e===n)return!0;e=Wx(e)}return!1}):qx=(n,e)=>n.contains(e),LT=(n,e,t)=>{if(t)return Array.from(n.querySelectorAll(e));const s=n.querySelector(e);return s?[s]:[]});let Vd=null,RT=!1;const OT=qx,FT=LT;let NT=(()=>{class n{validateStyleProperty(t){return function wL(n){Vd||(Vd=function EL(){return typeof document<"u"?document.body:null}()||{},RT=!!Vd.style&&"WebkitAppearance"in Vd.style);let e=!0;return Vd.style&&!function bL(n){return"ebkit"==n.substring(1,6)}(n)&&(e=n in Vd.style,!e&&RT&&(e="Webkit"+n.charAt(0).toUpperCase()+n.slice(1)in Vd.style)),e}(t)}matchesElement(t,s){return!1}containsElement(t,s){return OT(t,s)}getParentElement(t){return Wx(t)}query(t,s,c){return FT(t,s,c)}computeStyle(t,s,c){return c||""}animate(t,s,c,p,y,w=[],C){return new Ig(c,p)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Sn({token:n,factory:n.\u0275fac}),n})(),Zx=(()=>{class n{}return n.NOOP=new NT,n})();const Xx="ng-enter",zy="ng-leave",By="ng-trigger",Vy=".ng-trigger",BT="ng-animating",Kx=".ng-animating";function lu(n){if("number"==typeof n)return n;const e=n.match(/^(-?[\.\d]+)(m?s)/);return!e||e.length<2?0:Yx(parseFloat(e[1]),e[2])}function Yx(n,e){return"s"===e?1e3*n:n}function jy(n,e,t){return n.hasOwnProperty("duration")?n:function CL(n,e,t){let c,p=0,y="";if("string"==typeof n){const w=n.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===w)return e.push(MT()),{duration:0,delay:0,easing:""};c=Yx(parseFloat(w[1]),w[2]);const C=w[3];null!=C&&(p=Yx(parseFloat(C),w[4]));const A=w[5];A&&(y=A)}else c=n;if(!t){let w=!1,C=e.length;c<0&&(e.push(function VP(){return new rt(3100,!1)}()),w=!0),p<0&&(e.push(function jP(){return new rt(3101,!1)}()),w=!0),w&&e.splice(C,0,MT())}return{duration:c,delay:p,easing:y}}(n,e,t)}function Mg(n,e={}){return Object.keys(n).forEach(t=>{e[t]=n[t]}),e}function VT(n){const e=new Map;return Object.keys(n).forEach(t=>{e.set(t,n[t])}),e}function Ah(n,e=new Map,t){if(t)for(let[s,c]of t)e.set(s,c);for(let[s,c]of n)e.set(s,c);return e}function UT(n,e,t){return t?e+":"+t+";":""}function $T(n){let e="";for(let t=0;t<n.style.length;t++){const s=n.style.item(t);e+=UT(0,s,n.style.getPropertyValue(s))}for(const t in n.style)n.style.hasOwnProperty(t)&&!t.startsWith("_")&&(e+=UT(0,AL(t),n.style[t]));n.setAttribute("style",e)}function Zl(n,e,t){n.style&&(e.forEach((s,c)=>{const p=Jx(c);t&&!t.has(c)&&t.set(c,n.style[p]),n.style[p]=s}),Ux()&&$T(n))}function jd(n,e){n.style&&(e.forEach((t,s)=>{const c=Jx(s);n.style[c]=""}),Ux()&&$T(n))}function Ag(n){return Array.isArray(n)?1==n.length?n[0]:bT(n):n}const Qx=new RegExp("{{\\s*(.+?)\\s*}}","g");function GT(n){let e=[];if("string"==typeof n){let t;for(;t=Qx.exec(n);)e.push(t[1]);Qx.lastIndex=0}return e}function Pg(n,e,t){const s=n.toString(),c=s.replace(Qx,(p,y)=>{let w=e[y];return null==w&&(t.push(function $P(n){return new rt(3003,!1)}()),w=""),w.toString()});return c==s?n:c}function Uy(n){const e=[];let t=n.next();for(;!t.done;)e.push(t.value),t=n.next();return e}const ML=/-+([a-z0-9])/g;function Jx(n){return n.replace(ML,(...e)=>e[1].toUpperCase())}function AL(n){return n.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function As(n,e,t){switch(e.type){case 7:return n.visitTrigger(e,t);case 0:return n.visitState(e,t);case 1:return n.visitTransition(e,t);case 2:return n.visitSequence(e,t);case 3:return n.visitGroup(e,t);case 4:return n.visitAnimate(e,t);case 5:return n.visitKeyframes(e,t);case 6:return n.visitStyle(e,t);case 8:return n.visitReference(e,t);case 9:return n.visitAnimateChild(e,t);case 10:return n.visitAnimateRef(e,t);case 11:return n.visitQuery(e,t);case 12:return n.visitStagger(e,t);default:throw function GP(n){return new rt(3004,!1)}()}}function HT(n,e){return window.getComputedStyle(n)[e]}function FL(n,e){const t=[];return"string"==typeof n?n.split(/\s*,\s*/).forEach(s=>function NL(n,e,t){if(":"==n[0]){const C=function zL(n,e){switch(n){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(t,s)=>parseFloat(s)>parseFloat(t);case":decrement":return(t,s)=>parseFloat(s)<parseFloat(t);default:return e.push(function rL(n){return new rt(3016,!1)}()),"* => *"}}(n,t);if("function"==typeof C)return void e.push(C);n=C}const s=n.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==s||s.length<4)return t.push(function iL(n){return new rt(3015,!1)}()),e;const c=s[1],p=s[2],y=s[3];e.push(qT(c,y));"<"==p[0]&&!("*"==c&&"*"==y)&&e.push(qT(y,c))}(s,t,e)):t.push(n),t}const qy=new Set(["true","1"]),Wy=new Set(["false","0"]);function qT(n,e){const t=qy.has(n)||Wy.has(n),s=qy.has(e)||Wy.has(e);return(c,p)=>{let y="*"==n||n==c,w="*"==e||e==p;return!y&&t&&"boolean"==typeof c&&(y=c?qy.has(n):Wy.has(n)),!w&&s&&"boolean"==typeof p&&(w=p?qy.has(e):Wy.has(e)),y&&w}}const BL=new RegExp("s*:selfs*,?","g");function e1(n,e,t,s){return new VL(n).build(e,t,s)}class VL{constructor(e){this._driver=e}build(e,t,s){const c=new $L(t);return this._resetContextStyleTimingState(c),As(this,Ag(e),c)}_resetContextStyleTimingState(e){e.currentQuerySelector="",e.collectedStyles=new Map,e.collectedStyles.set("",new Map),e.currentTime=0}visitTrigger(e,t){let s=t.queryCount=0,c=t.depCount=0;const p=[],y=[];return"@"==e.name.charAt(0)&&t.errors.push(function qP(){return new rt(3006,!1)}()),e.definitions.forEach(w=>{if(this._resetContextStyleTimingState(t),0==w.type){const C=w,A=C.name;A.toString().split(/\s*,\s*/).forEach(F=>{C.name=F,p.push(this.visitState(C,t))}),C.name=A}else if(1==w.type){const C=this.visitTransition(w,t);s+=C.queryCount,c+=C.depCount,y.push(C)}else t.errors.push(function WP(){return new rt(3007,!1)}())}),{type:7,name:e.name,states:p,transitions:y,queryCount:s,depCount:c,options:null}}visitState(e,t){const s=this.visitStyle(e.styles,t),c=e.options&&e.options.params||null;if(s.containsDynamicStyles){const p=new Set,y=c||{};s.styles.forEach(w=>{w instanceof Map&&w.forEach(C=>{GT(C).forEach(A=>{y.hasOwnProperty(A)||p.add(A)})})}),p.size&&(Uy(p.values()),t.errors.push(function ZP(n,e){return new rt(3008,!1)}()))}return{type:0,name:e.name,style:s,options:c?{params:c}:null}}visitTransition(e,t){t.queryCount=0,t.depCount=0;const s=As(this,Ag(e.animation),t);return{type:1,matchers:FL(e.expr,t.errors),animation:s,queryCount:t.queryCount,depCount:t.depCount,options:Ud(e.options)}}visitSequence(e,t){return{type:2,steps:e.steps.map(s=>As(this,s,t)),options:Ud(e.options)}}visitGroup(e,t){const s=t.currentTime;let c=0;const p=e.steps.map(y=>{t.currentTime=s;const w=As(this,y,t);return c=Math.max(c,t.currentTime),w});return t.currentTime=c,{type:3,steps:p,options:Ud(e.options)}}visitAnimate(e,t){const s=function HL(n,e){if(n.hasOwnProperty("duration"))return n;if("number"==typeof n)return t1(jy(n,e).duration,0,"");const t=n;if(t.split(/\s+/).some(p=>"{"==p.charAt(0)&&"{"==p.charAt(1))){const p=t1(0,0,"");return p.dynamic=!0,p.strValue=t,p}const c=jy(t,e);return t1(c.duration,c.delay,c.easing)}(e.timings,t.errors);t.currentAnimateTimings=s;let c,p=e.styles?e.styles:Ny({});if(5==p.type)c=this.visitKeyframes(p,t);else{let y=e.styles,w=!1;if(!y){w=!0;const A={};s.easing&&(A.easing=s.easing),y=Ny(A)}t.currentTime+=s.duration+s.delay;const C=this.visitStyle(y,t);C.isEmptyStep=w,c=C}return t.currentAnimateTimings=null,{type:4,timings:s,style:c,options:null}}visitStyle(e,t){const s=this._makeStyleAst(e,t);return this._validateStyleAst(s,t),s}_makeStyleAst(e,t){const s=[],c=Array.isArray(e.styles)?e.styles:[e.styles];for(let w of c)"string"==typeof w?w===au?s.push(w):t.errors.push(new rt(3002,!1)):s.push(VT(w));let p=!1,y=null;return s.forEach(w=>{if(w instanceof Map&&(w.has("easing")&&(y=w.get("easing"),w.delete("easing")),!p))for(let C of w.values())if(C.toString().indexOf("{{")>=0){p=!0;break}}),{type:6,styles:s,easing:y,offset:e.offset,containsDynamicStyles:p,options:null}}_validateStyleAst(e,t){const s=t.currentAnimateTimings;let c=t.currentTime,p=t.currentTime;s&&p>0&&(p-=s.duration+s.delay),e.styles.forEach(y=>{"string"!=typeof y&&y.forEach((w,C)=>{const A=t.collectedStyles.get(t.currentQuerySelector),F=A.get(C);let V=!0;F&&(p!=c&&p>=F.startTime&&c<=F.endTime&&(t.errors.push(function KP(n,e,t,s,c){return new rt(3010,!1)}()),V=!1),p=F.startTime),V&&A.set(C,{startTime:p,endTime:c}),t.options&&function SL(n,e,t){const s=e.params||{},c=GT(n);c.length&&c.forEach(p=>{s.hasOwnProperty(p)||t.push(function UP(n){return new rt(3001,!1)}())})}(w,t.options,t.errors)})})}visitKeyframes(e,t){const s={type:5,styles:[],options:null};if(!t.currentAnimateTimings)return t.errors.push(function YP(){return new rt(3011,!1)}()),s;let p=0;const y=[];let w=!1,C=!1,A=0;const F=e.steps.map(qe=>{const ct=this._makeStyleAst(qe,t);let Ve=null!=ct.offset?ct.offset:function GL(n){if("string"==typeof n)return null;let e=null;if(Array.isArray(n))n.forEach(t=>{if(t instanceof Map&&t.has("offset")){const s=t;e=parseFloat(s.get("offset")),s.delete("offset")}});else if(n instanceof Map&&n.has("offset")){const t=n;e=parseFloat(t.get("offset")),t.delete("offset")}return e}(ct.styles),vt=0;return null!=Ve&&(p++,vt=ct.offset=Ve),C=C||vt<0||vt>1,w=w||vt<A,A=vt,y.push(vt),ct});C&&t.errors.push(function QP(){return new rt(3012,!1)}()),w&&t.errors.push(function JP(){return new rt(3200,!1)}());const V=e.steps.length;let X=0;p>0&&p<V?t.errors.push(function eL(){return new rt(3202,!1)}()):0==p&&(X=1/(V-1));const ie=V-1,fe=t.currentTime,De=t.currentAnimateTimings,Ne=De.duration;return F.forEach((qe,ct)=>{const Ve=X>0?ct==ie?1:X*ct:y[ct],vt=Ve*Ne;t.currentTime=fe+De.delay+vt,De.duration=vt,this._validateStyleAst(qe,t),qe.offset=Ve,s.styles.push(qe)}),s}visitReference(e,t){return{type:8,animation:As(this,Ag(e.animation),t),options:Ud(e.options)}}visitAnimateChild(e,t){return t.depCount++,{type:9,options:Ud(e.options)}}visitAnimateRef(e,t){return{type:10,animation:this.visitReference(e.animation,t),options:Ud(e.options)}}visitQuery(e,t){const s=t.currentQuerySelector,c=e.options||{};t.queryCount++,t.currentQuery=e;const[p,y]=function jL(n){const e=!!n.split(/\s*,\s*/).find(t=>":self"==t);return e&&(n=n.replace(BL,"")),n=n.replace(/@\*/g,Vy).replace(/@\w+/g,t=>Vy+"-"+t.slice(1)).replace(/:animating/g,Kx),[n,e]}(e.selector);t.currentQuerySelector=s.length?s+" "+p:p,Ms(t.collectedStyles,t.currentQuerySelector,new Map);const w=As(this,Ag(e.animation),t);return t.currentQuery=null,t.currentQuerySelector=s,{type:11,selector:p,limit:c.limit||0,optional:!!c.optional,includeSelf:y,animation:w,originalSelector:e.selector,options:Ud(e.options)}}visitStagger(e,t){t.currentQuery||t.errors.push(function tL(){return new rt(3013,!1)}());const s="full"===e.timings?{duration:0,delay:0,easing:"full"}:jy(e.timings,t.errors,!0);return{type:12,animation:As(this,Ag(e.animation),t),timings:s,options:null}}}class $L{constructor(e){this.errors=e,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}}function Ud(n){return n?(n=Mg(n)).params&&(n.params=function UL(n){return n?Mg(n):null}(n.params)):n={},n}function t1(n,e,t){return{duration:n,delay:e,easing:t}}function n1(n,e,t,s,c,p,y=null,w=!1){return{type:1,element:n,keyframes:e,preStyleProps:t,postStyleProps:s,duration:c,delay:p,totalTime:c+p,easing:y,subTimeline:w}}class Zy{constructor(){this._map=new Map}get(e){return this._map.get(e)||[]}append(e,t){let s=this._map.get(e);s||this._map.set(e,s=[]),s.push(...t)}has(e){return this._map.has(e)}clear(){this._map.clear()}}const ZL=new RegExp(":enter","g"),KL=new RegExp(":leave","g");function i1(n,e,t,s,c,p=new Map,y=new Map,w,C,A=[]){return(new YL).buildKeyframes(n,e,t,s,c,p,y,w,C,A)}class YL{buildKeyframes(e,t,s,c,p,y,w,C,A,F=[]){A=A||new Zy;const V=new r1(e,t,A,c,p,F,[]);V.options=C;const X=C.delay?lu(C.delay):0;V.currentTimeline.delayNextStep(X),V.currentTimeline.setStyles([y],null,V.errors,C),As(this,s,V);const ie=V.timelines.filter(fe=>fe.containsAnimation());if(ie.length&&w.size){let fe;for(let De=ie.length-1;De>=0;De--){const Ne=ie[De];if(Ne.element===t){fe=Ne;break}}fe&&!fe.allowOnlyTimelineStyles()&&fe.setStyles([w],null,V.errors,C)}return ie.length?ie.map(fe=>fe.buildKeyframes()):[n1(t,[],[],[],0,X,"",!1)]}visitTrigger(e,t){}visitState(e,t){}visitTransition(e,t){}visitAnimateChild(e,t){const s=t.subInstructions.get(t.element);if(s){const c=t.createSubContext(e.options),p=t.currentTimeline.currentTime,y=this._visitSubInstructions(s,c,c.options);p!=y&&t.transformIntoNewTimeline(y)}t.previousNode=e}visitAnimateRef(e,t){const s=t.createSubContext(e.options);s.transformIntoNewTimeline(),this._applyAnimationRefDelays([e.options,e.animation.options],t,s),this.visitReference(e.animation,s),t.transformIntoNewTimeline(s.currentTimeline.currentTime),t.previousNode=e}_applyAnimationRefDelays(e,t,s){for(const c of e){const p=c?.delay;if(p){const y="number"==typeof p?p:lu(Pg(p,c?.params??{},t.errors));s.delayNextStep(y)}}}_visitSubInstructions(e,t,s){let p=t.currentTimeline.currentTime;const y=null!=s.duration?lu(s.duration):null,w=null!=s.delay?lu(s.delay):null;return 0!==y&&e.forEach(C=>{const A=t.appendInstructionToTimeline(C,y,w);p=Math.max(p,A.duration+A.delay)}),p}visitReference(e,t){t.updateOptions(e.options,!0),As(this,e.animation,t),t.previousNode=e}visitSequence(e,t){const s=t.subContextCount;let c=t;const p=e.options;if(p&&(p.params||p.delay)&&(c=t.createSubContext(p),c.transformIntoNewTimeline(),null!=p.delay)){6==c.previousNode.type&&(c.currentTimeline.snapshotCurrentStyles(),c.previousNode=Xy);const y=lu(p.delay);c.delayNextStep(y)}e.steps.length&&(e.steps.forEach(y=>As(this,y,c)),c.currentTimeline.applyStylesToKeyframe(),c.subContextCount>s&&c.transformIntoNewTimeline()),t.previousNode=e}visitGroup(e,t){const s=[];let c=t.currentTimeline.currentTime;const p=e.options&&e.options.delay?lu(e.options.delay):0;e.steps.forEach(y=>{const w=t.createSubContext(e.options);p&&w.delayNextStep(p),As(this,y,w),c=Math.max(c,w.currentTimeline.currentTime),s.push(w.currentTimeline)}),s.forEach(y=>t.currentTimeline.mergeTimelineCollectedStyles(y)),t.transformIntoNewTimeline(c),t.previousNode=e}_visitTiming(e,t){if(e.dynamic){const s=e.strValue;return jy(t.params?Pg(s,t.params,t.errors):s,t.errors)}return{duration:e.duration,delay:e.delay,easing:e.easing}}visitAnimate(e,t){const s=t.currentAnimateTimings=this._visitTiming(e.timings,t),c=t.currentTimeline;s.delay&&(t.incrementTime(s.delay),c.snapshotCurrentStyles());const p=e.style;5==p.type?this.visitKeyframes(p,t):(t.incrementTime(s.duration),this.visitStyle(p,t),c.applyStylesToKeyframe()),t.currentAnimateTimings=null,t.previousNode=e}visitStyle(e,t){const s=t.currentTimeline,c=t.currentAnimateTimings;!c&&s.hasCurrentStyleProperties()&&s.forwardFrame();const p=c&&c.easing||e.easing;e.isEmptyStep?s.applyEmptyStep(p):s.setStyles(e.styles,p,t.errors,t.options),t.previousNode=e}visitKeyframes(e,t){const s=t.currentAnimateTimings,c=t.currentTimeline.duration,p=s.duration,w=t.createSubContext().currentTimeline;w.easing=s.easing,e.styles.forEach(C=>{w.forwardTime((C.offset||0)*p),w.setStyles(C.styles,C.easing,t.errors,t.options),w.applyStylesToKeyframe()}),t.currentTimeline.mergeTimelineCollectedStyles(w),t.transformIntoNewTimeline(c+p),t.previousNode=e}visitQuery(e,t){const s=t.currentTimeline.currentTime,c=e.options||{},p=c.delay?lu(c.delay):0;p&&(6===t.previousNode.type||0==s&&t.currentTimeline.hasCurrentStyleProperties())&&(t.currentTimeline.snapshotCurrentStyles(),t.previousNode=Xy);let y=s;const w=t.invokeQuery(e.selector,e.originalSelector,e.limit,e.includeSelf,!!c.optional,t.errors);t.currentQueryTotal=w.length;let C=null;w.forEach((A,F)=>{t.currentQueryIndex=F;const V=t.createSubContext(e.options,A);p&&V.delayNextStep(p),A===t.element&&(C=V.currentTimeline),As(this,e.animation,V),V.currentTimeline.applyStylesToKeyframe(),y=Math.max(y,V.currentTimeline.currentTime)}),t.currentQueryIndex=0,t.currentQueryTotal=0,t.transformIntoNewTimeline(y),C&&(t.currentTimeline.mergeTimelineCollectedStyles(C),t.currentTimeline.snapshotCurrentStyles()),t.previousNode=e}visitStagger(e,t){const s=t.parentContext,c=t.currentTimeline,p=e.timings,y=Math.abs(p.duration),w=y*(t.currentQueryTotal-1);let C=y*t.currentQueryIndex;switch(p.duration<0?"reverse":p.easing){case"reverse":C=w-C;break;case"full":C=s.currentStaggerTime}const F=t.currentTimeline;C&&F.delayNextStep(C);const V=F.currentTime;As(this,e.animation,t),t.previousNode=e,s.currentStaggerTime=c.currentTime-V+(c.startTime-s.currentTimeline.startTime)}}const Xy={};class r1{constructor(e,t,s,c,p,y,w,C){this._driver=e,this.element=t,this.subInstructions=s,this._enterClassName=c,this._leaveClassName=p,this.errors=y,this.timelines=w,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=Xy,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=C||new Ky(this._driver,t,0),w.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(e,t){if(!e)return;const s=e;let c=this.options;null!=s.duration&&(c.duration=lu(s.duration)),null!=s.delay&&(c.delay=lu(s.delay));const p=s.params;if(p){let y=c.params;y||(y=this.options.params={}),Object.keys(p).forEach(w=>{(!t||!y.hasOwnProperty(w))&&(y[w]=Pg(p[w],y,this.errors))})}}_copyOptions(){const e={};if(this.options){const t=this.options.params;if(t){const s=e.params={};Object.keys(t).forEach(c=>{s[c]=t[c]})}}return e}createSubContext(e=null,t,s){const c=t||this.element,p=new r1(this._driver,c,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(c,s||0));return p.previousNode=this.previousNode,p.currentAnimateTimings=this.currentAnimateTimings,p.options=this._copyOptions(),p.updateOptions(e),p.currentQueryIndex=this.currentQueryIndex,p.currentQueryTotal=this.currentQueryTotal,p.parentContext=this,this.subContextCount++,p}transformIntoNewTimeline(e){return this.previousNode=Xy,this.currentTimeline=this.currentTimeline.fork(this.element,e),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(e,t,s){const c={duration:t??e.duration,delay:this.currentTimeline.currentTime+(s??0)+e.delay,easing:""},p=new QL(this._driver,e.element,e.keyframes,e.preStyleProps,e.postStyleProps,c,e.stretchStartingKeyframe);return this.timelines.push(p),c}incrementTime(e){this.currentTimeline.forwardTime(this.currentTimeline.duration+e)}delayNextStep(e){e>0&&this.currentTimeline.delayNextStep(e)}invokeQuery(e,t,s,c,p,y){let w=[];if(c&&w.push(this.element),e.length>0){e=(e=e.replace(ZL,"."+this._enterClassName)).replace(KL,"."+this._leaveClassName);let A=this._driver.query(this.element,e,1!=s);0!==s&&(A=s<0?A.slice(A.length+s,A.length):A.slice(0,s)),w.push(...A)}return!p&&0==w.length&&y.push(function nL(n){return new rt(3014,!1)}()),w}}class Ky{constructor(e,t,s,c){this._driver=e,this.element=t,this.startTime=s,this._elementTimelineStylesLookup=c,this.duration=0,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(t),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(t,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(e){const t=1===this._keyframes.size&&this._pendingStyles.size;this.duration||t?(this.forwardTime(this.currentTime+e),t&&this.snapshotCurrentStyles()):this.startTime+=e}fork(e,t){return this.applyStylesToKeyframe(),new Ky(this._driver,e,t||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(e){this.applyStylesToKeyframe(),this.duration=e,this._loadKeyframe()}_updateStyle(e,t){this._localTimelineStyles.set(e,t),this._globalTimelineStyles.set(e,t),this._styleSummary.set(e,{time:this.currentTime,value:t})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(e){e&&this._previousKeyframe.set("easing",e);for(let[t,s]of this._globalTimelineStyles)this._backFill.set(t,s||au),this._currentKeyframe.set(t,au);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(e,t,s,c){t&&this._previousKeyframe.set("easing",t);const p=c&&c.params||{},y=function JL(n,e){const t=new Map;let s;return n.forEach(c=>{if("*"===c){s=s||e.keys();for(let p of s)t.set(p,au)}else Ah(c,t)}),t}(e,this._globalTimelineStyles);for(let[w,C]of y){const A=Pg(C,p,s);this._pendingStyles.set(w,A),this._localTimelineStyles.has(w)||this._backFill.set(w,this._globalTimelineStyles.get(w)??au),this._updateStyle(w,A)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((e,t)=>{this._currentKeyframe.set(t,e)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((e,t)=>{this._currentKeyframe.has(t)||this._currentKeyframe.set(t,e)}))}snapshotCurrentStyles(){for(let[e,t]of this._localTimelineStyles)this._pendingStyles.set(e,t),this._updateStyle(e,t)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const e=[];for(let t in this._currentKeyframe)e.push(t);return e}mergeTimelineCollectedStyles(e){e._styleSummary.forEach((t,s)=>{const c=this._styleSummary.get(s);(!c||t.time>c.time)&&this._updateStyle(s,t.value)})}buildKeyframes(){this.applyStylesToKeyframe();const e=new Set,t=new Set,s=1===this._keyframes.size&&0===this.duration;let c=[];this._keyframes.forEach((w,C)=>{const A=Ah(w,new Map,this._backFill);A.forEach((F,V)=>{"!"===F?e.add(V):F===au&&t.add(V)}),s||A.set("offset",C/this.duration),c.push(A)});const p=e.size?Uy(e.values()):[],y=t.size?Uy(t.values()):[];if(s){const w=c[0],C=new Map(w);w.set("offset",0),C.set("offset",1),c=[w,C]}return n1(this.element,c,p,y,this.duration,this.startTime,this.easing,!1)}}class QL extends Ky{constructor(e,t,s,c,p,y,w=!1){super(e,t,y.delay),this.keyframes=s,this.preStyleProps=c,this.postStyleProps=p,this._stretchStartingKeyframe=w,this.timings={duration:y.duration,delay:y.delay,easing:y.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let e=this.keyframes,{delay:t,duration:s,easing:c}=this.timings;if(this._stretchStartingKeyframe&&t){const p=[],y=s+t,w=t/y,C=Ah(e[0]);C.set("offset",0),p.push(C);const A=Ah(e[0]);A.set("offset",XT(w)),p.push(A);const F=e.length-1;for(let V=1;V<=F;V++){let X=Ah(e[V]);const ie=X.get("offset");X.set("offset",XT((t+ie*s)/y)),p.push(X)}s=y,t=0,c="",e=p}return n1(this.element,e,this.preStyleProps,this.postStyleProps,s,t,c,!0)}}function XT(n,e=3){const t=Math.pow(10,e-1);return Math.round(n*t)/t}class o1{}const ek=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]);class tk extends o1{normalizePropertyName(e,t){return Jx(e)}normalizeStyleValue(e,t,s,c){let p="";const y=s.toString().trim();if(ek.has(t)&&0!==s&&"0"!==s)if("number"==typeof s)p="px";else{const w=s.match(/^[+-]?[\d\.]+([a-z]*)$/);w&&0==w[1].length&&c.push(function HP(n,e){return new rt(3005,!1)}())}return y+p}}function KT(n,e,t,s,c,p,y,w,C,A,F,V,X){return{type:0,element:n,triggerName:e,isRemovalTransition:c,fromState:t,fromStyles:p,toState:s,toStyles:y,timelines:w,queriedElements:C,preStyleProps:A,postStyleProps:F,totalTime:V,errors:X}}const s1={};class YT{constructor(e,t,s){this._triggerName=e,this.ast=t,this._stateStyles=s}match(e,t,s,c){return function nk(n,e,t,s,c){return n.some(p=>p(e,t,s,c))}(this.ast.matchers,e,t,s,c)}buildStyles(e,t,s){let c=this._stateStyles.get("*");return void 0!==e&&(c=this._stateStyles.get(e?.toString())||c),c?c.buildStyles(t,s):new Map}build(e,t,s,c,p,y,w,C,A,F){const V=[],X=this.ast.options&&this.ast.options.params||s1,fe=this.buildStyles(s,w&&w.params||s1,V),De=C&&C.params||s1,Ne=this.buildStyles(c,De,V),qe=new Set,ct=new Map,Ve=new Map,vt="void"===c,gn={params:ik(De,X),delay:this.ast.options?.delay},Bn=F?[]:i1(e,t,this.ast.animation,p,y,fe,Ne,gn,A,V);let Mi=0;if(Bn.forEach(Ls=>{Mi=Math.max(Ls.duration+Ls.delay,Mi)}),V.length)return KT(t,this._triggerName,s,c,vt,fe,Ne,[],[],ct,Ve,Mi,V);Bn.forEach(Ls=>{const ks=Ls.element,kf=Ms(ct,ks,new Set);Ls.preStyleProps.forEach(al=>kf.add(al));const cu=Ms(Ve,ks,new Set);Ls.postStyleProps.forEach(al=>cu.add(al)),ks!==t&&qe.add(ks)});const Ps=Uy(qe.values());return KT(t,this._triggerName,s,c,vt,fe,Ne,Bn,Ps,ct,Ve,Mi)}}function ik(n,e){const t=Mg(e);for(const s in n)n.hasOwnProperty(s)&&null!=n[s]&&(t[s]=n[s]);return t}class rk{constructor(e,t,s){this.styles=e,this.defaultParams=t,this.normalizer=s}buildStyles(e,t){const s=new Map,c=Mg(this.defaultParams);return Object.keys(e).forEach(p=>{const y=e[p];null!==y&&(c[p]=y)}),this.styles.styles.forEach(p=>{"string"!=typeof p&&p.forEach((y,w)=>{y&&(y=Pg(y,c,t));const C=this.normalizer.normalizePropertyName(w,t);y=this.normalizer.normalizeStyleValue(w,C,y,t),s.set(C,y)})}),s}}class sk{constructor(e,t,s){this.name=e,this.ast=t,this._normalizer=s,this.transitionFactories=[],this.states=new Map,t.states.forEach(c=>{this.states.set(c.name,new rk(c.style,c.options&&c.options.params||{},s))}),QT(this.states,"true","1"),QT(this.states,"false","0"),t.transitions.forEach(c=>{this.transitionFactories.push(new YT(e,c,this.states))}),this.fallbackTransition=function ak(n,e,t){return new YT(n,{type:1,animation:{type:2,steps:[],options:null},matchers:[(y,w)=>!0],options:null,queryCount:0,depCount:0},e)}(e,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(e,t,s,c){return this.transitionFactories.find(y=>y.match(e,t,s,c))||null}matchStyles(e,t,s){return this.fallbackTransition.buildStyles(e,t,s)}}function QT(n,e,t){n.has(e)?n.has(t)||n.set(t,n.get(e)):n.has(t)&&n.set(e,n.get(t))}const lk=new Zy;class ck{constructor(e,t,s){this.bodyNode=e,this._driver=t,this._normalizer=s,this._animations=new Map,this._playersById=new Map,this.players=[]}register(e,t){const s=[],p=e1(this._driver,t,s,[]);if(s.length)throw function cL(n){return new rt(3503,!1)}();this._animations.set(e,p)}_buildPlayer(e,t,s){const c=e.element,p=AT(0,this._normalizer,0,e.keyframes,t,s);return this._driver.animate(c,p,e.duration,e.delay,e.easing,[],!0)}create(e,t,s={}){const c=[],p=this._animations.get(e);let y;const w=new Map;if(p?(y=i1(this._driver,t,p,Xx,zy,new Map,new Map,s,lk,c),y.forEach(F=>{const V=Ms(w,F.element,new Map);F.postStyleProps.forEach(X=>V.set(X,null))})):(c.push(function uL(){return new rt(3300,!1)}()),y=[]),c.length)throw function hL(n){return new rt(3504,!1)}();w.forEach((F,V)=>{F.forEach((X,ie)=>{F.set(ie,this._driver.computeStyle(V,ie,au))})});const A=Mh(y.map(F=>{const V=w.get(F.element);return this._buildPlayer(F,new Map,V)}));return this._playersById.set(e,A),A.onDestroy(()=>this.destroy(e)),this.players.push(A),A}destroy(e){const t=this._getPlayer(e);t.destroy(),this._playersById.delete(e);const s=this.players.indexOf(t);s>=0&&this.players.splice(s,1)}_getPlayer(e){const t=this._playersById.get(e);if(!t)throw function dL(n){return new rt(3301,!1)}();return t}listen(e,t,s,c){const p=Hx(t,"","","");return $x(this._getPlayer(e),s,p,c),()=>{}}command(e,t,s,c){if("register"==s)return void this.register(e,c[0]);if("create"==s)return void this.create(e,t,c[0]||{});const p=this._getPlayer(e);switch(s){case"play":p.play();break;case"pause":p.pause();break;case"reset":p.reset();break;case"restart":p.restart();break;case"finish":p.finish();break;case"init":p.init();break;case"setPosition":p.setPosition(parseFloat(c[0]));break;case"destroy":this.destroy(e)}}}const JT="ng-animate-queued",a1="ng-animate-disabled",fk=[],eD={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},mk={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},ga="__ng_removed";class l1{constructor(e,t=""){this.namespaceId=t;const s=e&&e.hasOwnProperty("value");if(this.value=function vk(n){return n??null}(s?e.value:e),s){const p=Mg(e);delete p.value,this.options=p}else this.options={};this.options.params||(this.options.params={})}get params(){return this.options.params}absorbOptions(e){const t=e.params;if(t){const s=this.options.params;Object.keys(t).forEach(c=>{null==s[c]&&(s[c]=t[c])})}}}const Lg="void",c1=new l1(Lg);class gk{constructor(e,t,s){this.id=e,this.hostElement=t,this._engine=s,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+e,_a(t,this._hostClassName)}listen(e,t,s,c){if(!this._triggers.has(t))throw function pL(n,e){return new rt(3302,!1)}();if(null==s||0==s.length)throw function fL(n){return new rt(3303,!1)}();if(!function xk(n){return"start"==n||"done"==n}(s))throw function mL(n,e){return new rt(3400,!1)}();const p=Ms(this._elementListeners,e,[]),y={name:t,phase:s,callback:c};p.push(y);const w=Ms(this._engine.statesByElement,e,new Map);return w.has(t)||(_a(e,By),_a(e,By+"-"+t),w.set(t,c1)),()=>{this._engine.afterFlush(()=>{const C=p.indexOf(y);C>=0&&p.splice(C,1),this._triggers.has(t)||w.delete(t)})}}register(e,t){return!this._triggers.has(e)&&(this._triggers.set(e,t),!0)}_getTrigger(e){const t=this._triggers.get(e);if(!t)throw function gL(n){return new rt(3401,!1)}();return t}trigger(e,t,s,c=!0){const p=this._getTrigger(t),y=new u1(this.id,t,e);let w=this._engine.statesByElement.get(e);w||(_a(e,By),_a(e,By+"-"+t),this._engine.statesByElement.set(e,w=new Map));let C=w.get(t);const A=new l1(s,this.id);if(!(s&&s.hasOwnProperty("value"))&&C&&A.absorbOptions(C.options),w.set(t,A),C||(C=c1),A.value!==Lg&&C.value===A.value){if(!function Ek(n,e){const t=Object.keys(n),s=Object.keys(e);if(t.length!=s.length)return!1;for(let c=0;c<t.length;c++){const p=t[c];if(!e.hasOwnProperty(p)||n[p]!==e[p])return!1}return!0}(C.params,A.params)){const De=[],Ne=p.matchStyles(C.value,C.params,De),qe=p.matchStyles(A.value,A.params,De);De.length?this._engine.reportError(De):this._engine.afterFlush(()=>{jd(e,Ne),Zl(e,qe)})}return}const X=Ms(this._engine.playersByElement,e,[]);X.forEach(De=>{De.namespaceId==this.id&&De.triggerName==t&&De.queued&&De.destroy()});let ie=p.matchTransition(C.value,A.value,e,A.params),fe=!1;if(!ie){if(!c)return;ie=p.fallbackTransition,fe=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:t,transition:ie,fromState:C,toState:A,player:y,isFallbackTransition:fe}),fe||(_a(e,JT),y.onStart(()=>{Lf(e,JT)})),y.onDone(()=>{let De=this.players.indexOf(y);De>=0&&this.players.splice(De,1);const Ne=this._engine.playersByElement.get(e);if(Ne){let qe=Ne.indexOf(y);qe>=0&&Ne.splice(qe,1)}}),this.players.push(y),X.push(y),y}deregister(e){this._triggers.delete(e),this._engine.statesByElement.forEach(t=>t.delete(e)),this._elementListeners.forEach((t,s)=>{this._elementListeners.set(s,t.filter(c=>c.name!=e))})}clearElementCache(e){this._engine.statesByElement.delete(e),this._elementListeners.delete(e);const t=this._engine.playersByElement.get(e);t&&(t.forEach(s=>s.destroy()),this._engine.playersByElement.delete(e))}_signalRemovalForInnerTriggers(e,t){const s=this._engine.driver.query(e,Vy,!0);s.forEach(c=>{if(c[ga])return;const p=this._engine.fetchNamespacesByElement(c);p.size?p.forEach(y=>y.triggerLeaveAnimation(c,t,!1,!0)):this.clearElementCache(c)}),this._engine.afterFlushAnimationsDone(()=>s.forEach(c=>this.clearElementCache(c)))}triggerLeaveAnimation(e,t,s,c){const p=this._engine.statesByElement.get(e),y=new Map;if(p){const w=[];if(p.forEach((C,A)=>{if(y.set(A,C.value),this._triggers.has(A)){const F=this.trigger(e,A,Lg,c);F&&w.push(F)}}),w.length)return this._engine.markElementAsRemoved(this.id,e,!0,t,y),s&&Mh(w).onDone(()=>this._engine.processLeaveNode(e)),!0}return!1}prepareLeaveAnimationListeners(e){const t=this._elementListeners.get(e),s=this._engine.statesByElement.get(e);if(t&&s){const c=new Set;t.forEach(p=>{const y=p.name;if(c.has(y))return;c.add(y);const C=this._triggers.get(y).fallbackTransition,A=s.get(y)||c1,F=new l1(Lg),V=new u1(this.id,y,e);this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:y,transition:C,fromState:A,toState:F,player:V,isFallbackTransition:!0})})}}removeNode(e,t){const s=this._engine;if(e.childElementCount&&this._signalRemovalForInnerTriggers(e,t),this.triggerLeaveAnimation(e,t,!0))return;let c=!1;if(s.totalAnimations){const p=s.players.length?s.playersByQueriedElement.get(e):[];if(p&&p.length)c=!0;else{let y=e;for(;y=y.parentNode;)if(s.statesByElement.get(y)){c=!0;break}}}if(this.prepareLeaveAnimationListeners(e),c)s.markElementAsRemoved(this.id,e,!1,t);else{const p=e[ga];(!p||p===eD)&&(s.afterFlush(()=>this.clearElementCache(e)),s.destroyInnerAnimations(e),s._onRemovalComplete(e,t))}}insertNode(e,t){_a(e,this._hostClassName)}drainQueuedTransitions(e){const t=[];return this._queue.forEach(s=>{const c=s.player;if(c.destroyed)return;const p=s.element,y=this._elementListeners.get(p);y&&y.forEach(w=>{if(w.name==s.triggerName){const C=Hx(p,s.triggerName,s.fromState.value,s.toState.value);C._data=e,$x(s.player,w.phase,C,w.callback)}}),c.markedForDestroy?this._engine.afterFlush(()=>{c.destroy()}):t.push(s)}),this._queue=[],t.sort((s,c)=>{const p=s.transition.ast.depCount,y=c.transition.ast.depCount;return 0==p||0==y?p-y:this._engine.driver.containsElement(s.element,c.element)?1:-1})}destroy(e){this.players.forEach(t=>t.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,e)}elementContainsData(e){let t=!1;return this._elementListeners.has(e)&&(t=!0),t=!!this._queue.find(s=>s.element===e)||t,t}}class _k{constructor(e,t,s){this.bodyNode=e,this.driver=t,this._normalizer=s,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(c,p)=>{}}_onRemovalComplete(e,t){this.onRemovalComplete(e,t)}get queuedPlayers(){const e=[];return this._namespaceList.forEach(t=>{t.players.forEach(s=>{s.queued&&e.push(s)})}),e}createNamespace(e,t){const s=new gk(e,t,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,t)?this._balanceNamespaceList(s,t):(this.newHostElements.set(t,s),this.collectEnterElement(t)),this._namespaceLookup[e]=s}_balanceNamespaceList(e,t){const s=this._namespaceList,c=this.namespacesByHostElement;if(s.length-1>=0){let y=!1,w=this.driver.getParentElement(t);for(;w;){const C=c.get(w);if(C){const A=s.indexOf(C);s.splice(A+1,0,e),y=!0;break}w=this.driver.getParentElement(w)}y||s.unshift(e)}else s.push(e);return c.set(t,e),e}register(e,t){let s=this._namespaceLookup[e];return s||(s=this.createNamespace(e,t)),s}registerTrigger(e,t,s){let c=this._namespaceLookup[e];c&&c.register(t,s)&&this.totalAnimations++}destroy(e,t){if(!e)return;const s=this._fetchNamespace(e);this.afterFlush(()=>{this.namespacesByHostElement.delete(s.hostElement),delete this._namespaceLookup[e];const c=this._namespaceList.indexOf(s);c>=0&&this._namespaceList.splice(c,1)}),this.afterFlushAnimationsDone(()=>s.destroy(t))}_fetchNamespace(e){return this._namespaceLookup[e]}fetchNamespacesByElement(e){const t=new Set,s=this.statesByElement.get(e);if(s)for(let c of s.values())if(c.namespaceId){const p=this._fetchNamespace(c.namespaceId);p&&t.add(p)}return t}trigger(e,t,s,c){if(Yy(t)){const p=this._fetchNamespace(e);if(p)return p.trigger(t,s,c),!0}return!1}insertNode(e,t,s,c){if(!Yy(t))return;const p=t[ga];if(p&&p.setForRemoval){p.setForRemoval=!1,p.setForMove=!0;const y=this.collectedLeaveElements.indexOf(t);y>=0&&this.collectedLeaveElements.splice(y,1)}if(e){const y=this._fetchNamespace(e);y&&y.insertNode(t,s)}c&&this.collectEnterElement(t)}collectEnterElement(e){this.collectedEnterElements.push(e)}markElementAsDisabled(e,t){t?this.disabledNodes.has(e)||(this.disabledNodes.add(e),_a(e,a1)):this.disabledNodes.has(e)&&(this.disabledNodes.delete(e),Lf(e,a1))}removeNode(e,t,s,c){if(Yy(t)){const p=e?this._fetchNamespace(e):null;if(p?p.removeNode(t,c):this.markElementAsRemoved(e,t,!1,c),s){const y=this.namespacesByHostElement.get(t);y&&y.id!==e&&y.removeNode(t,c)}}else this._onRemovalComplete(t,c)}markElementAsRemoved(e,t,s,c,p){this.collectedLeaveElements.push(t),t[ga]={namespaceId:e,setForRemoval:c,hasAnimation:s,removedBeforeQueried:!1,previousTriggersValues:p}}listen(e,t,s,c,p){return Yy(t)?this._fetchNamespace(e).listen(t,s,c,p):()=>{}}_buildInstruction(e,t,s,c,p){return e.transition.build(this.driver,e.element,e.fromState.value,e.toState.value,s,c,e.fromState.options,e.toState.options,t,p)}destroyInnerAnimations(e){let t=this.driver.query(e,Vy,!0);t.forEach(s=>this.destroyActiveAnimationsForElement(s)),0!=this.playersByQueriedElement.size&&(t=this.driver.query(e,Kx,!0),t.forEach(s=>this.finishActiveQueriedAnimationOnElement(s)))}destroyActiveAnimationsForElement(e){const t=this.playersByElement.get(e);t&&t.forEach(s=>{s.queued?s.markedForDestroy=!0:s.destroy()})}finishActiveQueriedAnimationOnElement(e){const t=this.playersByQueriedElement.get(e);t&&t.forEach(s=>s.finish())}whenRenderingDone(){return new Promise(e=>{if(this.players.length)return Mh(this.players).onDone(()=>e());e()})}processLeaveNode(e){const t=e[ga];if(t&&t.setForRemoval){if(e[ga]=eD,t.namespaceId){this.destroyInnerAnimations(e);const s=this._fetchNamespace(t.namespaceId);s&&s.clearElementCache(e)}this._onRemovalComplete(e,t.setForRemoval)}e.classList?.contains(a1)&&this.markElementAsDisabled(e,!1),this.driver.query(e,".ng-animate-disabled",!0).forEach(s=>{this.markElementAsDisabled(s,!1)})}flush(e=-1){let t=[];if(this.newHostElements.size&&(this.newHostElements.forEach((s,c)=>this._balanceNamespaceList(s,c)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let s=0;s<this.collectedEnterElements.length;s++)_a(this.collectedEnterElements[s],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const s=[];try{t=this._flushAnimations(s,e)}finally{for(let c=0;c<s.length;c++)s[c]()}}else for(let s=0;s<this.collectedLeaveElements.length;s++)this.processLeaveNode(this.collectedLeaveElements[s]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(s=>s()),this._flushFns=[],this._whenQuietFns.length){const s=this._whenQuietFns;this._whenQuietFns=[],t.length?Mh(t).onDone(()=>{s.forEach(c=>c())}):s.forEach(c=>c())}}reportError(e){throw function _L(n){return new rt(3402,!1)}()}_flushAnimations(e,t){const s=new Zy,c=[],p=new Map,y=[],w=new Map,C=new Map,A=new Map,F=new Set;this.disabledNodes.forEach(Tt=>{F.add(Tt);const Vt=this.driver.query(Tt,".ng-animate-queued",!0);for(let Qt=0;Qt<Vt.length;Qt++)F.add(Vt[Qt])});const V=this.bodyNode,X=Array.from(this.statesByElement.keys()),ie=iD(X,this.collectedEnterElements),fe=new Map;let De=0;ie.forEach((Tt,Vt)=>{const Qt=Xx+De++;fe.set(Vt,Qt),Tt.forEach(qn=>_a(qn,Qt))});const Ne=[],qe=new Set,ct=new Set;for(let Tt=0;Tt<this.collectedLeaveElements.length;Tt++){const Vt=this.collectedLeaveElements[Tt],Qt=Vt[ga];Qt&&Qt.setForRemoval&&(Ne.push(Vt),qe.add(Vt),Qt.hasAnimation?this.driver.query(Vt,".ng-star-inserted",!0).forEach(qn=>qe.add(qn)):ct.add(Vt))}const Ve=new Map,vt=iD(X,Array.from(qe));vt.forEach((Tt,Vt)=>{const Qt=zy+De++;Ve.set(Vt,Qt),Tt.forEach(qn=>_a(qn,Qt))}),e.push(()=>{ie.forEach((Tt,Vt)=>{const Qt=fe.get(Vt);Tt.forEach(qn=>Lf(qn,Qt))}),vt.forEach((Tt,Vt)=>{const Qt=Ve.get(Vt);Tt.forEach(qn=>Lf(qn,Qt))}),Ne.forEach(Tt=>{this.processLeaveNode(Tt)})});const gn=[],Bn=[];for(let Tt=this._namespaceList.length-1;Tt>=0;Tt--)this._namespaceList[Tt].drainQueuedTransitions(t).forEach(Qt=>{const qn=Qt.player,zr=Qt.element;if(gn.push(qn),this.collectedEnterElements.length){const vo=zr[ga];if(vo&&vo.setForMove){if(vo.previousTriggersValues&&vo.previousTriggersValues.has(Qt.triggerName)){const $d=vo.previousTriggersValues.get(Qt.triggerName),ya=this.statesByElement.get(Qt.element);if(ya&&ya.has(Qt.triggerName)){const ev=ya.get(Qt.triggerName);ev.value=$d,ya.set(Qt.triggerName,ev)}}return void qn.destroy()}}const Xl=!V||!this.driver.containsElement(V,zr),Rs=Ve.get(zr),Ph=fe.get(zr),Ai=this._buildInstruction(Qt,s,Ph,Rs,Xl);if(Ai.errors&&Ai.errors.length)return void Bn.push(Ai);if(Xl)return qn.onStart(()=>jd(zr,Ai.fromStyles)),qn.onDestroy(()=>Zl(zr,Ai.toStyles)),void c.push(qn);if(Qt.isFallbackTransition)return qn.onStart(()=>jd(zr,Ai.fromStyles)),qn.onDestroy(()=>Zl(zr,Ai.toStyles)),void c.push(qn);const dD=[];Ai.timelines.forEach(vo=>{vo.stretchStartingKeyframe=!0,this.disabledNodes.has(vo.element)||dD.push(vo)}),Ai.timelines=dD,s.append(zr,Ai.timelines),y.push({instruction:Ai,player:qn,element:zr}),Ai.queriedElements.forEach(vo=>Ms(w,vo,[]).push(qn)),Ai.preStyleProps.forEach((vo,$d)=>{if(vo.size){let ya=C.get($d);ya||C.set($d,ya=new Set),vo.forEach((ev,p1)=>ya.add(p1))}}),Ai.postStyleProps.forEach((vo,$d)=>{let ya=A.get($d);ya||A.set($d,ya=new Set),vo.forEach((ev,p1)=>ya.add(p1))})});if(Bn.length){const Tt=[];Bn.forEach(Vt=>{Tt.push(function yL(n,e){return new rt(3505,!1)}())}),gn.forEach(Vt=>Vt.destroy()),this.reportError(Tt)}const Mi=new Map,Ps=new Map;y.forEach(Tt=>{const Vt=Tt.element;s.has(Vt)&&(Ps.set(Vt,Vt),this._beforeAnimationBuild(Tt.player.namespaceId,Tt.instruction,Mi))}),c.forEach(Tt=>{const Vt=Tt.element;this._getPreviousPlayers(Vt,!1,Tt.namespaceId,Tt.triggerName,null).forEach(qn=>{Ms(Mi,Vt,[]).push(qn),qn.destroy()})});const Ls=Ne.filter(Tt=>oD(Tt,C,A)),ks=new Map;nD(ks,this.driver,ct,A,au).forEach(Tt=>{oD(Tt,C,A)&&Ls.push(Tt)});const cu=new Map;ie.forEach((Tt,Vt)=>{nD(cu,this.driver,new Set(Tt),C,"!")}),Ls.forEach(Tt=>{const Vt=ks.get(Tt),Qt=cu.get(Tt);ks.set(Tt,new Map([...Array.from(Vt?.entries()??[]),...Array.from(Qt?.entries()??[])]))});const al=[],Rf=[],Of={};y.forEach(Tt=>{const{element:Vt,player:Qt,instruction:qn}=Tt;if(s.has(Vt)){if(F.has(Vt))return Qt.onDestroy(()=>Zl(Vt,qn.toStyles)),Qt.disabled=!0,Qt.overrideTotalTime(qn.totalTime),void c.push(Qt);let zr=Of;if(Ps.size>1){let Rs=Vt;const Ph=[];for(;Rs=Rs.parentNode;){const Ai=Ps.get(Rs);if(Ai){zr=Ai;break}Ph.push(Rs)}Ph.forEach(Ai=>Ps.set(Ai,zr))}const Xl=this._buildAnimation(Qt.namespaceId,qn,Mi,p,cu,ks);if(Qt.setRealPlayer(Xl),zr===Of)al.push(Qt);else{const Rs=this.playersByElement.get(zr);Rs&&Rs.length&&(Qt.parentPlayer=Mh(Rs)),c.push(Qt)}}else jd(Vt,qn.fromStyles),Qt.onDestroy(()=>Zl(Vt,qn.toStyles)),Rf.push(Qt),F.has(Vt)&&c.push(Qt)}),Rf.forEach(Tt=>{const Vt=p.get(Tt.element);if(Vt&&Vt.length){const Qt=Mh(Vt);Tt.setRealPlayer(Qt)}}),c.forEach(Tt=>{Tt.parentPlayer?Tt.syncPlayerEvents(Tt.parentPlayer):Tt.destroy()});for(let Tt=0;Tt<Ne.length;Tt++){const Vt=Ne[Tt],Qt=Vt[ga];if(Lf(Vt,zy),Qt&&Qt.hasAnimation)continue;let qn=[];if(w.size){let Xl=w.get(Vt);Xl&&Xl.length&&qn.push(...Xl);let Rs=this.driver.query(Vt,Kx,!0);for(let Ph=0;Ph<Rs.length;Ph++){let Ai=w.get(Rs[Ph]);Ai&&Ai.length&&qn.push(...Ai)}}const zr=qn.filter(Xl=>!Xl.destroyed);zr.length?bk(this,Vt,zr):this.processLeaveNode(Vt)}return Ne.length=0,al.forEach(Tt=>{this.players.push(Tt),Tt.onDone(()=>{Tt.destroy();const Vt=this.players.indexOf(Tt);this.players.splice(Vt,1)}),Tt.play()}),al}elementContainsData(e,t){let s=!1;const c=t[ga];return c&&c.setForRemoval&&(s=!0),this.playersByElement.has(t)&&(s=!0),this.playersByQueriedElement.has(t)&&(s=!0),this.statesByElement.has(t)&&(s=!0),this._fetchNamespace(e).elementContainsData(t)||s}afterFlush(e){this._flushFns.push(e)}afterFlushAnimationsDone(e){this._whenQuietFns.push(e)}_getPreviousPlayers(e,t,s,c,p){let y=[];if(t){const w=this.playersByQueriedElement.get(e);w&&(y=w)}else{const w=this.playersByElement.get(e);if(w){const C=!p||p==Lg;w.forEach(A=>{A.queued||!C&&A.triggerName!=c||y.push(A)})}}return(s||c)&&(y=y.filter(w=>!(s&&s!=w.namespaceId||c&&c!=w.triggerName))),y}_beforeAnimationBuild(e,t,s){const p=t.element,y=t.isRemovalTransition?void 0:e,w=t.isRemovalTransition?void 0:t.triggerName;for(const C of t.timelines){const A=C.element,F=A!==p,V=Ms(s,A,[]);this._getPreviousPlayers(A,F,y,w,t.toState).forEach(ie=>{const fe=ie.getRealPlayer();fe.beforeDestroy&&fe.beforeDestroy(),ie.destroy(),V.push(ie)})}jd(p,t.fromStyles)}_buildAnimation(e,t,s,c,p,y){const w=t.triggerName,C=t.element,A=[],F=new Set,V=new Set,X=t.timelines.map(fe=>{const De=fe.element;F.add(De);const Ne=De[ga];if(Ne&&Ne.removedBeforeQueried)return new Ig(fe.duration,fe.delay);const qe=De!==C,ct=function wk(n){const e=[];return rD(n,e),e}((s.get(De)||fk).map(Mi=>Mi.getRealPlayer())).filter(Mi=>!!Mi.element&&Mi.element===De),Ve=p.get(De),vt=y.get(De),gn=AT(0,this._normalizer,0,fe.keyframes,Ve,vt),Bn=this._buildPlayer(fe,gn,ct);if(fe.subTimeline&&c&&V.add(De),qe){const Mi=new u1(e,w,De);Mi.setRealPlayer(Bn),A.push(Mi)}return Bn});A.forEach(fe=>{Ms(this.playersByQueriedElement,fe.element,[]).push(fe),fe.onDone(()=>function yk(n,e,t){let s=n.get(e);if(s){if(s.length){const c=s.indexOf(t);s.splice(c,1)}0==s.length&&n.delete(e)}return s}(this.playersByQueriedElement,fe.element,fe))}),F.forEach(fe=>_a(fe,BT));const ie=Mh(X);return ie.onDestroy(()=>{F.forEach(fe=>Lf(fe,BT)),Zl(C,t.toStyles)}),V.forEach(fe=>{Ms(c,fe,[]).push(ie)}),ie}_buildPlayer(e,t,s){return t.length>0?this.driver.animate(e.element,t,e.duration,e.delay,e.easing,s):new Ig(e.duration,e.delay)}}class u1{constructor(e,t,s){this.namespaceId=e,this.triggerName=t,this.element=s,this._player=new Ig,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(e){this._containsRealPlayer||(this._player=e,this._queuedCallbacks.forEach((t,s)=>{t.forEach(c=>$x(e,s,void 0,c))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(e.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(e){this.totalTime=e}syncPlayerEvents(e){const t=this._player;t.triggerCallback&&e.onStart(()=>t.triggerCallback("start")),e.onDone(()=>this.finish()),e.onDestroy(()=>this.destroy())}_queueEvent(e,t){Ms(this._queuedCallbacks,e,[]).push(t)}onDone(e){this.queued&&this._queueEvent("done",e),this._player.onDone(e)}onStart(e){this.queued&&this._queueEvent("start",e),this._player.onStart(e)}onDestroy(e){this.queued&&this._queueEvent("destroy",e),this._player.onDestroy(e)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(e){this.queued||this._player.setPosition(e)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(e){const t=this._player;t.triggerCallback&&t.triggerCallback(e)}}function Yy(n){return n&&1===n.nodeType}function tD(n,e){const t=n.style.display;return n.style.display=e??"none",t}function nD(n,e,t,s,c){const p=[];t.forEach(C=>p.push(tD(C)));const y=[];s.forEach((C,A)=>{const F=new Map;C.forEach(V=>{const X=e.computeStyle(A,V,c);F.set(V,X),(!X||0==X.length)&&(A[ga]=mk,y.push(A))}),n.set(A,F)});let w=0;return t.forEach(C=>tD(C,p[w++])),y}function iD(n,e){const t=new Map;if(n.forEach(w=>t.set(w,[])),0==e.length)return t;const c=new Set(e),p=new Map;function y(w){if(!w)return 1;let C=p.get(w);if(C)return C;const A=w.parentNode;return C=t.has(A)?A:c.has(A)?1:y(A),p.set(w,C),C}return e.forEach(w=>{const C=y(w);1!==C&&t.get(C).push(w)}),t}function _a(n,e){n.classList?.add(e)}function Lf(n,e){n.classList?.remove(e)}function bk(n,e,t){Mh(t).onDone(()=>n.processLeaveNode(e))}function rD(n,e){for(let t=0;t<n.length;t++){const s=n[t];s instanceof CT?rD(s.players,e):e.push(s)}}function oD(n,e,t){const s=t.get(n);if(!s)return!1;let c=e.get(n);return c?s.forEach(p=>c.add(p)):e.set(n,s),t.delete(n),!0}class Qy{constructor(e,t,s){this.bodyNode=e,this._driver=t,this._normalizer=s,this._triggerCache={},this.onRemovalComplete=(c,p)=>{},this._transitionEngine=new _k(e,t,s),this._timelineEngine=new ck(e,t,s),this._transitionEngine.onRemovalComplete=(c,p)=>this.onRemovalComplete(c,p)}registerTrigger(e,t,s,c,p){const y=e+"-"+c;let w=this._triggerCache[y];if(!w){const C=[],F=e1(this._driver,p,C,[]);if(C.length)throw function aL(n,e){return new rt(3404,!1)}();w=function ok(n,e,t){return new sk(n,e,t)}(c,F,this._normalizer),this._triggerCache[y]=w}this._transitionEngine.registerTrigger(t,c,w)}register(e,t){this._transitionEngine.register(e,t)}destroy(e,t){this._transitionEngine.destroy(e,t)}onInsert(e,t,s,c){this._transitionEngine.insertNode(e,t,s,c)}onRemove(e,t,s,c){this._transitionEngine.removeNode(e,t,c||!1,s)}disableAnimations(e,t){this._transitionEngine.markElementAsDisabled(e,t)}process(e,t,s,c){if("@"==s.charAt(0)){const[p,y]=PT(s);this._timelineEngine.command(p,t,y,c)}else this._transitionEngine.trigger(e,t,s,c)}listen(e,t,s,c,p){if("@"==s.charAt(0)){const[y,w]=PT(s);return this._timelineEngine.listen(y,t,w,p)}return this._transitionEngine.listen(e,t,s,c,p)}flush(e=-1){this._transitionEngine.flush(e)}get players(){return this._transitionEngine.players.concat(this._timelineEngine.players)}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}}let Dk=(()=>{class n{constructor(t,s,c){this._element=t,this._startStyles=s,this._endStyles=c,this._state=0;let p=n.initialStylesByElement.get(t);p||n.initialStylesByElement.set(t,p=new Map),this._initialStyles=p}start(){this._state<1&&(this._startStyles&&Zl(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(Zl(this._element,this._initialStyles),this._endStyles&&(Zl(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(n.initialStylesByElement.delete(this._element),this._startStyles&&(jd(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(jd(this._element,this._endStyles),this._endStyles=null),Zl(this._element,this._initialStyles),this._state=3)}}return n.initialStylesByElement=new WeakMap,n})();function h1(n){let e=null;return n.forEach((t,s)=>{(function Ck(n){return"display"===n||"position"===n})(s)&&(e=e||new Map,e.set(s,t))}),e}class sD{constructor(e,t,s,c){this.element=e,this.keyframes=t,this.options=s,this._specialStyles=c,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=s.duration,this._delay=s.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const e=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,e,this.options),this._finalKeyframe=e.length?e[e.length-1]:new Map,this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(e){const t=[];return e.forEach(s=>{t.push(Object.fromEntries(s))}),t}_triggerWebAnimation(e,t,s){return e.animate(this._convertKeyframesToObject(t),s)}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(e=>e()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}setPosition(e){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=e*this.time}getPosition(){return this.domPlayer.currentTime/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const e=new Map;this.hasStarted()&&this._finalKeyframe.forEach((s,c)=>{"offset"!==c&&e.set(c,this._finished?s:HT(this.element,c))}),this.currentSnapshot=e}triggerCallback(e){const t="start"===e?this._onStartFns:this._onDoneFns;t.forEach(s=>s()),t.length=0}}class Ik{validateStyleProperty(e){return!0}validateAnimatableStyleProperty(e){return!0}matchesElement(e,t){return!1}containsElement(e,t){return OT(e,t)}getParentElement(e){return Wx(e)}query(e,t,s){return FT(e,t,s)}computeStyle(e,t,s){return window.getComputedStyle(e)[t]}animate(e,t,s,c,p,y=[]){const C={duration:s,delay:c,fill:0==c?"both":"forwards"};p&&(C.easing=p);const A=new Map,F=y.filter(ie=>ie instanceof sD);(function PL(n,e){return 0===n||0===e})(s,c)&&F.forEach(ie=>{ie.currentSnapshot.forEach((fe,De)=>A.set(De,fe))});let V=function IL(n){return n.length?n[0]instanceof Map?n:n.map(e=>VT(e)):[]}(t).map(ie=>Ah(ie));V=function LL(n,e,t){if(t.size&&e.length){let s=e[0],c=[];if(t.forEach((p,y)=>{s.has(y)||c.push(y),s.set(y,p)}),c.length)for(let p=1;p<e.length;p++){let y=e[p];c.forEach(w=>y.set(w,HT(n,w)))}}return e}(e,V,A);const X=function Tk(n,e){let t=null,s=null;return Array.isArray(e)&&e.length?(t=h1(e[0]),e.length>1&&(s=h1(e[e.length-1]))):e instanceof Map&&(t=h1(e)),t||s?new Dk(n,t,s):null}(e,V);return new sD(e,V,C,X)}}let Sk=(()=>{class n extends vT{constructor(t,s){super(),this._nextAnimationId=0,this._renderer=t.createRenderer(s.body,{id:"0",encapsulation:Vi.None,styles:[],data:{animation:[]}})}build(t){const s=this._nextAnimationId.toString();this._nextAnimationId++;const c=Array.isArray(t)?bT(t):t;return aD(this._renderer,null,s,"register",[c]),new Mk(s,this._renderer)}}return n.\u0275fac=function(t){return new(t||n)(Bt(ko),Bt(rl))},n.\u0275prov=Sn({token:n,factory:n.\u0275fac}),n})();class Mk extends class b2{}{constructor(e,t){super(),this._id=e,this._renderer=t}create(e,t){return new Ak(this._id,e,t||{},this._renderer)}}class Ak{constructor(e,t,s,c){this.id=e,this.element=t,this._renderer=c,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",s)}_listen(e,t){return this._renderer.listen(this.element,`@@${this.id}:${e}`,t)}_command(e,...t){return aD(this._renderer,this.element,this.id,e,t)}onDone(e){this._listen("done",e)}onStart(e){this._listen("start",e)}onDestroy(e){this._listen("destroy",e)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(e){this._command("setPosition",e)}getPosition(){return this._renderer.engine.players[+this.id]?.getPosition()??0}}function aD(n,e,t,s,c){return n.setProperty(e,`@@${t}:${s}`,c)}const lD="@.disabled";let Pk=(()=>{class n{constructor(t,s,c){this.delegate=t,this.engine=s,this._zone=c,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),s.onRemovalComplete=(p,y)=>{const w=y?.parentNode(p);w&&y.removeChild(w,p)}}createRenderer(t,s){const p=this.delegate.createRenderer(t,s);if(!(t&&s&&s.data&&s.data.animation)){let F=this._rendererCache.get(p);return F||(F=new cD("",p,this.engine,()=>this._rendererCache.delete(p)),this._rendererCache.set(p,F)),F}const y=s.id,w=s.id+"-"+this._currentId;this._currentId++,this.engine.register(w,t);const C=F=>{Array.isArray(F)?F.forEach(C):this.engine.registerTrigger(y,w,t,F.name,F)};return s.data.animation.forEach(C),new Lk(this,w,p,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){this.promise.then(()=>{this._microtaskId++})}scheduleListenerCallback(t,s,c){t>=0&&t<this._microtaskId?this._zone.run(()=>s(c)):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(p=>{const[y,w]=p;y(w)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([s,c]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return n.\u0275fac=function(t){return new(t||n)(Bt(ko),Bt(Qy),Bt(Yi))},n.\u0275prov=Sn({token:n,factory:n.\u0275fac}),n})();class cD{constructor(e,t,s,c){this.namespaceId=e,this.delegate=t,this.engine=s,this._onDestroy=c,this.destroyNode=this.delegate.destroyNode?p=>t.destroyNode(p):null}get data(){return this.delegate.data}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy(),this._onDestroy?.()}createElement(e,t){return this.delegate.createElement(e,t)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}appendChild(e,t){this.delegate.appendChild(e,t),this.engine.onInsert(this.namespaceId,t,e,!1)}insertBefore(e,t,s,c=!0){this.delegate.insertBefore(e,t,s),this.engine.onInsert(this.namespaceId,t,e,c)}removeChild(e,t,s){this.engine.onRemove(this.namespaceId,t,this.delegate,s)}selectRootElement(e,t){return this.delegate.selectRootElement(e,t)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,t,s,c){this.delegate.setAttribute(e,t,s,c)}removeAttribute(e,t,s){this.delegate.removeAttribute(e,t,s)}addClass(e,t){this.delegate.addClass(e,t)}removeClass(e,t){this.delegate.removeClass(e,t)}setStyle(e,t,s,c){this.delegate.setStyle(e,t,s,c)}removeStyle(e,t,s){this.delegate.removeStyle(e,t,s)}setProperty(e,t,s){"@"==t.charAt(0)&&t==lD?this.disableAnimations(e,!!s):this.delegate.setProperty(e,t,s)}setValue(e,t){this.delegate.setValue(e,t)}listen(e,t,s){return this.delegate.listen(e,t,s)}disableAnimations(e,t){this.engine.disableAnimations(e,t)}}class Lk extends cD{constructor(e,t,s,c,p){super(t,s,c,p),this.factory=e,this.namespaceId=t}setProperty(e,t,s){"@"==t.charAt(0)?"."==t.charAt(1)&&t==lD?this.disableAnimations(e,s=void 0===s||!!s):this.engine.process(this.namespaceId,e,t.slice(1),s):this.delegate.setProperty(e,t,s)}listen(e,t,s){if("@"==t.charAt(0)){const c=function kk(n){switch(n){case"body":return document.body;case"document":return document;case"window":return window;default:return n}}(e);let p=t.slice(1),y="";return"@"!=p.charAt(0)&&([p,y]=function Rk(n){const e=n.indexOf(".");return[n.substring(0,e),n.slice(e+1)]}(p)),this.engine.listen(this.namespaceId,c,p,y,w=>{this.factory.scheduleListenerCallback(w._data||-1,s,w)})}return this.delegate.listen(e,t,s)}}const uD=[{provide:vT,useClass:Sk},{provide:o1,useFactory:function Fk(){return new tk}},{provide:Qy,useClass:(()=>{class n extends Qy{constructor(t,s,c,p){super(t.body,s,c)}ngOnDestroy(){this.flush()}}return n.\u0275fac=function(t){return new(t||n)(Bt(rl),Bt(Zx),Bt(o1),Bt(my))},n.\u0275prov=Sn({token:n,factory:n.\u0275fac}),n})()},{provide:ko,useFactory:function Nk(n,e,t){return new Pk(n,e,t)},deps:[Fy,Qy,Yi]}],d1=[{provide:Zx,useFactory:()=>new Ik},{provide:nE,useValue:"BrowserAnimations"},...uD],hD=[{provide:Zx,useClass:NT},{provide:nE,useValue:"NoopAnimations"},...uD];let zk=(()=>{class n{static withConfig(t){return{ngModule:n,providers:t.disableAnimations?hD:d1}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=fr({type:n}),n.\u0275inj=Hr({providers:d1,imports:[hT]}),n})(),Bk=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=fr({type:n,bootstrap:[BP]}),n.\u0275inj=Hr({imports:[hT,zk,x2,J2,tP]}),n})();(function MS(){yE=!1})(),QA().bootstrapModule(Bk).catch(n=>console.error(n))},898:function(Ff){Ff.exports=function(){"use strict";var uu,hu,gi;function Gd(d,Ue){if(uu)if(hu){var Bo="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+uu+")(sharedChunk); ("+hu+")(sharedChunk); self.onerror = null;",eo={};uu(eo),gi=Ue(eo),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(gi.workerUrl=window.URL.createObjectURL(new Blob([Bo],{type:"text/javascript"})))}else hu=Ue;else uu=Ue}return Gd(0,function(d){var Ue=typeof self<"u"?self:{},Bo="2.12.0";let eo;const Jt={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==eo){const r=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{eo=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):r}catch{eo=r}}return eo},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Wt={supported:!1,testSupport:function(r){!Vo&&Ji&&(Kl?Yl(r):xi=r)}};let xi,Ji,Vo=!1,Kl=!1;function Yl(r){const i=r.createTexture();r.bindTexture(r.TEXTURE_2D,i);try{if(r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,Ji),r.isContextLost())return;Wt.supported=!0}catch{}r.deleteTexture(i),Vo=!0}Ue.document&&(Ji=Ue.document.createElement("img"),Ji.onload=function(){xi&&Yl(xi),xi=null,Kl=!0},Ji.onerror=function(){Vo=!0,xi=null},Ji.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const jo="01";var Os=to;function to(r,i,o,l){this.cx=3*r,this.bx=3*(o-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(l-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=i,this.p2x=o,this.p2y=l}to.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,i){if(void 0===i&&(i=1e-6),r<0)return 0;if(r>1)return 1;for(var o=r,l=0;l<8;l++){var h=this.sampleCurveX(o)-r;if(Math.abs(h)<i)return o;var m=this.sampleCurveDerivativeX(o);if(Math.abs(m)<1e-6)break;o-=h/m}var _=0,x=1;for(o=r,l=0;l<20&&(h=this.sampleCurveX(o),!(Math.abs(h-r)<i));l++)r>h?_=o:x=o,o=.5*(x-_)+_;return o},solve:function(r,i){return this.sampleCurveY(this.solveCurveX(r,i))}};var et=no;function no(r,i){this.x=r,this.y=i}no.prototype={clone:function(){return new no(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,i){return this.clone()._rotateAround(r,i)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var i=r.x-this.x,o=r.y-this.y;return i*i+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,i){return Math.atan2(this.x*i-this.y*r,this.x*r+this.y*i)},_matMult:function(r){var i=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=i,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var i=Math.cos(r),o=Math.sin(r),l=o*this.x+i*this.y;return this.x=i*this.x-o*this.y,this.y=l,this},_rotateAround:function(r,i){var o=Math.cos(r),l=Math.sin(r),h=i.y+l*(this.x-i.x)+o*(this.y-i.y);return this.x=i.x+o*(this.x-i.x)-l*(this.y-i.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},no.convert=function(r){return r instanceof no?r:Array.isArray(r)?new no(r[0],r[1]):r};const ps=Math.PI/180,du=180/Math.PI;function on(r){return r*ps}function bi(r){return r*du}const va=[[0,0],[1,0],[1,1],[0,1]];function xa(r){if(r<=0)return 0;if(r>=1)return 1;const i=r*r,o=i*r;return 4*(r<.5?o:3*(r-i)+o-.75)}function Ql(r,i,o,l){const h=new Os(r,i,o,l);return function(m){return h.solve(m)}}const ba=Ql(.25,.1,.25,1);function sn(r,i,o){return Math.min(o,Math.max(i,r))}function wa(r,i,o){return(o=sn((o-r)/(i-r),0,1))*o*(3-2*o)}function Fs(r,i,o){const l=o-i,h=((r-i)%l+l)%l+i;return h===i?o:h}function Ea(r,i,o){if(!r.length)return o(null,[]);let l=r.length;const h=new Array(r.length);let m=null;r.forEach((_,x)=>{i(_,(E,T)=>{E&&(m=E),h[x]=T,0==--l&&o(m,h)})})}function Ns(r){const i=[];for(const o in r)i.push(r[o]);return i}function _n(r,...i){for(const o of i)for(const l in o)r[l]=o[l];return r}let Ta=1;function Jl(){return Ta++}function fs(){return function r(i){return i?(i^Math.random()*(16>>i/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,r)}()}function Uo(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function $o(r){return!!r&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(r)}function zs(r,i){r.forEach(o=>{i[o]&&(i[o]=i[o].bind(i))})}function Br(r,i){return-1!==r.indexOf(i,r.length-i.length)}function io(r,i,o){const l={};for(const h in r)l[h]=i.call(o||this,r[h],h,r);return l}function Bs(r,i,o){const l={};for(const h in r)i.call(o||this,r[h],h,r)&&(l[h]=r[h]);return l}function Vr(r){return Array.isArray(r)?r.map(Vr):"object"==typeof r&&r?io(r,Vr):r}const pu={};function Qn(r){pu[r]||(typeof console<"u"&&console.warn(r),pu[r]=!0)}function Go(r,i,o){return(o.y-r.y)*(i.x-r.x)>(i.y-r.y)*(o.x-r.x)}function hn(r){let i=0;for(let o,l,h=0,m=r.length,_=m-1;h<m;_=h++)o=r[h],l=r[_],i+=(l.x-o.x)*(o.y+l.y);return i}function Ho(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function fu(r){const i={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(o,l,h,m)=>{const _=h||m;return i[l]=!_||_.toLowerCase(),""}),i["max-age"]){const o=parseInt(i["max-age"],10);isNaN(o)?delete i["max-age"]:i["max-age"]=o}return i}let Vs=null;function ec(r){if(null==Vs){const i=r.navigator?r.navigator.userAgent:null;Vs=!!r.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return Vs}function mu(r){try{const i=Ue[r];return i.setItem("_mapbox_test_",1),i.removeItem("_mapbox_test_"),!0}catch{return!1}}function Da(r,i){return[r[4*i],r[4*i+1],r[4*i+2],r[4*i+3]]}const Lh="mapbox-tiles";let Tr,js,tc=500,ll=50;function nc(){try{return Ue.caches}catch{}}function ms(){nc()&&!Tr&&(Tr=Ue.caches.open(Lh))}function ic(r){const i=r.indexOf("?");if(i<0)return r;const l=function(h){const m=h.indexOf("?");return m>0?h.slice(m+1).split("&"):[]}(r).filter(h=>{const m=h.split("=");return"language"===m[0]||"worldview"===m[0]});return l.length?`${r.slice(0,i)}?${l.join("&")}`:r.slice(0,i)}let rc=1/0;const ro={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(ro);class gu extends Error{constructor(i,o,l){401===o&&lc(l)&&(i+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(i),this.status=o,this.url=l}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const oo=Ho()?()=>self.worker&&self.worker.referrer:()=>("blob:"===Ue.location.protocol?Ue.parent:Ue).location.href,Us=function(r,i){if(!(/^file:/.test(o=r.url)||/^file:/.test(oo())&&!/^\w+:/.test(o))){if(Ue.fetch&&Ue.Request&&Ue.AbortController&&Ue.Request.prototype.hasOwnProperty("signal"))return function(l,h){const m=new Ue.AbortController,_=new Ue.Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,referrer:oo(),signal:m.signal});let x=!1,E=!1;const T=(S=_.url).indexOf("sku=")>0&&lc(S);var S;"json"===l.type&&_.headers.set("Accept","application/json");const P=(O,N,j)=>{if(E)return;if(O&&"SecurityError"!==O.message&&Qn(O),N&&j)return L(N);const G=Date.now();Ue.fetch(_).then(ne=>{if(ne.ok){const ae=T?ne.clone():null;return L(ne,ae,G)}return h(new gu(ne.statusText,ne.status,l.url))}).catch(ne=>{20!==ne.code&&h(new Error(ne.message))})},L=(O,N,j)=>{("arrayBuffer"===l.type?O.arrayBuffer():"json"===l.type?O.json():O.text()).then(G=>{E||(N&&j&&function(ne,ae,te){if(ms(),!Tr)return;const se={status:ae.status,statusText:ae.statusText,headers:new Ue.Headers};ae.headers.forEach((be,Ee)=>se.headers.set(Ee,be));const he=fu(ae.headers.get("Cache-Control")||"");if(he["no-store"])return;he["max-age"]&&se.headers.set("Expires",new Date(te+1e3*he["max-age"]).toUTCString());const le=se.headers.get("Expires");le&&(new Date(le).getTime()-te<42e4||function(be,Ee){if(void 0===js)try{new Response(new ReadableStream),js=!0}catch{js=!1}js?Ee(be.body):be.blob().then(Ee)}(ae,be=>{const Ee=new Ue.Response(be,se);ms(),Tr&&Tr.then(ke=>ke.put(ic(ne.url),Ee)).catch(ke=>Qn(ke.message))}))}(_,N,j),x=!0,h(null,G,O.headers.get("Cache-Control"),O.headers.get("Expires")))}).catch(G=>{E||h(new Error(G.message))})};return T?function(O,N){if(ms(),!Tr)return N(null);const j=ic(O.url);Tr.then(G=>{G.match(j).then(ne=>{const ae=function(te){if(!te)return!1;const se=new Date(te.headers.get("Expires")||0),he=fu(te.headers.get("Cache-Control")||"");return se>Date.now()&&!he["no-cache"]}(ne);G.delete(j),ae&&G.put(j,ne.clone()),N(null,ne,ae)}).catch(N)}).catch(N)}(_,P):P(null,null),{cancel:()=>{E=!0,x||m.abort()}}}(r,i);if(Ho()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",r,i,void 0,!0)}var o;return function(l,h){const m=new Ue.XMLHttpRequest;m.open(l.method||"GET",l.url,!0),"arrayBuffer"===l.type&&(m.responseType="arraybuffer");for(const _ in l.headers)m.setRequestHeader(_,l.headers[_]);return"json"===l.type&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials="include"===l.credentials,m.onerror=()=>{h(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||0===m.status)&&null!==m.response){let _=m.response;if("json"===l.type)try{_=JSON.parse(m.response)}catch(x){return h(x)}h(null,_,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else h(new gu(m.statusText,m.status,l.url))},m.send(l.body),{cancel:()=>m.abort()}}(r,i)},Ca=function(r,i){return Us(_n(r,{type:"arrayBuffer"}),i)};function oc(r){const i=Ue.document.createElement("a");return i.href=r,i.protocol===Ue.document.location.protocol&&i.host===Ue.document.location.host}const kh="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let cl,Ia;cl=[],Ia=0;const sc=function(r,i){if(Wt.supported&&(r.headers||(r.headers={}),r.headers.accept="image/webp,*/*"),Ia>=Jt.MAX_PARALLEL_IMAGE_REQUESTS){const m={requestParameters:r,callback:i,cancelled:!1,cancel(){this.cancelled=!0}};return cl.push(m),m}Ia++;let o=!1;const l=()=>{if(!o)for(o=!0,Ia--;cl.length&&Ia<Jt.MAX_PARALLEL_IMAGE_REQUESTS;){const m=cl.shift(),{requestParameters:_,callback:x,cancelled:E}=m;E||(m.cancel=sc(_,x).cancel)}},h=Ca(r,(m,_,x,E)=>{l(),m?i(m):_&&(Ue.createImageBitmap?function(T,S){const P=new Ue.Blob([new Uint8Array(T)],{type:"image/png"});Ue.createImageBitmap(P).then(L=>{S(null,L)}).catch(L=>{S(new Error(`Could not load image because of ${L.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(_,(T,S)=>i(T,S,x,E)):function(T,S){const P=new Ue.Image,L=Ue.URL;P.onload=()=>{S(null,P),L.revokeObjectURL(P.src),P.onload=null,Ue.requestAnimationFrame(()=>{P.src=kh})},P.onerror=()=>S(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const O=new Ue.Blob([new Uint8Array(T)],{type:"image/png"});P.src=T.byteLength?L.createObjectURL(O):kh}(_,(T,S)=>i(T,S,x,E)))});return{cancel:()=>{h.cancel(),l()}}},ac="NO_ACCESS_TOKEN";function qo(r){return 0===r.indexOf("mapbox:")}function lc(r){return Jt.API_URL_REGEX.test(r)}function cc(r){return Jt.API_CDN_URL_REGEX.test(r)}function Sa(r){return Jt.API_STYLE_REGEX.test(r)&&!$s(r)}function $s(r){return Jt.API_SPRITE_REGEX.test(r)}const Ma=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function so(r){const i=r.match(Ma);if(!i)throw new Error("Unable to parse URL object");return{protocol:i[1],authority:i[2],path:i[3]||"/",params:i[4]?i[4].split("&"):[]}}function Gs(r){const i=r.params.length?`?${r.params.join("&")}`:"";return`${r.protocol}://${r.authority}${r.path}${i}`}function ul(r){if(!r)return null;const i=r.split(".");if(!i||3!==i.length)return null;try{return JSON.parse(decodeURIComponent(Ue.atob(i[1]).split("").map(o=>"%"+("00"+o.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class ee{constructor(i){this.type=i,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(i){const o=ul(Jt.ACCESS_TOKEN);let l="";return l=o&&o.u?Ue.btoa(encodeURIComponent(o.u).replace(/%([0-9A-F]{2})/g,(h,m)=>String.fromCharCode(Number("0x"+m)))):Jt.ACCESS_TOKEN||"",i?`mapbox.eventData.${i}:${l}`:`mapbox.eventData:${l}`}fetchEventData(){const i=mu("localStorage"),o=this.getStorageKey(),l=this.getStorageKey("uuid");if(i)try{const h=Ue.localStorage.getItem(o);h&&(this.eventData=JSON.parse(h));const m=Ue.localStorage.getItem(l);m&&(this.anonId=m)}catch{Qn("Unable to read from LocalStorage")}}saveEventData(){const i=mu("localStorage"),o=this.getStorageKey(),l=this.getStorageKey("uuid");if(i)try{Ue.localStorage.setItem(l,this.anonId),Object.keys(this.eventData).length>=1&&Ue.localStorage.setItem(o,JSON.stringify(this.eventData))}catch{Qn("Unable to write to LocalStorage")}}processRequests(i){}postEvent(i,o,l,h){if(!Jt.EVENTS_URL)return;const m=so(Jt.EVENTS_URL);m.params.push(`access_token=${h||Jt.ACCESS_TOKEN||""}`);const _={event:this.type,created:new Date(i).toISOString()},x=o?_n(_,o):_,E={url:Gs(m),headers:{"Content-Type":"text/plain"},body:JSON.stringify([x])};var S;this.pendingRequest=(S=T=>{this.pendingRequest=null,l(T),this.saveEventData(),this.processRequests(h)},Us(_n(E,{method:"POST"}),S))}queueRequest(i,o){this.queue.push(i),this.processRequests(o)}}const z=new class extends ee{constructor(r){super("appUserTurnstile"),this._customAccessToken=r}postTurnstileEvent(r,i){Jt.EVENTS_URL&&Jt.ACCESS_TOKEN&&Array.isArray(r)&&r.some(o=>qo(o)||lc(o))&&this.queueRequest(Date.now(),i)}processRequests(r){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const i=ul(Jt.ACCESS_TOKEN),o=i?i.u:Jt.ACCESS_TOKEN;let l=o!==this.eventData.tokenU;$o(this.anonId)||(this.anonId=fs(),l=!0);const h=this.queue.shift();if(this.eventData.lastSuccess){const m=new Date(this.eventData.lastSuccess),_=new Date(h),x=(h-this.eventData.lastSuccess)/864e5;l=l||x>=1||x<-1||m.getDate()!==_.getDate()}else l=!0;l?this.postEvent(h,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Bo,skuId:jo,"enabled.telemetry":!1,userId:this.anonId},m=>{m||(this.eventData.lastSuccess=h,this.eventData.tokenU=o)},r):this.processRequests()}},U=z.postTurnstileEvent.bind(z),Y=new class extends ee{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(r,i,o,l){this.skuToken=i,this.errorCb=l,Jt.EVENTS_URL&&(o||Jt.ACCESS_TOKEN?this.queueRequest({id:r,timestamp:Date.now()},o):this.errorCb(new Error(ac)))}processRequests(r){if(this.pendingRequest||0===this.queue.length)return;const{id:i,timestamp:o}=this.queue.shift();i&&this.success[i]||(this.anonId||this.fetchEventData(),$o(this.anonId)||(this.anonId=fs()),this.postEvent(o,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Bo,skuId:jo,skuToken:this.skuToken,userId:this.anonId},l=>{l?this.errorCb(l):i&&(this.success[i]=!0)},r))}},oe=Y.postMapLoadEvent.bind(Y),de=new class extends ee{constructor(){super("gljs.performance")}postPerformanceEvent(r,i){Jt.EVENTS_URL&&(r||Jt.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:i},r)}processRequests(r){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:i,performanceData:o}=this.queue.shift(),l=function(h){const m=Ue.performance.getEntriesByType("resource"),_=Ue.performance.getEntriesByType("mark"),x=function(L){const O={};if(L)for(const N in L)if("other"!==N)for(const j of L[N]){const G=`${N}ResolveRangeMin`,ne=`${N}ResolveRangeMax`,ae=`${N}RequestCount`,te=`${N}RequestCachedCount`;O[G]=Math.min(O[G]||1/0,j.startTime),O[ne]=Math.max(O[ne]||-1/0,j.responseEnd);const se=he=>{void 0===O[he]&&(O[he]=0),++O[he]};void 0!==j.transferSize&&0===j.transferSize&&se(te),se(ae)}return O}(function(L,O){const N={};if(L)for(const j of L){const G=O(j);void 0===N[G]&&(N[G]=[]),N[G].push(j)}return N}(m,We)),E=Ue.devicePixelRatio,T=Ue.navigator.connection||Ue.navigator.mozConnection||Ue.navigator.webkitConnection,S={counters:[],metadata:[],attributes:[]},P=(L,O,N)=>{null!=N&&L.push({name:O,value:N.toString()})};for(const L in x)P(S.counters,L,x[L]);if(h.interactionRange[0]!==1/0&&h.interactionRange[1]!==-1/0&&(P(S.counters,"interactionRangeMin",h.interactionRange[0]),P(S.counters,"interactionRangeMax",h.interactionRange[1])),_)for(const L of Object.keys(je)){const O=je[L],N=_.find(j=>j.name===O);N&&P(S.counters,O,N.startTime)}return P(S.counters,"visibilityHidden",h.visibilityHidden),P(S.attributes,"style",function(L){if(L)for(const O of L){const N=O.name.split("?")[0];if(Sa(N)){const j=N.split("/").slice(-2);if(2===j.length)return`mapbox://styles/${j[0]}/${j[1]}`}}}(m)),P(S.attributes,"terrainEnabled",h.terrainEnabled?"true":"false"),P(S.attributes,"fogEnabled",h.fogEnabled?"true":"false"),P(S.attributes,"projection",h.projection),P(S.attributes,"zoom",h.zoom),P(S.metadata,"devicePixelRatio",E),P(S.metadata,"connectionEffectiveType",T?T.effectiveType:void 0),P(S.metadata,"navigatorUserAgent",Ue.navigator.userAgent),P(S.metadata,"screenWidth",Ue.screen.width),P(S.metadata,"screenHeight",Ue.screen.height),P(S.metadata,"windowWidth",Ue.innerWidth),P(S.metadata,"windowHeight",Ue.innerHeight),P(S.metadata,"mapWidth",h.width/E),P(S.metadata,"mapHeight",h.height/E),P(S.metadata,"webglRenderer",h.renderer),P(S.metadata,"webglVendor",h.vendor),P(S.metadata,"sdkVersion",Bo),P(S.metadata,"sdkIdentifier","mapbox-gl-js"),S}(o);for(const h of l.metadata);for(const h of l.counters);for(const h of l.attributes);this.postEvent(i,l,()=>{},r)}},ve=de.postPerformanceEvent.bind(de),ye=new class extends ee{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(r,i,o,l){if(!Jt.API_URL||!Jt.SESSION_PATH)return;const h=so(Jt.API_URL+Jt.SESSION_PATH);h.params.push(`sku=${i||""}`),h.params.push(`access_token=${l||Jt.ACCESS_TOKEN||""}`);const m={url:Gs(h),headers:{"Content-Type":"text/plain"}};var x;this.pendingRequest=(x=_=>{this.pendingRequest=null,o(_),this.saveEventData(),this.processRequests(l)},Us(_n(m,{method:"GET"}),x))}getSessionAPI(r,i,o,l){this.skuToken=i,this.errorCb=l,Jt.SESSION_PATH&&Jt.API_URL&&(o||Jt.ACCESS_TOKEN?this.queueRequest({id:r,timestamp:Date.now()},o):this.errorCb(new Error(ac)))}processRequests(r){if(this.pendingRequest||0===this.queue.length)return;const{id:i,timestamp:o}=this.queue.shift();i&&this.success[i]||this.getSession(o,this.skuToken,l=>{l?this.errorCb(l):i&&(this.success[i]=!0)},r)}},pe=ye.getSessionAPI.bind(ye),we=new Set,je={create:"create",load:"load",fullLoad:"fullLoad"},it={mark(r){Ue.performance.mark(r)},measure(r,i,o){Ue.performance.measure(r,i,o)}};function We(r){const i=r.name.split("?")[0];return cc(i)&&i.includes("mapbox-gl.js")?"javascript":cc(i)&&i.includes("mapbox-gl.css")?"css":Jt.API_FONTS_REGEX.test(i)?"fontRange":$s(i)?"sprite":Sa(i)?"style":Jt.API_TILEJSON_REGEX.test(i)?"tilejson":"other"}const Et=Ue.performance;function bt(r){const i=r?r.url.toString():void 0;return Et.getEntriesByName(i)}let gt,Lt,an,Dn;const xt={now:()=>void 0!==an?an:Ue.performance.now(),setNow(r){an=r},restoreNow(){an=void 0},frame(r){const i=Ue.requestAnimationFrame(r);return{cancel:()=>Ue.cancelAnimationFrame(i)}},getImageData(r,i=0){const{width:o,height:l}=r;Dn||(Dn=Ue.document.createElement("canvas"));const h=Dn.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return(o>Dn.width||l>Dn.height)&&(Dn.width=o,Dn.height=l),h.clearRect(-i,-i,o+2*i,l+2*i),h.drawImage(r,0,0,o,l),h.getImageData(-i,-i,o+2*i,l+2*i)},resolveURL:r=>(gt||(gt=Ue.document.createElement("a")),gt.href=r,gt.href),get devicePixelRatio(){return Ue.devicePixelRatio},get prefersReducedMotion(){return!!Ue.matchMedia&&(null==Lt&&(Lt=Ue.matchMedia("(prefers-reduced-motion: reduce)")),Lt.matches)}};function Un(r,i,o){o[r]&&-1!==o[r].indexOf(i)||(o[r]=o[r]||[],o[r].push(i))}function Wn(r,i,o){if(o&&o[r]){const l=o[r].indexOf(i);-1!==l&&o[r].splice(l,1)}}class Wo{constructor(i,o={}){_n(this,o),this.type=i}}class gs extends Wo{constructor(i,o={}){super("error",_n({error:i},o))}}class jr{on(i,o){return this._listeners=this._listeners||{},Un(i,o,this._listeners),this}off(i,o){return Wn(i,o,this._listeners),Wn(i,o,this._oneTimeListeners),this}once(i,o){return o?(this._oneTimeListeners=this._oneTimeListeners||{},Un(i,o,this._oneTimeListeners),this):new Promise(l=>this.once(i,l))}fire(i,o){"string"==typeof i&&(i=new Wo(i,o||{}));const l=i.type;if(this.listens(l)){i.target=this;const h=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const x of h)x.call(this,i);const m=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const x of m)Wn(l,x,this._oneTimeListeners),x.call(this,i);const _=this._eventedParent;_&&(_n(i,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),_.fire(i))}else i instanceof gs&&console.error(i.error);return this}listens(i){return!!(this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i))}setEventedParent(i,o){return this._eventedParent=i,this._eventedParentData=o,this}}var Re=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function _s(r,...i){for(const o of i)for(const l in o)r[l]=o[l];return r}function _i(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function ys(r){if(Array.isArray(r))return r.map(ys);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const i={};for(const o in r)i[o]=ys(r[o]);return i}return _i(r)}class Hd extends Error{constructor(i,o){super(o),this.message=o,this.key=i}}var Ur=Hd;class _u{constructor(i,o=[]){this.parent=i,this.bindings={};for(const[l,h]of o)this.bindings[l]=h}concat(i){return new _u(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}var qd=_u;const pr={kind:"null"},st={kind:"number"},ln={kind:"string"},_t={kind:"boolean"},$r={kind:"color"},In={kind:"object"},Xt={kind:"value"},uc={kind:"collator"},Hs={kind:"formatted"},kt={kind:"resolvedImage"};function wi(r,i){return{kind:"array",itemType:r,N:i}}function si(r){if("array"===r.kind){const i=si(r.itemType);return"number"==typeof r.N?`array<${i}, ${r.N}>`:"value"===r.itemType.kind?"array":`array<${i}>`}return r.kind}const rt=[pr,st,ln,_t,$r,Hs,In,wi(Xt),kt];function qs(r,i){if("error"===i.kind)return null;if("array"===r.kind){if("array"===i.kind&&(0===i.N&&"value"===i.itemType.kind||!qs(r.itemType,i.itemType))&&("number"!=typeof r.N||r.N===i.N))return null}else{if(r.kind===i.kind)return null;if("value"===r.kind)for(const o of rt)if(!qs(o,i))return null}return`Expected ${si(r)} but found ${si(i)} instead.`}function jt(r,i){return i.some(o=>o.kind===r.kind)}function Tn(r,i){return i.some(o=>"null"===o?null===r:"array"===o?Array.isArray(r):"object"===o?r&&!Array.isArray(r)&&"object"==typeof r:o===typeof r)}var hc,Wd={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Ws(r){return(r=Math.round(r))<0?0:r>255?255:r}function Zs(r){return Ws("%"===r[r.length-1]?parseFloat(r)/100*255:parseInt(r))}function er(r){return(i="%"===r[r.length-1]?parseFloat(r)/100:parseFloat(r))<0?0:i>1?1:i;var i}function Zd(r,i,o){return o<0?o+=1:o>1&&(o-=1),6*o<1?r+(i-r)*o*6:2*o<1?i:3*o<2?r+(i-r)*(2/3-o)*6:r}try{hc={}.parseCSSColor=function(r){var i,o=r.replace(/ /g,"").toLowerCase();if(o in Wd)return Wd[o].slice();if("#"===o[0])return 4===o.length?(i=parseInt(o.substr(1),16))>=0&&i<=4095?[(3840&i)>>4|(3840&i)>>8,240&i|(240&i)>>4,15&i|(15&i)<<4,1]:null:7===o.length&&(i=parseInt(o.substr(1),16))>=0&&i<=16777215?[(16711680&i)>>16,(65280&i)>>8,255&i,1]:null;var l=o.indexOf("("),h=o.indexOf(")");if(-1!==l&&h+1===o.length){var m=o.substr(0,l),_=o.substr(l+1,h-(l+1)).split(","),x=1;switch(m){case"rgba":if(4!==_.length)return null;x=er(_.pop());case"rgb":return 3!==_.length?null:[Zs(_[0]),Zs(_[1]),Zs(_[2]),x];case"hsla":if(4!==_.length)return null;x=er(_.pop());case"hsl":if(3!==_.length)return null;var E=(parseFloat(_[0])%360+360)%360/360,T=er(_[1]),S=er(_[2]),P=S<=.5?S*(T+1):S+T-S*T,L=2*S-P;return[Ws(255*Zd(L,P,E+1/3)),Ws(255*Zd(L,P,E)),Ws(255*Zd(L,P,E-1/3)),x];default:return null}}return null}}catch{}class Dr{constructor(i,o,l,h=1){this.r=i,this.g=o,this.b=l,this.a=h}static parse(i){if(!i)return;if(i instanceof Dr)return i;if("string"!=typeof i)return;const o=hc(i);return o?new Dr(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3]):void 0}toString(){const[i,o,l,h]=this.toArray();return`rgba(${Math.round(i)},${Math.round(o)},${Math.round(l)},${h})`}toArray(){const{r:i,g:o,b:l,a:h}=this;return 0===h?[0,0,0,0]:[255*i/h,255*o/h,255*l/h,h]}toArray01(){const{r:i,g:o,b:l,a:h}=this;return 0===h?[0,0,0,0]:[i/h,o/h,l/h,h]}toArray01PremultipliedAlpha(){const{r:i,g:o,b:l,a:h}=this;return[i,o,l,h]}}Dr.black=new Dr(0,0,0,1),Dr.white=new Dr(1,1,1,1),Dr.transparent=new Dr(0,0,0,0),Dr.red=new Dr(1,0,0,1),Dr.blue=new Dr(0,0,1,1);var ui=Dr;class Gr{constructor(i,o,l){this.sensitivity=i?o?"variant":"case":o?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,o){return this.collator.compare(i,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Xd{constructor(i,o,l,h,m){this.text=i.normalize?i.normalize():i,this.image=o,this.scale=l,this.fontStack=h,this.textColor=m}}class tr{constructor(i){this.sections=i}static fromString(i){return new tr([new Xd(i,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(i=>0!==i.text.length||i.image&&0!==i.image.name.length)}static factory(i){return i instanceof tr?i:tr.fromString(i)}toString(){return 0===this.sections.length?"":this.sections.map(i=>i.text).join("")}serialize(){const i=["format"];for(const o of this.sections){if(o.image){i.push(["image",o.image.name]);continue}i.push(o.text);const l={};o.fontStack&&(l["text-font"]=["literal",o.fontStack.split(",")]),o.scale&&(l["font-scale"]=o.scale),o.textColor&&(l["text-color"]=["rgba"].concat(o.textColor.toArray())),i.push(l)}return i}}class xo{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new xo({name:i,available:!1}):null}serialize(){return["image",this.name]}}function zf(r,i,o,l){return"number"==typeof r&&r>=0&&r<=255&&"number"==typeof i&&i>=0&&i<=255&&"number"==typeof o&&o>=0&&o<=255?void 0===l||"number"==typeof l&&l>=0&&l<=1?null:`Invalid rgba value [${[r,i,o,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof l?[r,i,o,l]:[r,i,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function yu(r){if(null===r||"string"==typeof r||"boolean"==typeof r||"number"==typeof r||r instanceof ui||r instanceof Gr||r instanceof tr||r instanceof xo)return!0;if(Array.isArray(r)){for(const i of r)if(!yu(i))return!1;return!0}if("object"==typeof r){for(const i in r)if(!yu(r[i]))return!1;return!0}return!1}function Ei(r){if(null===r)return pr;if("string"==typeof r)return ln;if("boolean"==typeof r)return _t;if("number"==typeof r)return st;if(r instanceof ui)return $r;if(r instanceof Gr)return uc;if(r instanceof tr)return Hs;if(r instanceof xo)return kt;if(Array.isArray(r)){const i=r.length;let o;for(const l of r){const h=Ei(l);if(o){if(o===h)continue;o=Xt;break}o=h}return wi(o||Xt,i)}return In}function dc(r){const i=typeof r;return null===r?"":"string"===i||"number"===i||"boolean"===i?String(r):r instanceof ui||r instanceof tr||r instanceof xo?r.toString():JSON.stringify(r)}class Kd{constructor(i,o){this.type=i,this.value=o}static parse(i,o){if(2!==i.length)return o.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!yu(i[1]))return o.error("invalid value");const l=i[1];let h=Ei(l);const m=o.expectedType;return"array"!==h.kind||0!==h.N||!m||"array"!==m.kind||"number"==typeof m.N&&0!==m.N||(h=m),new Kd(h,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof ui?["rgba"].concat(this.value.toArray()):this.value instanceof tr?this.value.serialize():this.value}}var Bi=Kd,Ut=class{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}};const pc={string:ln,number:st,boolean:_t,object:In};class Yd{constructor(i,o){this.type=i,this.args=o}static parse(i,o){if(i.length<2)return o.error("Expected at least one argument.");let l,h=1;const m=i[0];if("array"===m){let x,E;if(i.length>2){const T=i[1];if("string"!=typeof T||!(T in pc)||"object"===T)return o.error('The item type argument of "array" must be one of string, number, boolean',1);x=pc[T],h++}else x=Xt;if(i.length>3){if(null!==i[2]&&("number"!=typeof i[2]||i[2]<0||i[2]!==Math.floor(i[2])))return o.error('The length argument to "array" must be a positive integer literal',2);E=i[2],h++}l=wi(x,E)}else l=pc[m];const _=[];for(;h<i.length;h++){const x=o.parse(i[h],h,Xt);if(!x)return null;_.push(x)}return new Yd(l,_)}evaluate(i){for(let o=0;o<this.args.length;o++){const l=this.args[o].evaluate(i);if(!qs(this.type,Ei(l)))return l;if(o===this.args.length-1)throw new Ut(`Expected value to be of type ${si(this.type)}, but found ${si(Ei(l))} instead.`)}return null}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=this.type,o=[i.kind];if("array"===i.kind){const l=i.itemType;if("string"===l.kind||"number"===l.kind||"boolean"===l.kind){o.push(l.kind);const h=i.N;("number"==typeof h||this.args.length>1)&&o.push(h)}}return o.concat(this.args.map(l=>l.serialize()))}}var Xs=Yd;class Sn{constructor(i){this.type=Hs,this.sections=i}static parse(i,o){if(i.length<2)return o.error("Expected at least one argument.");const l=i[1];if(!Array.isArray(l)&&"object"==typeof l)return o.error("First argument must be an image or text section.");const h=[];let m=!1;for(let _=1;_<=i.length-1;++_){const x=i[_];if(m&&"object"==typeof x&&!Array.isArray(x)){m=!1;let E=null;if(x["font-scale"]&&(E=o.parse(x["font-scale"],1,st),!E))return null;let T=null;if(x["text-font"]&&(T=o.parse(x["text-font"],1,wi(ln)),!T))return null;let S=null;if(x["text-color"]&&(S=o.parse(x["text-color"],1,$r),!S))return null;const P=h[h.length-1];P.scale=E,P.font=T,P.textColor=S}else{const E=o.parse(i[_],1,Xt);if(!E)return null;const T=E.type.kind;if("string"!==T&&"value"!==T&&"null"!==T&&"resolvedImage"!==T)return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,h.push({content:E,scale:null,font:null,textColor:null})}}return new Sn(h)}evaluate(i){return new tr(this.sections.map(o=>{const l=o.content.evaluate(i);return Ei(l)===kt?new Xd("",l,null,null,null):new Xd(dc(l),null,o.scale?o.scale.evaluate(i):null,o.font?o.font.evaluate(i).join(","):null,o.textColor?o.textColor.evaluate(i):null)}))}eachChild(i){for(const o of this.sections)i(o.content),o.scale&&i(o.scale),o.font&&i(o.font),o.textColor&&i(o.textColor)}outputDefined(){return!1}serialize(){const i=["format"];for(const o of this.sections){i.push(o.content.serialize());const l={};o.scale&&(l["font-scale"]=o.scale.serialize()),o.font&&(l["text-font"]=o.font.serialize()),o.textColor&&(l["text-color"]=o.textColor.serialize()),i.push(l)}return i}}class Rh{constructor(i){this.type=kt,this.input=i}static parse(i,o){if(2!==i.length)return o.error("Expected two arguments.");const l=o.parse(i[1],1,ln);return l?new Rh(l):o.error("No image name provided.")}evaluate(i){const o=this.input.evaluate(i),l=xo.fromString(o);return l&&i.availableImages&&(l.available=i.availableImages.indexOf(o)>-1),l}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Hr={"to-boolean":_t,"to-color":$r,"to-number":st,"to-string":ln};class hl{constructor(i,o){this.type=i,this.args=o}static parse(i,o){if(i.length<2)return o.error("Expected at least one argument.");const l=i[0];if(("to-boolean"===l||"to-string"===l)&&2!==i.length)return o.error("Expected one argument.");const h=Hr[l],m=[];for(let _=1;_<i.length;_++){const x=o.parse(i[_],_,Xt);if(!x)return null;m.push(x)}return new hl(h,m)}evaluate(i){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(i));if("color"===this.type.kind){let o,l;for(const h of this.args){if(o=h.evaluate(i),l=null,o instanceof ui)return o;if("string"==typeof o){const m=i.parseColor(o);if(m)return m}else if(Array.isArray(o)&&(l=o.length<3||o.length>4?`Invalid rbga value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:zf(o[0],o[1],o[2],o[3]),!l))return new ui(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new Ut(l||`Could not parse color from value '${"string"==typeof o?o:String(JSON.stringify(o))}'`)}if("number"===this.type.kind){let o=null;for(const l of this.args){if(o=l.evaluate(i),null===o)return 0;const h=Number(o);if(!isNaN(h))return h}throw new Ut(`Could not convert ${JSON.stringify(o)} to number.`)}return"formatted"===this.type.kind?tr.fromString(dc(this.args[0].evaluate(i))):"resolvedImage"===this.type.kind?xo.fromString(dc(this.args[0].evaluate(i))):dc(this.args[0].evaluate(i))}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Sn([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Rh(this.args[0]).serialize();const i=[`to-${this.type.kind}`];return this.eachChild(o=>{i.push(o.serialize())}),i}}var dl=hl;const fc=["Unknown","Point","LineString","Polygon"];var Qd=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?fc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const r=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:o,y:l}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(o*i-r[0])+this.featureDistanceData.bearing[1]*(l*i-r[1])}return 0}parseColor(r){let i=this._parseColorCache[r];return i||(i=this._parseColorCache[r]=ui.parse(r)),i}};class pl{constructor(i,o,l,h){this.name=i,this.type=o,this._evaluate=l,this.args=h}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(i=>i.serialize()))}static parse(i,o){const l=i[0],h=pl.definitions[l];if(!h)return o.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(h)?h[0]:h.type,_=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,x=_.filter(([T])=>!Array.isArray(T)||T.length===i.length-1);let E=null;for(const[T,S]of x){E=new bo(o.registry,o.path,null,o.scope);const P=[];let L=!1;for(let O=1;O<i.length;O++){const N=i[O],j=Array.isArray(T)?T[O-1]:T.type,G=E.parse(N,1+P.length,j);if(!G){L=!0;break}P.push(G)}if(!L)if(Array.isArray(T)&&T.length!==P.length)E.error(`Expected ${T.length} arguments, but found ${P.length} instead.`);else{for(let O=0;O<P.length;O++){const N=Array.isArray(T)?T[O]:T.type,j=P[O];E.concat(O+1).checkSubtype(N,j.type)}if(0===E.errors.length)return new pl(l,m,S,P)}}if(1===x.length)o.errors.push(...E.errors);else{const T=(x.length?x:_).map(([P])=>{return L=P,Array.isArray(L)?`(${L.map(si).join(", ")})`:`(${si(L.type)}...)`;var L}).join(" | "),S=[];for(let P=1;P<i.length;P++){const L=o.parse(i[P],1+S.length);if(!L)return null;S.push(si(L.type))}o.error(`Expected arguments of type ${T}, but found (${S.join(", ")}) instead.`)}return null}static register(i,o){pl.definitions=o;for(const l in o)i[l]=pl}}var vs=pl;class Aa{constructor(i,o,l){this.type=uc,this.locale=l,this.caseSensitive=i,this.diacriticSensitive=o}static parse(i,o){if(2!==i.length)return o.error("Expected one argument.");const l=i[1];if("object"!=typeof l||Array.isArray(l))return o.error("Collator options argument must be an object.");const h=o.parse(void 0!==l["case-sensitive"]&&l["case-sensitive"],1,_t);if(!h)return null;const m=o.parse(void 0!==l["diacritic-sensitive"]&&l["diacritic-sensitive"],1,_t);if(!m)return null;let _=null;return l.locale&&(_=o.parse(l.locale,1,ln),!_)?null:new Aa(h,m,_)}evaluate(i){return new Gr(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}serialize(){const i={};return i["case-sensitive"]=this.caseSensitive.serialize(),i["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(i.locale=this.locale.serialize()),["collator",i]}}const Ti=8192;function mc(r,i){r[0]=Math.min(r[0],i[0]),r[1]=Math.min(r[1],i[1]),r[2]=Math.max(r[2],i[0]),r[3]=Math.max(r[3],i[1])}function gc(r,i){return!(r[0]<=i[0]||r[2]>=i[2]||r[1]<=i[1]||r[3]>=i[3])}function $t(r,i){const o=(180+r[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,h=Math.pow(2,i.z);return[Math.round(o*h*Ti),Math.round(l*h*Ti)]}function vu(r,i,o){const l=r[0]-i[0],h=r[1]-i[1],m=r[0]-o[0],_=r[1]-o[1];return l*_-m*h==0&&l*m<=0&&h*_<=0}function xu(r,i){let o=!1;for(let _=0,x=i.length;_<x;_++){const E=i[_];for(let T=0,S=E.length;T<S-1;T++){if(vu(r,E[T],E[T+1]))return!1;(h=E[T])[1]>(l=r)[1]!=(m=E[T+1])[1]>l[1]&&l[0]<(m[0]-h[0])*(l[1]-h[1])/(m[1]-h[1])+h[0]&&(o=!o)}}var l,h,m;return o}function qr(r,i){for(let o=0;o<i.length;o++)if(xu(r,i[o]))return!0;return!1}function _c(r,i,o,l){const h=l[0]-o[0],m=l[1]-o[1],_=(r[0]-o[0])*m-h*(r[1]-o[1]),x=(i[0]-o[0])*m-h*(i[1]-o[1]);return _>0&&x<0||_<0&&x>0}function bu(r,i,o){for(const T of o)for(let S=0;S<T.length-1;++S)if((x=[(_=T[S+1])[0]-(m=T[S])[0],_[1]-m[1]])[0]*(E=[(h=i)[0]-(l=r)[0],h[1]-l[1]])[1]-x[1]*E[0]!=0&&_c(l,h,m,_)&&_c(m,_,l,h))return!0;var l,h,m,_,x,E;return!1}function Zo(r,i){for(let o=0;o<r.length;++o)if(!xu(r[o],i))return!1;for(let o=0;o<r.length-1;++o)if(bu(r[o],r[o+1],i))return!1;return!0}function ao(r,i){for(let o=0;o<i.length;o++)if(Zo(r,i[o]))return!0;return!1}function wu(r,i,o){const l=[];for(let h=0;h<r.length;h++){const m=[];for(let _=0;_<r[h].length;_++){const x=$t(r[h][_],o);mc(i,x),m.push(x)}l.push(m)}return l}function Jd(r,i,o){const l=[];for(let h=0;h<r.length;h++){const m=wu(r[h],i,o);l.push(m)}return l}function Vi(r,i,o,l){if(r[0]<o[0]||r[0]>o[2]){const h=.5*l;let m=r[0]-o[0]>h?-l:o[0]-r[0]>h?l:0;0===m&&(m=r[0]-o[2]>h?-l:o[2]-r[0]>h?l:0),r[0]+=m}mc(i,r)}function Ct(r,i,o,l){const h=Math.pow(2,l.z)*Ti,m=[l.x*Ti,l.y*Ti],_=[];if(!r)return _;for(const x of r)for(const E of x){const T=[E.x+m[0],E.y+m[1]];Vi(T,i,o,h),_.push(T)}return _}function Bf(r,i,o,l){const h=Math.pow(2,l.z)*Ti,m=[l.x*Ti,l.y*Ti],_=[];if(!r)return _;for(const E of r){const T=[];for(const S of E){const P=[S.x+m[0],S.y+m[1]];mc(i,P),T.push(P)}_.push(T)}if(i[2]-i[0]<=h/2){(x=i)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const E of _)for(const T of E)Vi(T,i,o,h)}var x;return _}class Eu{constructor(i,o){this.type=_t,this.geojson=i,this.geometries=o}static parse(i,o){if(2!==i.length)return o.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(yu(i[1])){const l=i[1];if("FeatureCollection"===l.type)for(let h=0;h<l.features.length;++h){const m=l.features[h].geometry.type;if("Polygon"===m||"MultiPolygon"===m)return new Eu(l,l.features[h].geometry)}else if("Feature"===l.type){const h=l.geometry.type;if("Polygon"===h||"MultiPolygon"===h)return new Eu(l,l.geometry)}else if("Polygon"===l.type||"MultiPolygon"===l.type)return new Eu(l,l)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(null!=i.geometry()&&null!=i.canonicalID()){if("Point"===i.geometryType())return function(o,l){const h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],_=o.canonicalID();if(!_)return!1;if("Polygon"===l.type){const x=wu(l.coordinates,m,_),E=Ct(o.geometry(),h,m,_);if(!gc(h,m))return!1;for(const T of E)if(!xu(T,x))return!1}if("MultiPolygon"===l.type){const x=Jd(l.coordinates,m,_),E=Ct(o.geometry(),h,m,_);if(!gc(h,m))return!1;for(const T of E)if(!qr(T,x))return!1}return!0}(i,this.geometries);if("LineString"===i.geometryType())return function(o,l){const h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],_=o.canonicalID();if(!_)return!1;if("Polygon"===l.type){const x=wu(l.coordinates,m,_),E=Bf(o.geometry(),h,m,_);if(!gc(h,m))return!1;for(const T of E)if(!Zo(T,x))return!1}if("MultiPolygon"===l.type){const x=Jd(l.coordinates,m,_),E=Bf(o.geometry(),h,m,_);if(!gc(h,m))return!1;for(const T of E)if(!ao(T,x))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Ks=Eu;function yn(r){if(r instanceof vs&&("get"===r.name&&1===r.args.length||"feature-state"===r.name||"has"===r.name&&1===r.args.length||"properties"===r.name||"geometry-type"===r.name||"id"===r.name||/^filter-/.test(r.name))||r instanceof Ks)return!1;let i=!0;return r.eachChild(o=>{i&&!yn(o)&&(i=!1)}),i}function Pa(r){if(r instanceof vs&&"feature-state"===r.name)return!1;let i=!0;return r.eachChild(o=>{i&&!Pa(o)&&(i=!1)}),i}function La(r,i){if(r instanceof vs&&i.indexOf(r.name)>=0)return!1;let o=!0;return r.eachChild(l=>{o&&!La(l,i)&&(o=!1)}),o}class fl{constructor(i,o){this.type=o.type,this.name=i,this.boundExpression=o}static parse(i,o){if(2!==i.length||"string"!=typeof i[1])return o.error("'var' expression requires exactly one string literal argument.");const l=i[1];return o.scope.has(l)?new fl(l,o.scope.get(l)):o.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Tu=fl;class lo{constructor(i,o=[],l,h=new qd,m=[]){this.registry=i,this.path=o,this.key=o.map(_=>`[${_}]`).join(""),this.scope=h,this.errors=m,this.expectedType=l}parse(i,o,l,h,m={}){return o?this.concat(o,l,h)._parse(i,m):this._parse(i,m)}_parse(i,o){function l(h,m,_){return"assert"===_?new Xs(m,[h]):"coerce"===_?new dl(m,[h]):h}if(null!==i&&"string"!=typeof i&&"boolean"!=typeof i&&"number"!=typeof i||(i=["literal",i]),Array.isArray(i)){if(0===i.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=i[0];if("string"!=typeof h)return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[h];if(m){let _=m.parse(i,this);if(!_)return null;if(this.expectedType){const x=this.expectedType,E=_.type;if("string"!==x.kind&&"number"!==x.kind&&"boolean"!==x.kind&&"object"!==x.kind&&"array"!==x.kind||"value"!==E.kind)if("color"!==x.kind&&"formatted"!==x.kind&&"resolvedImage"!==x.kind||"value"!==E.kind&&"string"!==E.kind){if(this.checkSubtype(x,E))return null}else _=l(_,x,o.typeAnnotation||"coerce");else _=l(_,x,o.typeAnnotation||"assert")}if(!(_ instanceof Bi)&&"resolvedImage"!==_.type.kind&&ml(_)){const x=new Qd;try{_=new Bi(_.type,_.evaluate(x))}catch(E){return this.error(E.message),null}}return _}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===i?"'undefined' value invalid. Use null instead.":"object"==typeof i?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,o,l){const h="number"==typeof i?this.path.concat(i):this.path,m=l?this.scope.concat(l):this.scope;return new lo(this.registry,h,o||null,m,this.errors)}error(i,...o){const l=`${this.key}${o.map(h=>`[${h}]`).join("")}`;this.errors.push(new Ur(l,i))}checkSubtype(i,o){const l=qs(i,o);return l&&this.error(l),l}}var bo=lo;function ml(r){if(r instanceof Tu)return ml(r.boundExpression);if(r instanceof vs&&"error"===r.name||r instanceof Aa||r instanceof Ks)return!1;const i=r instanceof dl||r instanceof Xs;let o=!0;return r.eachChild(l=>{o=i?o&&ml(l):o&&l instanceof Bi}),!!o&&yn(r)&&La(r,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Zn(r,i){const o=r.length-1;let l,h,m=0,_=o,x=0;for(;m<=_;)if(x=Math.floor((m+_)/2),l=r[x],h=r[x+1],l<=i){if(x===o||i<h)return x;m=x+1}else{if(!(l>i))throw new Ut("Input is not a number.");_=x-1}return 0}class yc{constructor(i,o,l){this.type=i,this.input=o,this.labels=[],this.outputs=[];for(const[h,m]of l)this.labels.push(h),this.outputs.push(m)}static parse(i,o){if(i.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return o.error("Expected an even number of arguments.");const l=o.parse(i[1],1,st);if(!l)return null;const h=[];let m=null;o.expectedType&&"value"!==o.expectedType.kind&&(m=o.expectedType);for(let _=1;_<i.length;_+=2){const x=1===_?-1/0:i[_],E=i[_+1],T=_,S=_+1;if("number"!=typeof x)return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(h.length&&h[h.length-1][0]>=x)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);const P=o.parse(E,S,m);if(!P)return null;m=m||P.type,h.push([x,P])}return new yc(m,l,h)}evaluate(i){const o=this.labels,l=this.outputs;if(1===o.length)return l[0].evaluate(i);const h=this.input.evaluate(i);if(h<=o[0])return l[0].evaluate(i);const m=o.length;return h>=o[m-1]?l[m-1].evaluate(i):l[Zn(o,h)].evaluate(i)}eachChild(i){i(this.input);for(const o of this.outputs)i(o)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){const i=["step",this.input.serialize()];for(let o=0;o<this.labels.length;o++)o>0&&i.push(this.labels[o]),i.push(this.outputs[o].serialize());return i}}var vc=yc;function dn(r,i,o){return r*(1-o)+i*o}var fr=Object.freeze({__proto__:null,number:dn,color:function(r,i,o){return new ui(dn(r.r,i.r,o),dn(r.g,i.g,o),dn(r.b,i.b,o),dn(r.a,i.a,o))},array:function(r,i,o){return r.map((l,h)=>dn(l,i[h],o))}});const Pi=4/29,ji=6/29,Vn=3*ji*ji,nr=Math.PI/180,mr=180/Math.PI;function Ys(r){return r>.008856451679035631?Math.pow(r,1/3):r/Vn+Pi}function ir(r){return r>ji?r*r*r:Vn*(r-Pi)}function Cr(r){return 255*(r<=.0031308?12.92*r:1.055*Math.pow(r,1/2.4)-.055)}function pt(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function rn(r){const i=pt(r.r),o=pt(r.g),l=pt(r.b),h=Ys((.4124564*i+.3575761*o+.1804375*l)/.95047),m=Ys((.2126729*i+.7151522*o+.072175*l)/1);return{l:116*m-16,a:500*(h-m),b:200*(m-Ys((.0193339*i+.119192*o+.9503041*l)/1.08883)),alpha:r.a}}function ei(r){let i=(r.l+16)/116,o=isNaN(r.a)?i:i+r.a/500,l=isNaN(r.b)?i:i-r.b/200;return i=1*ir(i),o=.95047*ir(o),l=1.08883*ir(l),new ui(Cr(3.2404542*o-1.5371385*i-.4985314*l),Cr(-.969266*o+1.8760108*i+.041556*l),Cr(.0556434*o-.2040259*i+1.0572252*l),r.alpha)}function Wr(r,i,o){const l=i-r;return r+o*(l>180||l<-180?l-360*Math.round(l/360):l)}const wo={forward:rn,reverse:ei,interpolate:function(r,i,o){return{l:dn(r.l,i.l,o),a:dn(r.a,i.a,o),b:dn(r.b,i.b,o),alpha:dn(r.alpha,i.alpha,o)}}},ci={forward:function(r){const{l:i,a:o,b:l}=rn(r),h=Math.atan2(l,o)*mr;return{h:h<0?h+360:h,c:Math.sqrt(o*o+l*l),l:i,alpha:r.a}},reverse:function(r){const i=r.h*nr,o=r.c;return ei({l:r.l,a:Math.cos(i)*o,b:Math.sin(i)*o,alpha:r.alpha})},interpolate:function(r,i,o){return{h:Wr(r.h,i.h,o),c:dn(r.c,i.c,o),l:dn(r.l,i.l,o),alpha:dn(r.alpha,i.alpha,o)}}};var Qs=Object.freeze({__proto__:null,lab:wo,hcl:ci});class ti{constructor(i,o,l,h,m){this.type=i,this.operator=o,this.interpolation=l,this.input=h,this.labels=[],this.outputs=[];for(const[_,x]of m)this.labels.push(_),this.outputs.push(x)}static interpolationFactor(i,o,l,h){let m=0;if("exponential"===i.name)m=ka(o,i.base,l,h);else if("linear"===i.name)m=ka(o,1,l,h);else if("cubic-bezier"===i.name){const _=i.controlPoints;m=new Os(_[0],_[1],_[2],_[3]).solve(ka(o,1,l,h))}return m}static parse(i,o){let[l,h,m,..._]=i;if(!Array.isArray(h)||0===h.length)return o.error("Expected an interpolation type expression.",1);if("linear"===h[0])h={name:"linear"};else if("exponential"===h[0]){const T=h[1];if("number"!=typeof T)return o.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:T}}else{if("cubic-bezier"!==h[0])return o.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const T=h.slice(1);if(4!==T.length||T.some(S=>"number"!=typeof S||S<0||S>1))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:T}}}if(i.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(m=o.parse(m,2,st),!m)return null;const x=[];let E=null;"interpolate-hcl"===l||"interpolate-lab"===l?E=$r:o.expectedType&&"value"!==o.expectedType.kind&&(E=o.expectedType);for(let T=0;T<_.length;T+=2){const S=_[T],P=_[T+1],L=T+3,O=T+4;if("number"!=typeof S)return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(x.length&&x[x.length-1][0]>=S)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',L);const N=o.parse(P,O,E);if(!N)return null;E=E||N.type,x.push([S,N])}return"number"===E.kind||"color"===E.kind||"array"===E.kind&&"number"===E.itemType.kind&&"number"==typeof E.N?new ti(E,l,h,m,x):o.error(`Type ${si(E)} is not interpolatable.`)}evaluate(i){const o=this.labels,l=this.outputs;if(1===o.length)return l[0].evaluate(i);const h=this.input.evaluate(i);if(h<=o[0])return l[0].evaluate(i);const m=o.length;if(h>=o[m-1])return l[m-1].evaluate(i);const _=Zn(o,h),x=ti.interpolationFactor(this.interpolation,h,o[_],o[_+1]),E=l[_].evaluate(i),T=l[_+1].evaluate(i);return"interpolate"===this.operator?fr[this.type.kind.toLowerCase()](E,T,x):"interpolate-hcl"===this.operator?ci.reverse(ci.interpolate(ci.forward(E),ci.forward(T),x)):wo.reverse(wo.interpolate(wo.forward(E),wo.forward(T),x))}eachChild(i){i(this.input);for(const o of this.outputs)i(o)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){let i;i="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const o=[this.operator,i,this.input.serialize()];for(let l=0;l<this.labels.length;l++)o.push(this.labels[l],this.outputs[l].serialize());return o}}function ka(r,i,o,l){const h=l-o,m=r-o;return 0===h?0:1===i?m/h:(Math.pow(i,m)-1)/(Math.pow(i,h)-1)}var Ir=ti;class en{constructor(i,o){this.type=i,this.args=o}static parse(i,o){if(i.length<2)return o.error("Expectected at least one argument.");let l=null;const h=o.expectedType;h&&"value"!==h.kind&&(l=h);const m=[];for(const x of i.slice(1)){const E=o.parse(x,1+m.length,l,void 0,{typeAnnotation:"omit"});if(!E)return null;l=l||E.type,m.push(E)}const _=h&&m.some(x=>qs(h,x.type));return new en(_?Xt:l,m)}evaluate(i){let o,l=null,h=0;for(const m of this.args){if(h++,l=m.evaluate(i),l&&l instanceof xo&&!l.available&&(o||(o=l),l=null,h===this.args.length))return o;if(null!==l)break}return l}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=["coalesce"];return this.eachChild(o=>{i.push(o.serialize())}),i}}var gl=en;class xs{constructor(i,o){this.type=o.type,this.bindings=[].concat(i),this.result=o}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const o of this.bindings)i(o[1]);i(this.result)}static parse(i,o){if(i.length<4)return o.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const l=[];for(let m=1;m<i.length-1;m+=2){const _=i[m];if("string"!=typeof _)return o.error(`Expected string, but found ${typeof _} instead.`,m);if(/[^a-zA-Z0-9_]/.test(_))return o.error("Variable names must contain only alphanumeric characters or '_'.",m);const x=o.parse(i[m+1],m+1);if(!x)return null;l.push([_,x])}const h=o.parse(i[i.length-1],i.length-1,o.expectedType,l);return h?new xs(l,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const i=["let"];for(const[o,l]of this.bindings)i.push(o,l.serialize());return i.push(this.result.serialize()),i}}var Du=xs;class bs{constructor(i,o,l){this.type=i,this.index=o,this.input=l}static parse(i,o){if(3!==i.length)return o.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const l=o.parse(i[1],1,st),h=o.parse(i[2],2,wi(o.expectedType||Xt));return l&&h?new bs(h.type.itemType,l,h):null}evaluate(i){const o=this.index.evaluate(i),l=this.input.evaluate(i);if(o<0)throw new Ut(`Array index out of bounds: ${o} < 0.`);if(o>=l.length)throw new Ut(`Array index out of bounds: ${o} > ${l.length-1}.`);if(o!==Math.floor(o))throw new Ut(`Array index must be an integer, but found ${o} instead.`);return l[o]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Ui=bs;class Js{constructor(i,o){this.type=_t,this.needle=i,this.haystack=o}static parse(i,o){if(3!==i.length)return o.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const l=o.parse(i[1],1,Xt),h=o.parse(i[2],2,Xt);return l&&h?jt(l.type,[_t,ln,st,pr,Xt])?new Js(l,h):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${si(l.type)} instead`):null}evaluate(i){const o=this.needle.evaluate(i),l=this.haystack.evaluate(i);if(null==l)return!1;if(!Tn(o,["boolean","string","number","null"]))throw new Ut(`Expected first argument to be of type boolean, string, number or null, but found ${si(Ei(o))} instead.`);if(!Tn(l,["string","array"]))throw new Ut(`Expected second argument to be of type array or string, but found ${si(Ei(l))} instead.`);return l.indexOf(o)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Ra=Js;class Sr{constructor(i,o,l){this.type=st,this.needle=i,this.haystack=o,this.fromIndex=l}static parse(i,o){if(i.length<=2||i.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const l=o.parse(i[1],1,Xt),h=o.parse(i[2],2,Xt);if(!l||!h)return null;if(!jt(l.type,[_t,ln,st,pr,Xt]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${si(l.type)} instead`);if(4===i.length){const m=o.parse(i[3],3,st);return m?new Sr(l,h,m):null}return new Sr(l,h)}evaluate(i){const o=this.needle.evaluate(i),l=this.haystack.evaluate(i);if(!Tn(o,["boolean","string","number","null"]))throw new Ut(`Expected first argument to be of type boolean, string, number or null, but found ${si(Ei(o))} instead.`);if(!Tn(l,["string","array"]))throw new Ut(`Expected second argument to be of type array or string, but found ${si(Ei(l))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(i);return l.indexOf(o,h)}return l.indexOf(o)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const i=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),i]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var _l=Sr;class Cu{constructor(i,o,l,h,m,_){this.inputType=i,this.type=o,this.input=l,this.cases=h,this.outputs=m,this.otherwise=_}static parse(i,o){if(i.length<5)return o.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return o.error("Expected an even number of arguments.");let l,h;o.expectedType&&"value"!==o.expectedType.kind&&(h=o.expectedType);const m={},_=[];for(let T=2;T<i.length-1;T+=2){let S=i[T];const P=i[T+1];Array.isArray(S)||(S=[S]);const L=o.concat(T);if(0===S.length)return L.error("Expected at least one branch label.");for(const N of S){if("number"!=typeof N&&"string"!=typeof N)return L.error("Branch labels must be numbers or strings.");if("number"==typeof N&&Math.abs(N)>Number.MAX_SAFE_INTEGER)return L.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof N&&Math.floor(N)!==N)return L.error("Numeric branch labels must be integer values.");if(l){if(L.checkSubtype(l,Ei(N)))return null}else l=Ei(N);if(void 0!==m[String(N)])return L.error("Branch labels must be unique.");m[String(N)]=_.length}const O=o.parse(P,T,h);if(!O)return null;h=h||O.type,_.push(O)}const x=o.parse(i[1],1,Xt);if(!x)return null;const E=o.parse(i[i.length-1],i.length-1,h);return E?"value"!==x.type.kind&&o.concat(1).checkSubtype(l,x.type)?null:new Cu(l,h,x,m,_,E):null}evaluate(i){const o=this.input.evaluate(i);return(Ei(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["match",this.input.serialize()],o=Object.keys(this.cases).sort(),l=[],h={};for(const _ of o){const x=h[this.cases[_]];void 0===x?(h[this.cases[_]]=l.length,l.push([this.cases[_],[_]])):l[x][1].push(_)}const m=_=>"number"===this.inputType.kind?Number(_):_;for(const[_,x]of l)i.push(1===x.length?m(x[0]):x.map(m)),i.push(this.outputs[_].serialize());return i.push(this.otherwise.serialize()),i}}var Jn=Cu;class yl{constructor(i,o,l){this.type=i,this.branches=o,this.otherwise=l}static parse(i,o){if(i.length<4)return o.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return o.error("Expected an odd number of arguments.");let l;o.expectedType&&"value"!==o.expectedType.kind&&(l=o.expectedType);const h=[];for(let _=1;_<i.length-1;_+=2){const x=o.parse(i[_],_,_t);if(!x)return null;const E=o.parse(i[_+1],_+1,l);if(!E)return null;h.push([x,E]),l=l||E.type}const m=o.parse(i[i.length-1],i.length-1,l);return m?new yl(l,h,m):null}evaluate(i){for(const[o,l]of this.branches)if(o.evaluate(i))return l.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[o,l]of this.branches)i(o),i(l);i(this.otherwise)}outputDefined(){return this.branches.every(([i,o])=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["case"];return this.eachChild(o=>{i.push(o.serialize())}),i}}var ep=yl;class ea{constructor(i,o,l,h){this.type=i,this.input=o,this.beginIndex=l,this.endIndex=h}static parse(i,o){if(i.length<=2||i.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const l=o.parse(i[1],1,Xt),h=o.parse(i[2],2,st);if(!l||!h)return null;if(!jt(l.type,[wi(Xt),ln,Xt]))return o.error(`Expected first argument to be of type array or string, but found ${si(l.type)} instead`);if(4===i.length){const m=o.parse(i[3],3,st);return m?new ea(l.type,l,h,m):null}return new ea(l.type,l,h)}evaluate(i){const o=this.input.evaluate(i),l=this.beginIndex.evaluate(i);if(!Tn(o,["string","array"]))throw new Ut(`Expected first argument to be of type array or string, but found ${si(Ei(o))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(i);return o.slice(l,h)}return o.slice(l)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const i=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),i]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Nh=ea;function vl(r,i){return"=="===r||"!="===r?"boolean"===i.kind||"string"===i.kind||"number"===i.kind||"null"===i.kind||"value"===i.kind:"string"===i.kind||"number"===i.kind||"value"===i.kind}function xc(r,i,o,l){return 0===l.compare(i,o)}function Zr(r,i,o){const l="=="!==r&&"!="!==r;return class pD{constructor(m,_,x){this.type=_t,this.lhs=m,this.rhs=_,this.collator=x,this.hasUntypedArgument="value"===m.type.kind||"value"===_.type.kind}static parse(m,_){if(3!==m.length&&4!==m.length)return _.error("Expected two or three arguments.");const x=m[0];let E=_.parse(m[1],1,Xt);if(!E)return null;if(!vl(x,E.type))return _.concat(1).error(`"${x}" comparisons are not supported for type '${si(E.type)}'.`);let T=_.parse(m[2],2,Xt);if(!T)return null;if(!vl(x,T.type))return _.concat(2).error(`"${x}" comparisons are not supported for type '${si(T.type)}'.`);if(E.type.kind!==T.type.kind&&"value"!==E.type.kind&&"value"!==T.type.kind)return _.error(`Cannot compare types '${si(E.type)}' and '${si(T.type)}'.`);l&&("value"===E.type.kind&&"value"!==T.type.kind?E=new Xs(T.type,[E]):"value"!==E.type.kind&&"value"===T.type.kind&&(T=new Xs(E.type,[T])));let S=null;if(4===m.length){if("string"!==E.type.kind&&"string"!==T.type.kind&&"value"!==E.type.kind&&"value"!==T.type.kind)return _.error("Cannot use collator to compare non-string types.");if(S=_.parse(m[3],3,uc),!S)return null}return new pD(E,T,S)}evaluate(m){const _=this.lhs.evaluate(m),x=this.rhs.evaluate(m);if(l&&this.hasUntypedArgument){const E=Ei(_),T=Ei(x);if(E.kind!==T.kind||"string"!==E.kind&&"number"!==E.kind)throw new Ut(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${E.kind}, ${T.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const E=Ei(_),T=Ei(x);if("string"!==E.kind||"string"!==T.kind)return i(m,_,x)}return this.collator?o(m,_,x,this.collator.evaluate(m)):i(m,_,x)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}serialize(){const m=[r];return this.eachChild(_=>{m.push(_.serialize())}),m}}}const $i=Zr("==",function(r,i,o){return i===o},xc),tp=Zr("!=",function(r,i,o){return i!==o},function(r,i,o,l){return!xc(0,i,o,l)}),rr=Zr("<",function(r,i,o){return i<o},function(r,i,o,l){return l.compare(i,o)<0}),Eo=Zr(">",function(r,i,o){return i>o},function(r,i,o,l){return l.compare(i,o)>0}),zh=Zr("<=",function(r,i,o){return i<=o},function(r,i,o,l){return l.compare(i,o)<=0}),Iu=Zr(">=",function(r,i,o){return i>=o},function(r,i,o,l){return l.compare(i,o)>=0});class xl{constructor(i,o,l,h,m,_){this.type=ln,this.number=i,this.locale=o,this.currency=l,this.unit=h,this.minFractionDigits=m,this.maxFractionDigits=_}static parse(i,o){if(3!==i.length)return o.error("Expected two arguments.");const l=o.parse(i[1],1,st);if(!l)return null;const h=i[2];if("object"!=typeof h||Array.isArray(h))return o.error("NumberFormat options argument must be an object.");let m=null;if(h.locale&&(m=o.parse(h.locale,1,ln),!m))return null;let _=null;if(h.currency&&(_=o.parse(h.currency,1,ln),!_))return null;let x=null;if(h.unit&&(x=o.parse(h.unit,1,ln),!x))return null;let E=null;if(h["min-fraction-digits"]&&(E=o.parse(h["min-fraction-digits"],1,st),!E))return null;let T=null;return h["max-fraction-digits"]&&(T=o.parse(h["max-fraction-digits"],1,st),!T)?null:new xl(l,m,_,x,E,T)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(i):void 0,unit:this.unit?this.unit.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.unit&&i(this.unit),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const i={};return this.locale&&(i.locale=this.locale.serialize()),this.currency&&(i.currency=this.currency.serialize()),this.unit&&(i.unit=this.unit.serialize()),this.minFractionDigits&&(i["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(i["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),i]}}class Xr{constructor(i){this.type=st,this.input=i}static parse(i,o){if(2!==i.length)return o.error(`Expected 1 argument, but found ${i.length-1} instead.`);const l=o.parse(i[1],1);return l?"array"!==l.type.kind&&"string"!==l.type.kind&&"value"!==l.type.kind?o.error(`Expected argument of type string or array, but found ${si(l.type)} instead.`):new Xr(l):null}evaluate(i){const o=this.input.evaluate(i);if("string"==typeof o||Array.isArray(o))return o.length;throw new Ut(`Expected value to be of type string or array, but found ${si(Ei(o))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){const i=["length"];return this.eachChild(o=>{i.push(o.serialize())}),i}}const np={"==":$i,"!=":tp,">":Eo,"<":rr,">=":Iu,"<=":zh,array:Xs,at:Ui,boolean:Xs,case:ep,coalesce:gl,collator:Aa,format:Sn,image:Rh,in:Ra,"index-of":_l,interpolate:Ir,"interpolate-hcl":Ir,"interpolate-lab":Ir,length:Xr,let:Du,literal:Bi,match:Jn,number:Xs,"number-format":xl,object:Xs,slice:Nh,step:vc,string:Xs,"to-boolean":dl,"to-color":dl,"to-number":dl,"to-string":dl,var:Tu,within:Ks};function Vf(r,[i,o,l,h]){i=i.evaluate(r),o=o.evaluate(r),l=l.evaluate(r);const m=h?h.evaluate(r):1,_=zf(i,o,l,m);if(_)throw new Ut(_);return new ui(i/255*m,o/255*m,l/255*m,m)}function Bh(r,i){return r in i}function Su(r,i){const o=i[r];return void 0===o?null:o}function ws(r){return{type:r}}vs.register(np,{error:[{kind:"error"},[ln],(r,[i])=>{throw new Ut(i.evaluate(r))}],typeof:[ln,[Xt],(r,[i])=>si(Ei(i.evaluate(r)))],"to-rgba":[wi(st,4),[$r],(r,[i])=>i.evaluate(r).toArray()],rgb:[$r,[st,st,st],Vf],rgba:[$r,[st,st,st,st],Vf],has:{type:_t,overloads:[[[ln],(r,[i])=>Bh(i.evaluate(r),r.properties())],[[ln,In],(r,[i,o])=>Bh(i.evaluate(r),o.evaluate(r))]]},get:{type:Xt,overloads:[[[ln],(r,[i])=>Su(i.evaluate(r),r.properties())],[[ln,In],(r,[i,o])=>Su(i.evaluate(r),o.evaluate(r))]]},"feature-state":[Xt,[ln],(r,[i])=>Su(i.evaluate(r),r.featureState||{})],properties:[In,[],r=>r.properties()],"geometry-type":[ln,[],r=>r.geometryType()],id:[Xt,[],r=>r.id()],zoom:[st,[],r=>r.globals.zoom],pitch:[st,[],r=>r.globals.pitch||0],"distance-from-center":[st,[],r=>r.distanceFromCenter()],"heatmap-density":[st,[],r=>r.globals.heatmapDensity||0],"line-progress":[st,[],r=>r.globals.lineProgress||0],"sky-radial-progress":[st,[],r=>r.globals.skyRadialProgress||0],accumulated:[Xt,[],r=>void 0===r.globals.accumulated?null:r.globals.accumulated],"+":[st,ws(st),(r,i)=>{let o=0;for(const l of i)o+=l.evaluate(r);return o}],"*":[st,ws(st),(r,i)=>{let o=1;for(const l of i)o*=l.evaluate(r);return o}],"-":{type:st,overloads:[[[st,st],(r,[i,o])=>i.evaluate(r)-o.evaluate(r)],[[st],(r,[i])=>-i.evaluate(r)]]},"/":[st,[st,st],(r,[i,o])=>i.evaluate(r)/o.evaluate(r)],"%":[st,[st,st],(r,[i,o])=>i.evaluate(r)%o.evaluate(r)],ln2:[st,[],()=>Math.LN2],pi:[st,[],()=>Math.PI],e:[st,[],()=>Math.E],"^":[st,[st,st],(r,[i,o])=>Math.pow(i.evaluate(r),o.evaluate(r))],sqrt:[st,[st],(r,[i])=>Math.sqrt(i.evaluate(r))],log10:[st,[st],(r,[i])=>Math.log(i.evaluate(r))/Math.LN10],ln:[st,[st],(r,[i])=>Math.log(i.evaluate(r))],log2:[st,[st],(r,[i])=>Math.log(i.evaluate(r))/Math.LN2],sin:[st,[st],(r,[i])=>Math.sin(i.evaluate(r))],cos:[st,[st],(r,[i])=>Math.cos(i.evaluate(r))],tan:[st,[st],(r,[i])=>Math.tan(i.evaluate(r))],asin:[st,[st],(r,[i])=>Math.asin(i.evaluate(r))],acos:[st,[st],(r,[i])=>Math.acos(i.evaluate(r))],atan:[st,[st],(r,[i])=>Math.atan(i.evaluate(r))],min:[st,ws(st),(r,i)=>Math.min(...i.map(o=>o.evaluate(r)))],max:[st,ws(st),(r,i)=>Math.max(...i.map(o=>o.evaluate(r)))],abs:[st,[st],(r,[i])=>Math.abs(i.evaluate(r))],round:[st,[st],(r,[i])=>{const o=i.evaluate(r);return o<0?-Math.round(-o):Math.round(o)}],floor:[st,[st],(r,[i])=>Math.floor(i.evaluate(r))],ceil:[st,[st],(r,[i])=>Math.ceil(i.evaluate(r))],"filter-==":[_t,[ln,Xt],(r,[i,o])=>r.properties()[i.value]===o.value],"filter-id-==":[_t,[Xt],(r,[i])=>r.id()===i.value],"filter-type-==":[_t,[ln],(r,[i])=>r.geometryType()===i.value],"filter-<":[_t,[ln,Xt],(r,[i,o])=>{const l=r.properties()[i.value],h=o.value;return typeof l==typeof h&&l<h}],"filter-id-<":[_t,[Xt],(r,[i])=>{const o=r.id(),l=i.value;return typeof o==typeof l&&o<l}],"filter->":[_t,[ln,Xt],(r,[i,o])=>{const l=r.properties()[i.value],h=o.value;return typeof l==typeof h&&l>h}],"filter-id->":[_t,[Xt],(r,[i])=>{const o=r.id(),l=i.value;return typeof o==typeof l&&o>l}],"filter-<=":[_t,[ln,Xt],(r,[i,o])=>{const l=r.properties()[i.value],h=o.value;return typeof l==typeof h&&l<=h}],"filter-id-<=":[_t,[Xt],(r,[i])=>{const o=r.id(),l=i.value;return typeof o==typeof l&&o<=l}],"filter->=":[_t,[ln,Xt],(r,[i,o])=>{const l=r.properties()[i.value],h=o.value;return typeof l==typeof h&&l>=h}],"filter-id->=":[_t,[Xt],(r,[i])=>{const o=r.id(),l=i.value;return typeof o==typeof l&&o>=l}],"filter-has":[_t,[Xt],(r,[i])=>i.value in r.properties()],"filter-has-id":[_t,[],r=>null!==r.id()&&void 0!==r.id()],"filter-type-in":[_t,[wi(ln)],(r,[i])=>i.value.indexOf(r.geometryType())>=0],"filter-id-in":[_t,[wi(Xt)],(r,[i])=>i.value.indexOf(r.id())>=0],"filter-in-small":[_t,[ln,wi(Xt)],(r,[i,o])=>o.value.indexOf(r.properties()[i.value])>=0],"filter-in-large":[_t,[ln,wi(Xt)],(r,[i,o])=>function(l,h,m,_){for(;m<=_;){const x=m+_>>1;if(h[x]===l)return!0;h[x]>l?_=x-1:m=x+1}return!1}(r.properties()[i.value],o.value,0,o.value.length-1)],all:{type:_t,overloads:[[[_t,_t],(r,[i,o])=>i.evaluate(r)&&o.evaluate(r)],[ws(_t),(r,i)=>{for(const o of i)if(!o.evaluate(r))return!1;return!0}]]},any:{type:_t,overloads:[[[_t,_t],(r,[i,o])=>i.evaluate(r)||o.evaluate(r)],[ws(_t),(r,i)=>{for(const o of i)if(o.evaluate(r))return!0;return!1}]]},"!":[_t,[_t],(r,[i])=>!i.evaluate(r)],"is-supported-script":[_t,[ln],(r,[i])=>{const o=r.globals&&r.globals.isSupportedScript;return!o||o(i.evaluate(r))}],upcase:[ln,[ln],(r,[i])=>i.evaluate(r).toUpperCase()],downcase:[ln,[ln],(r,[i])=>i.evaluate(r).toLowerCase()],concat:[ln,ws(Xt),(r,i)=>i.map(o=>dc(o.evaluate(r))).join("")],"resolved-locale":[ln,[uc],(r,[i])=>i.evaluate(r).resolvedLocale()]});var Mu=np;function jf(r){return{result:"success",value:r}}function co(r){return{result:"error",value:r}}function bl(r){return"data-driven"===r["property-type"]}function wl(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function ip(r){return!!r.expression&&r.expression.interpolated}function Mn(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":null===r?"null":typeof r}function Au(r){return"object"==typeof r&&null!==r&&!Array.isArray(r)}function kg(r){return r}function Vh(r,i){const o="color"===i.type,l=r.stops&&"object"==typeof r.stops[0][0],h=l||!(l||void 0!==r.property),m=r.type||(ip(i)?"exponential":"interval");if(o&&((r=_s({},r)).stops&&(r.stops=r.stops.map(T=>[T[0],ui.parse(T[1])])),r.default=ui.parse(r.default?r.default:i.default)),r.colorSpace&&"rgb"!==r.colorSpace&&!Qs[r.colorSpace])throw new Error(`Unknown color space: ${r.colorSpace}`);let _,x,E;if("exponential"===m)_=Pu;else if("interval"===m)_=Uf;else if("categorical"===m){_=rp,x=Object.create(null);for(const T of r.stops)x[T[0]]=T[1];E=typeof r.stops[0][0]}else{if("identity"!==m)throw new Error(`Unknown function type "${m}"`);_=wc}if(l){const T={},S=[];for(let O=0;O<r.stops.length;O++){const N=r.stops[O],j=N[0].zoom;void 0===T[j]&&(T[j]={zoom:j,type:r.type,property:r.property,default:r.default,stops:[]},S.push(j)),T[j].stops.push([N[0].value,N[1]])}const P=[];for(const O of S)P.push([T[O].zoom,Vh(T[O],i)]);const L={name:"linear"};return{kind:"composite",interpolationType:L,interpolationFactor:Ir.interpolationFactor.bind(void 0,L),zoomStops:P.map(O=>O[0]),evaluate:({zoom:O},N)=>Pu({stops:P,base:r.base},i,O).evaluate(O,N)}}if(h){const T="exponential"===m?{name:"exponential",base:void 0!==r.base?r.base:1}:null;return{kind:"camera",interpolationType:T,interpolationFactor:Ir.interpolationFactor.bind(void 0,T),zoomStops:r.stops.map(S=>S[0]),evaluate:({zoom:S})=>_(r,i,S,x,E)}}return{kind:"source",evaluate(T,S){const P=S&&S.properties?S.properties[r.property]:void 0;return void 0===P?bc(r.default,i.default):_(r,i,P,x,E)}}}function bc(r,i,o){return void 0!==r?r:void 0!==i?i:void 0!==o?o:void 0}function rp(r,i,o,l,h){return bc(typeof o===h?l[o]:void 0,r.default,i.default)}function Uf(r,i,o){if("number"!==Mn(o))return bc(r.default,i.default);const l=r.stops.length;if(1===l||o<=r.stops[0][0])return r.stops[0][1];if(o>=r.stops[l-1][0])return r.stops[l-1][1];const h=Zn(r.stops.map(m=>m[0]),o);return r.stops[h][1]}function Pu(r,i,o){const l=void 0!==r.base?r.base:1;if("number"!==Mn(o))return bc(r.default,i.default);const h=r.stops.length;if(1===h||o<=r.stops[0][0])return r.stops[0][1];if(o>=r.stops[h-1][0])return r.stops[h-1][1];const m=Zn(r.stops.map(S=>S[0]),o),_=function(S,P,L,O){const N=O-L,j=S-L;return 0===N?0:1===P?j/N:(Math.pow(P,j)-1)/(Math.pow(P,N)-1)}(o,l,r.stops[m][0],r.stops[m+1][0]),x=r.stops[m][1],E=r.stops[m+1][1];let T=fr[i.type]||kg;if(r.colorSpace&&"rgb"!==r.colorSpace){const S=Qs[r.colorSpace];T=(P,L)=>S.reverse(S.interpolate(S.forward(P),S.forward(L),_))}return"function"==typeof x.evaluate?{evaluate(...S){const P=x.evaluate.apply(void 0,S),L=E.evaluate.apply(void 0,S);if(void 0!==P&&void 0!==L)return T(P,L,_)}}:T(x,E,_)}function wc(r,i,o){return"color"===i.type?o=ui.parse(o):"formatted"===i.type?o=tr.fromString(o.toString()):"resolvedImage"===i.type?o=xo.fromString(o.toString()):Mn(o)===i.type||"enum"===i.type&&i.values[o]||(o=void 0),bc(o,r.default,i.default)}class jh{constructor(i,o){var l;this.expression=i,this._warningHistory={},this._evaluator=new Qd,this._defaultValue=o?"color"===(l=o).type&&(Au(l.default)||Array.isArray(l.default))?new ui(0,0,0,0):"color"===l.type?ui.parse(l.default)||null:void 0===l.default?null:l.default:null,this._enumValues=o&&"enum"===o.type?o.values:null}evaluateWithoutErrorHandling(i,o,l,h,m,_,x,E){return this._evaluator.globals=i,this._evaluator.feature=o,this._evaluator.featureState=l,this._evaluator.canonical=h||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=E||null,this.expression.evaluate(this._evaluator)}evaluate(i,o,l,h,m,_,x,E){this._evaluator.globals=i,this._evaluator.feature=o||null,this._evaluator.featureState=l||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=E||null;try{const T=this.expression.evaluate(this._evaluator);if(null==T||"number"==typeof T&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new Ut(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console<"u"&&console.warn(T.message)),this._defaultValue}}}function Lu(r){return Array.isArray(r)&&r.length>0&&"string"==typeof r[0]&&r[0]in Mu}function Oa(r,i){const o=new bo(Mu,[],i?function(h){const m={color:$r,string:ln,number:st,enum:ln,boolean:_t,formatted:Hs,resolvedImage:kt};return"array"===h.type?wi(m[h.value]||Xt,h.length):m[h.type]}(i):void 0),l=o.parse(r,void 0,void 0,void 0,i&&"string"===i.type?{typeAnnotation:"coerce"}:void 0);return l?jf(new jh(l,i)):co(o.errors)}class Mr{constructor(i,o){this.kind=i,this._styleExpression=o,this.isStateDependent="constant"!==i&&!Pa(o.expression)}evaluateWithoutErrorHandling(i,o,l,h,m,_){return this._styleExpression.evaluateWithoutErrorHandling(i,o,l,h,m,_)}evaluate(i,o,l,h,m,_){return this._styleExpression.evaluate(i,o,l,h,m,_)}}class ku{constructor(i,o,l,h){this.kind=i,this.zoomStops=l,this._styleExpression=o,this.isStateDependent="camera"!==i&&!Pa(o.expression),this.interpolationType=h}evaluateWithoutErrorHandling(i,o,l,h,m,_){return this._styleExpression.evaluateWithoutErrorHandling(i,o,l,h,m,_)}evaluate(i,o,l,h,m,_){return this._styleExpression.evaluate(i,o,l,h,m,_)}interpolationFactor(i,o,l){return this.interpolationType?Ir.interpolationFactor(this.interpolationType,i,o,l):0}}function Fa(r,i){if("error"===(r=Oa(r,i)).result)return r;const o=r.value.expression,l=yn(o);if(!l&&!bl(i))return co([new Ur("","data expressions not supported")]);const h=La(o,["zoom","pitch","distance-from-center"]);if(!h&&!wl(i))return co([new Ur("","zoom expressions not supported")]);const m=Ec(o);return m||h?m instanceof Ur?co([m]):m instanceof Ir&&!ip(i)?co([new Ur("",'"interpolate" expressions cannot be used with this property')]):jf(m?new ku(l?"camera":"composite",r.value,m.labels,m instanceof Ir?m.interpolation:void 0):new Mr(l?"constant":"source",r.value)):co([new Ur("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Na{constructor(i,o){this._parameters=i,this._specification=o,_s(this,Vh(this._parameters,this._specification))}static deserialize(i){return new Na(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function Ec(r){let i=null;if(r instanceof Du)i=Ec(r.result);else if(r instanceof gl){for(const o of r.args)if(i=Ec(o),i)break}else(r instanceof vc||r instanceof Ir)&&r.input instanceof vs&&"zoom"===r.input.name&&(i=r);return i instanceof Ur||r.eachChild(o=>{const l=Ec(o);l instanceof Ur?i=l:!i&&l?i=new Ur("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&l&&i!==l&&(i=new Ur("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}class at{constructor(i,o,l,h){this.message=(i?`${i}: `:"")+l,h&&(this.identifier=h),null!=o&&o.__line__&&(this.line=o.__line__)}}function Kr(r){const i=r.key,o=r.value,l=r.valueSpec||{},h=r.objectElementValidators||{},m=r.style,_=r.styleSpec;let x=[];const E=Mn(o);if("object"!==E)return[new at(i,o,`object expected, ${E} found`)];for(const T in o){const S=T.split(".")[0],P=l[S]||l["*"];let L;h[S]?L=h[S]:l[S]?L=sr:h["*"]?L=h["*"]:l["*"]&&(L=sr),L?x=x.concat(L({key:(i&&`${i}.`)+T,value:o[T],valueSpec:P,style:m,styleSpec:_,object:o,objectKey:T},o)):x.push(new at(i,o[T],`unknown property "${T}"`))}for(const T in l)h[T]||l[T].required&&void 0===l[T].default&&void 0===o[T]&&x.push(new at(i,o,`missing required property "${T}"`));return x}function El(r){const i=r.value,o=r.valueSpec,l=r.style,h=r.styleSpec,m=r.key,_=r.arrayElementValidator||sr;if("array"!==Mn(i))return[new at(m,i,`array expected, ${Mn(i)} found`)];if(o.length&&i.length!==o.length)return[new at(m,i,`array length ${o.length} expected, length ${i.length} found`)];if(o["min-length"]&&i.length<o["min-length"])return[new at(m,i,`array length at least ${o["min-length"]} expected, length ${i.length} found`)];let x={type:o.value,values:o.values,minimum:o.minimum,maximum:o.maximum,function:void 0};h.$version<7&&(x.function=o.function),"object"===Mn(o.value)&&(x=o.value);let E=[];for(let T=0;T<i.length;T++)E=E.concat(_({array:i,arrayIndex:T,value:i[T],valueSpec:x,style:l,styleSpec:h,key:`${m}[${T}]`}));return E}function op(r){const i=r.key,o=r.value,l=r.valueSpec;let h=Mn(o);if("number"===h&&o!=o&&(h="NaN"),"number"!==h)return[new at(i,o,`number expected, ${h} found`)];if("minimum"in l){let m=l.minimum;if("array"===Mn(l.minimum)&&(m=l.minimum[r.arrayIndex]),o<m)return[new at(i,o,`${o} is less than the minimum value ${m}`)]}if("maximum"in l){let m=l.maximum;if("array"===Mn(l.maximum)&&(m=l.maximum[r.arrayIndex]),o>m)return[new at(i,o,`${o} is greater than the maximum value ${m}`)]}return[]}function Ru(r){const i=r.valueSpec,o=_i(r.value.type);let l,h,m,_={};const x="categorical"!==o&&void 0===r.value.property,E=!x,T="array"===Mn(r.value.stops)&&"array"===Mn(r.value.stops[0])&&"object"===Mn(r.value.stops[0][0]),S=Kr({key:r.key,value:r.value,valueSpec:r.styleSpec.function,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(O){if("identity"===o)return[new at(O.key,O.value,'identity function may not have a "stops" property')];let N=[];const j=O.value;return N=N.concat(El({key:O.key,value:j,valueSpec:O.valueSpec,style:O.style,styleSpec:O.styleSpec,arrayElementValidator:P})),"array"===Mn(j)&&0===j.length&&N.push(new at(O.key,j,"array must have at least one stop")),N},default:function(O){return sr({key:O.key,value:O.value,valueSpec:i,style:O.style,styleSpec:O.styleSpec})}}});return"identity"===o&&x&&S.push(new at(r.key,r.value,'missing required property "property"')),"identity"===o||r.value.stops||S.push(new at(r.key,r.value,'missing required property "stops"')),"exponential"===o&&r.valueSpec.expression&&!ip(r.valueSpec)&&S.push(new at(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(E&&!bl(r.valueSpec)?S.push(new at(r.key,r.value,"property functions not supported")):x&&!wl(r.valueSpec)&&S.push(new at(r.key,r.value,"zoom functions not supported"))),"categorical"!==o&&!T||void 0!==r.value.property||S.push(new at(r.key,r.value,'"property" property is required')),S;function P(O){let N=[];const j=O.value,G=O.key;if("array"!==Mn(j))return[new at(G,j,`array expected, ${Mn(j)} found`)];if(2!==j.length)return[new at(G,j,`array length 2 expected, length ${j.length} found`)];if(T){if("object"!==Mn(j[0]))return[new at(G,j,`object expected, ${Mn(j[0])} found`)];if(void 0===j[0].zoom)return[new at(G,j,"object stop key must have zoom")];if(void 0===j[0].value)return[new at(G,j,"object stop key must have value")];const ne=_i(j[0].zoom);if("number"!=typeof ne)return[new at(G,j[0].zoom,"stop zoom values must be numbers")];if(m&&m>ne)return[new at(G,j[0].zoom,"stop zoom values must appear in ascending order")];ne!==m&&(m=ne,h=void 0,_={}),N=N.concat(Kr({key:`${G}[0]`,value:j[0],valueSpec:{zoom:{}},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{zoom:op,value:L}}))}else N=N.concat(L({key:`${G}[0]`,value:j[0],valueSpec:{},style:O.style,styleSpec:O.styleSpec},j));return Lu(ys(j[1]))?N.concat([new at(`${G}[1]`,j[1],"expressions are not allowed in function stops.")]):N.concat(sr({key:`${G}[1]`,value:j[1],valueSpec:i,style:O.style,styleSpec:O.styleSpec}))}function L(O,N){const j=Mn(O.value),G=_i(O.value),ne=null!==O.value?O.value:N;if(l){if(j!==l)return[new at(O.key,ne,`${j} stop domain type must match previous stop domain type ${l}`)]}else l=j;if("number"!==j&&"string"!==j&&"boolean"!==j&&"number"!=typeof G&&"string"!=typeof G&&"boolean"!=typeof G)return[new at(O.key,ne,"stop domain value must be a number, string, or boolean")];if("number"!==j&&"categorical"!==o){let ae=`number expected, ${j} found`;return bl(i)&&void 0===o&&(ae+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new at(O.key,ne,ae)]}return"categorical"!==o||"number"!==j||"number"==typeof G&&isFinite(G)&&Math.floor(G)===G?"categorical"!==o&&"number"===j&&"number"==typeof G&&"number"==typeof h&&void 0!==h&&G<h?[new at(O.key,ne,"stop domain values must appear in ascending order")]:(h=G,"categorical"===o&&G in _?[new at(O.key,ne,"stop domain values must be unique")]:(_[G]=!0,[])):[new at(O.key,ne,`integer expected, found ${String(G)}`)]}}function Tl(r){const i=("property"===r.expressionContext?Fa:Oa)(ys(r.value),r.valueSpec);if("error"===i.result)return i.value.map(l=>new at(`${r.key}${l.key}`,r.value,l.message));const o=i.value.expression||i.value._styleExpression.expression;if("property"===r.expressionContext&&"text-font"===r.propertyKey&&!o.outputDefined())return[new at(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===r.expressionContext&&"layout"===r.propertyType&&!Pa(o))return[new at(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===r.expressionContext)return Yr(o,r);if(r.expressionContext&&0===r.expressionContext.indexOf("cluster")){if(!La(o,["zoom","feature-state"]))return[new at(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===r.expressionContext&&!yn(o))return[new at(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Yr(r,i){const o=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(i.valueSpec&&i.valueSpec.expression)for(const h of i.valueSpec.expression.parameters)o.delete(h);if(0===o.size)return[];const l=[];return r instanceof vs&&o.has(r.name)?[new at(i.key,i.value,`["${r.name}"] expression is not supported in a filter for a ${i.object.type} layer with id: ${i.object.id}`)]:(r.eachChild(h=>{l.push(...Yr(h,i))}),l)}function Dl(r){const i=r.key,o=r.value,l=r.valueSpec,h=[];return Array.isArray(l.values)?-1===l.values.indexOf(_i(o))&&h.push(new at(i,o,`expected one of [${l.values.join(", ")}], ${JSON.stringify(o)} found`)):-1===Object.keys(l.values).indexOf(_i(o))&&h.push(new at(i,o,`expected one of [${Object.keys(l.values).join(", ")}], ${JSON.stringify(o)} found`)),h}function Cl(r){if(!0===r||!1===r)return!0;if(!Array.isArray(r)||0===r.length)return!1;switch(r[0]){case"has":return r.length>=2&&"$id"!==r[1]&&"$type"!==r[1];case"in":return r.length>=3&&("string"!=typeof r[1]||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==r.length||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const i of r.slice(1))if(!Cl(i)&&"boolean"!=typeof i)return!1;return!0;default:return!0}}function Es(r,i="fill"){if(null==r)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Cl(r)||(r=Li(r));const o=r;let l=!0;try{l=function(T){if(!ni(T))return T;let S=ys(T);return Ou(S),S=Ar(S),S}(o)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(o,null,2)}\n        `)}const h=Re[`filter_${i}`],m=Oa(l,h);let _=null;if("error"===m.result)throw new Error(m.value.map(T=>`${T.key}: ${T.message}`).join(", "));_=(T,S,P)=>m.value.evaluate(T,S,{},P);let x=null,E=null;if(l!==o){const T=Oa(o,h);if("error"===T.result)throw new Error(T.value.map(S=>`${S.key}: ${S.message}`).join(", "));x=(S,P,L,O,N)=>T.value.evaluate(S,P,{},L,void 0,void 0,O,N),E=!yn(T.value.expression)}return{filter:_,dynamicFilter:x||void 0,needGeometry:Tc(l),needFeature:!!E}}function Ar(r){if(!Array.isArray(r))return r;const i=function(o){if($f.has(o[0]))for(let l=1;l<o.length;l++)if(ni(o[l]))return!0;return o}(r);return!0===i?i:i.map(o=>Ar(o))}function Ou(r){let i=!1;const o=[];if("case"===r[0]){for(let l=1;l<r.length-1;l+=2)i=i||ni(r[l]),o.push(r[l+1]);o.push(r[r.length-1])}else if("match"===r[0]){i=i||ni(r[1]);for(let l=2;l<r.length-1;l+=2)o.push(r[l+1]);o.push(r[r.length-1])}else if("step"===r[0]){i=i||ni(r[1]);for(let l=1;l<r.length-1;l+=2)o.push(r[l+1])}i&&(r.length=0,r.push("any",...o));for(let l=1;l<r.length;l++)Ou(r[l])}function ni(r){if(!Array.isArray(r))return!1;if("pitch"===(i=r[0])||"distance-from-center"===i)return!0;var i;for(let o=1;o<r.length;o++)if(ni(r[o]))return!0;return!1}const $f=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Rg(r,i){return r<i?-1:r>i?1:0}function Tc(r){if(!Array.isArray(r))return!1;if("within"===r[0])return!0;for(let i=1;i<r.length;i++)if(Tc(r[i]))return!0;return!1}function Li(r){if(!r)return!0;const i=r[0];return r.length<=1?"any"!==i:"=="===i?Uh(r[1],r[2],"=="):"!="===i?or(Uh(r[1],r[2],"==")):"<"===i||">"===i||"<="===i||">="===i?Uh(r[1],r[2],i):"any"===i?(o=r.slice(1),["any"].concat(o.map(Li))):"all"===i?["all"].concat(r.slice(1).map(Li)):"none"===i?["all"].concat(r.slice(1).map(Li).map(or)):"in"===i?Il(r[1],r.slice(2)):"!in"===i?or(Il(r[1],r.slice(2))):"has"===i?za(r[1]):"!has"===i?or(za(r[1])):"within"!==i||r;var o}function Uh(r,i,o){switch(r){case"$type":return[`filter-type-${o}`,i];case"$id":return[`filter-id-${o}`,i];default:return[`filter-${o}`,r,i]}}function Il(r,i){if(0===i.length)return!1;switch(r){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(o=>typeof o!=typeof i[0])?["filter-in-large",r,["literal",i.sort(Rg)]]:["filter-in-small",r,["literal",i]]}}function za(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function or(r){return["!",r]}function Dc(r){return Cl(ys(r.value))?Tl(_s({},r,{expressionContext:"filter",valueSpec:r.styleSpec[`filter_${r.layerType||"fill"}`]})):Cc(r)}function Cc(r){const i=r.value,o=r.key;if("array"!==Mn(i))return[new at(o,i,`array expected, ${Mn(i)} found`)];const l=r.styleSpec;let h,m=[];if(i.length<1)return[new at(o,i,"filter array must have at least 1 element")];switch(m=m.concat(Dl({key:`${o}[0]`,value:i[0],valueSpec:l.filter_operator,style:r.style,styleSpec:r.styleSpec})),_i(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&"$type"===_i(i[1])&&m.push(new at(o,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":3!==i.length&&m.push(new at(o,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(h=Mn(i[1]),"string"!==h&&m.push(new at(`${o}[1]`,i[1],`string expected, ${h} found`)));for(let _=2;_<i.length;_++)h=Mn(i[_]),"$type"===_i(i[1])?m=m.concat(Dl({key:`${o}[${_}]`,value:i[_],valueSpec:l.geometry_type,style:r.style,styleSpec:r.styleSpec})):"string"!==h&&"number"!==h&&"boolean"!==h&&m.push(new at(`${o}[${_}]`,i[_],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let _=1;_<i.length;_++)m=m.concat(Cc({key:`${o}[${_}]`,value:i[_],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":h=Mn(i[1]),2!==i.length?m.push(new at(o,i,`filter array for "${i[0]}" operator must have 2 elements`)):"string"!==h&&m.push(new at(`${o}[1]`,i[1],`string expected, ${h} found`));break;case"within":h=Mn(i[1]),2!==i.length?m.push(new at(o,i,`filter array for "${i[0]}" operator must have 2 elements`)):"object"!==h&&m.push(new at(`${o}[1]`,i[1],`object expected, ${h} found`))}return m}function $h(r,i){const o=r.key,l=r.style,h=r.styleSpec,m=r.value,_=r.objectKey,x=h[`${i}_${r.layerType}`];if(!x)return[];const E=_.match(/^(.*)-transition$/);if("paint"===i&&E&&x[E[1]]&&x[E[1]].transition)return sr({key:o,value:m,valueSpec:h.transition,style:l,styleSpec:h});const T=r.valueSpec||x[_];if(!T)return[new at(o,m,`unknown property "${_}"`)];let S;if("string"===Mn(m)&&bl(T)&&!T.tokens&&(S=/^{([^}]+)}$/.exec(m)))return[new at(o,m,`"${_}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(S[1])} }\`.`)];const P=[];return"symbol"===r.layerType&&("text-field"===_&&l&&!l.glyphs&&P.push(new at(o,m,'use of "text-field" requires a style "glyphs" property')),"text-font"===_&&Au(ys(m))&&"identity"===_i(m.type)&&P.push(new at(o,m,'"text-font" does not support identity functions'))),P.concat(sr({key:r.key,value:m,valueSpec:T,style:l,styleSpec:h,expressionContext:"property",propertyType:i,propertyKey:_}))}function Xo(r){return $h(r,"paint")}function Gh(r){return $h(r,"layout")}function Sl(r){let i=[];const o=r.value,l=r.key,h=r.style,m=r.styleSpec;o.type||o.ref||i.push(new at(l,o,'either "type" or "ref" is required'));let _=_i(o.type);const x=_i(o.ref);if(o.id){const E=_i(o.id);for(let T=0;T<r.arrayIndex;T++){const S=h.layers[T];_i(S.id)===E&&i.push(new at(l,o.id,`duplicate layer id "${o.id}", previously used at line ${S.id.__line__}`))}}if("ref"in o){let E;["type","source","source-layer","filter","layout"].forEach(T=>{T in o&&i.push(new at(l,o[T],`"${T}" is prohibited for ref layers`))}),h.layers.forEach(T=>{_i(T.id)===x&&(E=T)}),E?E.ref?i.push(new at(l,o.ref,"ref cannot reference another ref layer")):_=_i(E.type):"string"==typeof x&&i.push(new at(l,o.ref,`ref layer "${x}" not found`))}else if("background"!==_&&"sky"!==_)if(o.source){const E=h.sources&&h.sources[o.source],T=E&&_i(E.type);E?"vector"===T&&"raster"===_?i.push(new at(l,o.source,`layer "${o.id}" requires a raster source`)):"raster"===T&&"raster"!==_?i.push(new at(l,o.source,`layer "${o.id}" requires a vector source`)):"vector"!==T||o["source-layer"]?"raster-dem"===T&&"hillshade"!==_?i.push(new at(l,o.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==_||!o.paint||!o.paint["line-gradient"]&&!o.paint["line-trim-offset"]||"geojson"===T&&E.lineMetrics||i.push(new at(l,o,`layer "${o.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new at(l,o,`layer "${o.id}" must specify a "source-layer"`)):i.push(new at(l,o.source,`source "${o.source}" not found`))}else i.push(new at(l,o,'missing required property "source"'));return i=i.concat(Kr({key:l,value:o,valueSpec:m.layer,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{"*":()=>[],type:()=>sr({key:`${l}.type`,value:o.type,valueSpec:m.layer.type,style:r.style,styleSpec:r.styleSpec,object:o,objectKey:"type"}),filter:E=>Dc(_s({layerType:_},E)),layout:E=>Kr({layer:o,key:E.key,value:E.value,valueSpec:{},style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":T=>Gh(_s({layerType:_},T))}}),paint:E=>Kr({layer:o,key:E.key,value:E.value,valueSpec:{},style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":T=>Xo(_s({layerType:_},T))}})}})),i}function Ot(r){const i=r.value,o=r.key,l=Mn(i);return"string"!==l?[new at(o,i,`string expected, ${l} found`)]:[]}const Fu={promoteId:function({key:r,value:i}){if("string"===Mn(i))return Ot({key:r,value:i});{const o=[];for(const l in i)o.push(...Ot({key:`${r}.${l}`,value:i[l]}));return o}}};function Gf(r){const i=r.value,o=r.key,l=r.styleSpec,h=r.style;if(!i.type)return[new at(o,i,'"type" is required')];const m=_i(i.type);let _;switch(m){case"vector":case"raster":case"raster-dem":return _=Kr({key:o,value:i,valueSpec:l[`source_${m.replace("-","_")}`],style:r.style,styleSpec:l,objectElementValidators:Fu}),_;case"geojson":if(_=Kr({key:o,value:i,valueSpec:l.source_geojson,style:h,styleSpec:l,objectElementValidators:Fu}),i.cluster)for(const x in i.clusterProperties){const[E,T]=i.clusterProperties[x],S="string"==typeof E?[E,["accumulated"],["get",x]]:E;_.push(...Tl({key:`${o}.${x}.map`,value:T,expressionContext:"cluster-map"})),_.push(...Tl({key:`${o}.${x}.reduce`,value:S,expressionContext:"cluster-reduce"}))}return _;case"video":return Kr({key:o,value:i,valueSpec:l.source_video,style:h,styleSpec:l});case"image":return Kr({key:o,value:i,valueSpec:l.source_image,style:h,styleSpec:l});case"canvas":return[new at(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Dl({key:`${o}.type`,value:i.type,valueSpec:{values:sp(l)},style:h,styleSpec:l})}}function sp(r){return r.source.reduce((i,o)=>{const l=r[o];return"enum"===l.type.type&&(i=i.concat(Object.keys(l.type.values))),i},[])}function ap(r){const i=r.value,o=r.styleSpec,l=o.light,h=r.style;let m=[];const _=Mn(i);if(void 0===i)return m;if("object"!==_)return m=m.concat([new at("light",i,`object expected, ${_} found`)]),m;for(const x in i){const E=x.match(/^(.*)-transition$/);m=m.concat(E&&l[E[1]]&&l[E[1]].transition?sr({key:x,value:i[x],valueSpec:o.transition,style:h,styleSpec:o}):l[x]?sr({key:x,value:i[x],valueSpec:l[x],style:h,styleSpec:o}):[new at(x,i[x],`unknown property "${x}"`)])}return m}function Nu(r){const i=r.value,o=r.key,l=r.style,h=r.styleSpec,m=h.terrain;let _=[];const x=Mn(i);if(void 0===i)return _;if("object"!==x)return _=_.concat([new at("terrain",i,`object expected, ${x} found`)]),_;for(const E in i){const T=E.match(/^(.*)-transition$/);_=_.concat(T&&m[T[1]]&&m[T[1]].transition?sr({key:E,value:i[E],valueSpec:h.transition,style:l,styleSpec:h}):m[E]?sr({key:E,value:i[E],valueSpec:m[E],style:l,styleSpec:h}):[new at(E,i[E],`unknown property "${E}"`)])}if(i.source){const E=l.sources&&l.sources[i.source],T=E&&_i(E.type);E?"raster-dem"!==T&&_.push(new at(o,i.source,`terrain cannot be used with a source of type ${String(T)}, it only be used with a "raster-dem" source type`)):_.push(new at(o,i.source,`source "${i.source}" not found`))}else _.push(new at(o,i,'terrain is missing required property "source"'));return _}function Hh(r){const i=r.value,o=r.style,l=r.styleSpec,h=l.fog;let m=[];const _=Mn(i);if(void 0===i)return m;if("object"!==_)return m=m.concat([new at("fog",i,`object expected, ${_} found`)]),m;for(const x in i){const E=x.match(/^(.*)-transition$/);m=m.concat(E&&h[E[1]]&&h[E[1]].transition?sr({key:x,value:i[x],valueSpec:l.transition,style:o,styleSpec:l}):h[x]?sr({key:x,value:i[x],valueSpec:h[x],style:o,styleSpec:l}):[new at(x,i[x],`unknown property "${x}"`)])}return m}const lp={"*":()=>[],array:El,boolean:function(r){const i=r.value,o=r.key,l=Mn(i);return"boolean"!==l?[new at(o,i,`boolean expected, ${l} found`)]:[]},number:op,color:function(r){const i=r.key,o=r.value,l=Mn(o);return"string"!==l?[new at(i,o,`color expected, ${l} found`)]:null===hc(o)?[new at(i,o,`color expected, "${o}" found`)]:[]},enum:Dl,filter:Dc,function:Ru,layer:Sl,object:Kr,source:Gf,light:ap,terrain:Nu,fog:Hh,string:Ot,formatted:function(r){return 0===Ot(r).length?[]:Tl(r)},resolvedImage:function(r){return 0===Ot(r).length?[]:Tl(r)},projection:function(r){const i=r.value,o=r.styleSpec,l=o.projection,h=r.style;let m=[];const _=Mn(i);if("object"===_)for(const x in i)m=m.concat(sr({key:x,value:i[x],valueSpec:l[x],style:h,styleSpec:o}));else"string"!==_&&(m=m.concat([new at("projection",i,`object or string expected, ${_} found`)]));return m}};function sr(r){const i=r.value,o=r.valueSpec,l=r.styleSpec;return o.expression&&Au(_i(i))?Ru(r):o.expression&&Lu(ys(i))?Tl(r):o.type&&lp[o.type]?lp[o.type](r):Kr(_s({},r,{valueSpec:o.type?l[o.type]:o}))}function Je(r){const i=r.value,o=r.key,l=Ot(r);return l.length||(-1===i.indexOf("{fontstack}")&&l.push(new at(o,i,'"glyphs" url must include a "{fontstack}" token')),-1===i.indexOf("{range}")&&l.push(new at(o,i,'"glyphs" url must include a "{range}" token'))),l}function vn(r,i=Re){return Xn(sr({key:"",value:r,valueSpec:i.$root,styleSpec:i,style:r,objectElementValidators:{glyphs:Je,"*":()=>[]}}))}const Pr=r=>Xn(Xo(r)),Lr=r=>Xn(Gh(r));function Xn(r){return r.slice().sort((i,o)=>i.line&&o.line?i.line-o.line:0)}function qh(r,i){let o=!1;if(i&&i.length)for(const l of i)r.fire(new gs(new Error(l.message))),o=!0;return o}var Ko=Di;function Di(r,i,o){var l=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;var h=new Int32Array(this.arrayBuffer);r=h[0],this.d=(i=h[1])+2*(o=h[2]);for(var m=0;m<this.d*this.d;m++){var _=h[3+m],x=h[3+m+1];l.push(_===x?null:h.subarray(_,x))}var E=h[3+l.length+1];this.keys=h.subarray(h[3+l.length],E),this.bboxes=h.subarray(E),this.insert=this._insertReadonly}else{this.d=i+2*o;for(var T=0;T<this.d*this.d;T++)l.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=r,this.padding=o,this.scale=i/r,this.uid=0;var S=o/i*r;this.min=-S,this.max=r+S}Di.prototype.insert=function(r,i,o,l,h){this._forEachCell(i,o,l,h,this._insertCell,this.uid++),this.keys.push(r),this.bboxes.push(i),this.bboxes.push(o),this.bboxes.push(l),this.bboxes.push(h)},Di.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Di.prototype._insertCell=function(r,i,o,l,h,m){this.cells[h].push(m)},Di.prototype.query=function(r,i,o,l,h){var m=this.min,_=this.max;if(r<=m&&i<=m&&_<=o&&_<=l&&!h)return Array.prototype.slice.call(this.keys);var x=[];return this._forEachCell(r,i,o,l,this._queryCell,x,{},h),x},Di.prototype._queryCell=function(r,i,o,l,h,m,_,x){var E=this.cells[h];if(null!==E)for(var T=this.keys,S=this.bboxes,P=0;P<E.length;P++){var L=E[P];if(void 0===_[L]){var O=4*L;(x?x(S[O+0],S[O+1],S[O+2],S[O+3]):r<=S[O+2]&&i<=S[O+3]&&o>=S[O+0]&&l>=S[O+1])?(_[L]=!0,m.push(T[L])):_[L]=!1}}},Di.prototype._forEachCell=function(r,i,o,l,h,m,_,x){for(var E=this._convertToCellCoord(r),T=this._convertToCellCoord(i),S=this._convertToCellCoord(o),P=this._convertToCellCoord(l),L=E;L<=S;L++)for(var O=T;O<=P;O++){var N=this.d*O+L;if((!x||x(this._convertFromCellCoord(L),this._convertFromCellCoord(O),this._convertFromCellCoord(L+1),this._convertFromCellCoord(O+1)))&&h.call(this,r,i,o,l,N,m,_,x))return}},Di.prototype._convertFromCellCoord=function(r){return(r-this.padding)/this.scale},Di.prototype._convertToCellCoord=function(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))},Di.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var r=this.cells,i=3+this.cells.length+1+1,o=0,l=0;l<this.cells.length;l++)o+=this.cells[l].length;var h=new Int32Array(i+o+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var m=i,_=0;_<r.length;_++){var x=r[_];h[3+_]=m,h.set(x,m),m+=x.length}return h[3+r.length]=m,h.set(this.keys,m),h[3+r.length+1]=m+=this.keys.length,h.set(this.bboxes,m),m+=this.bboxes.length,h.buffer};const Ml={};function lt(r,i,o={}){Object.defineProperty(r,"_classRegistryKey",{value:i,writeable:!1}),Ml[i]={klass:r,omit:o.omit||[]}}lt(Object,"Object"),Ko.serialize=function(r,i){const o=r.toArrayBuffer();return i&&i.push(o),{buffer:o}},Ko.deserialize=function(r){return new Ko(r.buffer)},Object.defineProperty(Ko,"name",{value:"Grid"}),lt(Ko,"Grid"),lt(ui,"Color"),lt(Error,"Error"),lt(gu,"AJAXError"),lt(xo,"ResolvedImage"),lt(Na,"StylePropertyFunction"),lt(jh,"StyleExpression",{omit:["_evaluator"]}),lt(ku,"ZoomDependentExpression"),lt(Mr,"ZoomConstantExpression"),lt(vs,"CompoundExpression",{omit:["_evaluate"]});for(const r in Mu)Ml[Mu[r]._classRegistryKey]||lt(Mu[r],`Expression${r}`);function Hf(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&"ArrayBuffer"===r.constructor.name)}function cp(r){return Ue.ImageBitmap&&r instanceof Ue.ImageBitmap}function Ba(r,i){if(null==r||"boolean"==typeof r||"number"==typeof r||"string"==typeof r||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp)return r;if(Hf(r)||cp(r))return i&&i.push(r),r;if(ArrayBuffer.isView(r)){const o=r;return i&&i.push(o.buffer),o}if(r instanceof Ue.ImageData)return i&&i.push(r.data.buffer),r;if(Array.isArray(r)){const o=[];for(const l of r)o.push(Ba(l,i));return o}if("object"==typeof r){const o=r.constructor,l=o._classRegistryKey;if(!l)throw new Error(`can't serialize object of unregistered class ${l}`);const h=o.serialize?o.serialize(r,i):{};if(!o.serialize){for(const m in r)r.hasOwnProperty(m)&&(Ml[l].omit.indexOf(m)>=0||(h[m]=Ba(r[m],i)));r instanceof Error&&(h.message=r.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==l&&(h.$name=l),h}throw new Error("can't serialize object of type "+typeof r)}function Al(r){if(null==r||"boolean"==typeof r||"number"==typeof r||"string"==typeof r||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||Hf(r)||cp(r)||ArrayBuffer.isView(r)||r instanceof Ue.ImageData)return r;if(Array.isArray(r))return r.map(Al);if("object"==typeof r){const i=r.$name||"Object",{klass:o}=Ml[i];if(!o)throw new Error(`can't deserialize unregistered class ${i}`);if(o.deserialize)return o.deserialize(r);const l=Object.create(o.prototype);for(const h of Object.keys(r))"$name"!==h&&(l[h]=Al(r[h]));return l}throw new Error("can't deserialize object of type "+typeof r)}const Gi=r=>r>=1536&&r<=1791,Yo=r=>r>=1872&&r<=1919,zu=r=>r>=2208&&r<=2303,ta=r=>r>=11904&&r<=12031,To=r=>r>=12032&&r<=12255,Wh=r=>r>=12272&&r<=12287,Va=r=>r>=12288&&r<=12351,Ic=r=>r>=12352&&r<=12447,Bu=r=>r>=12448&&r<=12543,Vu=r=>r>=12544&&r<=12591,Sc=r=>r>=12704&&r<=12735,Zh=r=>r>=12736&&r<=12783,ju=r=>r>=12784&&r<=12799,up=r=>r>=12800&&r<=13055,Xh=r=>r>=13056&&r<=13311,Uu=r=>r>=13312&&r<=19903,$u=r=>r>=19968&&r<=40959,Kh=r=>r>=40960&&r<=42127,Yh=r=>r>=42128&&r<=42191,Gu=r=>r>=44032&&r<=55215,ja=r=>r>=63744&&r<=64255,f=r=>r>=64336&&r<=65023,a=r=>r>=65040&&r<=65055,u=r=>r>=65072&&r<=65103,g=r=>r>=65104&&r<=65135,v=r=>r>=65136&&r<=65279,b=r=>r>=65280&&r<=65519;function D(r){for(const i of r)if(R(i.charCodeAt(0)))return!0;return!1}function I(r){for(const i of r)if(!M(i.charCodeAt(0)))return!1;return!0}function M(r){return!(Gi(r)||Yo(r)||zu(r)||f(r)||v(r))}function R(r){return!(746!==r&&747!==r&&(r<4352||!(Sc(r)||Vu(r)||u(r)&&!(r>=65097&&r<=65103)||ja(r)||Xh(r)||ta(r)||Zh(r)||!(!Va(r)||r>=12296&&r<=12305||r>=12308&&r<=12319||12336===r)||Uu(r)||$u(r)||up(r)||(i=r,i>=12592&&i<=12687)||(i=>i>=43360&&i<=43391)(r)||(i=>i>=55216&&i<=55295)(r)||(i=>i>=4352&&i<=4607)(r)||Gu(r)||Ic(r)||Wh(r)||(i=>i>=12688&&i<=12703)(r)||To(r)||ju(r)||Bu(r)&&12540!==r||!(!b(r)||65288===r||65289===r||65293===r||r>=65306&&r<=65310||65339===r||65341===r||65343===r||r>=65371&&r<=65503||65507===r||r>=65512&&r<=65519)||!(!g(r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||(i=>i>=5120&&i<=5759)(r)||(i=>i>=6320&&i<=6399)(r)||a(r)||(i=>i>=19904&&i<=19967)(r)||Kh(r)||Yh(r))));var i}function k(r){return!(R(r)||(i=r,(o=i)>=128&&o<=255&&(167===i||169===i||174===i||177===i||188===i||189===i||190===i||215===i||247===i)||(o=>o>=8192&&o<=8303)(i)&&(8214===i||8224===i||8225===i||8240===i||8241===i||8251===i||8252===i||8258===i||8263===i||8264===i||8265===i||8273===i)||(o=>o>=8448&&o<=8527)(i)||(o=>o>=8528&&o<=8591)(i)||(o=>o>=8960&&o<=9215)(i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||9003===i||i>=9085&&i<=9114||i>=9150&&i<=9165||9167===i||i>=9169&&i<=9179||i>=9186&&i<=9215)||(o=>o>=9216&&o<=9279)(i)&&9251!==i||(o=>o>=9280&&o<=9311)(i)||(o=>o>=9312&&o<=9471)(i)||(o=>o>=9632&&o<=9727)(i)||(o=>o>=9728&&o<=9983)(i)&&!(i>=9754&&i<=9759)||(o=>o>=11008&&o<=11263)(i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||Va(i)||Bu(i)||(o=>o>=57344&&o<=63743)(i)||u(i)||g(i)||b(i)||8734===i||8756===i||8757===i||i>=9984&&i<=10087||i>=10102&&i<=10131||65532===i||65533===i));var i,o}function B(r){return r>=1424&&r<=2303||f(r)||v(r)}function $(r,i){return!(!i&&B(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||(o=r,o>=6016&&o<=6143));var o}function Z(r){for(const i of r)if(B(i.charCodeAt(0)))return!0;return!1}const W="deferred",K="loading",q="loaded";let H=null,J="unavailable",Q=null;const re=function(r){r&&"string"==typeof r&&r.indexOf("NetworkError")>-1&&(J="error"),H&&H(r)};function ue(){ce.fire(new Wo("pluginStateChange",{pluginStatus:J,pluginURL:Q}))}const ce=new jr,me=function(){return J},Se=function(){if(J!==W||!Q)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");J=K,ue(),Q&&Ca({url:Q},r=>{r?re(r):(J=q,ue())})},Te={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>J===q||null!=Te.applyArabicShaping,isLoading:()=>J===K,setState(r){J=r.pluginStatus,Q=r.pluginURL},isParsed:()=>null!=Te.applyArabicShaping&&null!=Te.processBidirectionalText&&null!=Te.processStyledBidirectionalText,getPluginURL:()=>Q};class _e{constructor(i,o){this.zoom=i,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.transition=o.transition,this.pitch=o.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(i){return function(o,l){for(const h of o)if(!$(h.charCodeAt(0),l))return!1;return!0}(i,Te.isLoaded())}}class Ze{constructor(i,o){this.property=i,this.value=o,this.expression=function(l,h){if(Au(l))return new Na(l,h);if(Lu(l)){const m=Fa(l,h);if("error"===m.result)throw new Error(m.value.map(_=>`${_.key}: ${_.message}`).join(", "));return m.value}{let m=l;return"string"==typeof l&&"color"===h.type&&(m=ui.parse(l)),{kind:"constant",evaluate:()=>m}}}(void 0===o?i.specification.default:o,i.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(i,o,l){return this.property.possiblyEvaluate(this,i,o,l)}}class xe{constructor(i){this.property=i,this.value=new Ze(i,void 0)}transitioned(i,o){return new Ce(this.property,this.value,o,_n({},i.transition,this.transition),i.now)}untransitioned(){return new Ce(this.property,this.value,null,{},0)}}class Le{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)}getValue(i){return Vr(this._values[i].value.value)}setValue(i,o){this._values.hasOwnProperty(i)||(this._values[i]=new xe(this._values[i].property)),this._values[i].value=new Ze(this._values[i].property,null===o?void 0:Vr(o))}getTransition(i){return Vr(this._values[i].transition)}setTransition(i,o){this._values.hasOwnProperty(i)||(this._values[i]=new xe(this._values[i].property)),this._values[i].transition=Vr(o)||void 0}serialize(){const i={};for(const o of Object.keys(this._values)){const l=this.getValue(o);void 0!==l&&(i[o]=l);const h=this.getTransition(o);void 0!==h&&(i[`${o}-transition`]=h)}return i}transitioned(i,o){const l=new He(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].transitioned(i,o._values[h]);return l}untransitioned(){const i=new He(this._properties);for(const o of Object.keys(this._values))i._values[o]=this._values[o].untransitioned();return i}}class Ce{constructor(i,o,l,h,m){const _=h.delay||0,x=h.duration||0;m=m||0,this.property=i,this.value=o,this.begin=m+_,this.end=this.begin+x,i.specification.transition&&(h.delay||h.duration)&&(this.prior=l)}possiblyEvaluate(i,o,l){const h=i.now||0,m=this.value.possiblyEvaluate(i,o,l),_=this.prior;if(_){if(h>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(h<this.begin)return _.possiblyEvaluate(i,o,l);{const x=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(i,o,l),m,xa(x))}}return m}}class He{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,o,l){const h=new Qe(this._properties);for(const m of Object.keys(this._values))h._values[m]=this._values[m].possiblyEvaluate(i,o,l);return h}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class Pe{constructor(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)}getValue(i){return Vr(this._values[i].value)}setValue(i,o){this._values[i]=new Ze(this._values[i].property,null===o?void 0:Vr(o))}serialize(){const i={};for(const o of Object.keys(this._values)){const l=this.getValue(o);void 0!==l&&(i[o]=l)}return i}possiblyEvaluate(i,o,l){const h=new Qe(this._properties);for(const m of Object.keys(this._values))h._values[m]=this._values[m].possiblyEvaluate(i,o,l);return h}}class Fe{constructor(i,o,l){this.property=i,this.value=o,this.parameters=l}isConstant(){return"constant"===this.value.kind}constantOr(i){return"constant"===this.value.kind?this.value.value:i}evaluate(i,o,l,h){return this.property.evaluate(this.value,this.parameters,i,o,l,h)}}class Qe{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class ge{constructor(i){this.specification=i}possiblyEvaluate(i,o){return i.expression.evaluate(o)}interpolate(i,o,l){const h=fr[this.specification.type];return h?h(i,o,l):i}}class Ie{constructor(i,o){this.specification=i,this.overrides=o}possiblyEvaluate(i,o,l,h){return new Fe(this,"constant"===i.expression.kind||"camera"===i.expression.kind?{kind:"constant",value:i.expression.evaluate(o,null,{},l,h)}:i.expression,o)}interpolate(i,o,l){if("constant"!==i.value.kind||"constant"!==o.value.kind)return i;if(void 0===i.value.value||void 0===o.value.value)return new Fe(this,{kind:"constant",value:void 0},i.parameters);const h=fr[this.specification.type];return h?new Fe(this,{kind:"constant",value:h(i.value.value,o.value.value,l)},i.parameters):i}evaluate(i,o,l,h,m,_){return"constant"===i.kind?i.value:i.evaluate(o,l,h,m,_)}}class ht{constructor(i){this.specification=i}possiblyEvaluate(i,o,l,h){return!!i.expression.evaluate(o,null,{},l,h)}interpolate(){return!1}}class wt{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const o=new _e(0,{});for(const l in i){const h=i[l];h.specification.overridable&&this.overridableProperties.push(l);const m=this.defaultPropertyValues[l]=new Ze(h,void 0),_=this.defaultTransitionablePropertyValues[l]=new xe(h);this.defaultTransitioningPropertyValues[l]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=m.possiblyEvaluate(o)}}}function ft(r,i){return 256*(r=sn(Math.floor(r),0,255))+sn(Math.floor(i),0,255)}lt(Ie,"DataDrivenProperty"),lt(ge,"DataConstantProperty"),lt(ht,"ColorRampProperty");const It={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Zt{constructor(i,o){this._structArray=i,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class mt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,o){return i._trim(),o&&(i.isTransferred=!0,o.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const o=Object.create(this.prototype);return o.arrayBuffer=i.arrayBuffer,o.length=i.length,o.capacity=i.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function ut(r,i=1){let o=0,l=0;return{members:r.map(h=>{const m=It[h.type].BYTES_PER_ELEMENT,_=o=xn(o,Math.max(i,m)),x=h.components||1;return l=Math.max(l,m),o+=m*x,{name:h.name,type:h.type,components:x,offset:_}}),size:xn(o,Math.max(l,i)),alignment:i}}function xn(r,i){return Math.ceil(r/i)*i}class pn extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,o){const l=this.length;return this.resize(l+1),this.emplace(l,i,o)}emplace(i,o,l){const h=2*i;return this.int16[h+0]=o,this.int16[h+1]=l,i}}pn.prototype.bytesPerElement=4,lt(pn,"StructArrayLayout2i4");class kn extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,o,l){const h=this.length;return this.resize(h+1),this.emplace(h,i,o,l)}emplace(i,o,l,h){const m=3*i;return this.int16[m+0]=o,this.int16[m+1]=l,this.int16[m+2]=h,i}}kn.prototype.bytesPerElement=6,lt(kn,"StructArrayLayout3i6");class Cn extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,o,l,h){const m=this.length;return this.resize(m+1),this.emplace(m,i,o,l,h)}emplace(i,o,l,h,m){const _=4*i;return this.int16[_+0]=o,this.int16[_+1]=l,this.int16[_+2]=h,this.int16[_+3]=m,i}}Cn.prototype.bytesPerElement=8,lt(Cn,"StructArrayLayout4i8");class Hi extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,l,h,m,_,x){const E=this.length;return this.resize(E+1),this.emplace(E,i,o,l,h,m,_,x)}emplace(i,o,l,h,m,_,x,E){const T=6*i,S=12*i,P=3*i;return this.int16[T+0]=o,this.int16[T+1]=l,this.uint8[S+4]=h,this.uint8[S+5]=m,this.uint8[S+6]=_,this.uint8[S+7]=x,this.float32[P+2]=E,i}}Hi.prototype.bytesPerElement=12,lt(Hi,"StructArrayLayout2i4ub1f12");class Qr extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,l,h){const m=this.length;return this.resize(m+1),this.emplace(m,i,o,l,h)}emplace(i,o,l,h,m){const _=4*i;return this.float32[_+0]=o,this.float32[_+1]=l,this.float32[_+2]=h,this.float32[_+3]=m,i}}Qr.prototype.bytesPerElement=16,lt(Qr,"StructArrayLayout4f16");class ar extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,l,h,m){const _=this.length;return this.resize(_+1),this.emplace(_,i,o,l,h,m)}emplace(i,o,l,h,m,_){const x=6*i,E=3*i;return this.uint16[x+0]=o,this.uint16[x+1]=l,this.uint16[x+2]=h,this.uint16[x+3]=m,this.float32[E+2]=_,i}}ar.prototype.bytesPerElement=12,lt(ar,"StructArrayLayout4ui1f12");class Do extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,o,l,h){const m=this.length;return this.resize(m+1),this.emplace(m,i,o,l,h)}emplace(i,o,l,h,m){const _=4*i;return this.uint16[_+0]=o,this.uint16[_+1]=l,this.uint16[_+2]=h,this.uint16[_+3]=m,i}}Do.prototype.bytesPerElement=8,lt(Do,"StructArrayLayout4ui8");class $n extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,o,l,h,m,_){const x=this.length;return this.resize(x+1),this.emplace(x,i,o,l,h,m,_)}emplace(i,o,l,h,m,_,x){const E=6*i;return this.int16[E+0]=o,this.int16[E+1]=l,this.int16[E+2]=h,this.int16[E+3]=m,this.int16[E+4]=_,this.int16[E+5]=x,i}}$n.prototype.bytesPerElement=12,lt($n,"StructArrayLayout6i12");class Nn extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,o,l,h,m,_,x,E,T,S,P,L){const O=this.length;return this.resize(O+1),this.emplace(O,i,o,l,h,m,_,x,E,T,S,P,L)}emplace(i,o,l,h,m,_,x,E,T,S,P,L,O){const N=12*i;return this.int16[N+0]=o,this.int16[N+1]=l,this.int16[N+2]=h,this.int16[N+3]=m,this.uint16[N+4]=_,this.uint16[N+5]=x,this.uint16[N+6]=E,this.uint16[N+7]=T,this.int16[N+8]=S,this.int16[N+9]=P,this.int16[N+10]=L,this.int16[N+11]=O,i}}Nn.prototype.bytesPerElement=24,lt(Nn,"StructArrayLayout4i4ui4i24");class bn extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,l,h,m,_){const x=this.length;return this.resize(x+1),this.emplace(x,i,o,l,h,m,_)}emplace(i,o,l,h,m,_,x){const E=10*i,T=5*i;return this.int16[E+0]=o,this.int16[E+1]=l,this.int16[E+2]=h,this.float32[T+2]=m,this.float32[T+3]=_,this.float32[T+4]=x,i}}bn.prototype.bytesPerElement=20,lt(bn,"StructArrayLayout3i3f20");class ii extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const o=this.length;return this.resize(o+1),this.emplace(o,i)}emplace(i,o){return this.uint32[1*i+0]=o,i}}ii.prototype.bytesPerElement=4,lt(ii,"StructArrayLayout1ul4");class yi extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,o,l,h,m,_,x,E,T,S,P,L,O){const N=this.length;return this.resize(N+1),this.emplace(N,i,o,l,h,m,_,x,E,T,S,P,L,O)}emplace(i,o,l,h,m,_,x,E,T,S,P,L,O,N){const j=20*i,G=10*i;return this.int16[j+0]=o,this.int16[j+1]=l,this.int16[j+2]=h,this.int16[j+3]=m,this.int16[j+4]=_,this.float32[G+3]=x,this.float32[G+4]=E,this.float32[G+5]=T,this.float32[G+6]=S,this.int16[j+14]=P,this.uint32[G+8]=L,this.uint16[j+18]=O,this.uint16[j+19]=N,i}}yi.prototype.bytesPerElement=40,lt(yi,"StructArrayLayout5i4f1i1ul2ui40");class Gn extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,o,l,h,m,_,x){const E=this.length;return this.resize(E+1),this.emplace(E,i,o,l,h,m,_,x)}emplace(i,o,l,h,m,_,x,E){const T=8*i;return this.int16[T+0]=o,this.int16[T+1]=l,this.int16[T+2]=h,this.int16[T+4]=m,this.int16[T+5]=_,this.int16[T+6]=x,this.int16[T+7]=E,i}}Gn.prototype.bytesPerElement=16,lt(Gn,"StructArrayLayout3i2i2i16");class lr extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,o,l,h,m){const _=this.length;return this.resize(_+1),this.emplace(_,i,o,l,h,m)}emplace(i,o,l,h,m,_){const x=4*i,E=8*i;return this.float32[x+0]=o,this.float32[x+1]=l,this.float32[x+2]=h,this.int16[E+6]=m,this.int16[E+7]=_,i}}lr.prototype.bytesPerElement=16,lt(lr,"StructArrayLayout2f1f2i16");class Pl extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,l,h){const m=this.length;return this.resize(m+1),this.emplace(m,i,o,l,h)}emplace(i,o,l,h,m){const _=12*i,x=3*i;return this.uint8[_+0]=o,this.uint8[_+1]=l,this.float32[x+1]=h,this.float32[x+2]=m,i}}Pl.prototype.bytesPerElement=12,lt(Pl,"StructArrayLayout2ub2f12");class kr extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,l){const h=this.length;return this.resize(h+1),this.emplace(h,i,o,l)}emplace(i,o,l,h){const m=3*i;return this.float32[m+0]=o,this.float32[m+1]=l,this.float32[m+2]=h,i}}kr.prototype.bytesPerElement=12,lt(kr,"StructArrayLayout3f12");class cr extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,o,l){const h=this.length;return this.resize(h+1),this.emplace(h,i,o,l)}emplace(i,o,l,h){const m=3*i;return this.uint16[m+0]=o,this.uint16[m+1]=l,this.uint16[m+2]=h,i}}cr.prototype.bytesPerElement=6,lt(cr,"StructArrayLayout3ui6");class uo extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,o,l,h,m,_,x,E,T,S,P,L,O,N,j,G,ne,ae,te,se,he){const le=this.length;return this.resize(le+1),this.emplace(le,i,o,l,h,m,_,x,E,T,S,P,L,O,N,j,G,ne,ae,te,se,he)}emplace(i,o,l,h,m,_,x,E,T,S,P,L,O,N,j,G,ne,ae,te,se,he,le){const be=30*i,Ee=15*i,ke=60*i;return this.int16[be+0]=o,this.int16[be+1]=l,this.int16[be+2]=h,this.float32[Ee+2]=m,this.float32[Ee+3]=_,this.uint16[be+8]=x,this.uint16[be+9]=E,this.uint32[Ee+5]=T,this.uint32[Ee+6]=S,this.uint32[Ee+7]=P,this.uint16[be+16]=L,this.uint16[be+17]=O,this.uint16[be+18]=N,this.float32[Ee+10]=j,this.float32[Ee+11]=G,this.uint8[ke+48]=ne,this.uint8[ke+49]=ae,this.uint8[ke+50]=te,this.uint32[Ee+13]=se,this.int16[be+28]=he,this.uint8[ke+58]=le,i}}uo.prototype.bytesPerElement=60,lt(uo,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class ho extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,o,l,h,m,_,x,E,T,S,P,L,O,N,j,G,ne,ae,te,se,he,le,be,Ee,ke,Xe,Ae,Oe,ze,$e){const Ke=this.length;return this.resize(Ke+1),this.emplace(Ke,i,o,l,h,m,_,x,E,T,S,P,L,O,N,j,G,ne,ae,te,se,he,le,be,Ee,ke,Xe,Ae,Oe,ze,$e)}emplace(i,o,l,h,m,_,x,E,T,S,P,L,O,N,j,G,ne,ae,te,se,he,le,be,Ee,ke,Xe,Ae,Oe,ze,$e,Ke){const Me=38*i,nt=19*i;return this.int16[Me+0]=o,this.int16[Me+1]=l,this.int16[Me+2]=h,this.float32[nt+2]=m,this.float32[nt+3]=_,this.int16[Me+8]=x,this.int16[Me+9]=E,this.int16[Me+10]=T,this.int16[Me+11]=S,this.int16[Me+12]=P,this.int16[Me+13]=L,this.uint16[Me+14]=O,this.uint16[Me+15]=N,this.uint16[Me+16]=j,this.uint16[Me+17]=G,this.uint16[Me+18]=ne,this.uint16[Me+19]=ae,this.uint16[Me+20]=te,this.uint16[Me+21]=se,this.uint16[Me+22]=he,this.uint16[Me+23]=le,this.uint16[Me+24]=be,this.uint16[Me+25]=Ee,this.uint16[Me+26]=ke,this.uint16[Me+27]=Xe,this.uint16[Me+28]=Ae,this.uint32[nt+15]=Oe,this.float32[nt+16]=ze,this.float32[nt+17]=$e,this.float32[nt+18]=Ke,i}}ho.prototype.bytesPerElement=76,lt(ho,"StructArrayLayout3i2f6i15ui1ul3f76");class Qo extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const o=this.length;return this.resize(o+1),this.emplace(o,i)}emplace(i,o){return this.float32[1*i+0]=o,i}}Qo.prototype.bytesPerElement=4,lt(Qo,"StructArrayLayout1f4");class Ll extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,l,h,m){const _=this.length;return this.resize(_+1),this.emplace(_,i,o,l,h,m)}emplace(i,o,l,h,m,_){const x=5*i;return this.float32[x+0]=o,this.float32[x+1]=l,this.float32[x+2]=h,this.float32[x+3]=m,this.float32[x+4]=_,i}}Ll.prototype.bytesPerElement=20,lt(Ll,"StructArrayLayout5f20");class na extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,o,l,h){const m=this.length;return this.resize(m+1),this.emplace(m,i,o,l,h)}emplace(i,o,l,h,m){const _=6*i;return this.uint32[3*i+0]=o,this.uint16[_+2]=l,this.uint16[_+3]=h,this.uint16[_+4]=m,i}}na.prototype.bytesPerElement=12,lt(na,"StructArrayLayout1ul3ui12");class gr extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,o){const l=this.length;return this.resize(l+1),this.emplace(l,i,o)}emplace(i,o,l){const h=2*i;return this.uint16[h+0]=o,this.uint16[h+1]=l,i}}gr.prototype.bytesPerElement=4,lt(gr,"StructArrayLayout2ui4");class ia extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const o=this.length;return this.resize(o+1),this.emplace(o,i)}emplace(i,o){return this.uint16[1*i+0]=o,i}}ia.prototype.bytesPerElement=2,lt(ia,"StructArrayLayout1ui2");class Ua extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o){const l=this.length;return this.resize(l+1),this.emplace(l,i,o)}emplace(i,o,l){const h=2*i;return this.float32[h+0]=o,this.float32[h+1]=l,i}}Ua.prototype.bytesPerElement=8,lt(Ua,"StructArrayLayout2f8");class qf extends Zt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}qf.prototype.size=40;class Qh extends yi{get(i){return new qf(this,i)}}lt(Qh,"CollisionBoxArray");class Mc extends Zt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(i){this._structArray.uint8[this._pos1+49]=i}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(i){this._structArray.uint8[this._pos1+50]=i}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(i){this._structArray.uint32[this._pos4+13]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(i){this._structArray.uint8[this._pos1+58]=i}}Mc.prototype.size=60;class tv extends uo{get(i){return new Mc(this,i)}}lt(tv,"PlacedSymbolArray");class Og extends Zt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(i){this._structArray.uint32[this._pos4+15]=i}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Og.prototype.size=76;class wn extends ho{get(i){return new Og(this,i)}}lt(wn,"SymbolInstanceArray");class nv extends Qo{getoffsetX(i){return this.float32[1*i+0]}}lt(nv,"GlyphOffsetArray");class iv extends pn{getx(i){return this.int16[2*i+0]}gety(i){return this.int16[2*i+1]}}lt(iv,"SymbolLineVertexArray");class rv extends Zt{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}rv.prototype.size=12;class ov extends na{get(i){return new rv(this,i)}}lt(ov,"FeatureIndexArray");class sv extends gr{geta_centroid_pos0(i){return this.uint16[2*i+0]}geta_centroid_pos1(i){return this.uint16[2*i+1]}}lt(sv,"FillExtrusionCentroidArray");const f1=ut([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),m1=ut([{name:"a_dash",components:4,type:"Uint16"}]);var ra={exports:{}},ki=function(r,i){var o,l,h,m,_,x,E,T;for(l=r.length-(o=3&r.length),h=i,_=3432918353,x=461845907,T=0;T<l;)E=255&r.charCodeAt(T)|(255&r.charCodeAt(++T))<<8|(255&r.charCodeAt(++T))<<16|(255&r.charCodeAt(++T))<<24,++T,h=27492+(65535&(m=5*(65535&(h=(h^=E=(65535&(E=(E=(65535&E)*_+(((E>>>16)*_&65535)<<16)&4294967295)<<15|E>>>17))*x+(((E>>>16)*x&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(E=0,o){case 3:E^=(255&r.charCodeAt(T+2))<<16;case 2:E^=(255&r.charCodeAt(T+1))<<8;case 1:h^=E=(65535&(E=(E=(65535&(E^=255&r.charCodeAt(T)))*_+(((E>>>16)*_&65535)<<16)&4294967295)<<15|E>>>17))*x+(((E>>>16)*x&65535)<<16)&4294967295}return h^=r.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0},Wf=function(r,i){for(var o,l=r.length,h=i^l,m=0;l>=4;)o=1540483477*(65535&(o=255&r.charCodeAt(m)|(255&r.charCodeAt(++m))<<8|(255&r.charCodeAt(++m))<<16|(255&r.charCodeAt(++m))<<24))+((1540483477*(o>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(o=1540483477*(65535&(o^=o>>>24))+((1540483477*(o>>>16)&65535)<<16)),l-=4,++m;switch(l){case 3:h^=(255&r.charCodeAt(m+2))<<16;case 2:h^=(255&r.charCodeAt(m+1))<<8;case 1:h=1540483477*(65535&(h^=255&r.charCodeAt(m)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0};ra.exports=ki,ra.exports.murmur3=ki,ra.exports.murmur2=Wf;class kl{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(i,o,l,h){this.ids.push(cv(i)),this.positions.push(o,l,h)}getPositions(i){const o=cv(i);let l=0,h=this.ids.length-1;for(;l<h;){const _=l+h>>1;this.ids[_]>=o?h=_:l=_+1}const m=[];for(;this.ids[l]===o;)m.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return m}static serialize(i,o){const l=new Float64Array(i.ids),h=new Uint32Array(i.positions);return Zf(l,h,0,l.length-1),o&&o.push(l.buffer,h.buffer),{ids:l,positions:h}}static deserialize(i){const o=new kl;return o.ids=i.ids,o.positions=i.positions,o.indexed=!0,o}}function cv(r){const i=+r;return!isNaN(i)&&Number.MIN_SAFE_INTEGER<=i&&i<=Number.MAX_SAFE_INTEGER?i:ra.exports(String(r))}function Zf(r,i,o,l){for(;o<l;){const h=r[o+l>>1];let m=o-1,_=l+1;for(;;){do{m++}while(r[m]<h);do{_--}while(r[_]>h);if(m>=_)break;Rr(r,m,_),Rr(i,3*m,3*_),Rr(i,3*m+1,3*_+1),Rr(i,3*m+2,3*_+2)}_-o<l-_?(Zf(r,i,o,_),o=_+1):(Zf(r,i,_+1,l),l=_)}}function Rr(r,i,o){const l=r[i];r[i]=r[o],r[o]=l}lt(kl,"FeaturePositionMap");class _r{constructor(i){this.gl=i.gl,this.initialized=!1}fetchUniformLocation(i,o){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(i,o),this.initialized=!0),!!this.location}}class Jh extends _r{constructor(i){super(i),this.current=0}set(i,o,l){this.fetchUniformLocation(i,o)&&this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))}}class ed extends _r{constructor(i){super(i),this.current=[0,0,0,0]}set(i,o,l){this.fetchUniformLocation(i,o)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3])))}}class Hu extends _r{constructor(i){super(i),this.current=ui.transparent}set(i,o,l){this.fetchUniformLocation(i,o)&&(l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a)))}}const Fg=new Float32Array(16),uv=new Float32Array(9),hv=new Float32Array(4);function Ng(r){return[ft(255*r.r,255*r.g),ft(255*r.b,255*r.a)]}class hp{constructor(i,o,l){this.value=i,this.uniformNames=o.map(h=>`u_${h}`),this.type=l}setUniform(i,o,l,h,m){o.set(i,m,h.constantOr(this.value))}getBinding(i,o){return"color"===this.type?new Hu(i):new Jh(i)}}class Ac{constructor(i,o){this.uniformNames=o.map(l=>`u_${l}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(i){this.pixelRatio=i.pixelRatio||1,this.pattern=i.tl.concat(i.br)}setUniform(i,o,l,h,m){const _="u_pattern"===m||"u_dash"===m?this.pattern:"u_pixel_ratio"===m?this.pixelRatio:null;_&&o.set(i,m,_)}getBinding(i,o){return"u_pattern"===o||"u_dash"===o?new ed(i):new Jh(i)}}class Ci{constructor(i,o,l,h){this.expression=i,this.type=l,this.maxValue=0,this.paintVertexAttributes=o.map(m=>({name:`a_${m}`,type:"Float32",components:"color"===l?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(i,o,l,h,m,_){const x=this.paintVertexArray.length,E=this.expression.evaluate(new _e(0),o,{},m,h,_);this.paintVertexArray.resize(i),this._setPaintValue(x,i,E)}updatePaintArray(i,o,l,h,m){const _=this.expression.evaluate({zoom:0},l,h,void 0,m);this._setPaintValue(i,o,_)}_setPaintValue(i,o,l){if("color"===this.type){const h=Ng(l);for(let m=i;m<o;m++)this.paintVertexArray.emplace(m,h[0],h[1])}else{for(let h=i;h<o;h++)this.paintVertexArray.emplace(h,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Co{constructor(i,o,l,h,m,_){this.expression=i,this.uniformNames=o.map(x=>`u_${x}_t`),this.type=l,this.useIntegerZoom=h,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=o.map(x=>({name:`a_${x}`,type:"Float32",components:"color"===l?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(i,o,l,h,m,_){const x=this.expression.evaluate(new _e(this.zoom),o,{},m,h,_),E=this.expression.evaluate(new _e(this.zoom+1),o,{},m,h,_),T=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(T,i,x,E)}updatePaintArray(i,o,l,h,m){const _=this.expression.evaluate({zoom:this.zoom},l,h,void 0,m),x=this.expression.evaluate({zoom:this.zoom+1},l,h,void 0,m);this._setPaintValue(i,o,_,x)}_setPaintValue(i,o,l,h){if("color"===this.type){const m=Ng(l),_=Ng(h);for(let x=i;x<o;x++)this.paintVertexArray.emplace(x,m[0],m[1],_[0],_[1])}else{for(let m=i;m<o;m++)this.paintVertexArray.emplace(m,l,h);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(h))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,o,l,h,m){const _=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,x=sn(this.expression.interpolationFactor(_,this.zoom,this.zoom+1),0,1);o.set(i,m,x)}getBinding(i,o){return new Jh(i)}}class Io{constructor(i,o,l,h,m){this.expression=i,this.layerId=m,this.paintVertexAttributes=("array"===l?m1:f1).members;for(let _=0;_<o.length;++_);this.paintVertexArray=new h}populatePaintArray(i,o,l){const h=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValues(h,i,o.patterns&&o.patterns[this.layerId],l)}updatePaintArray(i,o,l,h,m,_){this._setPaintValues(i,o,l.patterns&&l.patterns[this.layerId],_)}_setPaintValues(i,o,l,h){if(!h||!l)return;const m=h[l];if(!m)return;const{tl:_,br:x,pixelRatio:E}=m;for(let T=i;T<o;T++)this.paintVertexArray.emplace(T,_[0],_[1],x[0],x[1],E)}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Pc{constructor(i,o,l=(()=>!0)){this.binders={},this._buffers=[];const h=[];for(const m in i.paint._values){if(!l(m))continue;const _=i.paint.get(m);if(!(_ instanceof Fe&&bl(_.property.specification)))continue;const x=pv(m,i.type),E=_.value,T=_.property.specification.type,S=_.property.useIntegerZoom,P="line-dasharray"===m||m.endsWith("pattern"),L="line-dasharray"===m&&"constant"!==i.layout.get("line-cap").value.kind;if("constant"!==E.kind||L)if("source"===E.kind||L||P){const O=zg(m,T,"source");this.binders[m]=P?new Io(E,x,T,O,i.id):new Ci(E,x,T,O),h.push(`/a_${m}`)}else{const O=zg(m,T,"composite");this.binders[m]=new Co(E,x,T,S,o,O),h.push(`/z_${m}`)}else this.binders[m]=P?new Ac(E.value,x):new hp(E.value,x,T),h.push(`/u_${m}`)}this.cacheKey=h.sort().join("")}getMaxValue(i){const o=this.binders[i];return o instanceof Ci||o instanceof Co?o.maxValue:0}populatePaintArrays(i,o,l,h,m,_){for(const x in this.binders){const E=this.binders[x];(E instanceof Ci||E instanceof Co||E instanceof Io)&&E.populatePaintArray(i,o,l,h,m,_)}}setConstantPatternPositions(i){for(const o in this.binders){const l=this.binders[o];l instanceof Ac&&l.setConstantPatternPositions(i)}}updatePaintArrays(i,o,l,h,m,_){let x=!1;for(const E in i){const T=o.getPositions(E);for(const S of T){const P=l.feature(S.index);for(const L in this.binders){const O=this.binders[L];if((O instanceof Ci||O instanceof Co||O instanceof Io)&&!0===O.expression.isStateDependent){const N=h.paint.get(L);O.expression=N.value,O.updatePaintArray(S.start,S.end,P,i[E],m,_),x=!0}}}}return x}defines(){const i=[];for(const o in this.binders){const l=this.binders[o];(l instanceof hp||l instanceof Ac)&&i.push(...l.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return i}getBinderAttributes(){const i=[];for(const o in this.binders){const l=this.binders[o];if(l instanceof Ci||l instanceof Co||l instanceof Io)for(let h=0;h<l.paintVertexAttributes.length;h++)i.push(l.paintVertexAttributes[h].name)}return i}getBinderUniforms(){const i=[];for(const o in this.binders){const l=this.binders[o];if(l instanceof hp||l instanceof Ac||l instanceof Co)for(const h of l.uniformNames)i.push(h)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i){const o=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof hp||h instanceof Ac||h instanceof Co)for(const m of h.uniformNames)o.push({name:m,property:l,binding:h.getBinding(i,m)})}return o}setUniforms(i,o,l,h,m){for(const{name:_,property:x,binding:E}of l)this.binders[x].setUniform(i,E,m,h.get(x),_)}updatePaintBuffers(){this._buffers=[];for(const i in this.binders){const o=this.binders[i];(o instanceof Ci||o instanceof Co||o instanceof Io)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(i){for(const o in this.binders){const l=this.binders[o];(l instanceof Ci||l instanceof Co||l instanceof Io)&&l.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const o=this.binders[i];(o instanceof Ci||o instanceof Co||o instanceof Io)&&o.destroy()}}}class Rl{constructor(i,o,l=(()=>!0)){this.programConfigurations={};for(const h of i)this.programConfigurations[h.id]=new Pc(h,o,l);this.needsUpload=!1,this._featureMap=new kl,this._bufferOffset=0}populatePaintArrays(i,o,l,h,m,_,x){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(i,o,h,m,_,x);void 0!==o.id&&this._featureMap.add(o.id,l,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,o,l,h,m){for(const _ of l)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(i,this._featureMap,o,_,h,m)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const o in this.programConfigurations)this.programConfigurations[o].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}const dv={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function pv(r,i){return dv[r]||[r.replace(`${i}-`,"").replace(/-/g,"_")]}const fv={"line-pattern":{source:ar,composite:ar},"fill-pattern":{source:ar,composite:ar},"fill-extrusion-pattern":{source:ar,composite:ar},"line-dasharray":{source:Do,composite:Do}},mv={color:{source:Ua,composite:Qr},number:{source:Qo,composite:Ua}};function zg(r,i,o){const l=fv[r];return l&&l[o]||mv[i][o]}lt(hp,"ConstantBinder"),lt(Ac,"PatternConstantBinder"),lt(Ci,"SourceExpressionBinder"),lt(Io,"PatternCompositeBinder"),lt(Co,"CompositeExpressionBinder"),lt(Pc,"ProgramConfiguration",{omit:["_buffers"]}),lt(Rl,"ProgramConfigurationSet");const dp="-transition";class So extends jr{constructor(i,o){if(super(),this.id=i.id,this.type=i.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==i.type&&(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,"background"!==i.type&&"sky"!==i.type&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter),o.layout&&(this._unevaluatedLayout=new Pe(o.layout)),o.paint)){this._transitionablePaint=new Le(o.paint);for(const l in i.paint)this.setPaintProperty(l,i.paint[l],{validate:!1});for(const l in i.layout)this.setLayoutProperty(l,i.layout[l],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Qe(o.paint)}}getLayoutProperty(i){return"visibility"===i?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,o,l={}){null!=o&&this._validate(Lr,`layers.${this.id}.layout.${i}`,i,o,l)||("visibility"!==i?this._unevaluatedLayout.setValue(i,o):this.visibility=o)}getPaintProperty(i){return Br(i,dp)?this._transitionablePaint.getTransition(i.slice(0,-dp.length)):this._transitionablePaint.getValue(i)}setPaintProperty(i,o,l={}){if(null!=o&&this._validate(Pr,`layers.${this.id}.paint.${i}`,i,o,l))return!1;if(Br(i,dp))return this._transitionablePaint.setTransition(i.slice(0,-dp.length),o||void 0),!1;{const h=this._transitionablePaint._values[i],m=h.value.isDataDriven(),_=h.value;this._transitionablePaint.setValue(i,o),this._handleSpecialPaintPropertyUpdate(i);const x=this._transitionablePaint._values[i].value,E=x.isDataDriven(),T=Br(i,"pattern")||"line-dasharray"===i;return E||m||T||this._handleOverridablePaintPropertyUpdate(i,_,x)}}_handleSpecialPaintPropertyUpdate(i){}getProgramIds(){return null}getProgramConfiguration(i){return null}_handleOverridablePaintPropertyUpdate(i,o,l){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||"none"===this.visibility}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,o){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,o)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,o)}serialize(){const i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(i.layout=i.layout||{},i.layout.visibility=this.visibility),Bs(i,(o,l)=>!(void 0===o||"layout"===l&&!Object.keys(o).length||"paint"===l&&!Object.keys(o).length))}_validate(i,o,l,h,m={}){return(!m||!1!==m.validate)&&qh(this,i.call(vn,{key:o,layerType:this.type,objectKey:l,value:h,styleSpec:Re,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const i in this.paint._values){const o=this.paint.get(i);if(o instanceof Fe&&bl(o.property.specification)&&("source"===o.value.kind||"composite"===o.value.kind)&&o.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Es(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const pp=ut([{name:"a_pos",components:2,type:"Int16"}],4),g1=ut([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class ai{constructor(i=[]){this.segments=i}prepareSegment(i,o,l,h){let m=this.segments[this.segments.length-1];return i>ai.MAX_VERTEX_ARRAY_LENGTH&&Qn(`Max vertices per segment is ${ai.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!m||m.vertexLength+i>ai.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==h)&&(m={vertexOffset:o.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0},void 0!==h&&(m.sortKey=h),this.segments.push(m)),m}get(){return this.segments}destroy(){for(const i of this.segments)for(const o in i.vaos)i.vaos[o].destroy()}static simpleSegment(i,o,l,h){return new ai([{vertexOffset:i,primitiveOffset:o,vertexLength:l,primitiveLength:h,vaos:{},sortKey:0}])}}ai.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,lt(ai,"SegmentVector");var St=8192;class Ts{constructor(i,o){i&&(o?this.setSouthWest(i).setNorthEast(o):4===i.length?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1]))}setNorthEast(i){return this._ne=i instanceof fn?new fn(i.lng,i.lat):fn.convert(i),this}setSouthWest(i){return this._sw=i instanceof fn?new fn(i.lng,i.lat):fn.convert(i),this}extend(i){const o=this._sw,l=this._ne;let h,m;if(i instanceof fn)h=i,m=i;else{if(!(i instanceof Ts))return Array.isArray(i)?4===i.length||i.every(Array.isArray)?this.extend(Ts.convert(i)):this.extend(fn.convert(i)):"object"==typeof i&&null!==i&&i.hasOwnProperty("lat")&&i.hasOwnProperty("lon")?this.extend(fn.convert(i)):this;if(h=i._sw,m=i._ne,!h||!m)return this}return o||l?(o.lng=Math.min(h.lng,o.lng),o.lat=Math.min(h.lat,o.lat),l.lng=Math.max(m.lng,l.lng),l.lat=Math.max(m.lat,l.lat)):(this._sw=new fn(h.lng,h.lat),this._ne=new fn(m.lng,m.lat)),this}getCenter(){return new fn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new fn(this.getWest(),this.getNorth())}getSouthEast(){return new fn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:o,lat:l}=fn.convert(i);let h=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&h}static convert(i){return!i||i instanceof Ts?i:new Ts(i)}}const fp=6371008.8;class fn{constructor(i,o){if(isNaN(i)||isNaN(o))throw new Error(`Invalid LngLat object: (${i}, ${o})`);if(this.lng=+i,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new fn(Fs(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const o=Math.PI/180,l=this.lat*o,h=i.lat*o,m=Math.sin(l)*Math.sin(h)+Math.cos(l)*Math.cos(h)*Math.cos((i.lng-this.lng)*o);return fp*Math.acos(Math.min(m,1))}toBounds(i=0){const o=360*i/40075017,l=o/Math.cos(Math.PI/180*this.lat);return new Ts(new fn(this.lng-l,this.lat-o),new fn(this.lng+l,this.lat+o))}static convert(i){if(i instanceof fn)return i;if(Array.isArray(i)&&(2===i.length||3===i.length))return new fn(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&"object"==typeof i&&null!==i)return new fn(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Bg=2*Math.PI*fp;function mp(r){return Bg*Math.cos(r*Math.PI/180)}function po(r){return(180+r)/360}function Jr(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function Jo(r,i){return r/mp(i)}function Bt(r){return 360*r-180}function qi(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function Vg(r,i){return r*mp(qi(i))}const es=85.051129;function qu(r){return 1/Math.cos(r*Math.PI/180)}class Wu{constructor(i,o,l=0){this.x=+i,this.y=+o,this.z=+l}static fromLngLat(i,o=0){const l=fn.convert(i);return new Wu(po(l.lng),Jr(l.lat),Jo(o,l.lat))}toLngLat(){return new fn(Bt(this.x),qi(this.y))}toAltitude(){return Vg(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Bg*qu(qi(this.y))}}function Xf(r,i,o,l,h,m,_,x,E){const T=(i+l)/2,S=(o+h)/2,P=new et(T,S);x(P),function(L,O,N,j,G,ne){const ae=N-G,te=j-ne;return Math.abs((j-O)*ae-(N-L)*te)/Math.hypot(ae,te)}(P.x,P.y,m.x,m.y,_.x,_.y)>=E?(Xf(r,i,o,T,S,m,P,x,E),Xf(r,T,S,l,h,P,_,x,E)):r.push(_)}function jg(r,i,o){let l=r[0],h=l.x,m=l.y;i(l);const _=[l];for(let x=1;x<r.length;x++){const E=r[x],{x:T,y:S}=E;i(E),Xf(_,h,m,T,S,l,E,i,o),h=T,m=S,l=E}return _}function td(r,i,o,l){if(l(i,o)){const h=i.add(o)._mult(.5);td(r,i,h,l),td(r,h,o,l)}else r.push(o)}function gp(r,i){let o=r[0];const l=[o];for(let h=1;h<r.length;h++){const m=r[h];td(l,o,m,i),o=m}return l}const _p=Math.pow(2,14)-1,nd=-_p-1;function gv(r,i){const o=Math.round(r.x*i),l=Math.round(r.y*i);return r.x=sn(o,nd,_p),r.y=sn(l,nd,_p),(o<r.x||o>r.x+1||l<r.y||l>r.y+1)&&Qn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),r}function oa(r,i,o){const l=r.loadGeometry(),h=r.extent,m=St/h;if(i&&o&&o.projection.isReprojectedInTileSpace){const _=1<<i.z,{scale:x,x:E,y:T,projection:S}=o,P=L=>{const O=Bt((i.x+L.x/h)/_),N=qi((i.y+L.y/h)/_),j=S.project(O,N);L.x=(j.x*x-E)*h,L.y=(j.y*x-T)*h};for(let L=0;L<l.length;L++)if(1!==r.type)l[L]=jg(l[L],P,1);else{const O=[];for(const N of l[L])N.x<0||N.x>=h||N.y<0||N.y>=h||(P(N),O.push(N));l[L]=O}}for(const _ of l)for(const x of _)gv(x,m);return l}function Ds(r,i){return{type:r.type,id:r.id,properties:r.properties,geometry:i?oa(r):[]}}function Lc(r,i,o,l,h){r.emplaceBack(2*i+(l+1)/2,2*o+(h+1)/2)}function id(r,i,o){r.emplaceBack(i.x,i.y,i.z,16384*o[0],16384*o[1],16384*o[2])}class Kf{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(o=>o.id),this.index=i.index,this.hasPattern=!1,this.projection=i.projection,this.layoutVertexArray=new pn,this.indexArray=new cr,this.segments=new ai,this.programConfigurations=new Rl(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(i,o,l,h){const m=this.layers[0],_=[];let x=null;"circle"===m.type&&(x=m.layout.get("circle-sort-key"));for(const{feature:T,id:S,index:P,sourceLayerIndex:L}of i){const O=this.layers[0]._featureFilter.needGeometry,N=Ds(T,O);if(!this.layers[0]._featureFilter.filter(new _e(this.zoom),N,l))continue;const j=x?x.evaluate(N,{},l):void 0,G={id:S,properties:T.properties,type:T.type,sourceLayerIndex:L,index:P,geometry:O?N.geometry:oa(T,l,h),patterns:{},sortKey:j};_.push(G)}x&&_.sort((T,S)=>T.sortKey-S.sortKey);let E=null;"globe"===h.projection.name&&(this.globeExtVertexArray=new $n,E=h.projection);for(const T of _){const{geometry:S,index:P,sourceLayerIndex:L}=T,O=i[P].feature;this.addFeature(T,S,P,o.availableImages,l,E),o.featureIndex.insert(O,S,P,L,this.index)}}update(i,o,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,o,this.stateDependentLayers,l,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,pp.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,g1.members))),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(i,o,l,h,m,_){for(const x of o)for(const E of x){const T=E.x,S=E.y;if(T<0||T>=St||S<0||S>=St)continue;if(_){const O=_.projectTilePoint(T,S,m),N=_.upVector(m,T,S),j=this.globeExtVertexArray;id(j,O,N),id(j,O,N),id(j,O,N),id(j,O,N)}const P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),L=P.vertexLength;Lc(this.layoutVertexArray,T,S,-1,-1),Lc(this.layoutVertexArray,T,S,1,-1),Lc(this.layoutVertexArray,T,S,1,1),Lc(this.layoutVertexArray,T,S,-1,1),this.indexArray.emplaceBack(L,L+1,L+2),this.indexArray.emplaceBack(L,L+2,L+3),P.vertexLength+=4,P.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,l,{},h,m)}}function Ug(r,i){for(let o=0;o<r.length;o++)if(kc(i,r[o]))return!0;for(let o=0;o<i.length;o++)if(kc(r,i[o]))return!0;return!!$g(r,i)}function Zu(r,i,o){return!!kc(r,i)||!!Yf(i,r,o)}function Xu(r,i){if(1===r.length)return Hg(i,r[0]);for(let o=0;o<i.length;o++){const l=i[o];for(let h=0;h<l.length;h++)if(kc(r,l[h]))return!0}for(let o=0;o<r.length;o++)if(Hg(i,r[o]))return!0;for(let o=0;o<i.length;o++)if($g(r,i[o]))return!0;return!1}function _v(r,i,o){if(r.length>1){if($g(r,i))return!0;for(let l=0;l<i.length;l++)if(Yf(i[l],r,o))return!0}for(let l=0;l<r.length;l++)if(Yf(r[l],i,o))return!0;return!1}function $g(r,i){if(0===r.length||0===i.length)return!1;for(let o=0;o<r.length-1;o++){const l=r[o],h=r[o+1];for(let m=0;m<i.length-1;m++)if(Gg(l,h,i[m],i[m+1]))return!0}return!1}function Gg(r,i,o,l){return Go(r,o,l)!==Go(i,o,l)&&Go(r,i,o)!==Go(r,i,l)}function Yf(r,i,o){const l=o*o;if(1===i.length)return r.distSqr(i[0])<l;for(let h=1;h<i.length;h++)if(yv(r,i[h-1],i[h])<l)return!0;return!1}function yv(r,i,o){const l=i.distSqr(o);if(0===l)return r.distSqr(i);const h=((r.x-i.x)*(o.x-i.x)+(r.y-i.y)*(o.y-i.y))/l;return r.distSqr(h<0?i:h>1?o:o.sub(i)._mult(h)._add(i))}function Hg(r,i){let o,l,h,m=!1;for(let _=0;_<r.length;_++){o=r[_];for(let x=0,E=o.length-1;x<o.length;E=x++)l=o[x],h=o[E],l.y>i.y!=h.y>i.y&&i.x<(h.x-l.x)*(i.y-l.y)/(h.y-l.y)+l.x&&(m=!m)}return m}function kc(r,i){let o=!1;for(let l=0,h=r.length-1;l<r.length;h=l++){const m=r[l],_=r[h];m.y>i.y!=_.y>i.y&&i.x<(_.x-m.x)*(i.y-m.y)/(_.y-m.y)+m.x&&(o=!o)}return o}function qg(r,i,o,l,h){for(const _ of r)if(i<=_.x&&o<=_.y&&l>=_.x&&h>=_.y)return!0;const m=[new et(i,o),new et(i,h),new et(l,h),new et(l,o)];if(r.length>2)for(const _ of m)if(kc(r,_))return!0;for(let _=0;_<r.length-1;_++)if(yp(r[_],r[_+1],m))return!0;return!1}function yp(r,i,o){const l=o[0],h=o[2];if(r.x<l.x&&i.x<l.x||r.x>h.x&&i.x>h.x||r.y<l.y&&i.y<l.y||r.y>h.y&&i.y>h.y)return!1;const m=Go(r,i,o[0]);return m!==Go(r,i,o[1])||m!==Go(r,i,o[2])||m!==Go(r,i,o[3])}function Rc(r,i,o){const l=i.paint.get(r).value;return"constant"===l.kind?l.value:o.programConfigurations.get(i.id).getMaxValue(r)}function vp(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function Qf(r,i,o,l,h){if(!i[0]&&!i[1])return r;const m=et.convert(i)._mult(h);"viewport"===o&&m._rotate(-l);const _=[];for(let x=0;x<r.length;x++)_.push(r[x].sub(m));return _}function vv(r,i,o,l){const h=et.convert(r)._mult(l);return"viewport"===i&&h._rotate(-o),h}lt(Kf,"CircleBucket",{omit:["layers"]});const Wg=new wt({"circle-sort-key":new Ie(Re.layout_circle["circle-sort-key"])});var _1={paint:new wt({"circle-radius":new Ie(Re.paint_circle["circle-radius"]),"circle-color":new Ie(Re.paint_circle["circle-color"]),"circle-blur":new Ie(Re.paint_circle["circle-blur"]),"circle-opacity":new Ie(Re.paint_circle["circle-opacity"]),"circle-translate":new ge(Re.paint_circle["circle-translate"]),"circle-translate-anchor":new ge(Re.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ge(Re.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ge(Re.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ie(Re.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ie(Re.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ie(Re.paint_circle["circle-stroke-opacity"])}),layout:Wg},xp=1e-6,fo=typeof Float32Array<"u"?Float32Array:Array;function bp(){var r=new fo(9);return fo!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function xv(r,i,o){var l=i[0],h=i[1],m=i[2],_=i[3],x=i[4],E=i[5],T=i[6],S=i[7],P=i[8],L=o[0],O=o[1],N=o[2],j=o[3],G=o[4],ne=o[5],ae=o[6],te=o[7],se=o[8];return r[0]=L*l+O*_+N*T,r[1]=L*h+O*x+N*S,r[2]=L*m+O*E+N*P,r[3]=j*l+G*_+ne*T,r[4]=j*h+G*x+ne*S,r[5]=j*m+G*E+ne*P,r[6]=ae*l+te*_+se*T,r[7]=ae*h+te*x+se*S,r[8]=ae*m+te*E+se*P,r}function sa(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function rd(r,i){var o=i[0],l=i[1],h=i[2],m=i[3],_=i[4],x=i[5],E=i[6],T=i[7],S=i[8],P=i[9],L=i[10],O=i[11],N=i[12],j=i[13],G=i[14],ne=i[15],ae=o*x-l*_,te=o*E-h*_,se=o*T-m*_,he=l*E-h*x,le=l*T-m*x,be=h*T-m*E,Ee=S*j-P*N,ke=S*G-L*N,Xe=S*ne-O*N,Ae=P*G-L*j,Oe=P*ne-O*j,ze=L*ne-O*G,$e=ae*ze-te*Oe+se*Ae+he*Xe-le*ke+be*Ee;return $e?(r[0]=(x*ze-E*Oe+T*Ae)*($e=1/$e),r[1]=(h*Oe-l*ze-m*Ae)*$e,r[2]=(j*be-G*le+ne*he)*$e,r[3]=(L*le-P*be-O*he)*$e,r[4]=(E*Xe-_*ze-T*ke)*$e,r[5]=(o*ze-h*Xe+m*ke)*$e,r[6]=(G*se-N*be-ne*te)*$e,r[7]=(S*be-L*se+O*te)*$e,r[8]=(_*Oe-x*Xe+T*Ee)*$e,r[9]=(l*Xe-o*Oe-m*Ee)*$e,r[10]=(N*le-j*se+ne*ae)*$e,r[11]=(P*se-S*le-O*ae)*$e,r[12]=(x*ke-_*Ae-E*Ee)*$e,r[13]=(o*Ae-l*ke+h*Ee)*$e,r[14]=(j*te-N*he-G*ae)*$e,r[15]=(S*he-P*te+L*ae)*$e,r):null}function Ku(r,i,o){var l=i[0],h=i[1],m=i[2],_=i[3],x=i[4],E=i[5],T=i[6],S=i[7],P=i[8],L=i[9],O=i[10],N=i[11],j=i[12],G=i[13],ne=i[14],ae=i[15],te=o[0],se=o[1],he=o[2],le=o[3];return r[0]=te*l+se*x+he*P+le*j,r[1]=te*h+se*E+he*L+le*G,r[2]=te*m+se*T+he*O+le*ne,r[3]=te*_+se*S+he*N+le*ae,r[4]=(te=o[4])*l+(se=o[5])*x+(he=o[6])*P+(le=o[7])*j,r[5]=te*h+se*E+he*L+le*G,r[6]=te*m+se*T+he*O+le*ne,r[7]=te*_+se*S+he*N+le*ae,r[8]=(te=o[8])*l+(se=o[9])*x+(he=o[10])*P+(le=o[11])*j,r[9]=te*h+se*E+he*L+le*G,r[10]=te*m+se*T+he*O+le*ne,r[11]=te*_+se*S+he*N+le*ae,r[12]=(te=o[12])*l+(se=o[13])*x+(he=o[14])*P+(le=o[15])*j,r[13]=te*h+se*E+he*L+le*G,r[14]=te*m+se*T+he*O+le*ne,r[15]=te*_+se*S+he*N+le*ae,r}function wp(r,i,o){var l,h,m,_,x,E,T,S,P,L,O,N,j=o[0],G=o[1],ne=o[2];return i===r?(r[12]=i[0]*j+i[4]*G+i[8]*ne+i[12],r[13]=i[1]*j+i[5]*G+i[9]*ne+i[13],r[14]=i[2]*j+i[6]*G+i[10]*ne+i[14],r[15]=i[3]*j+i[7]*G+i[11]*ne+i[15]):(h=i[1],m=i[2],_=i[3],x=i[4],E=i[5],T=i[6],S=i[7],P=i[8],L=i[9],O=i[10],N=i[11],r[0]=l=i[0],r[1]=h,r[2]=m,r[3]=_,r[4]=x,r[5]=E,r[6]=T,r[7]=S,r[8]=P,r[9]=L,r[10]=O,r[11]=N,r[12]=l*j+x*G+P*ne+i[12],r[13]=h*j+E*G+L*ne+i[13],r[14]=m*j+T*G+O*ne+i[14],r[15]=_*j+S*G+N*ne+i[15]),r}function Yu(r,i,o){var l=o[0],h=o[1],m=o[2];return r[0]=i[0]*l,r[1]=i[1]*l,r[2]=i[2]*l,r[3]=i[3]*l,r[4]=i[4]*h,r[5]=i[5]*h,r[6]=i[6]*h,r[7]=i[7]*h,r[8]=i[8]*m,r[9]=i[9]*m,r[10]=i[10]*m,r[11]=i[11]*m,r[12]=i[12],r[13]=i[13],r[14]=i[14],r[15]=i[15],r}function Zg(r,i,o){var l=Math.sin(o),h=Math.cos(o),m=i[4],_=i[5],x=i[6],E=i[7],T=i[8],S=i[9],P=i[10],L=i[11];return i!==r&&(r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=i[3],r[12]=i[12],r[13]=i[13],r[14]=i[14],r[15]=i[15]),r[4]=m*h+T*l,r[5]=_*h+S*l,r[6]=x*h+P*l,r[7]=E*h+L*l,r[8]=T*h-m*l,r[9]=S*h-_*l,r[10]=P*h-x*l,r[11]=L*h-E*l,r}function Jf(r,i,o){var l=Math.sin(o),h=Math.cos(o),m=i[0],_=i[1],x=i[2],E=i[3],T=i[8],S=i[9],P=i[10],L=i[11];return i!==r&&(r[4]=i[4],r[5]=i[5],r[6]=i[6],r[7]=i[7],r[12]=i[12],r[13]=i[13],r[14]=i[14],r[15]=i[15]),r[0]=m*h-T*l,r[1]=_*h-S*l,r[2]=x*h-P*l,r[3]=E*h-L*l,r[8]=m*l+T*h,r[9]=_*l+S*h,r[10]=x*l+P*h,r[11]=E*l+L*h,r}function Xg(r,i){return r[0]=i[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=i[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=i[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function em(r,i,o){var l,h,m,_=o[0],x=o[1],E=o[2],T=Math.hypot(_,x,E);return T<xp?null:(_*=T=1/T,x*=T,E*=T,l=Math.sin(i),h=Math.cos(i),r[0]=_*_*(m=1-h)+h,r[1]=x*_*m+E*l,r[2]=E*_*m-x*l,r[3]=0,r[4]=_*x*m-E*l,r[5]=x*x*m+h,r[6]=E*x*m+_*l,r[7]=0,r[8]=_*E*m+x*l,r[9]=x*E*m-_*l,r[10]=E*E*m+h,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r)}Math.hypot||(Math.hypot=function(){for(var r=0,i=arguments.length;i--;)r+=arguments[i]*arguments[i];return Math.sqrt(r)});var tm=Ku;function Ep(){var r=new fo(3);return fo!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function nm(r){var i=new fo(3);return i[0]=r[0],i[1]=r[1],i[2]=r[2],i}function Qu(r){return Math.hypot(r[0],r[1],r[2])}function Wi(r,i,o){var l=new fo(3);return l[0]=r,l[1]=i,l[2]=o,l}function $a(r,i,o){return r[0]=i[0]+o[0],r[1]=i[1]+o[1],r[2]=i[2]+o[2],r}function im(r,i,o){return r[0]=i[0]-o[0],r[1]=i[1]-o[1],r[2]=i[2]-o[2],r}function Kg(r,i,o){return r[0]=i[0]*o[0],r[1]=i[1]*o[1],r[2]=i[2]*o[2],r}function Ju(r,i,o){return r[0]=Math.min(i[0],o[0]),r[1]=Math.min(i[1],o[1]),r[2]=Math.min(i[2],o[2]),r}function Oc(r,i,o){return r[0]=Math.max(i[0],o[0]),r[1]=Math.max(i[1],o[1]),r[2]=Math.max(i[2],o[2]),r}function Mo(r,i,o){return r[0]=i[0]*o,r[1]=i[1]*o,r[2]=i[2]*o,r}function od(r,i,o,l){return r[0]=i[0]+o[0]*l,r[1]=i[1]+o[1]*l,r[2]=i[2]+o[2]*l,r}function Or(r,i){var o=i[0],l=i[1],h=i[2],m=o*o+l*l+h*h;return m>0&&(m=1/Math.sqrt(m)),r[0]=i[0]*m,r[1]=i[1]*m,r[2]=i[2]*m,r}function Ao(r,i){return r[0]*i[0]+r[1]*i[1]+r[2]*i[2]}function rm(r,i,o){var l=i[0],h=i[1],m=i[2],_=o[0],x=o[1],E=o[2];return r[0]=h*E-m*x,r[1]=m*_-l*E,r[2]=l*x-h*_,r}function hi(r,i,o){var l=i[0],h=i[1],m=i[2],_=o[3]*l+o[7]*h+o[11]*m+o[15];return r[0]=(o[0]*l+o[4]*h+o[8]*m+o[12])/(_=_||1),r[1]=(o[1]*l+o[5]*h+o[9]*m+o[13])/_,r[2]=(o[2]*l+o[6]*h+o[10]*m+o[14])/_,r}function Fr(r,i,o){var l=o[0],h=o[1],m=o[2],_=i[0],x=i[1],E=i[2],T=h*E-m*x,S=m*_-l*E,P=l*x-h*_,L=h*P-m*S,O=m*T-l*P,N=l*S-h*T,j=2*o[3];return S*=j,P*=j,O*=2,N*=2,r[0]=_+(T*=j)+(L*=2),r[1]=x+S+O,r[2]=E+P+N,r}var Fc,ts=im,om=Kg,Nr=Qu;function eh(r,i,o){return r[0]=i[0]*o,r[1]=i[1]*o,r[2]=i[2]*o,r[3]=i[3]*o,r}function sm(r,i){var o=i[0],l=i[1],h=i[2],m=i[3],_=o*o+l*l+h*h+m*m;return _>0&&(_=1/Math.sqrt(_)),r[0]=o*_,r[1]=l*_,r[2]=h*_,r[3]=m*_,r}function Nc(r,i,o){var l=i[0],h=i[1],m=i[2],_=i[3];return r[0]=o[0]*l+o[4]*h+o[8]*m+o[12]*_,r[1]=o[1]*l+o[5]*h+o[9]*m+o[13]*_,r[2]=o[2]*l+o[6]*h+o[10]*m+o[14]*_,r[3]=o[3]*l+o[7]*h+o[11]*m+o[15]*_,r}function Yg(){var r=new fo(4);return fo!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function am(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function Qg(r,i,o){o*=.5;var l=i[0],h=i[1],m=i[2],_=i[3],x=Math.sin(o),E=Math.cos(o);return r[0]=l*E+_*x,r[1]=h*E+m*x,r[2]=m*E-h*x,r[3]=_*E-l*x,r}function lm(r,i,o){o*=.5;var l=i[0],h=i[1],m=i[2],_=i[3],x=Math.sin(o),E=Math.cos(o);return r[0]=l*E-m*x,r[1]=h*E+_*x,r[2]=m*E+l*x,r[3]=_*E-h*x,r}Ep(),Fc=new fo(4),fo!=Float32Array&&(Fc[0]=0,Fc[1]=0,Fc[2]=0,Fc[3]=0);var bv=sm;Ep(),Wi(1,0,0),Wi(0,1,0),Yg(),Yg(),bp();class Tp{constructor(i,o){this.pos=i,this.dir=o}intersectsPlane(i,o,l){const h=Ao(o,this.dir);if(Math.abs(h)<1e-6)return!1;const m=((i[0]-this.pos[0])*o[0]+(i[1]-this.pos[1])*o[1]+(i[2]-this.pos[2])*o[2])/h;return l[0]=this.pos[0]+this.dir[0]*m,l[1]=this.pos[1]+this.dir[1]*m,l[2]=this.pos[2]+this.dir[2]*m,!0}closestPointOnSphere(i,o,l){if(j=(O=this.pos)[0],G=O[1],ne=O[2],ae=(N=i)[0],te=N[1],se=N[2],Math.abs(j-ae)<=xp*Math.max(1,Math.abs(j),Math.abs(ae))&&Math.abs(G-te)<=xp*Math.max(1,Math.abs(G),Math.abs(te))&&Math.abs(ne-se)<=xp*Math.max(1,Math.abs(ne),Math.abs(se))||0===o)return l[0]=l[1]=l[2]=0,!1;var O,N,j,G,ne,ae,te,se;const[h,m,_]=this.dir,x=this.pos[0]-i[0],E=this.pos[1]-i[1],T=this.pos[2]-i[2],S=h*h+m*m+_*_,P=2*(x*h+E*m+T*_),L=P*P-4*S*(x*x+E*E+T*T-o*o);if(L<0){const O=Math.max(-P/2,0),N=x+h*O,j=E+m*O,G=T+_*O,ne=Math.hypot(N,j,G);return l[0]=N*o/ne,l[1]=j*o/ne,l[2]=G*o/ne,!1}{const O=(-P-Math.sqrt(L))/(2*S);if(O<0){const N=Math.hypot(x,E,T);return l[0]=x*o/N,l[1]=E*o/N,l[2]=T*o/N,!1}return l[0]=x+h*O,l[1]=E+m*O,l[2]=T+_*O,!0}}}class cm{constructor(i,o,l,h,m){this.TL=i,this.TR=o,this.BR=l,this.BL=h,this.horizon=m}static fromInvProjectionMatrix(i,o,l){const h=[-1,1,1],m=[1,1,1],_=[1,-1,1],x=[-1,-1,1],E=hi(h,h,i),T=hi(m,m,i),S=hi(_,_,i),P=hi(x,x,i);return new cm(E,T,S,P,o/l)}}class um{constructor(i,o){this.points=i,this.planes=o}static fromInvProjectionMatrix(i,o,l,h){const m=Math.pow(2,l),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const T=Nc([],E,i),S=1/T[3]/o*m;return(P=T)[0]=(L=T)[0]*(O=[S,S,h?1/T[3]:S,S])[0],P[1]=L[1]*O[1],P[2]=L[2]*O[2],P[3]=L[3]*O[3],P;var P,L,O}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const T=Or([],rm([],ts([],_[E[0]],_[E[1]]),ts([],_[E[2]],_[E[1]]))),S=-Ao(T,_[E[1]]);return T.concat(S)});return new um(_,x)}}class ur{static fromPoints(i){const o=[1/0,1/0,1/0],l=[-1/0,-1/0,-1/0];for(const h of i)Ju(o,o,h),Oc(l,l,h);return new ur(o,l)}static applyTransform(i,o){const l=i.getCorners();for(let h=0;h<l.length;++h)hi(l[h],l[h],o);return ur.fromPoints(l)}constructor(i,o){this.min=i,this.max=o,this.center=Mo([],$a([],this.min,this.max),.5)}quadrant(i){const o=[i%2==0,i<2],l=nm(this.min),h=nm(this.max);for(let m=0;m<o.length;m++)l[m]=o[m]?this.min[m]:this.center[m],h[m]=o[m]?this.center[m]:this.max[m];return h[2]=this.max[2],new ur(l,h)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}distanceZ(i){return Math.max(Math.min(this.max[2],i[2]),this.min[2])-i[2]}getCorners(){const i=this.min,o=this.max;return[[i[0],i[1],i[2]],[o[0],i[1],i[2]],[o[0],o[1],i[2]],[i[0],o[1],i[2]],[i[0],i[1],o[2]],[o[0],i[1],o[2]],[o[0],o[1],o[2]],[i[0],o[1],o[2]]]}intersects(i){const o=this.getCorners();let l=!0;for(let h=0;h<i.planes.length;h++){const m=i.planes[h];let _=0;for(let x=0;x<o.length;x++)_+=Ao(m,o[x])+m[3]>=0;if(0===_)return 0;_!==o.length&&(l=!1)}if(l)return 2;for(let h=0;h<3;h++){let m=Number.MAX_VALUE,_=-Number.MAX_VALUE;for(let x=0;x<i.points.length;x++){const E=i.points[x][h]-this.min[h];m=Math.min(m,E),_=Math.max(_,E)}if(_<0||m>this.max[h]-this.min[h])return 0}return 1}}function Dp(r,i,o,l,h,m,_,x,E){if(m&&r.queryGeometry.isAboveHorizon)return!1;m&&(E*=r.pixelToTileUnitsFactor);const T=r.tileID.canonical,S=o.projection.upVectorScale(T,o.center.lat,o.worldSize).metersToTile;for(const P of i)for(const L of P){const O=L.add(x),N=h&&o.elevation?o.elevation.exaggeration()*h.getElevationAt(O.x,O.y,!0):0,j=o.projection.projectTilePoint(O.x,O.y,T);if(N>0){const te=o.projection.upVector(T,O.x,O.y);j.x+=te[0]*S*N,j.y+=te[1]*S*N,j.z+=te[2]*S*N}const G=m?O:wv(j.x,j.y,j.z,l),ne=m?r.tilespaceRays.map(te=>sd(te,N)):r.queryGeometry.screenGeometry,ae=Nc([],[j.x,j.y,j.z,1],l);if(!_&&m?E*=ae[3]/o.cameraToCenterDistance:_&&!m&&(E*=o.cameraToCenterDistance/ae[3]),m){const te=qi((L.y/St+T.y)/(1<<T.z));E/=o.projection.pixelsPerMeter(te,1)/Jo(1,te)}if(Zu(ne,G,E))return!0}return!1}function wv(r,i,o,l){const h=Nc([],[r,i,o,1],l);return new et(h[0]/h[3],h[1]/h[3])}const hm=Wi(0,0,0),Ev=Wi(0,0,1);function sd(r,i){const o=Ep();return hm[2]=i,r.intersectsPlane(hm,Ev,o),new et(o[0],o[1])}class Jg extends Kf{}function e_(r,{width:i,height:o},l,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==i*o*l)throw new RangeError("mismatched image size")}else h=new Uint8Array(i*o*l);return r.width=i,r.height=o,r.data=h,r}function Cp(r,i,o){const{width:l,height:h}=i;l===r.width&&h===r.height||(ad(r,i,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,l),height:Math.min(r.height,h)},o),r.width=l,r.height=h,r.data=i.data)}function ad(r,i,o,l,h,m){if(0===h.width||0===h.height)return i;if(h.width>r.width||h.height>r.height||o.x>r.width-h.width||o.y>r.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>i.width||h.height>i.height||l.x>i.width-h.width||l.y>i.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const _=r.data,x=i.data;for(let E=0;E<h.height;E++){const T=((o.y+E)*r.width+o.x)*m,S=((l.y+E)*i.width+l.x)*m;for(let P=0;P<h.width*m;P++)x[S+P]=_[T+P]}return i}lt(Jg,"HeatmapBucket",{omit:["layers"]});class aa{constructor(i,o){e_(this,i,1,o)}resize(i){Cp(this,new aa(i),1)}clone(){return new aa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,o,l,h,m){ad(i,o,l,h,m,1)}}class Po{constructor(i,o){e_(this,i,4,o)}resize(i){Cp(this,new Po(i),4)}replace(i,o){o?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new Po({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,o,l,h,m){ad(i,o,l,h,m,4)}}lt(aa,"AlphaImage"),lt(Po,"RGBAImage");var th={paint:new wt({"heatmap-radius":new Ie(Re.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ie(Re.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ge(Re.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ht(Re.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ge(Re.paint_heatmap["heatmap-opacity"])})};function ld(r){const i={},o=r.resolution||256,l=r.clips?r.clips.length:1,h=r.image||new Po({width:o,height:l}),m=(_,x,E)=>{i[r.evaluationKey]=E;const T=r.expression.evaluate(i);h.data[_+x+0]=Math.floor(255*T.r/T.a),h.data[_+x+1]=Math.floor(255*T.g/T.a),h.data[_+x+2]=Math.floor(255*T.b/T.a),h.data[_+x+3]=Math.floor(255*T.a)};if(r.clips)for(let _=0,x=0;_<l;++_,x+=4*o)for(let E=0,T=0;E<o;E++,T+=4){const S=E/(o-1),{start:P,end:L}=r.clips[_];m(x,T,P*(1-S)+L*S)}else for(let _=0,x=0;_<o;_++,x+=4)m(0,x,_/(o-1));return h}var t_={paint:new wt({"hillshade-illumination-direction":new ge(Re.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ge(Re.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ge(Re.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ge(Re.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ge(Re.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ge(Re.paint_hillshade["hillshade-accent-color"])})};const Tv=ut([{name:"a_pos",components:2,type:"Int16"}],4),{members:dm}=Tv;var cd={exports:{}};function Ip(r,i,o){o=o||2;var l,h,m,_,x,E,T,S=i&&i.length,P=S?i[0]*o:r.length,L=n_(r,0,P,o,!0),O=[];if(!L||L.next===L.prev)return O;if(S&&(L=function(j,G,ne,ae){var te,se,he,le=[];for(te=0,se=G.length;te<se;te++)(he=n_(j,G[te]*ae,te<se-1?G[te+1]*ae:j.length,ae,!1))===he.next&&(he.steiner=!0),le.push(o_(he));for(le.sort(fm),te=0;te<le.length;te++)ne=Cv(le[te],ne);return ne}(r,i,L,o)),r.length>80*o){l=m=r[0],h=_=r[1];for(var N=o;N<P;N+=o)(x=r[N])<l&&(l=x),(E=r[N+1])<h&&(h=E),x>m&&(m=x),E>_&&(_=E);T=0!==(T=Math.max(m-l,_-h))?32767/T:0}return ud(L,O,o,l,h,T,0),O}function n_(r,i,o,l,h){var m,_;if(h===ih(r,i,o,l)>0)for(m=i;m<o;m+=l)_=gm(m,r[m],r[m+1],_);else for(m=o-l;m>=i;m-=l)_=gm(m,r[m],r[m+1],_);return _&&Mp(_,_.next)&&(Vc(_),_=_.next),_}function zc(r,i){if(!r)return r;i||(i=r);var o,l=r;do{if(o=!1,l.steiner||!Mp(l,l.next)&&0!==di(l.prev,l,l.next))l=l.next;else{if(Vc(l),(l=i=l.prev)===l.next)break;o=!0}}while(o||l!==i);return i}function ud(r,i,o,l,h,m,_){if(r){!_&&m&&function(S,P,L,O){var N=S;do{0===N.z&&(N.z=Sp(N.x,N.y,P,L,O)),N.prevZ=N.prev,N.nextZ=N.next,N=N.next}while(N!==S);N.prevZ.nextZ=null,N.prevZ=null,function(j){var G,ne,ae,te,se,he,le,be,Ee=1;do{for(ne=j,j=null,se=null,he=0;ne;){for(he++,ae=ne,le=0,G=0;G<Ee&&(le++,ae=ae.nextZ);G++);for(be=Ee;le>0||be>0&&ae;)0!==le&&(0===be||!ae||ne.z<=ae.z)?(te=ne,ne=ne.nextZ,le--):(te=ae,ae=ae.nextZ,be--),se?se.nextZ=te:j=te,te.prevZ=se,se=te;ne=ae}se.nextZ=null,Ee*=2}while(he>1)}(N)}(r,l,h,m);for(var x,E,T=r;r.prev!==r.next;)if(x=r.prev,E=r.next,m?i_(r,l,h,m):Dv(r))i.push(x.i/o|0),i.push(r.i/o|0),i.push(E.i/o|0),Vc(r),r=E.next,T=E.next;else if((r=E)===T){_?1===_?ud(r=pm(zc(r),i,o),i,o,l,h,m,2):2===_&&r_(r,i,o,l,h,m):ud(zc(r),i,o,l,h,m,1);break}}}function Dv(r){var i=r.prev,o=r,l=r.next;if(di(i,o,l)>=0)return!1;for(var h=i.x,m=o.x,_=l.x,x=i.y,E=o.y,T=l.y,S=h<m?h<_?h:_:m<_?m:_,P=x<E?x<T?x:T:E<T?E:T,L=h>m?h>_?h:_:m>_?m:_,O=x>E?x>T?x:T:E>T?E:T,N=l.next;N!==i;){if(N.x>=S&&N.x<=L&&N.y>=P&&N.y<=O&&ns(h,x,m,E,_,T,N.x,N.y)&&di(N.prev,N,N.next)>=0)return!1;N=N.next}return!0}function i_(r,i,o,l){var h=r.prev,m=r,_=r.next;if(di(h,m,_)>=0)return!1;for(var x=h.x,E=m.x,T=_.x,S=h.y,P=m.y,L=_.y,O=x<E?x<T?x:T:E<T?E:T,N=S<P?S<L?S:L:P<L?P:L,j=x>E?x>T?x:T:E>T?E:T,G=S>P?S>L?S:L:P>L?P:L,ne=Sp(O,N,i,o,l),ae=Sp(j,G,i,o,l),te=r.prevZ,se=r.nextZ;te&&te.z>=ne&&se&&se.z<=ae;){if(te.x>=O&&te.x<=j&&te.y>=N&&te.y<=G&&te!==h&&te!==_&&ns(x,S,E,P,T,L,te.x,te.y)&&di(te.prev,te,te.next)>=0||(te=te.prevZ,se.x>=O&&se.x<=j&&se.y>=N&&se.y<=G&&se!==h&&se!==_&&ns(x,S,E,P,T,L,se.x,se.y)&&di(se.prev,se,se.next)>=0))return!1;se=se.nextZ}for(;te&&te.z>=ne;){if(te.x>=O&&te.x<=j&&te.y>=N&&te.y<=G&&te!==h&&te!==_&&ns(x,S,E,P,T,L,te.x,te.y)&&di(te.prev,te,te.next)>=0)return!1;te=te.prevZ}for(;se&&se.z<=ae;){if(se.x>=O&&se.x<=j&&se.y>=N&&se.y<=G&&se!==h&&se!==_&&ns(x,S,E,P,T,L,se.x,se.y)&&di(se.prev,se,se.next)>=0)return!1;se=se.nextZ}return!0}function pm(r,i,o){var l=r;do{var h=l.prev,m=l.next.next;!Mp(h,m)&&Sv(h,l,l.next,m)&&nh(h,m)&&nh(m,h)&&(i.push(h.i/o|0),i.push(l.i/o|0),i.push(m.i/o|0),Vc(l),Vc(l.next),l=r=m),l=l.next}while(l!==r);return zc(l)}function r_(r,i,o,l,h,m){var _=r;do{for(var x=_.next.next;x!==_.prev;){if(_.i!==x.i&&s_(_,x)){var E=mm(_,x);return _=zc(_,_.next),E=zc(E,E.next),ud(_,i,o,l,h,m,0),void ud(E,i,o,l,h,m,0)}x=x.next}_=_.next}while(_!==r)}function fm(r,i){return r.x-i.x}function Cv(r,i){var o=function(h,m){var _,x=m,E=h.x,T=h.y,S=-1/0;do{if(T<=x.y&&T>=x.next.y&&x.next.y!==x.y){var P=x.x+(T-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(P<=E&&P>S&&(S=P,_=x.x<x.next.x?x:x.next,P===E))return _}x=x.next}while(x!==m);if(!_)return null;var L,O=_,N=_.x,j=_.y,G=1/0;x=_;do{E>=x.x&&x.x>=N&&E!==x.x&&ns(T<j?E:S,T,N,j,T<j?S:E,T,x.x,x.y)&&(L=Math.abs(T-x.y)/(E-x.x),nh(x,h)&&(L<G||L===G&&(x.x>_.x||x.x===_.x&&Iv(_,x)))&&(_=x,G=L)),x=x.next}while(x!==O);return _}(r,i);if(!o)return i;var l=mm(o,r);return zc(l,l.next),zc(o,o.next)}function Iv(r,i){return di(r.prev,r,i.prev)<0&&di(i.next,r,r.next)<0}function Sp(r,i,o,l,h){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-o)*h|0)|r<<8))|r<<4))|r<<2))|r<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-l)*h|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function o_(r){var i=r,o=r;do{(i.x<o.x||i.x===o.x&&i.y<o.y)&&(o=i),i=i.next}while(i!==r);return o}function ns(r,i,o,l,h,m,_,x){return(h-_)*(i-x)>=(r-_)*(m-x)&&(r-_)*(l-x)>=(o-_)*(i-x)&&(o-_)*(m-x)>=(h-_)*(l-x)}function s_(r,i){return r.next.i!==i.i&&r.prev.i!==i.i&&!function(o,l){var h=o;do{if(h.i!==o.i&&h.next.i!==o.i&&h.i!==l.i&&h.next.i!==l.i&&Sv(h,h.next,o,l))return!0;h=h.next}while(h!==o);return!1}(r,i)&&(nh(r,i)&&nh(i,r)&&function(o,l){var h=o,m=!1,_=(o.x+l.x)/2,x=(o.y+l.y)/2;do{h.y>x!=h.next.y>x&&h.next.y!==h.y&&_<(h.next.x-h.x)*(x-h.y)/(h.next.y-h.y)+h.x&&(m=!m),h=h.next}while(h!==o);return m}(r,i)&&(di(r.prev,r,i.prev)||di(r,i.prev,i))||Mp(r,i)&&di(r.prev,r,r.next)>0&&di(i.prev,i,i.next)>0)}function di(r,i,o){return(i.y-r.y)*(o.x-i.x)-(i.x-r.x)*(o.y-i.y)}function Mp(r,i){return r.x===i.x&&r.y===i.y}function Sv(r,i,o,l){var h=Ap(di(r,i,o)),m=Ap(di(r,i,l)),_=Ap(di(o,l,r)),x=Ap(di(o,l,i));return h!==m&&_!==x||!(0!==h||!Bc(r,o,i))||!(0!==m||!Bc(r,l,i))||!(0!==_||!Bc(o,r,l))||!(0!==x||!Bc(o,i,l))}function Bc(r,i,o){return i.x<=Math.max(r.x,o.x)&&i.x>=Math.min(r.x,o.x)&&i.y<=Math.max(r.y,o.y)&&i.y>=Math.min(r.y,o.y)}function Ap(r){return r>0?1:r<0?-1:0}function nh(r,i){return di(r.prev,r,r.next)<0?di(r,i,r.next)>=0&&di(r,r.prev,i)>=0:di(r,i,r.prev)<0||di(r,r.next,i)<0}function mm(r,i){var o=new Pp(r.i,r.x,r.y),l=new Pp(i.i,i.x,i.y),h=r.next,m=i.prev;return r.next=i,i.prev=r,o.next=h,h.prev=o,l.next=o,o.prev=l,m.next=l,l.prev=m,l}function gm(r,i,o,l){var h=new Pp(r,i,o);return l?(h.next=l.next,h.prev=l,l.next.prev=h,l.next=h):(h.prev=h,h.next=h),h}function Vc(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Pp(r,i,o){this.i=r,this.x=i,this.y=o,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ih(r,i,o,l){for(var h=0,m=i,_=o-l;m<o;m+=l)h+=(r[_]-r[m])*(r[m+1]+r[_+1]),_=m;return h}function Lp(r,i,o,l,h){_m(r,i,o||0,l||r.length-1,h||ym)}function _m(r,i,o,l,h){for(;l>o;){if(l-o>600){var m=l-o+1,_=i-o+1,x=Math.log(m),E=.5*Math.exp(2*x/3),T=.5*Math.sqrt(x*E*(m-E)/m)*(_-m/2<0?-1:1);_m(r,i,Math.max(o,Math.floor(i-_*E/m+T)),Math.min(l,Math.floor(i+(m-_)*E/m+T)),h)}var S=r[i],P=o,L=l;for(jc(r,o,i),h(r[l],S)>0&&jc(r,o,l);P<L;){for(jc(r,P,L),P++,L--;h(r[P],S)<0;)P++;for(;h(r[L],S)>0;)L--}0===h(r[o],S)?jc(r,o,L):jc(r,++L,l),L<=i&&(o=L+1),i<=L&&(l=L-1)}}function jc(r,i,o){var l=r[i];r[i]=r[o],r[o]=l}function ym(r,i){return r<i?-1:r>i?1:0}function hd(r,i){const o=r.length;if(o<=1)return[r];const l=[];let h,m;for(let _=0;_<o;_++){const x=hn(r[_]);0!==x&&(r[_].area=Math.abs(x),void 0===m&&(m=x<0),m===x<0?(h&&l.push(h),h=[r[_]]):h.push(r[_]))}if(h&&l.push(h),i>1)for(let _=0;_<l.length;_++)l[_].length<=i||(Lp(l[_],i,1,l[_].length-1,dd),l[_]=l[_].slice(0,i));return l}function dd(r,i){return i.area-r.area}function vm(r,i,o){const l=o.patternDependencies;let h=!1;for(const m of i){const _=m.paint.get(`${r}-pattern`);_.isConstant()||(h=!0);const x=_.constantOr(null);x&&(h=!0,l[x]=!0)}return h}function kp(r,i,o,l,h){const m=h.patternDependencies;for(const _ of i){const x=_.paint.get(`${r}-pattern`).value;if("constant"!==x.kind){let E=x.evaluate({zoom:l},o,{},h.availableImages);E=E&&E.name?E.name:E,m[E]=!0,o.patterns[_.id]=E}}return o}cd.exports=Ip,cd.exports.default=Ip,Ip.deviation=function(r,i,o,l){var h=i&&i.length,m=Math.abs(ih(r,0,h?i[0]*o:r.length,o));if(h)for(var _=0,x=i.length;_<x;_++)m-=Math.abs(ih(r,i[_]*o,_<x-1?i[_+1]*o:r.length,o));var E=0;for(_=0;_<l.length;_+=3){var T=l[_]*o,S=l[_+1]*o,P=l[_+2]*o;E+=Math.abs((r[T]-r[P])*(r[S+1]-r[T+1])-(r[T]-r[S])*(r[P+1]-r[T+1]))}return 0===m&&0===E?0:Math.abs((E-m)/m)},Ip.flatten=function(r){for(var i=r[0][0].length,o={vertices:[],holes:[],dimensions:i},l=0,h=0;h<r.length;h++){for(var m=0;m<r[h].length;m++)for(var _=0;_<i;_++)o.vertices.push(r[h][m][_]);h>0&&o.holes.push(l+=r[h-1].length)}return o};class Rp{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(o=>o.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new pn,this.indexArray=new cr,this.indexArray2=new gr,this.programConfigurations=new Rl(i.layers,i.zoom),this.segments=new ai,this.segments2=new ai,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.projection=i.projection}populate(i,o,l,h){this.hasPattern=vm("fill",this.layers,o);const m=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:x,id:E,index:T,sourceLayerIndex:S}of i){const P=this.layers[0]._featureFilter.needGeometry,L=Ds(x,P);if(!this.layers[0]._featureFilter.filter(new _e(this.zoom),L,l))continue;const O=m?m.evaluate(L,{},l,o.availableImages):void 0,N={id:E,properties:x.properties,type:x.type,sourceLayerIndex:S,index:T,geometry:P?L.geometry:oa(x,l,h),patterns:{},sortKey:O};_.push(N)}m&&_.sort((x,E)=>x.sortKey-E.sortKey);for(const x of _){const{geometry:E,index:T,sourceLayerIndex:S}=x;if(this.hasPattern){const P=kp("fill",this.layers,x,this.zoom,o);this.patternFeatures.push(P)}else this.addFeature(x,E,T,l,{},o.availableImages);o.featureIndex.insert(i[T].feature,E,T,S,this.index)}}update(i,o,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,o,this.stateDependentLayers,l,h)}addFeatures(i,o,l,h,m){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,o,l,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,dm),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,o,l,h,m,_=[]){for(const x of hd(o,500)){let E=0;for(const N of x)E+=N.length;const T=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),S=T.vertexLength,P=[],L=[];for(const N of x){if(0===N.length)continue;N!==x[0]&&L.push(P.length/2);const j=this.segments2.prepareSegment(N.length,this.layoutVertexArray,this.indexArray2),G=j.vertexLength;this.layoutVertexArray.emplaceBack(N[0].x,N[0].y),this.indexArray2.emplaceBack(G+N.length-1,G),P.push(N[0].x),P.push(N[0].y);for(let ne=1;ne<N.length;ne++)this.layoutVertexArray.emplaceBack(N[ne].x,N[ne].y),this.indexArray2.emplaceBack(G+ne-1,G+ne),P.push(N[ne].x),P.push(N[ne].y);j.vertexLength+=N.length,j.primitiveLength+=N.length}const O=cd.exports(P,L);for(let N=0;N<O.length;N+=3)this.indexArray.emplaceBack(S+O[N],S+O[N+1],S+O[N+2]);T.vertexLength+=E,T.primitiveLength+=O.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,l,m,_,h)}}lt(Rp,"FillBucket",{omit:["layers","patternFeatures"]});const Mv=new wt({"fill-sort-key":new Ie(Re.layout_fill["fill-sort-key"])});var a_={paint:new wt({"fill-antialias":new ge(Re.paint_fill["fill-antialias"]),"fill-opacity":new Ie(Re.paint_fill["fill-opacity"]),"fill-color":new Ie(Re.paint_fill["fill-color"]),"fill-outline-color":new Ie(Re.paint_fill["fill-outline-color"]),"fill-translate":new ge(Re.paint_fill["fill-translate"]),"fill-translate-anchor":new ge(Re.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ie(Re.paint_fill["fill-pattern"])}),layout:Mv};const xm=ut([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Op=ut([{name:"a_centroid_pos",components:2,type:"Uint16"}]),bm=ut([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Uc}=xm;var Fp={},Av=et,Pv=rh;function rh(r,i,o,l,h){this.properties={},this.extent=o,this.type=0,this._pbf=r,this._geometry=-1,this._keys=l,this._values=h,r.readFields(wm,this,i)}function wm(r,i,o){1==r?i.id=o.readVarint():2==r?function(l,h){for(var m=l.readVarint()+l.pos;l.pos<m;){var _=h._keys[l.readVarint()],x=h._values[l.readVarint()];h.properties[_]=x}}(o,i):3==r?i.type=o.readVarint():4==r&&(i._geometry=o.pos)}function Lv(r){for(var i,o,l=0,h=0,m=r.length,_=m-1;h<m;_=h++)l+=((o=r[_]).x-(i=r[h]).x)*(i.y+o.y);return l}rh.types=["Unknown","Point","LineString","Polygon"],rh.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var i,o=r.readVarint()+r.pos,l=1,h=0,m=0,_=0,x=[];r.pos<o;){if(h<=0){var E=r.readVarint();l=7&E,h=E>>3}if(h--,1===l||2===l)m+=r.readSVarint(),_+=r.readSVarint(),1===l&&(i&&x.push(i),i=[]),i.push(new Av(m,_));else{if(7!==l)throw new Error("unknown command "+l);i&&i.push(i[0].clone())}}return i&&x.push(i),x},rh.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var i=r.readVarint()+r.pos,o=1,l=0,h=0,m=0,_=1/0,x=-1/0,E=1/0,T=-1/0;r.pos<i;){if(l<=0){var S=r.readVarint();o=7&S,l=S>>3}if(l--,1===o||2===o)(h+=r.readSVarint())<_&&(_=h),h>x&&(x=h),(m+=r.readSVarint())<E&&(E=m),m>T&&(T=m);else if(7!==o)throw new Error("unknown command "+o)}return[_,E,x,T]},rh.prototype.toGeoJSON=function(r,i,o){var l,h,m=this.extent*Math.pow(2,o),_=this.extent*r,x=this.extent*i,E=this.loadGeometry(),T=rh.types[this.type];function S(O){for(var N=0;N<O.length;N++){var j=O[N];O[N]=[360*(j.x+_)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(j.y+x)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var P=[];for(l=0;l<E.length;l++)P[l]=E[l][0];S(E=P);break;case 2:for(l=0;l<E.length;l++)S(E[l]);break;case 3:for(E=function(O){var N=O.length;if(N<=1)return[O];for(var j,G,ne=[],ae=0;ae<N;ae++){var te=Lv(O[ae]);0!==te&&(void 0===G&&(G=te<0),G===te<0?(j&&ne.push(j),j=[O[ae]]):j.push(O[ae]))}return j&&ne.push(j),ne}(E),l=0;l<E.length;l++)for(h=0;h<E[l].length;h++)S(E[l][h])}1===E.length?E=E[0]:T="Multi"+T;var L={type:"Feature",geometry:{type:T,coordinates:E},properties:this.properties};return"id"in this&&(L.id=this.id),L};var l_=Pv,pd=Np;function Np(r,i){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(c_,this,i),this.length=this._features.length}function c_(r,i,o){15===r?i.version=o.readVarint():1===r?i.name=o.readString():5===r?i.extent=o.readVarint():2===r?i._features.push(o.pos):3===r?i._keys.push(o.readString()):4===r&&i._values.push(function(l){for(var h=null,m=l.readVarint()+l.pos;l.pos<m;){var _=l.readVarint()>>3;h=1===_?l.readString():2===_?l.readFloat():3===_?l.readDouble():4===_?l.readVarint64():5===_?l.readVarint():6===_?l.readSVarint():7===_?l.readBoolean():null}return h}(o))}Np.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var i=this._pbf.readVarint()+this._pbf.pos;return new l_(this._pbf,i,this.extent,this._keys,this._values)};var u_=pd;function h_(r,i,o){if(3===r){var l=new u_(o,o.readVarint()+o.pos);l.length&&(i[l.name]=l)}}var zp=Fp.VectorTile=function(r,i){this.layers=r.readFields(h_,{},i)},Bp=Fp.VectorTileFeature=Pv;function Vp(r,i,o,l){const h=[],m=0===l?(_,x,E,T,S,P)=>{_.push(new et(P,E+(P-x)/(T-x)*(S-E)))}:(_,x,E,T,S,P)=>{_.push(new et(x+(P-E)/(S-E)*(T-x),P))};for(const _ of r){const x=[];for(const E of _){if(E.length<=2)continue;const T=[];for(let L=0;L<E.length-1;L++){const O=E[L].x,N=E[L].y,j=E[L+1].x,G=E[L+1].y,ne=0===l?O:N,ae=0===l?j:G;ne<i?ae>i&&m(T,O,N,j,G,i):ne>o?ae<o&&m(T,O,N,j,G,o):T.push(E[L]),ae<i&&ne>=i&&m(T,O,N,j,G,i),ae>o&&ne<=o&&m(T,O,N,j,G,o)}let S=E[E.length-1];const P=0===l?S.x:S.y;P>=i&&P<=o&&T.push(S),T.length&&(S=T[T.length-1],T[0].x===S.x&&T[0].y===S.y||T.push(T[0]),x.push(T))}x.length&&h.push(x)}return h}Fp.VectorTileLayer=pd;const kv=Bp.types,Rv=Math.pow(2,13);function fd(r,i,o,l,h,m,_,x){r.emplaceBack((i<<1)+_,(o<<1)+m,(Math.floor(l*Rv)<<1)+h,Math.round(x))}function is(r,i,o){r.emplaceBack(i.x,i.y,i.z,16384*o[0],16384*o[1],16384*o[2])}class oh{constructor(){this.acc=new et(0,0),this.polyCount=[]}startRing(i){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new et(i.x,i.y),this.max=new et(i.x,i.y))}append(i,o){this.currentPolyCount.edges++,this.acc._add(i);const l=this.min,h=this.max;i.x<l.x?l.x=i.x:i.x>h.x&&(h.x=i.x),i.y<l.y?l.y=i.y:i.y>h.y&&(h.y=i.y),((0===i.x||i.x===St)&&i.x===o.x)!=((0===i.y||i.y===St)&&i.y===o.y)&&this.processBorderOverlap(i,o),o.x<0!=i.x<0&&this.addBorderIntersection(0,dn(o.y,i.y,(0-o.x)/(i.x-o.x))),o.x>St!=i.x>St&&this.addBorderIntersection(1,dn(o.y,i.y,(St-o.x)/(i.x-o.x))),o.y<0!=i.y<0&&this.addBorderIntersection(2,dn(o.x,i.x,(0-o.y)/(i.y-o.y))),o.y>St!=i.y>St&&this.addBorderIntersection(3,dn(o.x,i.x,(St-o.y)/(i.y-o.y)))}addBorderIntersection(i,o){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const l=this.borders[i];o<l[0]&&(l[0]=o),o>l[1]&&(l[1]=o)}processBorderOverlap(i,o){if(i.x===o.x){if(i.y===o.y)return;const l=0===i.x?0:1;this.addBorderIntersection(l,o.y),this.addBorderIntersection(l,i.y)}else{const l=0===i.y?2:3;this.addBorderIntersection(l,o.x),this.addBorderIntersection(l,i.x)}}centroid(){const i=this.polyCount.reduce((o,l)=>o+l.edges,0);return 0!==i?this.acc.div(i)._round():new et(0,0)}span(){return new et(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((i,o)=>i+ +(o[0]!==Number.MAX_VALUE),0)}}class md{constructor(i){this.zoom=i.zoom,this.canonical=i.canonical,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(o=>o.id),this.index=i.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=i.projection,this.layoutVertexArray=new Cn,this.centroidVertexArray=new sv,this.indexArray=new cr,this.programConfigurations=new Rl(i.layers,i.zoom),this.segments=new ai,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.enableTerrain=i.enableTerrain}populate(i,o,l,h){this.features=[],this.hasPattern=vm("fill-extrusion",this.layers,o),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(m){const _=Math.exp(Math.PI*(1-m.y/(1<<m.z)*2));return 80150034*_/(_*_+1)/St/(1<<m.z)}(l),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:m,id:_,index:x,sourceLayerIndex:E}of i){const T=this.layers[0]._featureFilter.needGeometry,S=Ds(m,T);if(!this.layers[0]._featureFilter.filter(new _e(this.zoom),S,l))continue;const P={id:_,sourceLayerIndex:E,index:x,geometry:T?S.geometry:oa(m,l,h),properties:m.properties,type:m.type,patterns:{}},L=this.layoutVertexArray.length;this.hasPattern?this.features.push(kp("fill-extrusion",this.layers,P,this.zoom,o)):this.addFeature(P,P.geometry,x,l,{},o.availableImages,h),o.featureIndex.insert(m,P.geometry,x,E,this.index,L)}this.sortBorders()}addFeatures(i,o,l,h,m){for(const _ of this.features){const{geometry:x}=_;this.addFeature(_,x,_.index,o,l,h,m)}this.sortBorders()}update(i,o,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,o,this.stateDependentLayers,l,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Uc),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=i.createVertexBuffer(this.layoutVertexExtArray,bm.members,!0))),this.programConfigurations.upload(i),this.uploaded=!0}uploadCentroid(i){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,Op.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,o,l,h,m,_,x){const E=[new et(0,0),new et(St,St)],T=x.projection,S="globe"===T.name,P=this.enableTerrain&&!S?new oh:null,L="Polygon"===kv[i.type];S&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new $n);const O=hd(o,500);for(let ne=O.length-1;ne>=0;ne--){const ae=O[ne];(0===ae.length||(N=ae[0]).every(te=>te.x<=0)||N.every(te=>te.x>=St)||N.every(te=>te.y<=0)||N.every(te=>te.y>=St))&&O.splice(ne,1)}var N;let j;if(S)j=p_(O,E,h);else{j=[];for(const ne of O)j.push({polygon:ne,bounds:E})}const G=L?this.edgeRadius:0;for(const{polygon:ne,bounds:ae}of j){let te=0,se=0;for(const le of ne)L&&!le[0].equals(le[le.length-1])&&le.push(le[0]),se+=L?le.length-1:le.length;const he=this.segments.prepareSegment((L?5:4)*se,this.layoutVertexArray,this.indexArray);if(L){const le=[],be=[];te=he.vertexLength;for(const ke of ne){let Xe,Ae;ke.length&&ke!==ne[0]&&be.push(le.length/2),Xe=ke[1].sub(ke[0])._perp()._unit();for(let Oe=1;Oe<ke.length;Oe++){const ze=ke[Oe],$e=ke[Oe===ke.length-1?1:Oe+1];let{x:Ke,y:Me}=ze;if(G){Ae=$e.sub(ze)._perp()._unit();const nt=Xe.add(Ae)._unit(),Dt=G*Math.min(4,1/(Xe.x*nt.x+Xe.y*nt.y));Ke+=Dt*nt.x,Me+=Dt*nt.y,Xe=Ae}fd(this.layoutVertexArray,Ke,Me,0,0,1,1,0),he.vertexLength++,le.push(ze.x,ze.y),S&&is(this.layoutVertexExtArray,T.projectTilePoint(Ke,Me,h),T.upVector(h,Ke,Me))}}const Ee=cd.exports(le,be);for(let ke=0;ke<Ee.length;ke+=3)this.indexArray.emplaceBack(te+Ee[ke],te+Ee[ke+2],te+Ee[ke+1]),he.primitiveLength++}for(const le of ne){P&&le.length&&P.startRing(le[0]);let be,Ee,ke,Xe=le.length>4&&zv(le[le.length-2],le[0],le[1]),Ae=G?y1(le[le.length-2],le[0],le[1],G):0;Ee=le[1].sub(le[0])._perp()._unit();let Oe=!0;for(let ze=1,$e=0;ze<le.length;ze++){let Ke=le[ze-1],Me=le[ze];const nt=le[ze===le.length-1?1:ze+1];if(P&&L&&P.currentPolyCount.top++,Nv(Me,Ke,ae)){G&&(Ee=nt.sub(Me)._perp()._unit(),Oe=!Oe);continue}P&&P.append(Me,Ke);const Dt=Me.sub(Ke)._perp(),ot=Dt.x/(Math.abs(Dt.x)+Math.abs(Dt.y)),dt=Dt.y>0?1:0,tt=Ke.dist(Me);if($e+tt>32768&&($e=0),G){ke=nt.sub(Me)._perp()._unit();let Kt=Fv(Ke,Me,nt,Ov(Ee,ke),G);isNaN(Kt)&&(Kt=0);const Mt=Me.sub(Ke)._unit();Ke=Ke.add(Mt.mult(Ae))._round(),Me=Me.add(Mt.mult(-Kt))._round(),Ae=Kt,Ee=ke}const At=he.vertexLength,tn=le.length>4&&zv(Ke,Me,nt);let cn=Em($e,Xe,Oe);if(fd(this.layoutVertexArray,Ke.x,Ke.y,ot,dt,0,0,cn),fd(this.layoutVertexArray,Ke.x,Ke.y,ot,dt,0,1,cn),$e+=tt,cn=Em($e,tn,!Oe),Xe=tn,fd(this.layoutVertexArray,Me.x,Me.y,ot,dt,0,0,cn),fd(this.layoutVertexArray,Me.x,Me.y,ot,dt,0,1,cn),he.vertexLength+=4,this.indexArray.emplaceBack(At+0,At+1,At+2),this.indexArray.emplaceBack(At+1,At+3,At+2),he.primitiveLength+=2,G){const Kt=te+(1===ze?le.length-2:ze-2),Mt=1===ze?te:Kt+1;if(this.indexArray.emplaceBack(At+1,Kt,At+3),this.indexArray.emplaceBack(Kt,Mt,At+3),he.primitiveLength+=2,void 0===be&&(be=At),!Nv(nt,le[ze],ae)){const An=ze===le.length-1?be:he.vertexLength;this.indexArray.emplaceBack(At+2,At+3,An),this.indexArray.emplaceBack(At+3,An+1,An),this.indexArray.emplaceBack(At+3,Mt,An+1),he.primitiveLength+=3}Oe=!Oe}if(S){const Kt=this.layoutVertexExtArray,Mt=T.projectTilePoint(Ke.x,Ke.y,h),An=T.projectTilePoint(Me.x,Me.y,h),Ft=T.upVector(h,Ke.x,Ke.y),nn=T.upVector(h,Me.x,Me.y);is(Kt,Mt,Ft),is(Kt,Mt,Ft),is(Kt,An,nn),is(Kt,An,nn)}}L&&(te+=le.length-1)}}if(P&&P.polyCount.length>0){if(P.borders){P.vertexArrayOffset=this.centroidVertexArray.length;const ne=P.borders,ae=this.featuresOnBorder.push(P)-1;for(let te=0;te<4;te++)ne[te][0]!==Number.MAX_VALUE&&this.borders[te].push(ae)}this.encodeCentroid(P.borders?void 0:P.centroid(),P)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,l,m,_,h)}sortBorders(){for(let i=0;i<4;i++)this.borders[i].sort((o,l)=>this.featuresOnBorder[o].borders[i][0]-this.featuresOnBorder[l].borders[i][0])}encodeCentroid(i,o,l=!0){let h,m;if(i)if(0!==i.y){const x=o.span()._mult(this.tileToMeter);h=(Math.max(i.x,1)<<3)+Math.min(7,Math.round(x.x/10)),m=(Math.max(i.y,1)<<3)+Math.min(7,Math.round(x.y/10))}else h=Math.ceil(7*(i.x+450)),m=0;else h=0,m=+l;let _=l?this.centroidVertexArray.length:o.vertexArrayOffset;for(const x of o.polyCount){l&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*x.edges+x.top);for(let E=0;E<x.top;E++)this.centroidVertexArray.emplace(_++,h,m);for(let E=0;E<2*x.edges;E++)this.centroidVertexArray.emplace(_++,0,m),this.centroidVertexArray.emplace(_++,h,m)}}}function Ov(r,i){const o=r.add(i)._unit();return r.x*o.x+r.y*o.y}function y1(r,i,o,l){const h=i.sub(r)._perp()._unit(),m=o.sub(i)._perp()._unit();return Fv(r,i,o,Ov(h,m),l)}function Fv(r,i,o,l,h){const m=Math.sqrt(1-l*l);return Math.min(r.dist(i)/3,i.dist(o)/3,h*m/l)}function Nv(r,i,o){return r.x<o[0].x&&i.x<o[0].x||r.x>o[1].x&&i.x>o[1].x||r.y<o[0].y&&i.y<o[0].y||r.y>o[1].y&&i.y>o[1].y}function zv(r,i,o){if(r.x<0||r.x>=St||i.x<0||i.x>=St||o.x<0||o.x>=St)return!1;const l=o.sub(i),h=l.perp(),m=r.sub(i);return(l.x*m.x+l.y*m.y)/Math.sqrt((l.x*l.x+l.y*l.y)*(m.x*m.x+m.y*m.y))>-.866&&h.x*m.x+h.y*m.y<0}function Em(r,i,o){const l=i?2|r:-3&r;return o?1|l:-2&l}function d_(){const r=Math.PI/32,i=Math.tan(r),o=fp;return o*Math.sqrt(1+2*i*i)-o}function p_(r,i,o){const l=1<<o.z,h=Bt(o.x/l),m=Bt((o.x+1)/l),_=qi(o.y/l),x=qi((o.y+1)/l);return function(E,T,S,P,L=0,O){const N=[];if(!E.length||!S||!P)return N;const j=(le,be)=>{for(const Ee of le)N.push({polygon:Ee,bounds:be})},G=Math.ceil(Math.log2(S)),ne=Math.ceil(Math.log2(P)),ae=G-ne,te=[];for(let le=0;le<Math.abs(ae);le++)te.push(ae>0?0:1);for(let le=0;le<Math.min(G,ne);le++)te.push(0),te.push(1);let se=E;if(se=Vp(se,T[0].y-L,T[1].y+L,1),se=Vp(se,T[0].x-L,T[1].x+L,0),!se.length)return N;const he=[];for(te.length?he.push({polygons:se,bounds:T,depth:0}):j(se,T);he.length;){const le=he.pop(),be=le.depth,Ee=te[be],ke=le.bounds[0],Xe=le.bounds[1],Ae=0===Ee?ke.x:ke.y,Oe=0===Ee?Xe.x:Xe.y,ze=O?O(Ee,Ae,Oe):.5*(Ae+Oe),$e=Vp(le.polygons,Ae-L,ze+L,Ee),Ke=Vp(le.polygons,ze-L,Oe+L,Ee);if($e.length){const Me=[ke,new et(0===Ee?ze:Xe.x,1===Ee?ze:Xe.y)];te.length>be+1?he.push({polygons:$e,bounds:Me,depth:be+1}):j($e,Me)}if(Ke.length){const Me=[new et(0===Ee?ze:ke.x,1===Ee?ze:ke.y),Xe];te.length>be+1?he.push({polygons:Ke,bounds:Me,depth:be+1}):j(Ke,Me)}}return N}(r,i,Math.ceil((m-h)/11.25),Math.ceil((_-x)/11.25),1,(E,T,S)=>{if(0===E)return.5*(T+S);{const P=qi((o.y+T/St)/l);return(Jr(.5*(qi((o.y+S/St)/l)+P))*l-o.y)*St}})}lt(md,"FillExtrusionBucket",{omit:["layers","features"]}),lt(oh,"PartMetadata");const Bv=new wt({"fill-extrusion-edge-radius":new ge(Re["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Vv={paint:new wt({"fill-extrusion-opacity":new ge(Re["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ie(Re["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ge(Re["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ge(Re["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ie(Re["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ie(Re["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ie(Re["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ge(Re["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new ge(Re["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new ge(Re["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:Bv};function jp(r,i,o){var l=2*Math.PI*6378137/256/Math.pow(2,o);return[r*l-2*Math.PI*6378137/2,i*l-2*Math.PI*6378137/2]}class rs{constructor(i,o,l){this.z=i,this.x=o,this.y=l,this.key=ah(0,i,i,o,l)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,o){const l=(_=this.y,x=this.z,E=jp(256*(m=this.x),256*(_=Math.pow(2,x)-_-1),x),T=jp(256*(m+1),256*(_+1),x),E[0]+","+E[1]+","+T[0]+","+T[1]),h=function(m,_,x){let E,T="";for(let S=m;S>0;S--)E=1<<S-1,T+=(_&E?1:0)+(x&E?2:0);return T}(this.z,this.x,this.y);var m,_,x,E,T;return i[(this.x+this.y)%i.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===o?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",l)}toString(){return`${this.z}/${this.x}/${this.y}`}}class sh{constructor(i,o){this.wrap=i,this.canonical=o,this.key=ah(i,o.z,o.z,o.x,o.y)}}class yr{constructor(i,o,l,h,m){this.overscaledZ=i,this.wrap=o,this.canonical=new rs(l,+h,+m),this.key=0===o&&i===l?this.canonical.key:ah(o,i,l,h,m)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){const o=this.canonical.z-i;return i>this.canonical.z?new yr(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new yr(i,this.wrap,i,this.canonical.x>>o,this.canonical.y>>o)}calculateScaledKey(i,o=!0){if(this.overscaledZ===i&&o)return this.key;if(i>this.canonical.z)return ah(this.wrap*+o,i,this.canonical.z,this.canonical.x,this.canonical.y);{const l=this.canonical.z-i;return ah(this.wrap*+o,i,i,this.canonical.x>>l,this.canonical.y>>l)}}isChildOf(i){if(i.wrap!==this.wrap)return!1;const o=this.canonical.z-i.canonical.z;return 0===i.overscaledZ||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>o&&i.canonical.y===this.canonical.y>>o}children(i){if(this.overscaledZ>=i)return[new yr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const o=this.canonical.z+1,l=2*this.canonical.x,h=2*this.canonical.y;return[new yr(o,this.wrap,o,l,h),new yr(o,this.wrap,o,l+1,h),new yr(o,this.wrap,o,l,h+1),new yr(o,this.wrap,o,l+1,h+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new yr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new yr(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new sh(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function ah(r,i,o,l,h){const m=1<<Math.min(o,22);let _=m*(h%m)+l%m;return r&&o<22&&(_+=m*m*((r<0?-2*r-1:2*r)%(1<<2*(22-o)))),16*(32*_+o)+(i-o)}lt(rs,"CanonicalTileID"),lt(yr,"OverscaledTileID",{omit:["projMatrix"]});class $c extends et{constructor(i,o,l){super(i,o),this.z=l}}function Up(r,i){return r.x*i.x+r.y*i.y}function jv(r,i){if(1===r.length){let o=0;const l=i[o++];let h;for(;!h||l.equals(h);)if(h=i[o++],!h)return 1/0;for(;o<i.length;o++){const m=i[o],_=r[0],x=h.sub(l),E=m.sub(l),T=_.sub(l),S=Up(x,x),P=Up(x,E),L=Up(E,E),O=Up(T,x),N=Up(T,E),j=S*L-P*P,G=(L*O-P*N)/j,ne=(S*N-P*O)/j,ae=l.z*(1-G-ne)+h.z*G+m.z*ne;if(isFinite(ae))return ae}return 1/0}{let o=1/0;for(const l of i)o=Math.min(o,l.z);return o}}function Uv(r,i,o,l,h,m,_,x){const E=_*h.getElevationAt(r,i,!0,!0),T=0!==m[0],S=T?0===m[1]?_*(m[0]/7-450):_*function(P,L,O){const N=Math.floor(L[0]/8),j=Math.floor(L[1]/8),G=10*(L[0]-8*N),ne=10*(L[1]-8*j),ae=P.getElevationAt(N,j,!0,!0),te=P.getMeterToDEM(O),se=Math.floor(.5*(G*te-1)),he=Math.floor(.5*(ne*te-1)),le=P.tileCoordToPixel(N,j),be=2*se+1,Ee=2*he+1,ke=(Dt=be,ot=Ee,[(Ke=P).getElevationAtPixel(Me=le.x-se,nt=le.y-he,!0),Ke.getElevationAtPixel(Me+ot,nt,!0),Ke.getElevationAtPixel(Me,nt+ot,!0),Ke.getElevationAtPixel(Me+Dt,nt+ot,!0)]),Xe=Math.abs(ke[0]-ke[1]),Ae=Math.abs(ke[2]-ke[3]),Oe=Math.abs(ke[0]-ke[2])+Math.abs(ke[1]-ke[3]),ze=Math.min(.25,.5*te*(Xe+Ae)/be),$e=Math.min(.25,.5*te*Oe/Ee);var Ke,Me,nt,Dt,ot;return ae+Math.max(ze*G,$e*ne)}(h,m,x):E;return{base:E+(0===o)?-1:o,top:T?Math.max(S+l,E+o+2):E+l}}const Tm=ut([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Dm}=Tm,v1=ut([{name:"a_packed",components:4,type:"Float32"}]),{members:x1}=v1,f_=Bp.types,$v=Math.cos(Math.PI/180*37.5);class $p{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(o=>o.id),this.index=i.index,this.projection=i.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(o=>{this.gradients[o.id]={}}),this.layoutVertexArray=new Hi,this.layoutVertexArray2=new Qr,this.indexArray=new cr,this.programConfigurations=new Rl(i.layers,i.zoom),this.segments=new ai,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(i,o,l,h){this.hasPattern=vm("line",this.layers,o);const m=this.layers[0].layout.get("line-sort-key"),_=[];for(const{feature:S,id:P,index:L,sourceLayerIndex:O}of i){const N=this.layers[0]._featureFilter.needGeometry,j=Ds(S,N);if(!this.layers[0]._featureFilter.filter(new _e(this.zoom),j,l))continue;const G=m?m.evaluate(j,{},l):void 0,ne={id:P,properties:S.properties,type:S.type,sourceLayerIndex:O,index:L,geometry:N?j.geometry:oa(S,l,h),patterns:{},sortKey:G};_.push(ne)}m&&_.sort((S,P)=>S.sortKey-P.sortKey);const{lineAtlas:x,featureIndex:E}=o,T=this.addConstantDashes(x);for(const S of _){const{geometry:P,index:L,sourceLayerIndex:O}=S;if(T&&this.addFeatureDashes(S,x),this.hasPattern){const N=kp("line",this.layers,S,this.zoom,o);this.patternFeatures.push(N)}else this.addFeature(S,P,L,l,x.positions,o.availableImages);E.insert(i[L].feature,P,L,O,this.index)}}addConstantDashes(i){let o=!1;for(const l of this.layers){const h=l.paint.get("line-dasharray").value,m=l.layout.get("line-cap").value;if("constant"!==h.kind||"constant"!==m.kind)o=!0;else{const _=m.value,x=h.value;if(!x)continue;i.addDash(x,_)}}return o}addFeatureDashes(i,o){const l=this.zoom;for(const h of this.layers){const m=h.paint.get("line-dasharray").value,_=h.layout.get("line-cap").value;if("constant"===m.kind&&"constant"===_.kind)continue;let x,E;if("constant"===m.kind){if(x=m.value,!x)continue}else x=m.evaluate({zoom:l},i);E="constant"===_.kind?_.value:_.evaluate({zoom:l},i),o.addDash(x,E),i.patterns[h.id]=o.getKey(x,E)}}update(i,o,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,o,this.stateDependentLayers,l,h)}addFeatures(i,o,l,h,m){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,o,l,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,x1)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Dm),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&i.properties.hasOwnProperty("mapbox_clip_start")&&i.properties.hasOwnProperty("mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,o,l,h,m,_){const x=this.layers[0].layout,E=x.get("line-join").evaluate(i,{}),T=x.get("line-cap").evaluate(i,{}),S=x.get("line-miter-limit"),P=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(const L of o)this.addLine(L,i,E,T,S,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,l,m,_,h)}addLine(i,o,l,h,m,_){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ne=0;ne<i.length-1;ne++)this.totalDistance+=i[ne].dist(i[ne+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const x="Polygon"===f_[o.type];let E=i.length;for(;E>=2&&i[E-1].equals(i[E-2]);)E--;let T=0;for(;T<E-1&&i[T].equals(i[T+1]);)T++;if(E<(x?3:2))return;"bevel"===l&&(m=1.05);const S=this.overscaling<=16?122880/(512*this.overscaling):0,P=this.segments.prepareSegment(10*E,this.layoutVertexArray,this.indexArray);let L,O,N,j,G;this.e1=this.e2=-1,x&&(L=i[E-2],G=i[T].sub(L)._unit()._perp());for(let ne=T;ne<E;ne++){if(N=ne===E-1?x?i[T+1]:void 0:i[ne+1],N&&i[ne].equals(N))continue;G&&(j=G),L&&(O=L),L=i[ne],G=N?N.sub(L)._unit()._perp():j,j=j||G;let ae=j.add(G);0===ae.x&&0===ae.y||ae._unit();const te=j.x*G.x+j.y*G.y,se=ae.x*G.x+ae.y*G.y,he=0!==se?1/se:1/0,le=2*Math.sqrt(2-2*se),be=se<$v&&O&&N,Ee=j.x*G.y-j.y*G.x>0;if(be&&ne>T){const Ae=L.dist(O);if(Ae>2*S){const Oe=L.sub(L.sub(O)._mult(S/Ae)._round());this.updateDistance(O,Oe),this.addCurrentVertex(Oe,j,0,0,P),O=Oe}}const ke=O&&N;let Xe=ke?l:x?"butt":h;if(ke&&"round"===Xe&&(he<_?Xe="miter":he<=2&&(Xe="fakeround")),"miter"===Xe&&he>m&&(Xe="bevel"),"bevel"===Xe&&(he>2&&(Xe="flipbevel"),he<m&&(Xe="miter")),O&&this.updateDistance(O,L),"miter"===Xe)ae._mult(he),this.addCurrentVertex(L,ae,0,0,P);else if("flipbevel"===Xe){if(he>100)ae=G.mult(-1);else{const Ae=he*j.add(G).mag()/j.sub(G).mag();ae._perp()._mult(Ae*(Ee?-1:1))}this.addCurrentVertex(L,ae,0,0,P),this.addCurrentVertex(L,ae.mult(-1),0,0,P)}else if("bevel"===Xe||"fakeround"===Xe){const Ae=-Math.sqrt(he*he-1),Oe=Ee?Ae:0,ze=Ee?0:Ae;if(O&&this.addCurrentVertex(L,j,Oe,ze,P),"fakeround"===Xe){const $e=Math.round(180*le/Math.PI/20);for(let Ke=1;Ke<$e;Ke++){let Me=Ke/$e;if(.5!==Me){const Dt=Me-.5;Me+=Me*Dt*(Me-1)*((1.0904+te*(te*(3.55645-1.43519*te)-3.2452))*Dt*Dt+(.848013+te*(.215638*te-1.06021)))}const nt=G.sub(j)._mult(Me)._add(j)._unit()._mult(Ee?-1:1);this.addHalfVertex(L,nt.x,nt.y,!1,Ee,0,P)}}N&&this.addCurrentVertex(L,G,-Oe,-ze,P)}else if("butt"===Xe)this.addCurrentVertex(L,ae,0,0,P);else if("square"===Xe){const Ae=O?1:-1;O||this.addCurrentVertex(L,ae,Ae,Ae,P),this.addCurrentVertex(L,ae,0,0,P),O&&this.addCurrentVertex(L,ae,Ae,Ae,P)}else"round"===Xe&&(O&&(this.addCurrentVertex(L,j,0,0,P),this.addCurrentVertex(L,j,1,1,P,!0)),N&&(this.addCurrentVertex(L,G,-1,-1,P,!0),this.addCurrentVertex(L,G,0,0,P)));if(be&&ne<E-1){const Ae=L.dist(N);if(Ae>2*S){const Oe=L.add(N.sub(L)._mult(S/Ae)._round());this.updateDistance(L,Oe),this.addCurrentVertex(Oe,G,0,0,P),L=Oe}}}}addCurrentVertex(i,o,l,h,m,_=!1){const x=o.y*h-o.x,E=-o.y-o.x*h;this.addHalfVertex(i,o.x+o.y*l,o.y-o.x*l,_,!1,l,m),this.addHalfVertex(i,x,E,_,!0,-h,m)}addHalfVertex({x:i,y:o},l,h,m,_,x,E){this.layoutVertexArray.emplaceBack((i<<1)+(m?1:0),(o<<1)+(_?1:0),Math.round(63*l)+128,Math.round(63*h)+128,1+(0===x?0:x<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const T=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,T),E.primitiveLength++),_?this.e2=T:this.e1=T}updateScaledDistance(){if(this.lineClips){const i=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=i*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(i,o){this.distance+=i.dist(o),this.updateScaledDistance()}}lt($p,"LineBucket",{omit:["layers","patternFeatures"]});const Gv=new wt({"line-cap":new Ie(Re.layout_line["line-cap"]),"line-join":new Ie(Re.layout_line["line-join"]),"line-miter-limit":new ge(Re.layout_line["line-miter-limit"]),"line-round-limit":new ge(Re.layout_line["line-round-limit"]),"line-sort-key":new Ie(Re.layout_line["line-sort-key"])});var m_={paint:new wt({"line-opacity":new Ie(Re.paint_line["line-opacity"]),"line-color":new Ie(Re.paint_line["line-color"]),"line-translate":new ge(Re.paint_line["line-translate"]),"line-translate-anchor":new ge(Re.paint_line["line-translate-anchor"]),"line-width":new Ie(Re.paint_line["line-width"]),"line-gap-width":new Ie(Re.paint_line["line-gap-width"]),"line-offset":new Ie(Re.paint_line["line-offset"]),"line-blur":new Ie(Re.paint_line["line-blur"]),"line-dasharray":new Ie(Re.paint_line["line-dasharray"]),"line-pattern":new Ie(Re.paint_line["line-pattern"]),"line-gradient":new ht(Re.paint_line["line-gradient"]),"line-trim-offset":new ge(Re.paint_line["line-trim-offset"])}),layout:Gv};const Cm=new class extends Ie{possiblyEvaluate(r,i){return i=new _e(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition}),super.possiblyEvaluate(r,i)}evaluate(r,i,o,l){return i=_n({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(r,i,o,l)}}(m_.paint.properties["line-width"].specification);function gd(r,i){return i>0?i+2*r:r}Cm.useIntegerZoom=!0;const Hv=ut([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Im=ut([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),qv=ut([{name:"a_projected_pos",components:4,type:"Float32"}],4);ut([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Ri=ut([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Wv=ut([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);ut([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const g_=ut([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),__=ut([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ut([{name:"triangle",components:3,type:"Uint16"}]),ut([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ut([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),ut([{type:"Float32",name:"offsetX"}]),ut([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);const la=128;function Sm(r,i){const{expression:o}=i;if("constant"===o.kind)return{kind:"constant",layoutSize:o.evaluate(new _e(r+1))};if("source"===o.kind)return{kind:"source"};{const{zoomStops:l,interpolationType:h}=o;let m=0;for(;m<l.length&&l[m]<=r;)m++;m=Math.max(0,m-1);let _=m;for(;_<l.length&&l[_]<r+1;)_++;_=Math.min(l.length-1,_);const x=l[m],E=l[_];return"composite"===o.kind?{kind:"composite",minZoom:x,maxZoom:E,interpolationType:h}:{kind:"camera",minZoom:x,maxZoom:E,minSize:o.evaluate(new _e(x)),maxSize:o.evaluate(new _e(E)),interpolationType:h}}}function Gp(r,{uSize:i,uSizeT:o},{lowerSize:l,upperSize:h}){return"source"===r.kind?l/la:"composite"===r.kind?dn(l/la,h/la,o):i}function lh(r,i){let o=0,l=0;if("constant"===r.kind)l=r.layoutSize;else if("source"!==r.kind){const{interpolationType:h,minZoom:m,maxZoom:_}=r,x=h?sn(Ir.interpolationFactor(h,i,m,_),0,1):0;"camera"===r.kind?l=dn(r.minSize,r.maxSize,x):o=x}return{uSizeT:o,uSize:l}}var Zv=Object.freeze({__proto__:null,getSizeData:Sm,evaluateSizeForFeature:Gp,evaluateSizeForZoom:lh,SIZE_PACK_FACTOR:la});function b1(r,i,o){return r.sections.forEach(l=>{l.text=function(h,m,_){const x=m.layout.get("text-transform").evaluate(_,{});return"uppercase"===x?h=h.toLocaleUpperCase():"lowercase"===x&&(h=h.toLocaleLowerCase()),Te.applyArabicShaping&&(h=Te.applyArabicShaping(h)),h}(l.text,i,o)}),r}const Hp={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function _d(r){return"\ufe36"===r||"\ufe48"===r||"\ufe38"===r||"\ufe44"===r||"\ufe42"===r||"\ufe3e"===r||"\ufe3c"===r||"\ufe3a"===r||"\ufe18"===r||"\ufe40"===r||"\ufe10"===r||"\ufe13"===r||"\ufe14"===r||"\uff40"===r||"\uffe3"===r||"\ufe11"===r||"\ufe12"===r}function y_(r){return"\ufe35"===r||"\ufe47"===r||"\ufe37"===r||"\ufe43"===r||"\ufe41"===r||"\ufe3d"===r||"\ufe3b"===r||"\ufe39"===r||"\ufe17"===r||"\ufe3f"===r}var ch=Hn,Mm=function(r,i,o,l,h){var m,_,x=8*h-l-1,E=(1<<x)-1,T=E>>1,S=-7,P=o?h-1:0,L=o?-1:1,O=r[i+P];for(P+=L,m=O&(1<<-S)-1,O>>=-S,S+=x;S>0;m=256*m+r[i+P],P+=L,S-=8);for(_=m&(1<<-S)-1,m>>=-S,S+=l;S>0;_=256*_+r[i+P],P+=L,S-=8);if(0===m)m=1-T;else{if(m===E)return _?NaN:1/0*(O?-1:1);_+=Math.pow(2,l),m-=T}return(O?-1:1)*_*Math.pow(2,m-l)},Am=function(r,i,o,l,h,m){var _,x,E,T=8*m-h-1,S=(1<<T)-1,P=S>>1,L=23===h?Math.pow(2,-24)-Math.pow(2,-77):0,O=l?0:m-1,N=l?1:-1,j=i<0||0===i&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(x=isNaN(i)?1:0,_=S):(_=Math.floor(Math.log(i)/Math.LN2),i*(E=Math.pow(2,-_))<1&&(_--,E*=2),(i+=_+P>=1?L/E:L*Math.pow(2,1-P))*E>=2&&(_++,E/=2),_+P>=S?(x=0,_=S):_+P>=1?(x=(i*E-1)*Math.pow(2,h),_+=P):(x=i*Math.pow(2,P-1)*Math.pow(2,h),_=0));h>=8;r[o+O]=255&x,O+=N,x/=256,h-=8);for(_=_<<h|x,T+=h;T>0;r[o+O]=255&_,O+=N,_/=256,T-=8);r[o+O-N]|=128*j};function Hn(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}Hn.Varint=0,Hn.Fixed64=1,Hn.Bytes=2,Hn.Fixed32=5;var qp=4294967296,Pm=1/qp,Wp=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Ol(r){return r.type===Hn.Bytes?r.readVarint()+r.pos:r.pos+1}function Zp(r,i,o){var l=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));o.realloc(l);for(var h=o.pos-1;h>=r;h--)o.buf[h+l]=o.buf[h]}function v_(r,i){for(var o=0;o<r.length;o++)i.writeVarint(r[o])}function x_(r,i){for(var o=0;o<r.length;o++)i.writeSVarint(r[o])}function Gc(r,i){for(var o=0;o<r.length;o++)i.writeFloat(r[o])}function Xv(r,i){for(var o=0;o<r.length;o++)i.writeDouble(r[o])}function Lm(r,i){for(var o=0;o<r.length;o++)i.writeBoolean(r[o])}function Xp(r,i){for(var o=0;o<r.length;o++)i.writeFixed32(r[o])}function Kv(r,i){for(var o=0;o<r.length;o++)i.writeSFixed32(r[o])}function km(r,i){for(var o=0;o<r.length;o++)i.writeFixed64(r[o])}function Kp(r,i){for(var o=0;o<r.length;o++)i.writeSFixed64(r[o])}function Ga(r,i){return(r[i]|r[i+1]<<8|r[i+2]<<16)+16777216*r[i+3]}function Hc(r,i,o){r[o]=i,r[o+1]=i>>>8,r[o+2]=i>>>16,r[o+3]=i>>>24}function Yp(r,i){return(r[i]|r[i+1]<<8|r[i+2]<<16)+(r[i+3]<<24)}function Yv(r,i,o){i.glyphs=[],1===r&&o.readMessage(Qv,i)}function Qv(r,i,o){if(3===r){const{id:l,bitmap:h,width:m,height:_,left:x,top:E,advance:T}=o.readMessage(b_,{});i.glyphs.push({id:l,bitmap:new aa({width:m+6,height:_+6},h),metrics:{width:m,height:_,left:x,top:E,advance:T}})}else 4===r?i.ascender=o.readSVarint():5===r&&(i.descender=o.readSVarint())}function b_(r,i,o){1===r?i.id=o.readVarint():2===r?i.bitmap=o.readBytes():3===r?i.width=o.readVarint():4===r?i.height=o.readVarint():5===r?i.left=o.readSVarint():6===r?i.top=o.readSVarint():7===r&&(i.advance=o.readVarint())}function Fl(r){let i=0,o=0;for(const _ of r)i+=_.w*_.h,o=Math.max(o,_.w);r.sort((_,x)=>x.h-_.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),o),h:1/0}];let h=0,m=0;for(const _ of r)for(let x=l.length-1;x>=0;x--){const E=l[x];if(!(_.w>E.w||_.h>E.h)){if(_.x=E.x,_.y=E.y,m=Math.max(m,_.y+_.h),h=Math.max(h,_.x+_.w),_.w===E.w&&_.h===E.h){const T=l.pop();x<l.length&&(l[x]=T)}else _.h===E.h?(E.x+=_.w,E.w-=_.w):_.w===E.w?(E.y+=_.h,E.h-=_.h):(l.push({x:E.x+_.w,y:E.y,w:E.w-_.w,h:_.h}),E.y+=_.h,E.h-=_.h);break}}return{w:h,h:m,fill:i/(h*m)||0}}Hn.prototype={destroy:function(){this.buf=null},readFields:function(r,i,o){for(o=o||this.length;this.pos<o;){var l=this.readVarint(),h=l>>3,m=this.pos;this.type=7&l,r(h,i,this),this.pos===m&&this.skip(l)}return i},readMessage:function(r,i){return this.readFields(r,i,this.readVarint()+this.pos)},readFixed32:function(){var r=Ga(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=Yp(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=Ga(this.buf,this.pos)+Ga(this.buf,this.pos+4)*qp;return this.pos+=8,r},readSFixed64:function(){var r=Ga(this.buf,this.pos)+Yp(this.buf,this.pos+4)*qp;return this.pos+=8,r},readFloat:function(){var r=Mm(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=Mm(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var i,o,l=this.buf;return i=127&(o=l[this.pos++]),o<128?i:(i|=(127&(o=l[this.pos++]))<<7,o<128?i:(i|=(127&(o=l[this.pos++]))<<14,o<128?i:(i|=(127&(o=l[this.pos++]))<<21,o<128?i:function(h,m,_){var x,E,T=_.buf;if(x=(112&(E=T[_.pos++]))>>4,E<128||(x|=(127&(E=T[_.pos++]))<<3,E<128)||(x|=(127&(E=T[_.pos++]))<<10,E<128)||(x|=(127&(E=T[_.pos++]))<<17,E<128)||(x|=(127&(E=T[_.pos++]))<<24,E<128)||(x|=(1&(E=T[_.pos++]))<<31,E<128))return function uh(r,i,o){return o?4294967296*i+(r>>>0):4294967296*(i>>>0)+(r>>>0)}(h,x,m);throw new Error("Expected varint not more than 10 bytes")}(i|=(15&(o=l[this.pos]))<<28,r,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2==1?(r+1)/-2:r/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var r=this.readVarint()+this.pos,i=this.pos;return this.pos=r,r-i>=12&&Wp?Wp.decode(this.buf.subarray(i,r)):function(o,l,h){for(var m="",_=l;_<h;){var x,E,T,S=o[_],P=null,L=S>239?4:S>223?3:S>191?2:1;if(_+L>h)break;1===L?S<128&&(P=S):2===L?128==(192&(x=o[_+1]))&&(P=(31&S)<<6|63&x)<=127&&(P=null):3===L?(E=o[_+2],128==(192&(x=o[_+1]))&&128==(192&E)&&((P=(15&S)<<12|(63&x)<<6|63&E)<=2047||P>=55296&&P<=57343)&&(P=null)):4===L&&(E=o[_+2],T=o[_+3],128==(192&(x=o[_+1]))&&128==(192&E)&&128==(192&T)&&((P=(15&S)<<18|(63&x)<<12|(63&E)<<6|63&T)<=65535||P>=1114112)&&(P=null)),null===P?(P=65533,L=1):P>65535&&(P-=65536,m+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),m+=String.fromCharCode(P),_+=L}return m}(this.buf,i,r)},readBytes:function(){var r=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,r);return this.pos=r,i},readPackedVarint:function(r,i){if(this.type!==Hn.Bytes)return r.push(this.readVarint(i));var o=Ol(this);for(r=r||[];this.pos<o;)r.push(this.readVarint(i));return r},readPackedSVarint:function(r){if(this.type!==Hn.Bytes)return r.push(this.readSVarint());var i=Ol(this);for(r=r||[];this.pos<i;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==Hn.Bytes)return r.push(this.readBoolean());var i=Ol(this);for(r=r||[];this.pos<i;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==Hn.Bytes)return r.push(this.readFloat());var i=Ol(this);for(r=r||[];this.pos<i;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==Hn.Bytes)return r.push(this.readDouble());var i=Ol(this);for(r=r||[];this.pos<i;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==Hn.Bytes)return r.push(this.readFixed32());var i=Ol(this);for(r=r||[];this.pos<i;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==Hn.Bytes)return r.push(this.readSFixed32());var i=Ol(this);for(r=r||[];this.pos<i;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==Hn.Bytes)return r.push(this.readFixed64());var i=Ol(this);for(r=r||[];this.pos<i;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==Hn.Bytes)return r.push(this.readSFixed64());var i=Ol(this);for(r=r||[];this.pos<i;)r.push(this.readSFixed64());return r},skip:function(r){var i=7&r;if(i===Hn.Varint)for(;this.buf[this.pos++]>127;);else if(i===Hn.Bytes)this.pos=this.readVarint()+this.pos;else if(i===Hn.Fixed32)this.pos+=4;else{if(i!==Hn.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(r,i){this.writeVarint(r<<3|i)},realloc:function(r){for(var i=this.length||16;i<this.pos+r;)i*=2;if(i!==this.length){var o=new Uint8Array(i);o.set(this.buf),this.buf=o,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),Hc(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),Hc(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),Hc(this.buf,-1&r,this.pos),Hc(this.buf,Math.floor(r*Pm),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),Hc(this.buf,-1&r,this.pos),Hc(this.buf,Math.floor(r*Pm),this.pos+4),this.pos+=8},writeVarint:function(r){(r=+r||0)>268435455||r<0?function(i,o){var l,h,m,x;if(i>=0?(l=i%4294967296|0,h=i/4294967296|0):(h=~(-i/4294967296),4294967295^(l=~(-i%4294967296))?l=l+1|0:(l=0,h=h+1|0)),i>=0x10000000000000000||i<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),m=l,(x=o).buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,x.buf[x.pos]=127&(m>>>=7),function(m,_){var x=(7&m)<<4;_.buf[_.pos++]|=x|((m>>>=3)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m)))))}(h,o)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(r){this.writeVarint(r<0?2*-r-1:2*r)},writeBoolean:function(r){this.writeVarint(Boolean(r))},writeString:function(r){r=String(r),this.realloc(4*r.length),this.pos++;var i=this.pos;this.pos=function(l,h,m){for(var _,x,E=0;E<h.length;E++){if((_=h.charCodeAt(E))>55295&&_<57344){if(!x){_>56319||E+1===h.length?(l[m++]=239,l[m++]=191,l[m++]=189):x=_;continue}if(_<56320){l[m++]=239,l[m++]=191,l[m++]=189,x=_;continue}_=x-55296<<10|_-56320|65536,x=null}else x&&(l[m++]=239,l[m++]=191,l[m++]=189,x=null);_<128?l[m++]=_:(_<2048?l[m++]=_>>6|192:(_<65536?l[m++]=_>>12|224:(l[m++]=_>>18|240,l[m++]=_>>12&63|128),l[m++]=_>>6&63|128),l[m++]=63&_|128)}return m}(this.buf,r,this.pos);var o=this.pos-i;o>=128&&Zp(i,o,this),this.pos=i-1,this.writeVarint(o),this.pos+=o},writeFloat:function(r){this.realloc(4),Am(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),Am(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var i=r.length;this.writeVarint(i),this.realloc(i);for(var o=0;o<i;o++)this.buf[this.pos++]=r[o]},writeRawMessage:function(r,i){this.pos++;var o=this.pos;r(i,this);var l=this.pos-o;l>=128&&Zp(o,l,this),this.pos=o-1,this.writeVarint(l),this.pos+=l},writeMessage:function(r,i,o){this.writeTag(r,Hn.Bytes),this.writeRawMessage(i,o)},writePackedVarint:function(r,i){i.length&&this.writeMessage(r,v_,i)},writePackedSVarint:function(r,i){i.length&&this.writeMessage(r,x_,i)},writePackedBoolean:function(r,i){i.length&&this.writeMessage(r,Lm,i)},writePackedFloat:function(r,i){i.length&&this.writeMessage(r,Gc,i)},writePackedDouble:function(r,i){i.length&&this.writeMessage(r,Xv,i)},writePackedFixed32:function(r,i){i.length&&this.writeMessage(r,Xp,i)},writePackedSFixed32:function(r,i){i.length&&this.writeMessage(r,Kv,i)},writePackedFixed64:function(r,i){i.length&&this.writeMessage(r,km,i)},writePackedSFixed64:function(r,i){i.length&&this.writeMessage(r,Kp,i)},writeBytesField:function(r,i){this.writeTag(r,Hn.Bytes),this.writeBytes(i)},writeFixed32Field:function(r,i){this.writeTag(r,Hn.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(r,i){this.writeTag(r,Hn.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(r,i){this.writeTag(r,Hn.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(r,i){this.writeTag(r,Hn.Fixed64),this.writeSFixed64(i)},writeVarintField:function(r,i){this.writeTag(r,Hn.Varint),this.writeVarint(i)},writeSVarintField:function(r,i){this.writeTag(r,Hn.Varint),this.writeSVarint(i)},writeStringField:function(r,i){this.writeTag(r,Hn.Bytes),this.writeString(i)},writeFloatField:function(r,i){this.writeTag(r,Hn.Fixed32),this.writeFloat(i)},writeDoubleField:function(r,i){this.writeTag(r,Hn.Fixed64),this.writeDouble(i)},writeBooleanField:function(r,i){this.writeVarintField(r,Boolean(i))}};class Rm{constructor(i,{pixelRatio:o,version:l,stretchX:h,stretchY:m,content:_}){this.paddedRect=i,this.pixelRatio=o,this.stretchX=h,this.stretchY=m,this.content=_,this.version=l}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class w_{constructor(i,o){const l={},h={};this.haveRenderCallbacks=[];const m=[];this.addImages(i,l,m),this.addImages(o,h,m);const{w:_,h:x}=Fl(m),E=new Po({width:_||1,height:x||1});for(const T in i){const S=i[T],P=l[T].paddedRect;Po.copy(S.data,E,{x:0,y:0},{x:P.x+1,y:P.y+1},S.data)}for(const T in o){const S=o[T],P=h[T].paddedRect,L=P.x+1,O=P.y+1,N=S.data.width,j=S.data.height;Po.copy(S.data,E,{x:0,y:0},{x:L,y:O},S.data),Po.copy(S.data,E,{x:0,y:j-1},{x:L,y:O-1},{width:N,height:1}),Po.copy(S.data,E,{x:0,y:0},{x:L,y:O+j},{width:N,height:1}),Po.copy(S.data,E,{x:N-1,y:0},{x:L-1,y:O},{width:1,height:j}),Po.copy(S.data,E,{x:0,y:0},{x:L+N,y:O},{width:1,height:j})}this.image=E,this.iconPositions=l,this.patternPositions=h}addImages(i,o,l){for(const h in i){const m=i[h],_={x:0,y:0,w:m.data.width+2,h:m.data.height+2};l.push(_),o[h]=new Rm(_,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(i,o){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(l=>i.hasImage(l)),i.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const l in i.updatedImages)this.patchUpdatedImage(this.iconPositions[l],i.getImage(l),o),this.patchUpdatedImage(this.patternPositions[l],i.getImage(l),o)}patchUpdatedImage(i,o,l){if(!i||!o||i.version===o.version)return;i.version=o.version;const[h,m]=i.tl;l.update(o.data,void 0,{x:h,y:m})}}lt(Rm,"ImagePosition"),lt(w_,"ImageAtlas");const Lo={horizontal:1,vertical:2,horizontalOnly:3};class yd{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(i,o){const l=new yd;return l.scale=i||1,l.fontStack=o,l}static forImage(i){const o=new yd;return o.imageName=i,o}}class Nl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,o){const l=new Nl;for(let h=0;h<i.sections.length;h++){const m=i.sections[h];m.image?l.addImageSection(m):l.addTextSection(m,o)}return l}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSections(){return this.sections}getSectionIndex(i){return this.sectionIndex[i]}getCharCode(i){return this.text.charCodeAt(i)}verticalizePunctuation(i){this.text=function(o,l){let h="";for(let m=0;m<o.length;m++){const _=o.charCodeAt(m+1)||null,x=o.charCodeAt(m-1)||null;h+=!l&&(_&&k(_)&&!Hp[o[m+1]]||x&&k(x)&&!Hp[o[m-1]])||!Hp[o[m]]?o[m]:Hp[o[m]]}return h}(this.text,i)}trim(){let i=0;for(let l=0;l<this.text.length&&vd[this.text.charCodeAt(l)];l++)i++;let o=this.text.length;for(let l=this.text.length-1;l>=0&&l>=i&&vd[this.text.charCodeAt(l)];l--)o--;this.text=this.text.substring(i,o),this.sectionIndex=this.sectionIndex.slice(i,o)}substring(i,o){const l=new Nl;return l.text=this.text.substring(i,o),l.sectionIndex=this.sectionIndex.slice(i,o),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,o)=>Math.max(i,this.sections[o].scale),0)}addTextSection(i,o){this.text+=i.text,this.sections.push(yd.forText(i.scale,i.fontStack||o));const l=this.sections.length-1;for(let h=0;h<i.text.length;++h)this.sectionIndex.push(l)}addImageSection(i){const o=i.image?i.image.name:"";if(0===o.length)return void Qn("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push(yd.forImage(o)),this.sectionIndex.push(this.sections.length-1)):Qn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Om(r,i,o,l,h,m,_,x,E,T,S,P,L,O,N){const j=Nl.fromFeature(r,h);P===Lo.vertical&&j.verticalizePunctuation(L);let G=[];const ne=function(le,be,Ee,ke,Xe,Ae){if(!le)return[];const Oe=[],ze=function(nt,Dt,ot,dt,tt,At){let tn=0;for(let cn=0;cn<nt.length();cn++){const Kt=nt.getSection(cn);tn+=Fm(nt.getCharCode(cn),Kt,dt,tt,Dt,At)}return tn/Math.max(1,Math.ceil(tn/ot))}(le,be,Ee,ke,Xe,Ae),$e=le.text.indexOf("\u200b")>=0;let Ke=0;for(let nt=0;nt<le.length();nt++){const Dt=le.getSection(nt),ot=le.getCharCode(nt);if(vd[ot]||(Ke+=Fm(ot,Dt,ke,Xe,be,Ae)),nt<le.length()-1){const dt=!((Me=ot)<11904||!(Sc(Me)||Vu(Me)||u(Me)||ja(Me)||Xh(Me)||ta(Me)||Zh(Me)||Va(Me)||Uu(Me)||$u(Me)||up(Me)||b(Me)||Ic(Me)||Wh(Me)||To(Me)||ju(Me)||Bu(Me)||a(Me)||Yh(Me)||Kh(Me)));(Jv[ot]||dt||Dt.imageName)&&Oe.push(xd(nt+1,Ke,ze,Oe,t0(ot,le.getCharCode(nt+1),dt&&$e),!1))}}var Me;return E_(xd(le.length(),Ke,ze,Oe,0,!0))}(j,T,m,i,l,O),{processBidirectionalText:ae,processStyledBidirectionalText:te}=Te;if(ae&&1===j.sections.length){const le=ae(j.toString(),ne);for(const be of le){const Ee=new Nl;Ee.text=be,Ee.sections=j.sections;for(let ke=0;ke<be.length;ke++)Ee.sectionIndex.push(0);G.push(Ee)}}else if(te){const le=te(j.text,j.sectionIndex,ne);for(const be of le){const Ee=new Nl;Ee.text=be[0],Ee.sectionIndex=be[1],Ee.sections=j.sections,G.push(Ee)}}else G=function(le,be){const Ee=[],ke=le.text;let Xe=0;for(const Ae of be)Ee.push(le.substring(Xe,Ae)),Xe=Ae;return Xe<ke.length&&Ee.push(le.substring(Xe,ke.length)),Ee}(j,ne);const se=[],he={positionedLines:se,text:j.toString(),top:S[1],bottom:S[1],left:S[0],right:S[0],writingMode:P,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(le,be,Ee,ke,Xe,Ae,Oe,ze,$e,Ke,Me,nt){let Dt=0,ot=0,dt=0;const tt="right"===ze?1:"left"===ze?0:.5;let At=!1;for(const Ft of Xe){const nn=Ft.getSections();for(const un of nn){if(un.imageName)continue;const zn=be[un.fontStack];if(zn&&(At=void 0!==zn.ascender&&void 0!==zn.descender,!At))break}if(!At)break}let tn=0;for(const Ft of Xe){Ft.trim();const nn=Ft.getMaxScale(),un=24*(nn-1),zn={positionedGlyphs:[],lineOffset:0};le.positionedLines[tn]=zn;const Rn=zn.positionedGlyphs;let On=0;if(!Ft.length()){ot+=Ae,++tn;continue}let Kn=0,ri=0;for(let Fn=0;Fn<Ft.length();Fn++){const vi=Ft.getSection(Fn),oi=Ft.getSectionIndex(Fn),En=Ft.getCharCode(Fn);let li=vi.scale,Ii=null,jn=null,pi=null,vr=24,Xi=0;const Fi=!($e===Lo.horizontal||!Me&&!R(En)||Me&&(vd[En]||(cn=En,Gi(cn)||Yo(cn)||zu(cn)||f(cn)||v(cn))));if(vi.imageName){const xr=ke[vi.imageName];if(!xr)continue;pi=vi.imageName,le.iconsInText=le.iconsInText||!0,jn=xr.paddedRect;const Ki=xr.displaySize;li=24*li/nt,Ii={width:Ki[0],height:Ki[1],left:1,top:-3,advance:Fi?Ki[1]:Ki[0],localGlyph:!1},Xi=At?-Ii.height*li:24*nn-17-Ki[1]*li,vr=Ii.advance;const Ss=(Fi?Ki[0]:Ki[1])*li-24*nn;Ss>0&&Ss>On&&(On=Ss)}else{const xr=Ee[vi.fontStack];if(!xr)continue;xr[En]&&(jn=xr[En]);const Ki=be[vi.fontStack];if(!Ki)continue;const Ss=Ki.glyphs[En];if(!Ss)continue;if(Ii=Ss.metrics,vr=8203!==En?24:0,At){const wh=void 0!==Ki.ascender?Math.abs(Ki.ascender):0,Pd=void 0!==Ki.descender?Math.abs(Ki.descender):0,Ld=(wh+Pd)*li;Kn<Ld&&(Kn=Ld,ri=(wh-Pd)/2*li),Xi=-wh*li}else Xi=24*(nn-li)-17}Fi?(le.verticalizable=!0,Rn.push({glyph:En,imageName:pi,x:Dt,y:ot+Xi,vertical:Fi,scale:li,localGlyph:Ii.localGlyph,fontStack:vi.fontStack,sectionIndex:oi,metrics:Ii,rect:jn}),Dt+=vr*li+Ke):(Rn.push({glyph:En,imageName:pi,x:Dt,y:ot+Xi,vertical:Fi,scale:li,localGlyph:Ii.localGlyph,fontStack:vi.fontStack,sectionIndex:oi,metrics:Ii,rect:jn}),Dt+=Ii.advance*li+Ke)}0!==Rn.length&&(dt=Math.max(Dt-Ke,dt),At?Cs(Rn,tt,On,ri,Ae*nn/2):Cs(Rn,tt,On,0,Ae/2)),Dt=0;const Oi=Ae*nn+On;zn.lineOffset=Math.max(On,un),ot+=Oi,++tn}var cn;const Kt=ot,{horizontalAlign:Mt,verticalAlign:An}=zl(Oe);(function(Ft,nn,un,zn,Rn,On){const Kn=(nn-un)*Rn,ri=-On*zn;for(const Oi of Ft)for(const Fn of Oi.positionedGlyphs)Fn.x+=Kn,Fn.y+=ri})(le.positionedLines,tt,Mt,An,dt,Kt),le.top+=-An*Kt,le.bottom=le.top+Kt,le.left+=-Mt*dt,le.right=le.left+dt,le.hasBaseline=At}(he,i,o,l,G,_,x,E,P,T,L,N),!function(le){for(const be of le)if(0!==be.positionedGlyphs.length)return!1;return!0}(se)&&he}const vd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Jv={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Fm(r,i,o,l,h,m){if(i.imageName){const _=l[i.imageName];return _?_.displaySize[0]*i.scale*24/m+h:0}{const _=o[i.fontStack],x=_&&_.glyphs[r];return x?x.metrics.advance*i.scale+h:0}}function e0(r,i,o,l){const h=Math.pow(r-i,2);return l?r<i?h/2:2*h:h+Math.abs(o)*o}function t0(r,i,o){let l=0;return 10===r&&(l-=1e4),o&&(l+=150),40!==r&&65288!==r||(l+=50),41!==i&&65289!==i||(l+=50),l}function xd(r,i,o,l,h,m){let _=null,x=e0(i,o,h,m);for(const E of l){const T=e0(i-E.x,o,h,m)+E.badness;T<=x&&(_=E,x=T)}return{index:r,x:i,priorBreak:_,badness:x}}function E_(r){return r?E_(r.priorBreak).concat(r.index):[]}function zl(r){let i=.5,o=.5;switch(r){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}return{horizontalAlign:i,verticalAlign:o}}function Cs(r,i,o,l,h){if(!(i||o||l||h))return;const m=r.length-1,_=r[m],x=(_.x+_.metrics.advance*_.scale)*i;for(let E=0;E<=m;E++)r[E].x-=x,r[E].y+=o+l+h}function n0(r,i,o){const{horizontalAlign:l,verticalAlign:h}=zl(o),m=i[0]-r.displaySize[0]*l,_=i[1]-r.displaySize[1]*h;return{image:r,top:_,bottom:_+r.displaySize[1],left:m,right:m+r.displaySize[0]}}function r0(r,i,o,l,h,m){const _=r.image;let x;if(_.content){const G=_.content,ne=_.pixelRatio||1;x=[G[0]/ne,G[1]/ne,_.displaySize[0]-G[2]/ne,_.displaySize[1]-G[3]/ne]}const E=i.left*m,T=i.right*m;let S,P,L,O;"width"===o||"both"===o?(O=h[0]+E-l[3],P=h[0]+T+l[1]):(O=h[0]+(E+T-_.displaySize[0])/2,P=O+_.displaySize[0]);const N=i.top*m,j=i.bottom*m;return"height"===o||"both"===o?(S=h[1]+N-l[0],L=h[1]+j+l[2]):(S=h[1]+(N+j-_.displaySize[1])/2,L=S+_.displaySize[1]),{image:_,top:S,right:P,bottom:L,left:O,collisionPadding:x}}class ko extends et{constructor(i,o,l,h,m){super(i,o),this.angle=h,this.z=l,void 0!==m&&(this.segment=m)}clone(){return new ko(this.x,this.y,this.z,this.angle,this.segment)}}function Qp(r,i,o,l,h){if(void 0===i.segment)return!0;let m=i,_=i.segment+1,x=0;for(;x>-o/2;){if(_--,_<0)return!1;x-=r[_].dist(m),m=r[_]}x+=r[_].dist(r[_+1]),_++;const E=[];let T=0;for(;x<o/2;){const S=r[_],P=r[_+1];if(!P)return!1;let L=r[_-1].angleTo(S)-S.angleTo(P);for(L=Math.abs((L+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:x,angleDelta:L}),T+=L;x-E[0].distance>l;)T-=E.shift().angleDelta;if(T>h)return!1;_++,x+=S.dist(P)}return!0}function T_(r){let i=0;for(let o=0;o<r.length-1;o++)i+=r[o].dist(r[o+1]);return i}function D_(r,i,o){return r?.6*i*o:0}function Jp(r,i){return Math.max(r?r.right-r.left:0,i?i.right-i.left:0)}function o0(r,i,o,l,h,m){const _=D_(o,h,m),x=Jp(o,l)*m;let E=0;const T=T_(r)/2;for(let S=0;S<r.length-1;S++){const P=r[S],L=r[S+1],O=P.dist(L);if(E+O>T){const N=(T-E)/O,j=dn(P.x,L.x,N),G=dn(P.y,L.y,N),ne=new ko(j,G,0,L.angleTo(P),S);return!_||Qp(r,ne,x,_,i)?ne:void 0}E+=O}}function Nm(r,i,o,l,h,m,_,x,E){const T=D_(l,m,_),S=Jp(l,h),P=S*_,L=0===r[0].x||r[0].x===E||0===r[0].y||r[0].y===E;return i-P<i/4&&(i=P+i/4),ef(r,L?i/2*x%i:(S/2+2*m)*_*x%i,i,T,o,P,L,!1,E)}function ef(r,i,o,l,h,m,_,x,E){const T=m/2,S=T_(r);let P=0,L=i-o,O=[];for(let N=0;N<r.length-1;N++){const j=r[N],G=r[N+1],ne=j.dist(G),ae=G.angleTo(j);for(;L+o<P+ne;){L+=o;const te=(L-P)/ne,se=dn(j.x,G.x,te),he=dn(j.y,G.y,te);if(se>=0&&se<E&&he>=0&&he<E&&L-T>=0&&L+T<=S){const le=new ko(se,he,0,ae,N);le._round(),l&&!Qp(r,le,m,l,h)||O.push(le)}}P+=ne}return x||O.length||_||(O=ef(r,P/2,o,l,h,m,_,!0,E)),O}function C_(r,i,o,l,h){const m=[];for(let _=0;_<r.length;_++){const x=r[_];let E;for(let T=0;T<x.length-1;T++){let S=x[T],P=x[T+1];S.x<i&&P.x<i||(S.x<i?S=new et(i,S.y+(i-S.x)/(P.x-S.x)*(P.y-S.y))._round():P.x<i&&(P=new et(i,S.y+(i-S.x)/(P.x-S.x)*(P.y-S.y))._round()),S.y<o&&P.y<o||(S.y<o?S=new et(S.x+(o-S.y)/(P.y-S.y)*(P.x-S.x),o)._round():P.y<o&&(P=new et(S.x+(o-S.y)/(P.y-S.y)*(P.x-S.x),o)._round()),S.x>=l&&P.x>=l||(S.x>=l?S=new et(l,S.y+(l-S.x)/(P.x-S.x)*(P.y-S.y))._round():P.x>=l&&(P=new et(l,S.y+(l-S.x)/(P.x-S.x)*(P.y-S.y))._round()),S.y>=h&&P.y>=h||(S.y>=h?S=new et(S.x+(h-S.y)/(P.y-S.y)*(P.x-S.x),h)._round():P.y>=h&&(P=new et(S.x+(h-S.y)/(P.y-S.y)*(P.x-S.x),h)._round()),E&&S.equals(E[E.length-1])||(E=[S],m.push(E)),E.push(P)))))}}return m}lt(ko,"Anchor");const qc=1e20;function Wc(r,i,o,l,h,m,_,x,E){for(let T=i;T<i+l;T++)I_(r,o*m+T,m,h,_,x,E);for(let T=o;T<o+h;T++)I_(r,T*m+i,1,l,_,x,E)}function I_(r,i,o,l,h,m,_){m[0]=0,_[0]=-qc,_[1]=qc,h[0]=r[i];for(let x=1,E=0,T=0;x<l;x++){h[x]=r[i+x*o];const S=x*x;do{const P=m[E];T=(h[x]-h[P]+S-P*P)/(x-P)/2}while(T<=_[E]&&--E>-1);E++,m[E]=x,_[E]=T,_[E+1]=qc}for(let x=0,E=0;x<l;x++){for(;_[E+1]<x;)E++;const T=m[E],S=x-T;r[i+x*o]=h[T]+S*S}}const zm={none:0,ideographs:1,all:2};class hh{constructor(i,o,l){this.requestManager=i,this.localGlyphMode=o,this.localFontFamily=l,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(i){this.url=i}getGlyphs(i,o){const l=[];for(const h in i)for(const m of i[h])l.push({stack:h,id:m});Ea(l,({stack:h,id:m},_)=>{let x=this.entries[h];x||(x=this.entries[h]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let E=x.glyphs[m];if(void 0!==E)return void _(null,{stack:h,id:m,glyph:E});if(E=this._tinySDF(x,h,m),E)return x.glyphs[m]=E,void _(null,{stack:h,id:m,glyph:E});const T=Math.floor(m/256);if(256*T>65535)return void _(new Error("glyphs > 65535 not supported"));if(x.ranges[T])return void _(null,{stack:h,id:m,glyph:E});let S=x.requests[T];S||(S=x.requests[T]=[],hh.loadGlyphRange(h,T,this.url,this.requestManager,(P,L)=>{if(L){x.ascender=L.ascender,x.descender=L.descender;for(const O in L.glyphs)this._doesCharSupportLocalGlyph(+O)||(x.glyphs[+O]=L.glyphs[+O]);x.ranges[T]=!0}for(const O of S)O(P,L);delete x.requests[T]})),S.push((P,L)=>{P?_(P):L&&_(null,{stack:h,id:m,glyph:L.glyphs[m]||null})})},(h,m)=>{if(h)o(h);else if(m){const _={};for(const{stack:x,id:E,glyph:T}of m)void 0===_[x]&&(_[x]={}),void 0===_[x].glyphs&&(_[x].glyphs={}),_[x].glyphs[E]=T&&{id:T.id,bitmap:T.bitmap.clone(),metrics:T.metrics},_[x].ascender=this.entries[x].ascender,_[x].descender=this.entries[x].descender;o(null,_)}})}_doesCharSupportLocalGlyph(i){return this.localGlyphMode!==zm.none&&(this.localGlyphMode===zm.all?!!this.localFontFamily:!!this.localFontFamily&&($u(i)||Gu(i)||Ic(i)||Bu(i)||Va(i)))}_tinySDF(i,o,l){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(l))return;let m=i.tinySDF;if(!m){let j="400";/bold/i.test(o)?j="900":/medium/i.test(o)?j="500":/light/i.test(o)&&(j="200"),m=i.tinySDF=new hh.TinySDF({fontFamily:h,fontWeight:j,fontSize:48,buffer:6,radius:16}),m.fontWeight=j}if(this.localGlyphs[m.fontWeight][l])return this.localGlyphs[m.fontWeight][l];const _=String.fromCharCode(l),{data:x,width:E,height:T,glyphWidth:S,glyphHeight:P,glyphLeft:L,glyphTop:O,glyphAdvance:N}=m.draw(_);return this.localGlyphs[m.fontWeight][l]={id:l,bitmap:new aa({width:E,height:T},x),metrics:{width:S/2,height:P/2,left:L/2,top:O/2-27,advance:N/2,localGlyph:!0}}}}function S_(r,i,o,l){const h=[],m=r.image,_=m.pixelRatio,x=m.paddedRect.w-2,E=m.paddedRect.h-2,T=r.right-r.left,S=r.bottom-r.top,P=m.stretchX||[[0,x]],L=m.stretchY||[[0,E]],O=(Ae,Oe)=>Ae+Oe[1]-Oe[0],N=P.reduce(O,0),j=L.reduce(O,0),G=x-N,ne=E-j;let ae=0,te=N,se=0,he=j,le=0,be=G,Ee=0,ke=ne;if(m.content&&l){const Ae=m.content;ae=tf(P,0,Ae[0]),se=tf(L,0,Ae[1]),te=tf(P,Ae[0],Ae[2]),he=tf(L,Ae[1],Ae[3]),le=Ae[0]-ae,Ee=Ae[1]-se,be=Ae[2]-Ae[0]-te,ke=Ae[3]-Ae[1]-he}const Xe=(Ae,Oe,ze,$e)=>{const Ke=nf(Ae.stretch-ae,te,T,r.left),Me=Ha(Ae.fixed-le,be,Ae.stretch,N),nt=nf(Oe.stretch-se,he,S,r.top),Dt=Ha(Oe.fixed-Ee,ke,Oe.stretch,j),ot=nf(ze.stretch-ae,te,T,r.left),dt=Ha(ze.fixed-le,be,ze.stretch,N),tt=nf($e.stretch-se,he,S,r.top),At=Ha($e.fixed-Ee,ke,$e.stretch,j),tn=new et(Ke,nt),cn=new et(ot,nt),Kt=new et(ot,tt),Mt=new et(Ke,tt),An=new et(Me/_,Dt/_),Ft=new et(dt/_,At/_),nn=i*Math.PI/180;if(nn){const Rn=Math.sin(nn),On=Math.cos(nn),Kn=[On,-Rn,Rn,On];tn._matMult(Kn),cn._matMult(Kn),Mt._matMult(Kn),Kt._matMult(Kn)}const un=Ae.stretch+Ae.fixed,zn=Oe.stretch+Oe.fixed;return{tl:tn,tr:cn,bl:Mt,br:Kt,tex:{x:m.paddedRect.x+1+un,y:m.paddedRect.y+1+zn,w:ze.stretch+ze.fixed-un,h:$e.stretch+$e.fixed-zn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:An,pixelOffsetBR:Ft,minFontScaleX:be/_/T,minFontScaleY:ke/_/S,isSDF:o}};if(l&&(m.stretchX||m.stretchY)){const Ae=M_(P,G,N),Oe=M_(L,ne,j);for(let ze=0;ze<Ae.length-1;ze++){const $e=Ae[ze],Ke=Ae[ze+1];for(let Me=0;Me<Oe.length-1;Me++)h.push(Xe($e,Oe[Me],Ke,Oe[Me+1]))}}else h.push(Xe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:E+1}));return h}function tf(r,i,o){let l=0;for(const h of r)l+=Math.max(i,Math.min(o,h[1]))-Math.max(i,Math.min(o,h[0]));return l}function M_(r,i,o){const l=[{fixed:-1,stretch:0}];for(const[h,m]of r){const _=l[l.length-1];l.push({fixed:h-_.stretch,stretch:_.stretch}),l.push({fixed:h-_.stretch,stretch:_.stretch+(m-h)})}return l.push({fixed:i+1,stretch:o}),l}function nf(r,i,o,l){return r/i*o+l}function Ha(r,i,o,l){return r-i*o/l}function qa(r,i,o,l){const h=i+r.positionedLines[l].lineOffset;return 0===l?o+h/2:o+(h+(i+r.positionedLines[l-1].lineOffset))/2}hh.loadGlyphRange=function(r,i,o,l,h){const m=256*i,_=m+255,x=l.transformRequest(l.normalizeGlyphsURL(o).replace("{fontstack}",r).replace("{range}",`${m}-${_}`),ro.Glyphs);Ca(x,(E,T)=>{if(E)h(E);else if(T){const S={},P=new ch(T).readFields(Yv,{});for(const L of P.glyphs)S[L.id]=L;h(null,{glyphs:S,ascender:P.ascender,descender:P.descender})}})},hh.TinySDF=class{constructor({fontSize:r=24,buffer:i=3,radius:o=8,cutoff:l=.25,fontFamily:h="sans-serif",fontWeight:m="normal",fontStyle:_="normal"}={}){this.buffer=i,this.cutoff=l,this.radius=o;const x=this.size=r+4*i,E=this._createCanvas(x),T=this.ctx=E.getContext("2d",{willReadFrequently:!0});T.font=`${_} ${m} ${r}px ${h}`,T.textBaseline="alphabetic",T.textAlign="left",T.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(r){const i=document.createElement("canvas");return i.width=i.height=r,i}draw(r){const{width:i,actualBoundingBoxAscent:o,actualBoundingBoxDescent:l,actualBoundingBoxLeft:h,actualBoundingBoxRight:m}=this.ctx.measureText(r),_=Math.ceil(o),x=Math.min(this.size-this.buffer,Math.ceil(m-h)),E=Math.min(this.size-this.buffer,_+Math.ceil(l)),T=x+2*this.buffer,S=E+2*this.buffer,P=Math.max(T*S,0),L=new Uint8ClampedArray(P),O={data:L,width:T,height:S,glyphWidth:x,glyphHeight:E,glyphTop:_,glyphLeft:0,glyphAdvance:i};if(0===x||0===E)return O;const{ctx:N,buffer:j,gridInner:G,gridOuter:ne}=this;N.clearRect(j,j,x,E),N.fillText(r,j,j+_);const ae=N.getImageData(j,j,x,E);ne.fill(qc,0,P),G.fill(0,0,P);for(let te=0;te<E;te++)for(let se=0;se<x;se++){const he=ae.data[4*(te*x+se)+3]/255;if(0===he)continue;const le=(te+j)*T+se+j;if(1===he)ne[le]=0,G[le]=qc;else{const be=.5-he;ne[le]=be>0?be*be:0,G[le]=be<0?be*be:0}}Wc(ne,0,0,T,S,T,this.f,this.v,this.z),Wc(G,j,j,x,E,T,this.f,this.v,this.z);for(let te=0;te<P;te++){const se=Math.sqrt(ne[te])-Math.sqrt(G[te]);L[te]=Math.round(255-255*(se/this.radius+this.cutoff))}return O}};class s0{constructor(i=[],o=a0){if(this.data=i,this.length=this.data.length,this.compare=o,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(i){this.data.push(i),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const i=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:o,compare:l}=this,h=o[i];for(;i>0;){const m=i-1>>1,_=o[m];if(l(h,_)>=0)break;o[i]=_,i=m}o[i]=h}_down(i){const{data:o,compare:l}=this,h=this.length>>1,m=o[i];for(;i<h;){let _=1+(i<<1),x=o[_];const E=_+1;if(E<this.length&&l(o[E],x)<0&&(_=E,x=o[E]),l(x,m)>=0)break;o[i]=x,i=_}o[i]=m}}function a0(r,i){return r<i?-1:r>i?1:0}function w1(r,i=1,o=!1){let l=1/0,h=1/0,m=-1/0,_=-1/0;const x=r[0];for(let O=0;O<x.length;O++){const N=x[O];(!O||N.x<l)&&(l=N.x),(!O||N.y<h)&&(h=N.y),(!O||N.x>m)&&(m=N.x),(!O||N.y>_)&&(_=N.y)}const E=Math.min(m-l,_-h);let T=E/2;const S=new s0([],E1);if(0===E)return new et(l,h);for(let O=l;O<m;O+=E)for(let N=h;N<_;N+=E)S.push(new Zc(O+T,N+T,T,r));let P=function(O){let N=0,j=0,G=0;const ne=O[0];for(let ae=0,te=ne.length,se=te-1;ae<te;se=ae++){const he=ne[ae],le=ne[se],be=he.x*le.y-le.x*he.y;j+=(he.x+le.x)*be,G+=(he.y+le.y)*be,N+=3*be}return new Zc(j/N,G/N,0,O)}(r),L=S.length;for(;S.length;){const O=S.pop();(O.d>P.d||!P.d)&&(P=O,o&&console.log("found best %d after %d probes",Math.round(1e4*O.d)/1e4,L)),O.max-P.d<=i||(T=O.h/2,S.push(new Zc(O.p.x-T,O.p.y-T,T,r)),S.push(new Zc(O.p.x+T,O.p.y-T,T,r)),S.push(new Zc(O.p.x-T,O.p.y+T,T,r)),S.push(new Zc(O.p.x+T,O.p.y+T,T,r)),L+=4)}return o&&(console.log(`num probes: ${L}`),console.log(`best distance: ${P.d}`)),P.p}function E1(r,i){return i.max-r.max}function Zc(r,i,o,l){this.p=new et(r,i),this.h=o,this.d=function(h,m){let _=!1,x=1/0;for(let E=0;E<m.length;E++){const T=m[E];for(let S=0,P=T.length,L=P-1;S<P;L=S++){const O=T[S],N=T[L];O.y>h.y!=N.y>h.y&&h.x<(N.x-O.x)*(h.y-O.y)/(N.y-O.y)+O.x&&(_=!_),x=Math.min(x,yv(h,O,N))}}return(_?1:-1)*Math.sqrt(x)}(this.p,l),this.max=this.d+this.h*Math.SQRT2}const A_=Number.POSITIVE_INFINITY,P_=Math.sqrt(2);function l0(r,[i,o]){let l=0,h=0;if(o===A_){i<0&&(i=0);const m=i/P_;switch(r){case"top-right":case"top-left":h=m-7;break;case"bottom-right":case"bottom-left":h=7-m;break;case"bottom":h=7-i;break;case"top":h=i-7}switch(r){case"top-right":case"bottom-right":l=-m;break;case"top-left":case"bottom-left":l=m;break;case"left":l=i;break;case"right":l=-i}}else{switch(i=Math.abs(i),o=Math.abs(o),r){case"top-right":case"top-left":case"top":h=o-7;break;case"bottom-right":case"bottom-left":case"bottom":h=7-o}switch(r){case"top-right":case"bottom-right":case"right":l=-i;break;case"top-left":case"bottom-left":case"left":l=i}}return[l,h]}function L_(r,i,o,l,h,m,_,x,E,T){r.createArrays(),r.tilePixelRatio=St/(512*r.overscaling),r.compareText={},r.iconsNeedLinear=!1;const S=r.layers[0].layout,P=r.layers[0]._unevaluatedLayout._values,L={};if("composite"===r.textSizeData.kind){const{minZoom:j,maxZoom:G}=r.textSizeData;L.compositeTextSizes=[P["text-size"].possiblyEvaluate(new _e(j),x),P["text-size"].possiblyEvaluate(new _e(G),x)]}if("composite"===r.iconSizeData.kind){const{minZoom:j,maxZoom:G}=r.iconSizeData;L.compositeIconSizes=[P["icon-size"].possiblyEvaluate(new _e(j),x),P["icon-size"].possiblyEvaluate(new _e(G),x)]}L.layoutTextSize=P["text-size"].possiblyEvaluate(new _e(E+1),x),L.layoutIconSize=P["icon-size"].possiblyEvaluate(new _e(E+1),x),L.textMaxSize=P["text-size"].possiblyEvaluate(new _e(18),x);const O="map"===S.get("text-rotation-alignment")&&"point"!==S.get("symbol-placement"),N=S.get("text-size");for(const j of r.features){const G=S.get("text-font").evaluate(j,{},x).join(","),ne=N.evaluate(j,{},x),ae=L.layoutTextSize.evaluate(j,{},x),te=(L.layoutIconSize.evaluate(j,{},x),{horizontal:{},vertical:void 0}),se=j.text;let he,le=[0,0];if(se){const ke=se.toString(),Xe=24*S.get("text-letter-spacing").evaluate(j,{},x),Ae=24*S.get("text-line-height").evaluate(j,{},x),Oe=I(ke)?Xe:0,ze=S.get("text-anchor").evaluate(j,{},x),$e=S.get("text-variable-anchor");if(!$e){const ot=S.get("text-radial-offset").evaluate(j,{},x);le=ot?l0(ze,[24*ot,A_]):S.get("text-offset").evaluate(j,{},x).map(dt=>24*dt)}let Ke=O?"center":S.get("text-justify").evaluate(j,{},x);const Me="point"===S.get("symbol-placement"),nt=Me?24*S.get("text-max-width").evaluate(j,{},x):1/0,Dt=ot=>{r.allowVerticalPlacement&&D(ke)&&(te.vertical=Om(se,i,o,h,G,nt,Ae,ze,ot,Oe,le,Lo.vertical,!0,ae,ne))};if(!O&&$e){const ot="auto"===Ke?$e.map(tt=>Bm(tt)):[Ke];let dt=!1;for(let tt=0;tt<ot.length;tt++){const At=ot[tt];if(!te.horizontal[At])if(dt)te.horizontal[At]=te.horizontal[0];else{const tn=Om(se,i,o,h,G,nt,Ae,"center",At,Oe,le,Lo.horizontal,!1,ae,ne);tn&&(te.horizontal[At]=tn,dt=1===tn.positionedLines.length)}}Dt("left")}else{if("auto"===Ke&&(Ke=Bm(ze)),Me||S.get("text-writing-mode").indexOf("horizontal")>=0||!D(ke)){const ot=Om(se,i,o,h,G,nt,Ae,ze,Ke,Oe,le,Lo.horizontal,!1,ae,ne);ot&&(te.horizontal[Ke]=ot)}Dt(Me?"left":Ke)}}let be=!1;if(j.icon&&j.icon.name){const ke=l[j.icon.name];ke&&(he=n0(h[j.icon.name],S.get("icon-offset").evaluate(j,{},x),S.get("icon-anchor").evaluate(j,{},x)),be=ke.sdf,void 0===r.sdfIcons?r.sdfIcons=ke.sdf:r.sdfIcons!==ke.sdf&&Qn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ke.pixelRatio!==r.pixelRatio||0!==S.get("icon-rotate").constantOr(1))&&(r.iconsNeedLinear=!0))}const Ee=os(te.horizontal)||te.vertical;r.iconsInText||(r.iconsInText=!!Ee&&Ee.iconsInText),(Ee||he)&&k_(r,j,te,he,l,L,ae,0,le,be,_,x,T)}m&&r.generateCollisionDebugBuffers(E,r.collisionBoxArray)}function Bm(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function k_(r,i,o,l,h,m,_,x,E,T,S,P,L){let O=m.textMaxSize.evaluate(i,{},P);void 0===O&&(O=_);const N=r.layers[0].layout,j=N.get("icon-offset").evaluate(i,{},P),G=os(o.horizontal)||o.vertical,ne="globe"===L.name,ae=_/24,te=r.tilePixelRatio*O/24,se=(Oe=r.overscaling,r.zoom>18&&Oe>2&&(Oe>>=1),Math.max(St/(512*Oe),1)*N.get("symbol-spacing")),he=N.get("text-padding")*r.tilePixelRatio,le=N.get("icon-padding")*r.tilePixelRatio,be=on(N.get("text-max-angle")),Ee="map"===N.get("text-rotation-alignment")&&"point"!==N.get("symbol-placement"),ke="map"===N.get("icon-rotation-alignment")&&"point"!==N.get("symbol-placement"),Xe=N.get("symbol-placement"),Ae=se/2;var Oe;const ze=N.get("icon-text-fit");let $e;l&&"none"!==ze&&(r.allowVerticalPlacement&&o.vertical&&($e=r0(l,o.vertical,ze,N.get("icon-text-fit-padding"),j,ae)),G&&(l=r0(l,G,ze,N.get("icon-text-fit-padding"),j,ae)));const Ke=(Me,nt,Dt)=>{if(nt.x<0||nt.x>=St||nt.y<0||nt.y>=St)return;let ot=null;if(ne){const{x:dt,y:tt,z:At}=L.projectTilePoint(nt.x,nt.y,Dt);ot={anchor:new ko(dt,tt,At,0,void 0),up:L.upVector(Dt,nt.x,nt.y)}}!function(dt,tt,At,tn,cn,Kt,Mt,An,Ft,nn,un,zn,Rn,On,Kn,ri,Oi,Fn,vi,oi,En,li,Ii,jn,pi){const vr=dt.addToLineVertexArray(tt,tn);let Xi,Fi,xr,Ki,Ss,wh,Pd,Ld=0,ty=0,ny=0,iy=0,Eh=-1,Ja=-1;const el={};let Th=ra.exports("");const nu=At?At.anchor:tt;let sg=0,kd=0;if(void 0===Ft._unevaluatedLayout.getValue("text-radial-offset")?[sg,kd]=Ft.layout.get("text-offset").evaluate(En,{},pi).map(Yn=>24*Yn):(sg=24*Ft.layout.get("text-radial-offset").evaluate(En,{},pi),kd=A_),dt.allowVerticalPlacement&&cn.vertical){const Yn=cn.vertical;if(Kn)wh=of(Yn),An&&(Pd=of(An));else{const Ni=Ft.layout.get("text-rotate").evaluate(En,{},pi)+90;xr=rf(nn,nu,tt,un,zn,Rn,Yn,On,Ni,ri),An&&(Ki=rf(nn,nu,tt,un,zn,Rn,An,Fn,Ni))}}if(Kt){const Yn=Ft.layout.get("icon-rotate").evaluate(En,{},pi),Ni="none"!==Ft.layout.get("icon-text-fit"),$l=S_(Kt,Yn,Ii,Ni),go=An?S_(An,Yn,Ii,Ni):void 0;Fi=rf(nn,nu,tt,un,zn,Rn,Kt,Fn,Yn),Ld=4*$l.length;const pa=dt.iconSizeData;let hs=null;"source"===pa.kind?(hs=[la*Ft.layout.get("icon-size").evaluate(En,{},pi)],hs[0]>Bl&&Qn(`${dt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===pa.kind&&(hs=[la*li.compositeIconSizes[0].evaluate(En,{},pi),la*li.compositeIconSizes[1].evaluate(En,{},pi)],(hs[0]>Bl||hs[1]>Bl)&&Qn(`${dt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),dt.addSymbols(dt.icon,$l,hs,oi,vi,En,!1,At,tt,vr.lineStartIndex,vr.lineLength,-1,jn,pi),Eh=dt.icon.placedSymbolArray.length-1,go&&(ty=4*go.length,dt.addSymbols(dt.icon,go,hs,oi,vi,En,Lo.vertical,At,tt,vr.lineStartIndex,vr.lineLength,-1,jn,pi),Ja=dt.icon.placedSymbolArray.length-1)}for(const Yn in cn.horizontal){const Ni=cn.horizontal[Yn];Xi||(Th=ra.exports(Ni.text),Kn?Ss=of(Ni):Xi=rf(nn,nu,tt,un,zn,Rn,Ni,On,Ft.layout.get("text-rotate").evaluate(En,{},pi),ri));const $l=1===Ni.positionedLines.length;if(ny+=R_(dt,At,tt,Ni,Mt,Ft,Kn,En,ri,vr,cn.vertical?Lo.horizontal:Lo.horizontalOnly,$l?Object.keys(cn.horizontal):[Yn],el,Eh,li,jn,pi),$l)break}cn.vertical&&(iy+=R_(dt,At,tt,cn.vertical,Mt,Ft,Kn,En,ri,vr,Lo.vertical,["vertical"],el,Ja,li,jn,pi));let Ul=-1;const us=(Yn,Ni)=>Yn?Math.max(Yn,Ni):Ni;Ul=us(Ss,Ul),Ul=us(wh,Ul),Ul=us(Pd,Ul);const Rd=Ul>-1?1:0;dt.glyphOffsetArray.length>=Xa.MAX_GLYPHS&&Qn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==En.sortKey&&dt.addToSortKeyRanges(dt.symbolInstances.length,En.sortKey),dt.symbolInstances.emplaceBack(nu.x,nu.y,nu.z,tt.x,tt.y,el.right>=0?el.right:-1,el.center>=0?el.center:-1,el.left>=0?el.left:-1,el.vertical>=0?el.vertical:-1,Eh,Ja,Th,void 0!==Xi?Xi:dt.collisionBoxArray.length,void 0!==Xi?Xi+1:dt.collisionBoxArray.length,void 0!==xr?xr:dt.collisionBoxArray.length,void 0!==xr?xr+1:dt.collisionBoxArray.length,void 0!==Fi?Fi:dt.collisionBoxArray.length,void 0!==Fi?Fi+1:dt.collisionBoxArray.length,Ki||dt.collisionBoxArray.length,Ki?Ki+1:dt.collisionBoxArray.length,un,ny,iy,Ld,ty,Rd,0,sg,kd,Ul)}(r,nt,ot,Me,o,l,h,$e,r.layers[0],r.collisionBoxArray,i.index,i.sourceLayerIndex,r.index,he,Ee,E,0,le,ke,j,i,m,T,S,P)};if("line"===Xe)for(const Me of C_(i.geometry,0,0,St,St)){const nt=Nm(Me,se,be,o.vertical||G,l,24,te,r.overscaling,St);for(const Dt of nt){const ot=G;ot&&c0(r,ot.text,Ae,Dt)||Ke(Me,Dt,P)}}else if("line-center"===Xe){for(const Me of i.geometry)if(Me.length>1){const nt=o0(Me,be,o.vertical||G,l,24,te);nt&&Ke(Me,nt,P)}}else if("Polygon"===i.type)for(const Me of hd(i.geometry,0)){const nt=w1(Me,16);Ke(Me[0],new ko(nt.x,nt.y,0,0,void 0),P)}else if("LineString"===i.type)for(const Me of i.geometry)Ke(Me,new ko(Me[0].x,Me[0].y,0,0,void 0),P);else if("Point"===i.type)for(const Me of i.geometry)for(const nt of Me)Ke([nt],new ko(nt.x,nt.y,0,0,void 0),P)}const Bl=32640;function R_(r,i,o,l,h,m,_,x,E,T,S,P,L,O,N,j,G){const ne=function(se,he,le,be,Ee,ke,Xe,Ae){const Oe=[];if(0===he.positionedLines.length)return Oe;const ze=be.layout.get("text-rotate").evaluate(ke,{})*Math.PI/180,$e=function(ot){const dt=ot[0],tt=ot[1],At=dt*tt;return At>0?[dt,-tt]:At<0?[-dt,tt]:0===dt?[tt,dt]:[tt,-dt]}(le);let Ke=Math.abs(he.top-he.bottom);for(const ot of he.positionedLines)Ke-=ot.lineOffset;const Me=he.positionedLines.length,nt=Ke/Me;let Dt=he.top-le[1];for(let ot=0;ot<Me;++ot){const dt=he.positionedLines[ot];Dt=qa(he,nt,Dt,ot);for(const tt of dt.positionedGlyphs){if(!tt.rect)continue;const At=tt.rect||{};let tn=4,cn=!0,Kt=1,Mt=0;if(tt.imageName){const jn=Xe[tt.imageName];if(!jn)continue;if(jn.sdf){Qn("SDF images are not supported in formatted text and will be ignored.");continue}cn=!1,Kt=jn.pixelRatio,tn=1/Kt}const An=(Ee||Ae)&&tt.vertical,Ft=tt.metrics.advance*tt.scale/2,nn=tt.metrics,un=tt.rect;if(null===un)continue;Ae&&he.verticalizable&&(Mt=tt.imageName?Ft-tt.metrics.width*tt.scale/2:0);const zn=Ee?[tt.x+Ft,tt.y]:[0,0];let Rn=[0,0],On=[0,0],Kn=!1;Ee||(An?(On=[tt.x+Ft+$e[0],tt.y+$e[1]-Mt],Kn=!0):Rn=[tt.x+Ft+le[0],tt.y+le[1]-Mt]);const ri=un.w*tt.scale/(Kt*(tt.localGlyph?2:1)),Oi=un.h*tt.scale/(Kt*(tt.localGlyph?2:1));let Fn,vi,oi,En;if(An){const jn=tt.y-Dt,pi=new et(-Ft,Ft-jn),vr=-Math.PI/2,Xi=new et(...On);Fn=new et(-Ft+Rn[0],Rn[1]),Fn._rotateAround(vr,pi)._add(Xi),Fn.x+=-jn+Ft,Fn.y-=(nn.left-tn)*tt.scale;const Fi=tt.imageName?nn.advance*tt.scale:24*tt.scale,xr=String.fromCharCode(tt.glyph);_d(xr)?Fn.x+=(1-tn)*tt.scale:y_(xr)?Fn.x+=Fi-nn.height*tt.scale+(-tn-1)*tt.scale:Fn.x+=tt.imageName||nn.width+2*tn===un.w&&nn.height+2*tn===un.h?(Fi-Oi)/2:(Fi-(nn.height+2*tn)*tt.scale)/2,vi=new et(Fn.x,Fn.y-ri),oi=new et(Fn.x+Oi,Fn.y),En=new et(Fn.x+Oi,Fn.y-ri)}else{const jn=(nn.left-tn)*tt.scale-Ft+Rn[0],pi=(-nn.top-tn)*tt.scale+Rn[1],vr=jn+ri,Xi=pi+Oi;Fn=new et(jn,pi),vi=new et(vr,pi),oi=new et(jn,Xi),En=new et(vr,Xi)}if(ze){let jn;jn=Ee?new et(0,0):Kn?new et($e[0],$e[1]):new et(le[0],le[1]),Fn._rotateAround(ze,jn),vi._rotateAround(ze,jn),oi._rotateAround(ze,jn),En._rotateAround(ze,jn)}const li=new et(0,0),Ii=new et(0,0);Oe.push({tl:Fn,tr:vi,bl:oi,br:En,tex:At,writingMode:he.writingMode,glyphOffset:zn,sectionIndex:tt.sectionIndex,isSDF:cn,pixelOffsetTL:li,pixelOffsetBR:Ii,minFontScaleX:0,minFontScaleY:0})}}return Oe}(0,l,E,m,_,x,h,r.allowVerticalPlacement),ae=r.textSizeData;let te=null;"source"===ae.kind?(te=[la*m.layout.get("text-size").evaluate(x,{},G)],te[0]>Bl&&Qn(`${r.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===ae.kind&&(te=[la*N.compositeTextSizes[0].evaluate(x,{},G),la*N.compositeTextSizes[1].evaluate(x,{},G)],(te[0]>Bl||te[1]>Bl)&&Qn(`${r.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),r.addSymbols(r.text,ne,te,E,_,x,S,i,o,T.lineStartIndex,T.lineLength,O,j,G);for(const se of P)L[se]=r.text.placedSymbolArray.length-1;return 4*ne.length}function os(r){for(const i in r)return r[i];return null}function rf(r,i,o,l,h,m,_,x,E,T){let S=_.top,P=_.bottom,L=_.left,O=_.right;const N=_.collisionPadding;if(N&&(L-=N[0],S-=N[1],O+=N[2],P+=N[3]),E){const j=new et(L,S),G=new et(O,S),ne=new et(L,P),ae=new et(O,P),te=on(E);let se=new et(0,0);T&&(se=new et(T[0],T[1])),j._rotateAround(te,se),G._rotateAround(te,se),ne._rotateAround(te,se),ae._rotateAround(te,se),L=Math.min(j.x,G.x,ne.x,ae.x),O=Math.max(j.x,G.x,ne.x,ae.x),S=Math.min(j.y,G.y,ne.y,ae.y),P=Math.max(j.y,G.y,ne.y,ae.y)}return r.emplaceBack(i.x,i.y,i.z,o.x,o.y,L,S,O,P,x,l,h,m),r.length-1}function of(r){r.collisionPadding&&(r.top-=r.collisionPadding[1],r.bottom+=r.collisionPadding[3]);const i=r.bottom-r.top;return i>0?Math.max(10,i):null}function c0(r,i,o,l){const h=r.compareText;if(i in h){const m=h[i];for(let _=m.length-1;_>=0;_--)if(l.dist(m[_])<o)return!0}else h[i]=[];return h[i].push(l),!1}const u0=ut([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:O_}=u0,F_=ut([{name:"a_pos_3",components:3,type:"Int16"}]);var dh=ut([{name:"a_pos",type:"Int16",components:2}]);const Wa=St/Math.PI/2,Vm=2*Jo(1,0)*Wa*Math.PI,Gt=[64,32,16],Rt=-Wa,Ro=Wa,N_=[new ur([Rt,Rt,Rt],[Ro,Ro,Ro]),new ur([Rt,Rt,Rt],[0,0,Ro]),new ur([0,Rt,Rt],[Ro,0,Ro]),new ur([Rt,0,Rt],[0,Ro,Ro]),new ur([0,0,Rt],[Ro,Ro,Ro])];function z_(r,i,o,l=!0){const h=Mo([],r._camera.position,r.worldSize),m=[i,o,1,1];Nc(m,m,r.pixelMatrixInverse),eh(m,m,1/m[3]);const _=Or([],ts([],m,h)),x=r.globeMatrix,E=[x[12],x[13],x[14]],T=ts([],E,h),S=Qu(T),P=Or([],T),L=r.worldSize/(2*Math.PI),O=Ao(P,_),N=Math.asin(L/S);if(N<Math.acos(O)){if(!l)return null;const Xe=[],Ae=[];Mo(Xe,_,S/O),Or(Ae,ts(Ae,Xe,T)),Or(_,$a(_,T,Mo(_,Ae,Math.tan(N)*S)))}const j=[];new Tp(h,_).closestPointOnSphere(E,L,j);const G=Or([],Da(x,0)),ne=Or([],Da(x,1)),ae=Or([],Da(x,2)),te=Ao(G,j),se=Ao(ne,j),he=Ao(ae,j),le=bi(Math.asin(-se/L));let be=bi(Math.atan2(te,he));be=r.center.lng+function(Xe,Ae){const Oe=(Ae-Xe+180)%360-180;return Oe<-180?Oe+360:Oe}(r.center.lng,be);const Ee=po(be),ke=sn(Jr(le),0,1);return new Wu(Ee,ke)}class h0{constructor(i,o,l){this.a=ts([],i,l),this.b=ts([],o,l),this.center=l;const h=Or([],this.a),m=Or([],this.b);this.angle=Math.acos(Ao(h,m))}}function sf(r,i){if(0===r.angle)return null;let o;return o=0===r.a[i]?1/r.angle*.5*Math.PI:1/r.angle*Math.atan(r.b[i]/r.a[i]/Math.sin(r.angle)-1/Math.tan(r.angle)),o<0||o>1?null:function(l,h,m,_){const x=Math.sin(m);return l*(Math.sin((1-_)*m)/x)+h*(Math.sin(_*m)/x)}(r.a[i],r.b[i],r.angle,sn(o,0,1))+r.center[i]}function ca(r){if(r.z<=1)return N_[r.z+2*r.y+r.x];const i=af(bd(r));return ur.fromPoints(i)}function Vl(r,i,o){return Mo(r,r,1-o),od(r,r,i,o)}function B_(r,i){const o=mh(i.zoom);if(0===o)return ca(r);const l=bd(r),h=af(l),m=po(l.getWest())*i.worldSize,_=po(l.getEast())*i.worldSize,x=Jr(l.getNorth())*i.worldSize,E=Jr(l.getSouth())*i.worldSize,T=[m,x,0],S=[_,x,0],P=[m,E,0],L=[_,E,0],O=rd([],i.globeMatrix);return hi(T,T,O),hi(S,S,O),hi(P,P,O),hi(L,L,O),h[0]=Vl(h[0],P,o),h[1]=Vl(h[1],L,o),h[2]=Vl(h[2],S,o),h[3]=Vl(h[3],T,o),ur.fromPoints(h)}function V_(r,i,o){for(const l of r)hi(l,l,i),Mo(l,l,o)}function bd({x:r,y:i,z:o}){const l=1/(1<<o),h=new fn(Bt(r*l),qi((i+1)*l)),m=new fn(Bt((r+1)*l),qi(i*l));return new Ts(h,m)}function af(r){const i=on(r.getNorth()),o=on(r.getSouth()),l=Math.cos(i),h=Math.cos(o),m=Math.sin(i),_=Math.sin(o),x=r.getWest(),E=r.getEast();return[ss(h,_,x),ss(h,_,E),ss(l,m,E),ss(l,m,x)]}function ss(r,i,o,l=Wa){return o=on(o),[r*Math.sin(o)*l,-i*l,r*Math.cos(o)*l]}function wd(r,i,o){return ss(Math.cos(on(r)),Math.sin(on(r)),i,o)}function Xc(r,i,o,l){const h=1<<o.z,m=(r/St+o.x)/h;return wd(qi((i/St+o.y)/h),Bt(m),l)}function fh({min:r,max:i}){return 16383/Math.max(i[0]-r[0],i[1]-r[1],i[2]-r[2])}const j_=new Float64Array(16);function lf(r){const i=fh(r),o=Xg(j_,[i,i,i]);return wp(o,o,((l=[])[0]=-(h=r.min)[0],l[1]=-h[1],l[2]=-h[2],l));var l,h}function U_(r){const i=(l=r.min,(o=j_)[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=l[0],o[13]=l[1],o[14]=l[2],o[15]=1,o);var o,l;const h=1/fh(r);return Yu(i,i,[h,h,h])}function d0(r,i,o,l,h){const m=function(E){const T=St/(2*Math.PI);return E/(2*Math.PI)/T}(o),_=[r,i,-o/(2*Math.PI)],x=sa(new Float64Array(16));return wp(x,x,_),Yu(x,x,[m,m,m]),Zg(x,x,on(-h)),Jf(x,x,on(-l)),x}function mh(r){return wa(5,6,r)}function jm(r,i){const o=wd(i.lat,i.lng);return _=(h=im([],function(N){const j=wd(N._center.lat,N._center.lng);let G=rm([],Wi(0,1,0),j);const ne=em([],-N.angle,j);G=hi(G,G,ne),em(ne,-N._pitch,G);const ae=Or([],j);return Mo(ae,ae,N.cameraToCenterDistance/N.pixelsPerMeter*Vm),hi(ae,ae,ne),$a([],j,ae)}(r),o))[0],x=h[1],E=h[2],T=(m=o)[0],S=m[1],P=m[2],O=(L=Math.sqrt(_*_+x*x+E*E)*Math.sqrt(T*T+S*S+P*P))&&Ao(h,m)/L,Math.acos(Math.min(Math.max(O,-1),1));var h,m,_,x,E,T,S,P,L,O}function $_(r,i){return jm(r,i)>Math.PI/2*1.01}const G_=on(85),gh=Math.cos(G_),p0=Math.sin(G_);function Um(r,i){const o=r.fovAboveCenter,l=r.elevation?r.elevation.getMinElevationBelowMSL()*i:0,h=(r._camera.position[2]*r.worldSize-l)/Math.cos(r._pitch),m=Math.sin(o)*h/Math.sin(Math.max(Math.PI/2-r._pitch-o,.01)),_=Math.sin(r._pitch)*m+h;return Math.min(1.01*_,h*(1/r._horizonShift))}function ua(r,i){if(!i.isReprojectedInTileSpace)return{scale:1<<r.z,x:r.x,y:r.y,x2:r.x+1,y2:r.y+1,projection:i};const o=Math.pow(2,-r.z),l=r.x*o,h=(r.x+1)*o,m=r.y*o,_=(r.y+1)*o,x=Bt(l),E=Bt(h),T=qi(m),S=qi(_),P=i.project(x,T),L=i.project(E,T),O=i.project(E,S),N=i.project(x,S);let j=Math.min(P.x,L.x,O.x,N.x),G=Math.min(P.y,L.y,O.y,N.y),ne=Math.max(P.x,L.x,O.x,N.x),ae=Math.max(P.y,L.y,O.y,N.y);const te=o/16;function se(le,be,Ee,ke,Xe,Ae){const Oe=(Ee+Xe)/2,ze=(ke+Ae)/2,$e=i.project(Bt(Oe),qi(ze)),Ke=Math.max(0,j-$e.x,G-$e.y,$e.x-ne,$e.y-ae);j=Math.min(j,$e.x),ne=Math.max(ne,$e.x),G=Math.min(G,$e.y),ae=Math.max(ae,$e.y),Ke>te&&(se(le,$e,Ee,ke,Oe,ze),se($e,be,Oe,ze,Xe,Ae))}se(P,L,l,m,h,m),se(L,O,h,m,h,_),se(O,N,h,_,l,_),se(N,P,l,_,l,m),j-=te,G-=te,ne+=te,ae+=te;const he=1/Math.max(ne-j,ae-G);return{scale:he,x:j*he,y:G*he,x2:ne*he,y2:ae*he,projection:i}}const f0=sa(new Float32Array(16));class Za{constructor(i){this.spec=i,this.name=i.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(i,o){return{x:0,y:0,z:0}}unproject(i,o){return new fn(0,0)}projectTilePoint(i,o,l){return{x:i,y:o,z:0}}locationPoint(i,o,l=!0){return i._coordinatePoint(i.locationCoordinate(o),l)}pixelsPerMeter(i,o){return Jo(1,i)*o}pixelSpaceConversion(i,o,l){return 1}farthestPixelDistance(i){return Um(i,i.pixelsPerMeter)}pointCoordinate(i,o,l,h){const m=i.horizonLineFromTop(!1),_=new et(o,Math.max(m,l));return i.rayIntersectionCoordinate(i.pointRayIntersection(_,h))}pointCoordinate3D(i,o,l){const h=new et(o,l);if(i.elevation)return i.elevation.pointCoordinate(h);{const m=this.pointCoordinate(i,h.x,h.y,0);return[m.x,m.y,m.z]}}isPointAboveHorizon(i,o){if(i.elevation)return!this.pointCoordinate3D(i,o.x,o.y);const l=i.horizonLineFromTop();return o.y<l}createInversionMatrix(i,o){return f0}createTileMatrix(i,o,l){let h,m,_;const x=l.canonical,E=sa(new Float64Array(16));if(this.isReprojectedInTileSpace){const T=ua(x,this);h=1,m=T.x+l.wrap*T.scale,_=T.y,Yu(E,E,[h/T.scale,h/T.scale,i.pixelsPerMeter/o])}else h=o/i.zoomScale(x.z),m=(x.x+Math.pow(2,x.z)*l.wrap)*h,_=x.y*h;return wp(E,E,[m,_,0]),Yu(E,E,[h/St,h/St,1]),E}upVector(i,o,l){return[0,0,1]}upVectorScale(i,o,l){return{metersToTile:1}}}class m0 extends Za{constructor(i){super(i),this.range=[4,7],this.center=i.center||[-96,37.5];const[o,l]=this.parallels=i.parallels||[29.5,45.5],h=Math.sin(on(o));this.n=(h+Math.sin(on(l)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(i,o){const{n:l,c:h,r0:m}=this,_=on(i-this.center[0]),x=on(o),E=Math.sqrt(h-2*l*Math.sin(x))/l;return{x:E*Math.sin(_*l),y:E*Math.cos(_*l)-m,z:0}}unproject(i,o){const{n:l,c:h,r0:m}=this,_=m+o;let x=Math.atan2(i,Math.abs(_))*Math.sign(_);_*l<0&&(x-=Math.PI*Math.sign(i)*Math.sign(_));const E=on(this.center[0])*l;x=Fs(x,-Math.PI-E,Math.PI-E);const T=sn(bi(x/l)+this.center[0],-180,180),S=Math.asin(sn((h-(i*i+_*_)*l*l)/(2*l),-1,1)),P=sn(bi(S),-85.051129,es);return new fn(T,P)}}const Ed=1.340264,Td=-.081106,Dd=893e-6,Cd=.003796,Id=Math.sqrt(3)/2;class g0 extends Za{project(i,o){o=o/180*Math.PI,i=i/180*Math.PI;const l=Math.asin(Id*Math.sin(o)),h=l*l,m=h*h*h;return{x:.5*(i*Math.cos(l)/(Id*(Ed+3*Td*h+m*(7*Dd+9*Cd*h)))/Math.PI+.5),y:1-.5*(l*(Ed+Td*h+m*(Dd+Cd*h))/Math.PI+1),z:0}}unproject(i,o){i=(2*i-.5)*Math.PI;let l=o=(2*(1-o)-1)*Math.PI,h=l*l,m=h*h*h;for(let S,P,L,O=0;O<12&&(P=l*(Ed+Td*h+m*(Dd+Cd*h))-o,L=Ed+3*Td*h+m*(7*Dd+9*Cd*h),S=P/L,l=sn(l-S,-Math.PI/3,Math.PI/3),h=l*l,m=h*h*h,!(Math.abs(S)<1e-12));++O);const _=Id*i*(Ed+3*Td*h+m*(7*Dd+9*Cd*h))/Math.cos(l),x=Math.asin(Math.sin(l)/Id),E=sn(180*_/Math.PI,-180,180),T=sn(180*x/Math.PI,-85.051129,es);return new fn(E,T)}}class H_ extends Za{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0}project(i,o){return{x:.5+i/360,y:.5-o/360,z:0}}unproject(i,o){const l=360*(i-.5),h=sn(360*(.5-o),-85.051129,es);return new fn(l,h)}}const Kc=Math.PI/2;function _h(r){return Math.tan((Kc+r)/2)}class D1 extends Za{constructor(i){super(i),this.center=i.center||[0,30];const[o,l]=this.parallels=i.parallels||[30,30];let h=on(o),m=on(l);this.southernCenter=h+m<0,this.southernCenter&&(h=-h,m=-m);const _=Math.cos(h),x=_h(h);this.n=h===m?Math.sin(h):Math.log(_/Math.cos(m))/Math.log(_h(m)/x),this.f=_*Math.pow(_h(h),this.n)/this.n}project(i,o){o=on(o),this.southernCenter&&(o=-o),i=on(i-this.center[0]);const l=1e-6,{n:h,f:m}=this;m>0?o<-Kc+l&&(o=-Kc+l):o>Kc-l&&(o=Kc-l);const _=m/Math.pow(_h(o),h);let x=_*Math.sin(h*i),E=m-_*Math.cos(h*i);return x=.5*(x/Math.PI+.5),E=.5*(E/Math.PI+.5),{x,y:this.southernCenter?E:1-E,z:0}}unproject(i,o){i=(2*i-.5)*Math.PI,this.southernCenter&&(o=1-o),o=(2*(1-o)-.5)*Math.PI;const{n:l,f:h}=this,m=h-o,_=Math.sign(m),x=Math.sign(l)*Math.sqrt(i*i+m*m);let E=Math.atan2(i,Math.abs(m))*_;m*l<0&&(E-=Math.PI*Math.sign(i)*_);const T=sn(bi(E/l)+this.center[0],-180,180),S=sn(bi(2*Math.atan(Math.pow(h/x,1/l))-Kc),-85.051129,es);return new fn(T,this.southernCenter?-S:S)}}class cf extends Za{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(i,o){return{x:po(i),y:Jr(o),z:0}}unproject(i,o){const l=Bt(i),h=qi(o);return new fn(l,h)}}const q_=on(es);class C1 extends Za{project(i,o){const l=(o=on(o))*o,h=l*l;return{x:.5*((i=on(i))*(.8707-.131979*l+h*(h*(.003971*l-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(o*(1.007226+l*(.015085+h*(.028874*l-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(i,o){i=(2*i-.5)*Math.PI;let l=o=(2*(1-o)-1)*Math.PI,h=25,m=0,_=l*l;do{_=l*l;const T=_*_;m=(l*(1.007226+_*(.015085+T*(.028874*_-.044475-.005916*T)))-o)/(1.007226+_*(.045255+T*(.259866*_-.311325-.005916*11*T))),l=sn(l-m,-q_,q_)}while(Math.abs(m)>1e-6&&--h>0);_=l*l;const x=sn(bi(i/(.8707+_*(_*(_*_*_*(.003971-.001529*_)-.013791)-.131979))),-180,180),E=bi(l);return new fn(x,E)}}const zt=on(es);class _0 extends Za{project(i,o){o=on(o),i=on(i);const l=Math.cos(o),h=2/Math.PI,m=Math.acos(l*Math.cos(i/2)),_=Math.sin(m)/m,x=.5*(i*h+2*l*Math.sin(i/2)/_)||0,E=.5*(o+Math.sin(o)/_)||0;return{x:.5*(x/Math.PI+.5),y:1-.5*(E/Math.PI+1),z:0}}unproject(i,o){let l=i=(2*i-.5)*Math.PI,h=o=(2*(1-o)-1)*Math.PI,m=25;const _=1e-6;let x=0,E=0;do{const T=Math.cos(h),S=Math.sin(h),P=2*S*T,L=S*S,O=T*T,N=Math.cos(l/2),j=Math.sin(l/2),G=2*N*j,ne=j*j,ae=1-O*N*N,te=ae?1/ae:0,se=ae?Math.acos(T*N)*Math.sqrt(1/ae):0,he=.5*(2*se*T*j+2*l/Math.PI)-i,le=.5*(se*S+h)-o,be=.5*te*(O*ne+se*T*N*L)+1/Math.PI,Ee=te*(G*P/4-se*S*j),ke=.125*te*(P*j-se*S*O*G),Xe=.5*te*(L*N+se*ne*T)+.5,Ae=Ee*ke-Xe*be;x=(le*Ee-he*Xe)/Ae,E=(he*ke-le*be)/Ae,l=sn(l-x,-Math.PI,Math.PI),h=sn(h-E,-zt,zt)}while((Math.abs(x)>_||Math.abs(E)>_)&&--m>0);return new fn(bi(l),bi(h))}}class $m extends Za{constructor(i){super(i),this.center=i.center||[0,0],this.parallels=i.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(on(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(i,o){const{scale:l,cosPhi:h}=this;return{x:on(i)*h*l+.5,y:-Math.sin(on(o))/h*l+.5,z:0}}unproject(i,o){const{scale:l,cosPhi:h}=this,m=-(o-.5)/l,_=sn(bi((i-.5)/l)/h,-180,180),x=Math.asin(sn(m*h,-1,1)),E=sn(bi(x),-85.051129,es);return new fn(_,E)}}class uf extends cf{constructor(i){super(i),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(i,o,l){const h=Xc(i,o,l);return hi(h,h,lf(ca(l))),{x:h[0],y:h[1],z:h[2]}}locationPoint(i,o){const l=wd(o.lat,o.lng),h=Or([],l),m=i.elevation?i.elevation.getAtPointOrZero(i.locationCoordinate(o),i._centerAltitude):i._centerAltitude;od(l,l,h,Jo(1,0)*St*m);const _=sa(new Float64Array(16));return Ku(_,i.pixelMatrix,i.globeMatrix),hi(l,l,_),new et(l[0],l[1])}pixelsPerMeter(i,o){return Jo(1,0)*o}pixelSpaceConversion(i,o,l){const h=Jo(1,i)*o,m=dn(Jo(1,45)*o,h,l);return this.pixelsPerMeter(i,o)/m}createTileMatrix(i,o,l){const h=U_(ca(l.canonical));return Ku(new Float64Array(16),i.globeMatrix,h)}createInversionMatrix(i,o){const{center:l}=i,h=lf(ca(o));return Jf(h,h,on(l.lng)),Zg(h,h,on(l.lat)),Yu(h,h,[i._pixelsPerMercatorPixel,i._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(i,o,l,h){return z_(i,o,l,!0)||new Wu(0,0)}pointCoordinate3D(i,o,l){const h=this.pointCoordinate(i,o,l,0);return[h.x,h.y,h.z]}isPointAboveHorizon(i,o){return!z_(i,o.x,o.y,!1)}farthestPixelDistance(i){const o=function(h,m){const _=h.cameraToCenterDistance,x=h._centerAltitude*m,E=h._camera,T=h._camera.forward(),S=$a([],Mo([],T,-_),[0,0,x]),P=h.worldSize/(2*Math.PI),L=[0,0,-P],O=h.width/h.height,N=Math.tan(h.fovAboveCenter),j=Mo([],E.up(),N),G=Mo([],E.right(),N*O),ne=Or([],$a([],$a([],T,j),G)),ae=[];let te;if(new Tp(S,ne).closestPointOnSphere(L,P,ae)){const se=$a([],ae,L),he=ts([],se,S);te=Math.cos(h.fovAboveCenter)*Qu(he)}else{const se=ts([],S,L),he=ts([],L,S);Or(he,he);const le=Qu(se)-P;te=Math.sqrt(le*(le+2*P));const be=Math.acos(te/(P+le))-Math.acos(Ao(T,he));te*=Math.cos(be)}return 1.01*te}(i,this.pixelsPerMeter(i.center.lat,i.worldSize)),l=mh(i.zoom);if(l>0){const h=Um(i,Jo(1,i.center.lat)*i.worldSize),m=i.worldSize/(2*Math.PI),_=Math.max(i.width,i.height)/i.worldSize*Math.PI;return dn(o,h+m*(1-Math.cos(_)),Math.pow(l,10))}return o}upVector(i,o,l){return Xc(o,l,i,1)}upVectorScale(i){return{metersToTile:Vm*fh(ca(i))}}}function as(r){const i=r.parallels,o=!!i&&Math.abs(i[0]+i[1])<.01;switch(r.name){case"mercator":return new cf(r);case"equirectangular":return new H_(r);case"naturalEarth":return new C1(r);case"equalEarth":return new g0(r);case"winkelTripel":return new _0(r);case"albers":return o?new $m(r):new m0(r);case"lambertConformalConic":return o?new $m(r):new D1(r);case"globe":return new uf(r)}throw new Error(`Invalid projection name: ${r.name}`)}const W_=Bp.types,y0=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function yh(r,i,o,l,h,m,_,x,E,T,S,P,L){const O=x?Math.min(Bl,Math.round(x[0])):0,N=x?Math.min(Bl,Math.round(x[1])):0;r.emplaceBack(i,o,Math.round(32*l),Math.round(32*h),m,_,(O<<1)+(E?1:0),N,16*T,16*S,256*P,256*L)}function ls(r,i,o,l,h,m,_){r.emplaceBack(i,o,l,h,m,_)}function vh(r,i,o,l,h){r.emplaceBack(i,o,l,h),r.emplaceBack(i,o,l,h),r.emplaceBack(i,o,l,h),r.emplaceBack(i,o,l,h)}function Z_(r){for(const i of r.sections)if(Z(i.text))return!0;return!1}class Sd{constructor(i){this.layoutVertexArray=new Nn,this.indexArray=new cr,this.programConfigurations=i,this.segments=new ai,this.dynamicLayoutVertexArray=new Qr,this.opacityVertexArray=new ii,this.placedSymbolArray=new tv,this.globeExtVertexArray=new bn}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(i,o,l,h){this.isEmpty()||(l&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Hv.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,qv.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,y0,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,Im.members,!0)),this.opacityVertexBuffer.itemSize=1),(l||h)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}lt(Sd,"SymbolBuffers");class X_{constructor(i,o,l){this.layoutVertexArray=new i,this.layoutAttributes=o,this.indexArray=new l,this.segments=new ai,this.collisionVertexArray=new Pl,this.collisionVertexArrayExt=new kr}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,Ri.members,!0),this.collisionVertexBufferExt=i.createVertexBuffer(this.collisionVertexArrayExt,Wv.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}lt(X_,"CollisionBuffers");class Xa{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(_=>_.id),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=sa([]),this.placementViewportMatrix=sa([]);const o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Sm(this.zoom,o["text-size"]),this.iconSizeData=Sm(this.zoom,o["icon-size"]);const l=this.layers[0].layout,h=l.get("symbol-sort-key"),m=l.get("symbol-z-order");this.canOverlap=l.get("text-allow-overlap")||l.get("icon-allow-overlap")||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==m&&void 0!==h.constantOr(1),this.sortFeaturesByY=("viewport-y"===m||"auto"===m&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=l.get("text-writing-mode").map(_=>Lo[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=i.sourceID,this.projection=i.projection}createArrays(){this.text=new Sd(new Rl(this.layers,this.zoom,i=>/^text/.test(i))),this.icon=new Sd(new Rl(this.layers,this.zoom,i=>/^icon/.test(i))),this.glyphOffsetArray=new nv,this.lineVertexArray=new iv,this.symbolInstances=new wn}calculateGlyphDependencies(i,o,l,h,m){for(let _=0;_<i.length;_++)if(o[i.charCodeAt(_)]=!0,h&&m){const x=Hp[i.charAt(_)];x&&(o[x.charCodeAt(0)]=!0)}}populate(i,o,l,h){const m=this.layers[0],_=m.layout,x="globe"===this.projection.name,E=_.get("text-font"),T=_.get("text-field"),S=_.get("icon-image"),P=("constant"!==T.value.kind||T.value.value instanceof tr&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&("constant"!==E.value.kind||E.value.value.length>0),L="constant"!==S.value.kind||!!S.value.value||Object.keys(S.parameters).length>0,O=_.get("symbol-sort-key");if(this.features=[],!P&&!L)return;const N=o.iconDependencies,j=o.glyphDependencies,G=o.availableImages,ne=new _e(this.zoom);for(const{feature:ae,id:te,index:se,sourceLayerIndex:he}of i){const le=m._featureFilter.needGeometry,be=Ds(ae,le);if(!m._featureFilter.filter(ne,be,l))continue;if(le||(be.geometry=oa(ae,l,h)),x&&1!==ae.type&&l.z<=5){const Ae=be.geometry,Oe=.98078528056,ze=($e,Ke)=>Ao(Xc($e.x,$e.y,l,1),Xc(Ke.x,Ke.y,l,1))<Oe;for(let $e=0;$e<Ae.length;$e++)Ae[$e]=gp(Ae[$e],ze)}let Ee,ke;if(P){const Ae=m.getValueAndResolveTokens("text-field",be,l,G),Oe=tr.factory(Ae);Z_(Oe)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===me()||this.hasRTLText&&Te.isParsed())&&(Ee=b1(Oe,m,be))}if(L){const Ae=m.getValueAndResolveTokens("icon-image",be,l,G);ke=Ae instanceof xo?Ae:xo.fromString(Ae)}if(!Ee&&!ke)continue;const Xe=this.sortFeaturesByKey?O.evaluate(be,{},l):void 0;if(this.features.push({id:te,text:Ee,icon:ke,index:se,sourceLayerIndex:he,geometry:be.geometry,properties:ae.properties,type:W_[ae.type],sortKey:Xe}),ke&&(N[ke.name]=!0),Ee){const Ae=E.evaluate(be,{},l).join(","),Oe="map"===_.get("text-rotation-alignment")&&"point"!==_.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Lo.vertical)>=0;for(const ze of Ee.sections)if(ze.image)N[ze.image.name]=!0;else{const $e=D(Ee.toString()),Ke=ze.fontStack||Ae,Me=j[Ke]=j[Ke]||{};this.calculateGlyphDependencies(ze.text,Me,Oe,this.allowVerticalPlacement,$e)}}}"line"===_.get("symbol-placement")&&(this.features=function(ae){const te={},se={},he=[];let le=0;function be(Ae){he.push(ae[Ae]),le++}function Ee(Ae,Oe,ze){const $e=se[Ae];return delete se[Ae],se[Oe]=$e,he[$e].geometry[0].pop(),he[$e].geometry[0]=he[$e].geometry[0].concat(ze[0]),$e}function ke(Ae,Oe,ze){const $e=te[Oe];return delete te[Oe],te[Ae]=$e,he[$e].geometry[0].shift(),he[$e].geometry[0]=ze[0].concat(he[$e].geometry[0]),$e}function Xe(Ae,Oe,ze){const $e=ze?Oe[0][Oe[0].length-1]:Oe[0][0];return`${Ae}:${$e.x}:${$e.y}`}for(let Ae=0;Ae<ae.length;Ae++){const Oe=ae[Ae],ze=Oe.geometry,$e=Oe.text?Oe.text.toString():null;if(!$e){be(Ae);continue}const Ke=Xe($e,ze),Me=Xe($e,ze,!0);if(Ke in se&&Me in te&&se[Ke]!==te[Me]){const nt=ke(Ke,Me,ze),Dt=Ee(Ke,Me,he[nt].geometry);delete te[Ke],delete se[Me],se[Xe($e,he[Dt].geometry,!0)]=Dt,he[nt].geometry=null}else Ke in se?Ee(Ke,Me,ze):Me in te?ke(Ke,Me,ze):(be(Ae),te[Ke]=le-1,se[Me]=le-1)}return he.filter(Ae=>Ae.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ae,te)=>ae.sortKey-te.sortKey)}update(i,o,l,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,o,this.layers,l,h),this.icon.programConfigurations.updatePaintArrays(i,o,this.layers,l,h))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=as(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,o){const l=this.lineVertexArray.length;if(void 0!==i.segment)for(const{x:h,y:m}of o)this.lineVertexArray.emplaceBack(h,m);return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(i,o,l,h,m,_,x,E,T,S,P,L,O,N){const j=i.indexArray,G=i.layoutVertexArray,ne=i.globeExtVertexArray,ae=i.segments.prepareSegment(4*o.length,G,j,this.canOverlap?_.sortKey:void 0),te=this.glyphOffsetArray.length,se=ae.vertexLength,he=this.allowVerticalPlacement&&x===Lo.vertical?Math.PI/2:0,le=_.text&&_.text.sections;for(let Ee=0;Ee<o.length;Ee++){const{tl:ke,tr:Xe,bl:Ae,br:Oe,tex:ze,pixelOffsetTL:$e,pixelOffsetBR:Ke,minFontScaleX:Me,minFontScaleY:nt,glyphOffset:Dt,isSDF:ot,sectionIndex:dt}=o[Ee],tt=ae.vertexLength,At=Dt[1];if(yh(G,T.x,T.y,ke.x,At+ke.y,ze.x,ze.y,l,ot,$e.x,$e.y,Me,nt),yh(G,T.x,T.y,Xe.x,At+Xe.y,ze.x+ze.w,ze.y,l,ot,Ke.x,$e.y,Me,nt),yh(G,T.x,T.y,Ae.x,At+Ae.y,ze.x,ze.y+ze.h,l,ot,$e.x,Ke.y,Me,nt),yh(G,T.x,T.y,Oe.x,At+Oe.y,ze.x+ze.w,ze.y+ze.h,l,ot,Ke.x,Ke.y,Me,nt),E){const{x:tn,y:cn,z:Kt}=E.anchor,[Mt,An,Ft]=E.up;ls(ne,tn,cn,Kt,Mt,An,Ft),ls(ne,tn,cn,Kt,Mt,An,Ft),ls(ne,tn,cn,Kt,Mt,An,Ft),ls(ne,tn,cn,Kt,Mt,An,Ft),vh(i.dynamicLayoutVertexArray,tn,cn,Kt,he)}else vh(i.dynamicLayoutVertexArray,T.x,T.y,T.z,he);j.emplaceBack(tt,tt+1,tt+2),j.emplaceBack(tt+1,tt+2,tt+3),ae.vertexLength+=4,ae.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Dt[0]),Ee!==o.length-1&&dt===o[Ee+1].sectionIndex||i.programConfigurations.populatePaintArrays(G.length,_,_.index,{},O,N,le&&le[dt])}const be=E?E.anchor:T;i.placedSymbolArray.emplaceBack(be.x,be.y,be.z,T.x,T.y,te,this.glyphOffsetArray.length-te,se,S,P,T.segment,l?l[0]:0,l?l[1]:0,h[0],h[1],x,0,!1,0,L,0)}_commitLayoutVertex(i,o,l,h,m,_,x){i.emplaceBack(o,l,h,m,_,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(i,o,l,h,m,_,x){const E=l.segments.prepareSegment(4,l.layoutVertexArray,l.indexArray),T=E.vertexLength,S=x.tileAnchorX,P=x.tileAnchorY;for(let O=0;O<4;O++)l.collisionVertexArray.emplaceBack(0,0,0,0);l.collisionVertexArrayExt.emplaceBack(o,-i.padding,-i.padding),l.collisionVertexArrayExt.emplaceBack(o,i.padding,-i.padding),l.collisionVertexArrayExt.emplaceBack(o,i.padding,i.padding),l.collisionVertexArrayExt.emplaceBack(o,-i.padding,i.padding),this._commitLayoutVertex(l.layoutVertexArray,h,m,_,S,P,new et(i.x1,i.y1)),this._commitLayoutVertex(l.layoutVertexArray,h,m,_,S,P,new et(i.x2,i.y1)),this._commitLayoutVertex(l.layoutVertexArray,h,m,_,S,P,new et(i.x2,i.y2)),this._commitLayoutVertex(l.layoutVertexArray,h,m,_,S,P,new et(i.x1,i.y2)),E.vertexLength+=4;const L=l.indexArray;L.emplaceBack(T,T+1),L.emplaceBack(T+1,T+2),L.emplaceBack(T+2,T+3),L.emplaceBack(T+3,T),E.primitiveLength+=4}_addTextDebugCollisionBoxes(i,o,l,h,m,_){for(let x=h;x<m;x++){const E=l.get(x),T=this.getSymbolInstanceTextSize(i,_,o,x);this._addCollisionDebugVertices(E,T,this.textCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(i,o,l,h,m,_){for(let x=h;x<m;x++){const E=l.get(x),T=this.getSymbolInstanceIconSize(i,o,_.placedIconSymbolIndex);this._addCollisionDebugVertices(E,T,this.iconCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,_)}}generateCollisionDebugBuffers(i,o){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new X_(Gn,g_.members,gr),this.iconCollisionBox=new X_(Gn,g_.members,gr);const l=lh(this.iconSizeData,i),h=lh(this.textSizeData,i);for(let m=0;m<this.symbolInstances.length;m++){const _=this.symbolInstances.get(m);this._addTextDebugCollisionBoxes(h,i,o,_.textBoxStartIndex,_.textBoxEndIndex,_),this._addTextDebugCollisionBoxes(h,i,o,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._addIconDebugCollisionBoxes(l,i,o,_.iconBoxStartIndex,_.iconBoxEndIndex,_),this._addIconDebugCollisionBoxes(l,i,o,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex,_)}}getSymbolInstanceTextSize(i,o,l,h){const m=this.text.placedSymbolArray.get(o.rightJustifiedTextSymbolIndex>=0?o.rightJustifiedTextSymbolIndex:o.centerJustifiedTextSymbolIndex>=0?o.centerJustifiedTextSymbolIndex:o.leftJustifiedTextSymbolIndex>=0?o.leftJustifiedTextSymbolIndex:o.verticalPlacedTextSymbolIndex>=0?o.verticalPlacedTextSymbolIndex:h),_=Gp(this.textSizeData,i,m)/24;return this.tilePixelRatio*_}getSymbolInstanceIconSize(i,o,l){const h=this.icon.placedSymbolArray.get(l),m=Gp(this.iconSizeData,i,h);return this.tilePixelRatio*m}_commitDebugCollisionVertexUpdate(i,o,l){i.emplaceBack(o,-l,-l),i.emplaceBack(o,l,-l),i.emplaceBack(o,l,l),i.emplaceBack(o,-l,l)}_updateTextDebugCollisionBoxes(i,o,l,h,m,_){for(let x=h;x<m;x++){const E=l.get(x),T=this.getSymbolInstanceTextSize(i,_,o,x);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,T,E.padding)}}_updateIconDebugCollisionBoxes(i,o,l,h,m,_){for(let x=h;x<m;x++){const E=l.get(x),T=this.getSymbolInstanceIconSize(i,o,_);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,T,E.padding)}}updateCollisionDebugBuffers(i,o){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const l=lh(this.iconSizeData,i),h=lh(this.textSizeData,i);for(let m=0;m<this.symbolInstances.length;m++){const _=this.symbolInstances.get(m);this._updateTextDebugCollisionBoxes(h,i,o,_.textBoxStartIndex,_.textBoxEndIndex,_),this._updateTextDebugCollisionBoxes(h,i,o,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._updateIconDebugCollisionBoxes(l,i,o,_.iconBoxStartIndex,_.iconBoxEndIndex,_.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(l,i,o,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex,_.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(i,o,l,h,m,_,x,E,T){const S={};if(o<l){const{x1:P,y1:L,x2:O,y2:N,padding:j,projectedAnchorX:G,projectedAnchorY:ne,projectedAnchorZ:ae,tileAnchorX:te,tileAnchorY:se,featureIndex:he}=i.get(o);S.textBox={x1:P,y1:L,x2:O,y2:N,padding:j,projectedAnchorX:G,projectedAnchorY:ne,projectedAnchorZ:ae,tileAnchorX:te,tileAnchorY:se},S.textFeatureIndex=he}if(h<m){const{x1:P,y1:L,x2:O,y2:N,padding:j,projectedAnchorX:G,projectedAnchorY:ne,projectedAnchorZ:ae,tileAnchorX:te,tileAnchorY:se,featureIndex:he}=i.get(h);S.verticalTextBox={x1:P,y1:L,x2:O,y2:N,padding:j,projectedAnchorX:G,projectedAnchorY:ne,projectedAnchorZ:ae,tileAnchorX:te,tileAnchorY:se},S.verticalTextFeatureIndex=he}if(_<x){const{x1:P,y1:L,x2:O,y2:N,padding:j,projectedAnchorX:G,projectedAnchorY:ne,projectedAnchorZ:ae,tileAnchorX:te,tileAnchorY:se,featureIndex:he}=i.get(_);S.iconBox={x1:P,y1:L,x2:O,y2:N,padding:j,projectedAnchorX:G,projectedAnchorY:ne,projectedAnchorZ:ae,tileAnchorX:te,tileAnchorY:se},S.iconFeatureIndex=he}if(E<T){const{x1:P,y1:L,x2:O,y2:N,padding:j,projectedAnchorX:G,projectedAnchorY:ne,projectedAnchorZ:ae,tileAnchorX:te,tileAnchorY:se,featureIndex:he}=i.get(E);S.verticalIconBox={x1:P,y1:L,x2:O,y2:N,padding:j,projectedAnchorX:G,projectedAnchorY:ne,projectedAnchorZ:ae,tileAnchorX:te,tileAnchorY:se},S.verticalIconFeatureIndex=he}return S}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let o=0;o<this.symbolInstances.length;o++){const l=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(i,o){const l=i.placedSymbolArray.get(o),h=l.vertexStartIndex+4*l.numGlyphs;for(let m=l.vertexStartIndex;m<h;m+=4)i.indexArray.emplaceBack(m,m+1,m+2),i.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const o=Math.sin(i),l=Math.cos(i),h=[],m=[],_=[];for(let x=0;x<this.symbolInstances.length;++x){_.push(x);const E=this.symbolInstances.get(x);h.push(0|Math.round(o*E.tileAnchorX+l*E.tileAnchorY)),m.push(E.featureIndex)}return _.sort((x,E)=>h[x]-h[E]||m[E]-m[x]),_}addToSortKeyRanges(i,o){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===o?l.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const o of this.symbolInstanceIndexes){const l=this.symbolInstances.get(o);this.featureSortOrder.push(l.featureIndex);const{rightJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:m,leftJustifiedTextSymbolIndex:_,verticalPlacedTextSymbolIndex:x,placedIconSymbolIndex:E,verticalPlacedIconSymbolIndex:T}=l;h>=0&&this.addIndicesForPlacedSymbol(this.text,h),m>=0&&m!==h&&this.addIndicesForPlacedSymbol(this.text,m),_>=0&&_!==m&&_!==h&&this.addIndicesForPlacedSymbol(this.text,_),x>=0&&this.addIndicesForPlacedSymbol(this.text,x),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}lt(Xa,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Xa.MAX_GLYPHS=65535,Xa.addDynamicAttributes=vh;const I1=new wt({"symbol-placement":new ge(Re.layout_symbol["symbol-placement"]),"symbol-spacing":new ge(Re.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ge(Re.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ie(Re.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ge(Re.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ge(Re.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ge(Re.layout_symbol["icon-ignore-placement"]),"icon-optional":new ge(Re.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ge(Re.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ie(Re.layout_symbol["icon-size"]),"icon-text-fit":new ge(Re.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ge(Re.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ie(Re.layout_symbol["icon-image"]),"icon-rotate":new Ie(Re.layout_symbol["icon-rotate"]),"icon-padding":new ge(Re.layout_symbol["icon-padding"]),"icon-keep-upright":new ge(Re.layout_symbol["icon-keep-upright"]),"icon-offset":new Ie(Re.layout_symbol["icon-offset"]),"icon-anchor":new Ie(Re.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ge(Re.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ge(Re.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ge(Re.layout_symbol["text-rotation-alignment"]),"text-field":new Ie(Re.layout_symbol["text-field"]),"text-font":new Ie(Re.layout_symbol["text-font"]),"text-size":new Ie(Re.layout_symbol["text-size"]),"text-max-width":new Ie(Re.layout_symbol["text-max-width"]),"text-line-height":new Ie(Re.layout_symbol["text-line-height"]),"text-letter-spacing":new Ie(Re.layout_symbol["text-letter-spacing"]),"text-justify":new Ie(Re.layout_symbol["text-justify"]),"text-radial-offset":new Ie(Re.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ge(Re.layout_symbol["text-variable-anchor"]),"text-anchor":new Ie(Re.layout_symbol["text-anchor"]),"text-max-angle":new ge(Re.layout_symbol["text-max-angle"]),"text-writing-mode":new ge(Re.layout_symbol["text-writing-mode"]),"text-rotate":new Ie(Re.layout_symbol["text-rotate"]),"text-padding":new ge(Re.layout_symbol["text-padding"]),"text-keep-upright":new ge(Re.layout_symbol["text-keep-upright"]),"text-transform":new Ie(Re.layout_symbol["text-transform"]),"text-offset":new Ie(Re.layout_symbol["text-offset"]),"text-allow-overlap":new ge(Re.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ge(Re.layout_symbol["text-ignore-placement"]),"text-optional":new ge(Re.layout_symbol["text-optional"])});var xh={paint:new wt({"icon-opacity":new Ie(Re.paint_symbol["icon-opacity"]),"icon-color":new Ie(Re.paint_symbol["icon-color"]),"icon-halo-color":new Ie(Re.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ie(Re.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ie(Re.paint_symbol["icon-halo-blur"]),"icon-translate":new ge(Re.paint_symbol["icon-translate"]),"icon-translate-anchor":new ge(Re.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ie(Re.paint_symbol["text-opacity"]),"text-color":new Ie(Re.paint_symbol["text-color"],{runtimeType:$r,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new Ie(Re.paint_symbol["text-halo-color"]),"text-halo-width":new Ie(Re.paint_symbol["text-halo-width"]),"text-halo-blur":new Ie(Re.paint_symbol["text-halo-blur"]),"text-translate":new ge(Re.paint_symbol["text-translate"]),"text-translate-anchor":new ge(Re.paint_symbol["text-translate-anchor"])}),layout:I1};class Md{constructor(i){this.type=i.property.overrides?i.property.overrides.runtimeType:pr,this.defaultValue=i}evaluate(i){if(i.formattedSection){const o=this.defaultValue.property.overrides;if(o&&o.hasOverride(i.formattedSection))return o.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}lt(Md,"FormatSectionOverride",{omit:["defaultValue"]});class bh extends So{constructor(i){super(i,xh)}recalculate(i,o){super.recalculate(i,o),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const l=this.layout.get("text-writing-mode");if(l){const h=[];for(const m of l)h.indexOf(m)<0&&h.push(m);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(i,o,l,h){const m=this.layout.get(i).evaluate(o,{},l,h),_=this._unevaluatedLayout._values[i];return _.isDataDriven()||Lu(_.value)||!m?m:(x=o.properties,m.replace(/{([^{}]+)}/g,(T,S)=>S in x?String(x[S]):""));var x}createBucket(i){return new Xa(i)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const i of xh.paint.overridableProperties){if(!bh.hasPaintOverride(this.layout,i))continue;const o=this.paint.get(i),l=new Md(o),h=new jh(l,o.property.specification);let m=null;m="constant"===o.value.kind||"source"===o.value.kind?new Mr("source",h):new ku("composite",h,o.value.zoomStops,o.value._interpolationType),this.paint._values[i]=new Fe(o.property,m,o.parameters)}}_handleOverridablePaintPropertyUpdate(i,o,l){return!(!this.layout||o.isDataDriven()||l.isDataDriven())&&bh.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,o){const l=i.get("text-field"),h=xh.paint.properties[o];let m=!1;const _=x=>{for(const E of x)if(h.overrides&&h.overrides.hasOverride(E))return void(m=!0)};if("constant"===l.value.kind&&l.value.value instanceof tr)_(l.value.value.sections);else if("source"===l.value.kind){const x=T=>{m||(T instanceof Bi&&Ei(T.value)===Hs?_(T.value.sections):T instanceof Sn?_(T.sections):T.eachChild(x))},E=l.value;E._styleExpression&&x(E._styleExpression.expression)}return m}getProgramConfiguration(i){return new Pc(this,i)}}var Gm={paint:new wt({"background-color":new ge(Re.paint_background["background-color"]),"background-pattern":new ge(Re.paint_background["background-pattern"]),"background-opacity":new ge(Re.paint_background["background-opacity"])})},Hm={paint:new wt({"raster-opacity":new ge(Re.paint_raster["raster-opacity"]),"raster-hue-rotate":new ge(Re.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ge(Re.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ge(Re.paint_raster["raster-brightness-max"]),"raster-saturation":new ge(Re.paint_raster["raster-saturation"]),"raster-contrast":new ge(Re.paint_raster["raster-contrast"]),"raster-resampling":new ge(Re.paint_raster["raster-resampling"]),"raster-fade-duration":new ge(Re.paint_raster["raster-fade-duration"])})};class S1 extends So{constructor(i){super(i,{}),this.implementation=i}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(i){this.implementation.onAdd&&this.implementation.onAdd(i,i.painter.context.gl)}onRemove(i){this.implementation.onRemove&&this.implementation.onRemove(i,i.painter.context.gl)}}var v0={paint:new wt({"sky-type":new ge(Re.paint_sky["sky-type"]),"sky-atmosphere-sun":new ge(Re.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ge(Re.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ge(Re.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ge(Re.paint_sky["sky-gradient-radius"]),"sky-gradient":new ht(Re.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ge(Re.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ge(Re.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ge(Re.paint_sky["sky-opacity"])})};function qm(r,i,o){const l=[0,0,1],h=am([]);return lm(h,h,o?-on(r)+Math.PI:on(r)),Qg(h,h,-on(i)),Fr(l,l,h),Or(l,l)}const x0={circle:class extends So{constructor(r){super(r,_1)}createBucket(r){return new Kf(r)}queryRadius(r){const i=r;return Rc("circle-radius",this,i)+Rc("circle-stroke-width",this,i)+vp(this.paint.get("circle-translate"))}queryIntersectsFeature(r,i,o,l,h,m,_,x){const E=vv(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,r.pixelToTileUnitsFactor),T=this.paint.get("circle-radius").evaluate(i,o)+this.paint.get("circle-stroke-width").evaluate(i,o);return Dp(r,l,m,_,x,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),E,T)}getProgramIds(){return["circle"]}getProgramConfiguration(r){return new Pc(this,r)}},heatmap:class extends So{createBucket(r){return new Jg(r)}constructor(r){super(r,th),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){"heatmap-color"===r&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=ld({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(r){return Rc("heatmap-radius",this,r)}queryIntersectsFeature(r,i,o,l,h,m,_,x){const E=this.paint.get("heatmap-radius").evaluate(i,o);return Dp(r,l,m,_,x,!0,!0,new et(0,0),E)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(r){return new Pc(this,r)}},hillshade:class extends So{constructor(r){super(r,t_)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends So{constructor(r){super(r,a_)}getProgramIds(){const r=this.paint.get("fill-pattern"),i=r&&r.constantOr(1),o=[i?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&o.push(i&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),o}getProgramConfiguration(r){return new Pc(this,r)}recalculate(r,i){super.recalculate(r,i);const o=this.paint._values["fill-outline-color"];"constant"===o.value.kind&&void 0===o.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new Rp(r)}queryRadius(){return vp(this.paint.get("fill-translate"))}queryIntersectsFeature(r,i,o,l,h,m){return!r.queryGeometry.isAboveHorizon&&Xu(Qf(r.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,r.pixelToTileUnitsFactor),l)}isTileClipped(){return!0}},"fill-extrusion":class extends So{constructor(r){super(r,Vv)}createBucket(r){return new md(r)}queryRadius(){return vp(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(r){return new Pc(this,r)}queryIntersectsFeature(r,i,o,l,h,m,_,x,E){const T=vv(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,r.pixelToTileUnitsFactor),S=this.paint.get("fill-extrusion-height").evaluate(i,o),P=this.paint.get("fill-extrusion-base").evaluate(i,o),L=[0,0],O=x&&m.elevation,N=m.elevation?m.elevation.exaggeration():1,j=r.tile.getBucket(this);if(O&&j instanceof md){const se=j.centroidVertexArray,he=E+1;he<se.length&&(L[0]=se.geta_centroid_pos0(he),L[1]=se.geta_centroid_pos1(he))}if(0===L[0]&&1===L[1])return!1;"globe"===m.projection.name&&(l=p_([l],[new et(0,0),new et(St,St)],r.tileID.canonical).map(se=>se.polygon).flat());const G=O?x:null,[ne,ae]=(he=l,le=P,be=S,Ee=T,ke=_,Xe=G,Ae=L,Oe=N,ze=m.center.lat,"globe"===(se=m).projection.name?function(Ke,Me,nt,Dt,ot,dt,tt,At,tn,cn,Kt){const Mt=[],An=[],Ft=Ke.projection.upVectorScale(Kt,Ke.center.lat,Ke.worldSize).metersToTile,nn=[0,0,0,1],un=[0,0,0,1],zn=(On,Kn,ri,Oi)=>{On[0]=Kn,On[1]=ri,On[2]=Oi,On[3]=1},Rn=d_();nt>0&&(nt+=Rn),Dt+=Rn;for(const On of Me){const Kn=[],ri=[];for(const Oi of On){const Fn=Oi.x+ot.x,vi=Oi.y+ot.y,oi=Ke.projection.projectTilePoint(Fn,vi,Kt),En=Ke.projection.upVector(Kt,Oi.x,Oi.y);let li=nt,Ii=Dt;if(tt){const jn=Uv(Fn,vi,nt,Dt,tt,At,tn,cn);li+=jn.base,Ii+=jn.top}0!==nt?zn(nn,oi.x+En[0]*Ft*li,oi.y+En[1]*Ft*li,oi.z+En[2]*Ft*li):zn(nn,oi.x,oi.y,oi.z),zn(un,oi.x+En[0]*Ft*Ii,oi.y+En[1]*Ft*Ii,oi.z+En[2]*Ft*Ii),hi(nn,nn,dt),hi(un,un,dt),Kn.push(new $c(nn[0],nn[1],nn[2])),ri.push(new $c(un[0],un[1],un[2]))}Mt.push(Kn),An.push(ri)}return[Mt,An]}(se,he,le,be,Ee,ke,Xe,Ae,Oe,ze,r.tileID.canonical):Xe?function(Ke,Me,nt,Dt,ot,dt,tt,At,tn){const cn=[],Kt=[],Mt=[0,0,0,1];for(const An of Ke){const Ft=[],nn=[];for(const un of An){const zn=un.x+Dt.x,Rn=un.y+Dt.y,On=Uv(zn,Rn,Me,nt,dt,tt,At,tn);Mt[0]=zn,Mt[1]=Rn,Mt[2]=On.base,Mt[3]=1,Nc(Mt,Mt,ot),Mt[3]=Math.max(Mt[3],1e-5);const Kn=new $c(Mt[0]/Mt[3],Mt[1]/Mt[3],Mt[2]/Mt[3]);Mt[0]=zn,Mt[1]=Rn,Mt[2]=On.top,Mt[3]=1,Nc(Mt,Mt,ot),Mt[3]=Math.max(Mt[3],1e-5);const ri=new $c(Mt[0]/Mt[3],Mt[1]/Mt[3],Mt[2]/Mt[3]);Ft.push(Kn),nn.push(ri)}cn.push(Ft),Kt.push(nn)}return[cn,Kt]}(he,le,be,Ee,ke,Xe,Ae,Oe,ze):function(Ke,Me,nt,Dt,ot){const dt=[],tt=[],At=ot[8]*Me,tn=ot[9]*Me,cn=ot[10]*Me,Kt=ot[11]*Me,Mt=ot[8]*nt,An=ot[9]*nt,Ft=ot[10]*nt,nn=ot[11]*nt;for(const un of Ke){const zn=[],Rn=[];for(const On of un){const Kn=On.x+Dt.x,ri=On.y+Dt.y,Oi=ot[0]*Kn+ot[4]*ri+ot[12],Fn=ot[1]*Kn+ot[5]*ri+ot[13],vi=ot[2]*Kn+ot[6]*ri+ot[14],oi=ot[3]*Kn+ot[7]*ri+ot[15],En=Oi+At,li=Fn+tn,Ii=vi+cn,jn=Math.max(oi+Kt,1e-5),pi=Oi+Mt,vr=Fn+An,Xi=vi+Ft,Fi=Math.max(oi+nn,1e-5);zn.push(new $c(En/jn,li/jn,Ii/jn)),Rn.push(new $c(pi/Fi,vr/Fi,Xi/Fi))}dt.push(zn),tt.push(Rn)}return[dt,tt]}(he,le,be,Ee,ke)),te=r.queryGeometry;var se,he,le,be,Ee,ke,Xe,Ae,Oe,ze;return function(se,he,le){let be=1/0;Xu(le,he)&&(be=jv(le,he[0]));for(let Ee=0;Ee<he.length;Ee++){const ke=he[Ee],Xe=se[Ee];for(let Ae=0;Ae<ke.length-1;Ae++){const Oe=ke[Ae],ze=[Oe,ke[Ae+1],Xe[Ae+1],Xe[Ae],Oe];Ug(le,ze)&&(be=Math.min(be,jv(le,ze)))}}return be!==1/0&&be}(ne,ae,te.isPointQuery()?te.screenBounds:te.screenGeometry)}},line:class extends So{constructor(r){super(r,m_),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(r){if("line-gradient"===r){const i=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=i._styleExpression&&i._styleExpression.expression instanceof vc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(r,i){super.recalculate(r,i),this.paint._values["line-floorwidth"]=Cm.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new $p(r)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(r){return new Pc(this,r)}queryRadius(r){const i=r,o=gd(Rc("line-width",this,i),Rc("line-gap-width",this,i)),l=Rc("line-offset",this,i);return o/2+Math.abs(l)+vp(this.paint.get("line-translate"))}queryIntersectsFeature(r,i,o,l,h,m){if(r.queryGeometry.isAboveHorizon)return!1;const _=Qf(r.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,r.pixelToTileUnitsFactor),x=r.pixelToTileUnitsFactor/2*gd(this.paint.get("line-width").evaluate(i,o),this.paint.get("line-gap-width").evaluate(i,o)),E=this.paint.get("line-offset").evaluate(i,o);return E&&(l=function(T,S){const P=[],L=new et(0,0);for(let O=0;O<T.length;O++){const N=T[O],j=[];for(let G=0;G<N.length;G++){const ne=N[G-1],ae=N[G],te=N[G+1],se=0===G?L:ae.sub(ne)._unit()._perp(),he=G===N.length-1?L:te.sub(ae)._unit()._perp(),le=se._add(he)._unit();le._mult(1/(le.x*he.x+le.y*he.y)),j.push(le._mult(S)._add(ae))}P.push(j)}return P}(l,E*r.pixelToTileUnitsFactor)),function(T,S,P){for(let L=0;L<S.length;L++){const O=S[L];if(T.length>=3)for(let N=0;N<O.length;N++)if(kc(T,O[N]))return!0;if(_v(T,O,P))return!0}return!1}(_,l,x)}isTileClipped(){return!0}},symbol:bh,background:class extends So{constructor(r){super(r,Gm)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends So{constructor(r){super(r,Hm)}getProgramIds(){return["raster"]}},sky:class extends So{constructor(r){super(r,v0),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){"sky-gradient"===r?this._updateColorRamp():"sky-atmosphere-sun"!==r&&"sky-atmosphere-halo-color"!==r&&"sky-atmosphere-color"!==r&&"sky-atmosphere-sun-intensity"!==r||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=ld({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(r){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const i=r.style.light.properties.get("position");return this._lightPosition.azimuthal!==i.azimuthal||this._lightPosition.polar!==i.polar}return!1}getCenter(r,i){if("atmosphere"===this.paint.get("sky-type")){const l=this.paint.get("sky-atmosphere-sun"),h=!l,m=r.style.light,_=m.properties.get("position");return h&&"viewport"===m.properties.get("anchor")&&Qn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?qm(_.azimuthal,90-_.polar,i):qm(l[0],90-l[1],i)}const o=this.paint.get("sky-gradient-center");return qm(o[0],90-o[1],i)}is3D(){return!1}isSky(){return!0}markSkyboxValid(r){this._skyboxInvalidated=!1,this._lightPosition=r.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const r=this.paint.get("sky-type");return"atmosphere"===r?["skyboxCapture","skybox"]:"gradient"===r?["skyboxGradient"]:null}}};class Ad{constructor(i,o,l,h){this.context=i,this.format=l,this.texture=i.gl.createTexture(),this.update(o,h)}update(i,o,l){const{width:h,height:m}=i,{context:_}=this,{gl:x}=_,{HTMLImageElement:E,HTMLCanvasElement:T,HTMLVideoElement:S,ImageData:P,ImageBitmap:L}=Ue;if(x.bindTexture(x.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!o||!1!==o.premultiply)),l||this.size&&this.size[0]===h&&this.size[1]===m){const{x:O,y:N}=l||{x:0,y:0};i instanceof E||i instanceof T||i instanceof S||i instanceof P||L&&i instanceof L?x.texSubImage2D(x.TEXTURE_2D,0,O,N,x.RGBA,x.UNSIGNED_BYTE,i):x.texSubImage2D(x.TEXTURE_2D,0,O,N,h,m,x.RGBA,x.UNSIGNED_BYTE,i.data)}else this.size=[h,m],i instanceof E||i instanceof T||i instanceof S||i instanceof P||L&&i instanceof L?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,i):x.texImage2D(x.TEXTURE_2D,0,this.format,h,m,0,this.format,x.UNSIGNED_BYTE,i.data);this.useMipmap=Boolean(o&&o.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&x.generateMipmap(x.TEXTURE_2D)}bind(i,o){const{context:l}=this,{gl:h}=l;h.bindTexture(h.TEXTURE_2D,this.texture),i!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,i),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap?i===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_NEAREST:i),this.filter=i),o!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,o),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,o),this.wrap=o)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}class K_{constructor(i){this._callback=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class M1{constructor(){this.tasks={},this.taskQueue=[],zs(["process"],this),this.invoker=new K_(this.process),this.nextId=0}add(i,o){const l=this.nextId++,h=function({type:m,isSymbolTile:_,zoom:x}){return x=x||0,"message"===m?0:"maybePrepare"!==m||_?"parseTile"!==m||_?"parseTile"===m&&_?300-x:"maybePrepare"===m&&_?400-x:500:200-x:100-x}(o);if(0===h){Ho();try{i()}finally{}return{cancel:()=>{}}}return this.tasks[l]={fn:i,metadata:o,priority:h,id:l},this.taskQueue.push(l),this.invoker.trigger(),{cancel:()=>{delete this.tasks[l]}}}process(){Ho();try{if(this.taskQueue=this.taskQueue.filter(l=>!!this.tasks[l]),!this.taskQueue.length)return;const i=this.pick();if(null===i)return;const o=this.tasks[i];if(delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),!o)return;o.fn()}finally{}}pick(){let i=null,o=1/0;for(let h=0;h<this.taskQueue.length;h++){const m=this.tasks[this.taskQueue[h]];m.priority<o&&(o=m.priority,i=h)}if(null===i)return null;const l=this.taskQueue[i];return this.taskQueue.splice(i,1),l}remove(){this.invoker.remove()}}class Y_{constructor(i){this._stringToNumber={},this._numberToString=[];for(let o=0;o<i.length;o++){const l=i[o];this._stringToNumber[l]=o,this._numberToString[o]=l}}encode(i){return this._stringToNumber[i]}decode(i){return this._numberToString[i]}}const A1=["tile","layer","source","sourceLayer","state"];class Wm{constructor(i,o,l,h,m){this.type="Feature",this._vectorTileFeature=i,this._z=o,this._x=l,this._y=h,this.properties=i.properties,this.id=m}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={type:"Feature",geometry:this.geometry,properties:this.properties};void 0!==this.id&&(i.id=this.id);for(const o of A1)void 0!==this[o]&&(i[o]=this[o]);return i}}const da=new Uint16Array(8184);for(let r=0;r<2046;r++){let i=r+2,o=0,l=0,h=0,m=0,_=0,x=0;for(1&i?h=m=_=32:o=l=x=32;(i>>=1)>1;){const T=o+h>>1,S=l+m>>1;1&i?(h=o,m=l,o=_,l=x):(o=h,l=m,h=_,m=x),_=T,x=S}const E=4*r;da[E+0]=o,da[E+1]=l,da[E+2]=h,da[E+3]=m}const Ka=new Uint16Array(2178),Yc=new Uint8Array(1089),Zm=new Uint16Array(1089);function b0(r){return 0===r?-.03125:32===r?.03125:0}var w0=ut([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const E0={type:2,extent:St,loadGeometry:()=>[[new et(0,0),new et(8193,0),new et(8193,8193),new et(0,8193),new et(0,0)]]};class Q_{constructor(i,o,l,h,m){this.tileID=i,this.uid=Jl(),this.uses=0,this.tileSize=o,this.tileZoom=l,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=m,this.expiredRequestCount=0,this.state="loading",h&&h.transform&&(this.projection=h.transform.projection)}registerFadeDuration(i){const o=i+this.timeAdded;o<xt.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=ua(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(i,o,l){if(this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(h,m){const _={};if(!m)return _;for(const x of h){const E=x.layerIds.map(T=>m.getLayer(T)).filter(Boolean);if(0!==E.length){x.layers=E,x.stateDependentLayerIds&&(x.stateDependentLayers=x.stateDependentLayerIds.map(T=>E.filter(S=>S.id===T)[0]));for(const T of E)_[T.id]=x}}return _}(i.buckets,o.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const m=this.buckets[h];if(m instanceof Xa){if(this.hasSymbolBuckets=!0,!l)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const m=this.buckets[h];if(m instanceof Xa&&m.hasRTLText){this.hasRTLText=!0,Te.isLoading()||Te.isLoaded()||"deferred"!==me()||Se();break}}this.queryPadding=0;for(const h in this.buckets){const m=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(h).queryRadius(m))}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage),i.lineAtlas&&(this.lineAtlas=i.lineAtlas)}else this.collisionBoxArray=new Qh}unloadVectorData(){if(this.hasData()){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(i){return this.buckets[i.id]}upload(i){for(const l in this.buckets){const h=this.buckets[l];h.uploadPending()&&h.upload(i)}const o=i.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Ad(i,this.imageAtlas.image,o.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ad(i,this.glyphAtlasImage,o.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Ad(i,this.lineAtlas.image,o.ALPHA),this.lineAtlas.uploaded=!0)}prepare(i){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture)}queryRenderedFeatures(i,o,l,h,m,_,x,E){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:h,pixelPosMatrix:x,transform:_,params:m,tileTransform:this.tileTransform},i,o,l):{}}querySourceFeatures(i,o){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const h=l.loadVTLayers(),m=o?o.sourceLayer:"",_=h._geojsonTileLayer||h[m];if(!_)return;const x=Es(o&&o.filter),{z:E,x:T,y:S}=this.tileID.canonical,P={z:E,x:T,y:S};for(let L=0;L<_.length;L++){const O=_.feature(L);if(x.needGeometry){const G=Ds(O,!0);if(!x.filter(new _e(this.tileID.overscaledZ),G,this.tileID.canonical))continue}else if(!x.filter(new _e(this.tileID.overscaledZ),O))continue;const N=l.getId(O,m),j=new Wm(O,E,T,S,N);j.tile=P,i.push(j)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const o=this.expirationTime;if(i.cacheControl){const l=fu(i.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const l=Date.now();let h=!1;if(this.expirationTime>l)h=!1;else if(o)if(this.expirationTime<o)h=!0;else{const m=this.expirationTime-o;m?this.expirationTime=l+Math.max(m,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(i,o){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(i).length||!o)return;const l=this.latestFeatureIndex.loadVTLayers(),h=o.style.listImages();for(const m in this.buckets){if(!o.style.hasLayer(m))continue;const _=this.buckets[m],x=_.layers[0].sourceLayer||"_geojsonTileLayer",E=l[x],T=i[x];if(!E||!T||0===Object.keys(T).length)continue;if(_.update(T,E,h,this.imageAtlas&&this.imageAtlas.patternPositions||{}),_ instanceof $p||_ instanceof Rp){const P=o.style._getSourceCache(_.layers[0].source);o._terrain&&o._terrain.enabled&&P&&_.programConfigurations.needsUpload&&o._terrain._clearRenderCacheForTile(P.id,this.tileID)}const S=o&&o.style&&o.style.getLayer(m);S&&(this.queryPadding=Math.max(this.queryPadding,S.queryRadius(_)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<xt.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=xt.now()+i}setTexture(i,o){const l=o.context,h=l.gl;this.texture=this.texture||o.getTileTexture(i.width),this.texture?this.texture.update(i,{useMipmap:!0}):(this.texture=new Ad(l,i,h.RGBA,{useMipmap:!0}),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),l.extTextureFilterAnisotropic&&h.texParameterf(h.TEXTURE_2D,l.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,l.extTextureFilterAnisotropicMax))}setDependencies(i,o){const l={};for(const h of o)l[h]=!0;this.dependencies[i]=l}hasDependency(i,o){for(const l of i){const h=this.dependencies[l];if(h)for(const m of o)if(h[m])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(i,o){if(!o||"mercator"===o.name||this._tileDebugBuffer)return;const l=oa(E0,this.tileID.canonical,this.tileTransform)[0],h=new pn,m=new ia;for(let _=0;_<l.length;_++){const{x,y:E}=l[_];h.emplaceBack(x,E),m.emplaceBack(_)}m.emplaceBack(0),this._tileDebugIndexBuffer=i.createIndexBuffer(m),this._tileDebugBuffer=i.createVertexBuffer(h,dh.members),this._tileDebugSegments=ai.simpleSegment(0,0,h.length,m.length)}_makeTileBoundsBuffers(i,o){if(this._tileBoundsBuffer||!o||"mercator"===o.name)return;const l=oa(E0,this.tileID.canonical,this.tileTransform)[0];let h,m;if(this.isRaster){const _=function(x,E){const T=ua(x,E),S=Math.pow(2,x.z);for(let G=0;G<33;G++)for(let ne=0;ne<33;ne++){const ae=Bt((x.x+(ne+b0(ne))/32)/S),te=qi((x.y+(G+b0(G))/32)/S),se=E.project(ae,te),he=33*G+ne;Ka[2*he+0]=Math.round((se.x*T.scale-T.x)*St),Ka[2*he+1]=Math.round((se.y*T.scale-T.y)*St)}Yc.fill(0),Zm.fill(0);for(let G=2045;G>=0;G--){const ne=4*G,ae=da[ne+0],te=da[ne+1],se=da[ne+2],he=da[ne+3],le=ae+se>>1,be=te+he>>1,Ee=le+be-te,ke=be+ae-le,Xe=33*te+ae,Ae=33*he+se,Oe=33*be+le,ze=Math.hypot((Ka[2*Xe+0]+Ka[2*Ae+0])/2-Ka[2*Oe+0],(Ka[2*Xe+1]+Ka[2*Ae+1])/2-Ka[2*Oe+1])>=16;if(Yc[Oe]=Yc[Oe]||(ze?1:0),G<1022){const $e=33*(te+ke>>1)+(ae+Ee>>1),Ke=33*(he+ke>>1)+(se+Ee>>1);Yc[Oe]=Yc[Oe]||Yc[$e]||Yc[Ke]}}const P=new Cn,L=new cr;let O=0;function N(G,ne){const ae=33*ne+G;return 0===Zm[ae]&&(P.emplaceBack(Ka[2*ae+0],Ka[2*ae+1],G*St/32,ne*St/32),Zm[ae]=++O),Zm[ae]-1}function j(G,ne,ae,te,se,he){const le=G+ae>>1,be=ne+te>>1;if(Math.abs(G-se)+Math.abs(ne-he)>1&&Yc[33*be+le])j(se,he,G,ne,le,be),j(ae,te,se,he,le,be);else{const Ee=N(G,ne),ke=N(ae,te),Xe=N(se,he);L.emplaceBack(Ee,ke,Xe)}}return j(0,0,32,32,32,0),j(32,32,0,0,0,32),{vertices:P,indices:L}}(this.tileID.canonical,o);h=_.vertices,m=_.indices}else{h=new Cn,m=new cr;for(const{x,y:E}of l)h.emplaceBack(x,E,0,0);const _=cd.exports(h.int16,void 0,4);for(let x=0;x<_.length;x+=3)m.emplaceBack(_[x],_[x+1],_[x+2])}this._tileBoundsBuffer=i.createVertexBuffer(h,w0.members),this._tileBoundsIndexBuffer=i.createIndexBuffer(m),this._tileBoundsSegments=ai.simpleSegment(0,0,h.length,m.length)}_makeGlobeTileDebugBuffers(i,o){const l=o.projection;if(!l||"globe"!==l.name||o.freezeTileCoverage)return;const h=this.tileID.canonical,m=lf(B_(h,o)),_=mh(o.zoom);let x;_>0&&(x=rd(new Float64Array(16),o.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(i,h,o,m,x,_),this._makeGlobeTileDebugTextBuffer(i,h,o,m,x,_)}_globePoint(i,o,l,h,m,_,x){let E=Xc(i,o,l);if(_){const T=1<<l.z,S=po(h.center.lng),P=Jr(h.center.lat),L=(l.x+.5)/T-S;let O=0;L>.5?O=-1:L<-.5&&(O=1);let N=(i/St+l.x)/T+O,j=(o/St+l.y)/T;N=(N-S)*h._pixelsPerMercatorPixel+S,j=(j-P)*h._pixelsPerMercatorPixel+P;const G=[N*h.worldSize,j*h.worldSize,0];hi(G,G,_),E=Vl(E,G,x)}return hi(E,E,m)}_makeGlobeTileDebugBorderBuffer(i,o,l,h,m,_){const x=new pn,E=new ia,T=new kn,S=(L,O,N,j,G)=>{const ne=(N-L)/(G-1),ae=(j-O)/(G-1),te=x.length;for(let se=0;se<G;se++){const he=L+se*ne,le=O+se*ae;x.emplaceBack(he,le);const be=this._globePoint(he,le,o,l,h,m,_);T.emplaceBack(be[0],be[1],be[2]),E.emplaceBack(te+se)}},P=St;S(0,0,P,0,16),S(P,0,P,P,16),S(P,P,0,P,16),S(0,P,0,0,16),this._tileDebugIndexBuffer=i.createIndexBuffer(E),this._tileDebugBuffer=i.createVertexBuffer(x,dh.members),this._globeTileDebugBorderBuffer=i.createVertexBuffer(T,F_.members),this._tileDebugSegments=ai.simpleSegment(0,0,x.length,E.length)}_makeGlobeTileDebugTextBuffer(i,o,l,h,m,_){const x=new pn,E=new cr,T=new kn,S=25;E.reserve(32),x.reserve(S),T.reserve(S);const P=(L,O)=>S*L+O;for(let L=0;L<S;L++){const O=2048*L;for(let N=0;N<S;N++){const j=2048*N;x.emplaceBack(j,O);const G=this._globePoint(j,O,o,l,h,m,_);T.emplaceBack(G[0],G[1],G[2])}}for(let L=0;L<4;L++)for(let O=0;O<4;O++){const N=P(L,O),j=P(L,O+1),G=P(L+1,O),ne=P(L+1,O+1);E.emplaceBack(N,j,G),E.emplaceBack(G,j,ne)}this._tileDebugTextIndexBuffer=i.createIndexBuffer(E),this._tileDebugTextBuffer=i.createVertexBuffer(x,dh.members),this._globeTileDebugTextBuffer=i.createVertexBuffer(T,F_.members),this._tileDebugTextSegments=ai.simpleSegment(0,0,S,32)}}class P1{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,o,l){const h=String(o);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][h]=this.stateChanges[i][h]||{},_n(this.stateChanges[i][h],l),null===this.deletedStates[i]){this.deletedStates[i]={};for(const m in this.state[i])m!==h&&(this.deletedStates[i][m]=null)}else if(this.deletedStates[i]&&null===this.deletedStates[i][h]){this.deletedStates[i][h]={};for(const m in this.state[i][h])l[m]||(this.deletedStates[i][h][m]=null)}else for(const m in l)this.deletedStates[i]&&this.deletedStates[i][h]&&null===this.deletedStates[i][h][m]&&delete this.deletedStates[i][h][m]}removeFeatureState(i,o,l){if(null===this.deletedStates[i])return;const h=String(o);if(this.deletedStates[i]=this.deletedStates[i]||{},l&&void 0!==o)null!==this.deletedStates[i][h]&&(this.deletedStates[i][h]=this.deletedStates[i][h]||{},this.deletedStates[i][h][l]=null);else if(void 0!==o)if(this.stateChanges[i]&&this.stateChanges[i][h])for(l in this.deletedStates[i][h]={},this.stateChanges[i][h])this.deletedStates[i][h][l]=null;else this.deletedStates[i][h]=null;else this.deletedStates[i]=null}getState(i,o){const l=String(o),h=_n({},(this.state[i]||{})[l],(this.stateChanges[i]||{})[l]);if(null===this.deletedStates[i])return{};if(this.deletedStates[i]){const m=this.deletedStates[i][o];if(null===m)return{};for(const _ in m)delete h[_]}return h}initializeTileState(i,o){i.setFeatureState(this.state,o)}coalesceChanges(i,o){const l={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const m={};for(const _ in this.stateChanges[h])this.state[h][_]||(this.state[h][_]={}),_n(this.state[h][_],this.stateChanges[h][_]),m[_]=this.state[h][_];l[h]=m}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const m={};if(null===this.deletedStates[h])for(const _ in this.state[h])m[_]={},this.state[h][_]={};else for(const _ in this.deletedStates[h]){if(null===this.deletedStates[h][_])this.state[h][_]={};else for(const x of Object.keys(this.deletedStates[h][_]))delete this.state[h][_][x];m[_]=this.state[h][_]}l[h]=l[h]||{},_n(l[h],m)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(l).length)for(const h in i)i[h].setFeatureState(l,o)}}class T0{constructor(i){this.size=i,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(i,o){const l=this.toIdx(i,o);return{min:this.minimums[l],max:this.maximums[l]}}isLeaf(i,o){return this.leaves[this.toIdx(i,o)]}toIdx(i,o){return o*this.size+i}}function D0(r,i,o,l){let h=0,m=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(l[_])<1e-15){if(o[_]<r[_]||o[_]>i[_])return null}else{const x=1/l[_];let E=(r[_]-o[_])*x,T=(i[_]-o[_])*x;if(E>T){const S=E;E=T,T=S}if(E>h&&(h=E),T<m&&(m=T),h>m)return null}return h}function Ya(r,i,o,l,h,m,_,x,E,T,S){const P=l-r,L=h-i,O=m-o,N=_-r,j=x-i,G=E-o,ne=S[1]*G-S[2]*j,ae=S[2]*N-S[0]*G,te=S[0]*j-S[1]*N,se=P*ne+L*ae+O*te;if(Math.abs(se)<1e-15)return null;const he=1/se,le=T[0]-r,be=T[1]-i,Ee=T[2]-o,ke=(le*ne+be*ae+Ee*te)*he;if(ke<0||ke>1)return null;const Xe=be*O-Ee*L,Ae=Ee*P-le*O,Oe=le*L-be*P,ze=(S[0]*Xe+S[1]*Ae+S[2]*Oe)*he;return ze<0||ke+ze>1?null:(N*Xe+j*Ae+G*Oe)*he}function hf(r,i,o){return(r-i)/(o-i)}function J_(r,i,o,l,h,m,_,x,E){const T=1<<o,S=m-l,P=_-h,L=(r+1)/T*S+l,O=(i+0)/T*P+h,N=(i+1)/T*P+h;x[0]=(r+0)/T*S+l,x[1]=O,E[0]=L,E[1]=N}class Xm{constructor(i){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=i,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const o=function(m){const _=Math.ceil(Math.log2(m.dim/8)),x=[];let E=Math.ceil(Math.pow(2,_));const T=1/E,S=(O,N,j,G,ne)=>{const ae=G?1:0,te=(O+1)*j-ae,se=N*j,he=(N+1)*j-ae;ne[0]=O*j,ne[1]=se,ne[2]=te,ne[3]=he};let P=new T0(E);const L=[];for(let O=0;O<E*E;O++){S(O%E,Math.floor(O/E),T,!1,L);const N=Qa(L[0],L[1],m),j=Qa(L[2],L[1],m),G=Qa(L[2],L[3],m),ne=Qa(L[0],L[3],m);P.minimums.push(Math.min(N,j,G,ne)),P.maximums.push(Math.max(N,j,G,ne)),P.leaves.push(1)}for(x.push(P),E/=2;E>=1;E/=2){const O=x[x.length-1];P=new T0(E);for(let N=0;N<E*E;N++){S(N%E,Math.floor(N/E),2,!0,L);const j=O.getElevation(L[0],L[1]),G=O.getElevation(L[2],L[1]),ne=O.getElevation(L[2],L[3]),ae=O.getElevation(L[0],L[3]),te=O.isLeaf(L[0],L[1]),se=O.isLeaf(L[2],L[1]),he=O.isLeaf(L[2],L[3]),le=O.isLeaf(L[0],L[3]),be=Math.min(j.min,G.min,ne.min,ae.min),Ee=Math.max(j.max,G.max,ne.max,ae.max),ke=te&&se&&he&&le;P.maximums.push(Ee),P.minimums.push(be),P.leaves.push(Ee-be<=5&&ke?1:0)}x.push(P)}return x}(this.dem),l=o.length-1,h=o[l];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(o,0,0,l,0)}raycastRoot(i,o,l,h,m,_,x=1){return D0([i,o,-100],[l,h,this.maximums[0]*x],m,_)}raycast(i,o,l,h,m,_,x=1){if(!this.nodeCount)return null;const E=this.raycastRoot(i,o,l,h,m,_,x);if(null==E)return null;const T=[],S=[],P=[],L=[],O=[{idx:0,t:E,nodex:0,nodey:0,depth:0}];for(;O.length>0;){const{idx:N,t:j,nodex:G,nodey:ne,depth:ae}=O.pop();if(this.leaves[N]){J_(G,ne,ae,i,o,l,h,P,L);const se=1<<ae,he=(G+0)/se,le=(G+1)/se,be=(ne+0)/se,Ee=(ne+1)/se,ke=Qa(he,be,this.dem)*x,Xe=Qa(le,be,this.dem)*x,Ae=Qa(le,Ee,this.dem)*x,Oe=Qa(he,Ee,this.dem)*x,ze=Ya(P[0],P[1],ke,L[0],P[1],Xe,L[0],L[1],Ae,m,_),$e=Ya(L[0],L[1],Ae,P[0],L[1],Oe,P[0],P[1],ke,m,_),Ke=Math.min(null!==ze?ze:Number.MAX_VALUE,null!==$e?$e:Number.MAX_VALUE);if(Ke!==Number.MAX_VALUE)return Ke;{const Me=od([],m,_,j);if(df(ke,Xe,Oe,Ae,hf(Me[0],P[0],L[0]),hf(Me[1],P[1],L[1]))>=Me[2])return j}continue}let te=0;for(let se=0;se<this._siblingOffset.length;se++){J_((G<<1)+this._siblingOffset[se][0],(ne<<1)+this._siblingOffset[se][1],ae+1,i,o,l,h,P,L),P[2]=-100,L[2]=this.maximums[this.childOffsets[N]+se]*x;const he=D0(P,L,m,_);if(null!=he){const le=he;T[se]=le;let be=!1;for(let Ee=0;Ee<te&&!be;Ee++)le>=T[S[Ee]]&&(S.splice(Ee,0,se),be=!0);be||(S[te]=se),te++}}for(let se=0;se<te;se++){const he=S[se];O.push({idx:this.childOffsets[N]+he,t:T[he],nodex:(G<<1)+this._siblingOffset[he][0],nodey:(ne<<1)+this._siblingOffset[he][1],depth:ae+1})}}return null}_addNode(i,o,l){return this.minimums.push(i),this.maximums.push(o),this.leaves.push(l),this.childOffsets.push(0),this.nodeCount++}_construct(i,o,l,h,m){if(1===i[h].isLeaf(o,l))return;this.childOffsets[m]||(this.childOffsets[m]=this.nodeCount);const _=h-1,x=i[_];let E=0,T=0;for(let S=0;S<this._siblingOffset.length;S++){const P=2*o+this._siblingOffset[S][0],L=2*l+this._siblingOffset[S][1],O=x.getElevation(P,L),N=x.isLeaf(P,L),j=this._addNode(O.min,O.max,N);N&&(E|=1<<S),T||(T=j)}for(let S=0;S<this._siblingOffset.length;S++)E&1<<S||this._construct(i,2*o+this._siblingOffset[S][0],2*l+this._siblingOffset[S][1],_,T+S)}}function df(r,i,o,l,h,m){return dn(dn(r,o,m),dn(i,l,m),h)}function Qa(r,i,o){const l=o.dim,h=sn(r*l-.5,0,l-1),m=sn(i*l-.5,0,l-1),_=Math.floor(h),x=Math.floor(m),E=Math.min(_+1,l-1),T=Math.min(x+1,l-1);return df(o.get(_,x),o.get(E,x),o.get(_,T),o.get(E,T),h-_,m-x)}const pf={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class ff{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(i,o,l,h=!1,m=!1){if(this.uid=i,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(l&&"mapbox"!==l&&"terrarium"!==l)return Qn(`"${l}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=o.height;const _=this.dim=o.height-2,x=new Uint32Array(o.data.buffer);if(this.pixels=new Uint8Array(o.data.buffer),this.encoding=l||"mapbox",this.borderReady=h,!h){for(let E=0;E<_;E++)x[this._idx(-1,E)]=x[this._idx(0,E)],x[this._idx(_,E)]=x[this._idx(_-1,E)],x[this._idx(E,-1)]=x[this._idx(E,0)],x[this._idx(E,_)]=x[this._idx(E,_-1)];x[this._idx(-1,-1)]=x[this._idx(0,0)],x[this._idx(_,-1)]=x[this._idx(_-1,0)],x[this._idx(-1,_)]=x[this._idx(0,_-1)],x[this._idx(_,_)]=x[this._idx(_-1,_-1)],m&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Xm(this)}get(i,o,l=!1){l&&(i=sn(i,-1,this.dim),o=sn(o,-1,this.dim));const h=4*this._idx(i,o);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(this.pixels[h],this.pixels[h+1],this.pixels[h+2])}static getUnpackVector(i){return pf[i]}get unpackVector(){return pf[this.encoding]}_idx(i,o){if(i<-1||i>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(i+1)}_unpackMapbox(i,o,l){return(256*i*256+256*o+l)/10-1e4}_unpackTerrarium(i,o,l){return 256*i+o+l/256-32768}static pack(i,o){const l=[0,0,0,0],h=ff.getUnpackVector(o);let m=Math.floor((i+h[3])/h[2]);return l[2]=m%256,m=Math.floor(m/256),l[1]=m%256,m=Math.floor(m/256),l[0]=m,l}getPixels(){return new Po({width:this.stride,height:this.stride},this.pixels)}backfillBorder(i,o,l){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let h=o*this.dim,m=o*this.dim+this.dim,_=l*this.dim,x=l*this.dim+this.dim;switch(o){case-1:h=m-1;break;case 1:m=h+1}switch(l){case-1:_=x-1;break;case 1:x=_+1}const E=-o*this.dim,T=-l*this.dim;for(let S=_;S<x;S++)for(let P=h;P<m;P++){const L=4*this._idx(P,S),O=4*this._idx(P+E,S+T);this.pixels[L+0]=i.pixels[O+0],this.pixels[L+1]=i.pixels[O+1],this.pixels[L+2]=i.pixels[O+2],this.pixels[L+3]=i.pixels[O+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}lt(ff,"DEMData"),lt(Xm,"DemMinMaxQuadTree",{omit:["dem"]});class jl{constructor(i,o){this.max=i,this.onRemove=o,this.reset()}reset(){for(const i in this.data)for(const o of this.data[i])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(i,o,l){const h=i.wrapped().key;void 0===this.data[h]&&(this.data[h]=[]);const m={value:o,timeout:void 0};if(void 0!==l&&(m.timeout=setTimeout(()=>{this.remove(i,m)},l)),this.data[h].push(m),this.order.push(h),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const o=this.data[i].shift();return o.timeout&&clearTimeout(o.timeout),0===this.data[i].length&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),o.value}getByKey(i){const o=this.data[i];return o?o[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,o){if(!this.has(i))return this;const l=i.wrapped().key,h=void 0===o?0:this.data[l].indexOf(o),m=this.data[l][h];return this.data[l].splice(h,1),m.timeout&&clearTimeout(m.timeout),0===this.data[l].length&&delete this.data[l],this.onRemove(m.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(i){const o=[];for(const l in this.data)for(const h of this.data[l])i(h.value)||o.push(h);for(const l of o)this.remove(l.value.tileID,l)}}class Qc{constructor(i,o,l){this.func=i,this.mask=o,this.range=l}}Qc.ReadOnly=!1,Qc.ReadWrite=!0,Qc.disabled=new Qc(519,Qc.ReadOnly,[0,1]);class Ym{constructor(i,o,l,h,m,_){this.test=i,this.ref=o,this.mask=l,this.fail=h,this.depthFail=m,this.pass=_}}Ym.disabled=new Ym({func:519,mask:0},0,0,7680,7680,7680);class Is{constructor(i,o,l){this.blendFunction=i,this.blendColor=o,this.mask=l}}Is.Replace=[1,0],Is.disabled=new Is(Is.Replace,ui.transparent,[!1,!1,!1,!1]),Is.unblended=new Is(Is.Replace,ui.transparent,[!0,!0,!0,!0]),Is.alphaBlended=new Is([1,771],ui.transparent,[!0,!0,!0,!0]);class mo{constructor(i,o,l){this.enable=i,this.mode=o,this.frontFace=l}}mo.disabled=new mo(!1,1029,2305),mo.backCCW=new mo(!0,1029,2305),mo.backCW=new mo(!0,1029,2304),mo.frontCW=new mo(!0,1028,2304),mo.frontCCW=new mo(!0,1028,2305);class cs extends jr{constructor(i,o,l){super(),this.id=i,this._onlySymbols=l,o.on("data",h=>{"source"===h.dataType&&"metadata"===h.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===h.dataType&&"content"===h.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),o.on("error",()=>{this._sourceErrored=!0}),this._source=o,this._tiles={},this._cache=new jl(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=o.minTileCacheSize,this._maxTileCacheSize=o.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new P1,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(i){this.map=i,this._minTileCacheSize=void 0===this._minTileCacheSize&&i?i._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&i?i._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const i in this._tiles){const o=this._tiles[i];if("loaded"!==o.state&&"errored"!==o.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(i,o){return i.isSymbolTile=this._onlySymbols,this._source.loadTile(i,o)}_unloadTile(i){if(this._source.unloadTile)return this._source.unloadTile(i,()=>{})}_abortTile(i){if(this._source.abortTile)return this._source.abortTile(i,()=>{})}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const l=this._tiles[o];l.upload(i),l.prepare(this.map.style.imageManager)}}getIds(){return Ns(this._tiles).map(i=>i.tileID).sort(mf).map(i=>i.key)}getRenderableIds(i){const o=[];for(const l in this._tiles)this._isIdRenderable(+l,i)&&o.push(this._tiles[l]);return i?o.sort((l,h)=>{const m=l.tileID,_=h.tileID,x=new et(m.canonical.x,m.canonical.y)._rotate(this.transform.angle),E=new et(_.canonical.x,_.canonical.y)._rotate(this.transform.angle);return m.overscaledZ-_.overscaledZ||E.y-x.y||E.x-x.x}).map(l=>l.tileID.key):o.map(l=>l.tileID).sort(mf).map(l=>l.key)}hasRenderableParent(i){const o=this.findLoadedParent(i,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(i,o){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(o||!this._tiles[i].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)"errored"!==this._tiles[i].state&&this._reloadTile(+i,"reloading")}}_reloadTile(i,o){const l=this._tiles[i];l&&("loading"!==l.state&&(l.state=o),this._loadTile(l,this._tileLoaded.bind(this,l,i,o)))}_tileLoaded(i,o,l,h){if(h)if(i.state="errored",404!==h.status)this._source.fire(new gs(h,{tile:i}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const m=this.map.painter.terrain;this.update(this.transform,m.getScaledDemTileSize(),!0),m.resetTileLookupCache(this.id)}else this.update(this.transform);else i.timeAdded=xt.now(),"expired"===l&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(o,i),"raster-dem"===this._source.type&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),this._source.fire(new Wo("data",{dataType:"source",tile:i,coord:i.tileID,sourceCacheId:this.id}))}_backfillDEM(i){const o=this.getRenderableIds();for(let h=0;h<o.length;h++){const m=o[h];if(i.neighboringTiles&&i.neighboringTiles[m]){const _=this.getTileByID(m);l(i,_),l(_,i)}}function l(h,m){if(!h.dem||h.dem.borderReady)return;h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0;let _=m.tileID.canonical.x-h.tileID.canonical.x;const x=m.tileID.canonical.y-h.tileID.canonical.y,E=Math.pow(2,h.tileID.canonical.z),T=m.tileID.key;0===_&&0===x||Math.abs(x)>1||(Math.abs(_)>1&&(1===Math.abs(_+E)?_+=E:1===Math.abs(_-E)&&(_-=E)),m.dem&&h.dem&&(h.dem.backfillBorder(m.dem,_,x),h.neighboringTiles&&h.neighboringTiles[T]&&(h.neighboringTiles[T].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,o,l,h){for(const m in this._tiles){let _=this._tiles[m];if(h[m]||!_.hasData()||_.tileID.overscaledZ<=o||_.tileID.overscaledZ>l)continue;let x=_.tileID;for(;_&&_.tileID.overscaledZ>o+1;){const T=_.tileID.scaledTo(_.tileID.overscaledZ-1);_=this._tiles[T.key],_&&_.hasData()&&(x=T)}let E=x;for(;E.overscaledZ>o;)if(E=E.scaledTo(E.overscaledZ-1),i[E.key]){h[x.key]=x;break}}}findLoadedParent(i,o){if(i.key in this._loadedParentTiles){const l=this._loadedParentTiles[i.key];return l&&l.tileID.overscaledZ>=o?l:null}for(let l=i.overscaledZ-1;l>=o;l--){const h=i.scaledTo(l),m=this._getLoadedTile(h);if(m)return m}}_getLoadedTile(i){const o=this._tiles[i.key];return o&&o.hasData()?o:this._cache.getByKey(this._source.reparseOverscaled?i.wrapped().key:i.canonical.key)}updateCacheSize(i,o){o=o||this._source.tileSize;const l=Math.ceil(i.width/o)+1,h=Math.ceil(i.height/o)+1,m=Math.floor(l*h*5),_="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,m):m,x="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(x)}handleWrapJump(i){const o=Math.round((i-(void 0===this._prevLng?i:this._prevLng))/360);if(this._prevLng=i,o){const l={};for(const h in this._tiles){const m=this._tiles[h];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+o),l[m.tileID.key]=m}this._tiles=l;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(+h,this._tiles[h])}}update(i,o,l){if(this.transform=i,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!l)return;let h;this.updateCacheSize(i,o),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?h=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(x=>new yr(x.canonical.z,x.wrap,x.canonical.z,x.canonical.x,x.canonical.y)):(h=i.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!l,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(h=h.filter(x=>this._source.hasTile(x)))):h=[];const m=this._updateRetainedTiles(h);if(Jc(this._source.type)&&0!==h.length){const x={},E={},T=Object.keys(m);for(const P of T){const L=m[P],O=this._tiles[P];if(!O||O.fadeEndTime&&O.fadeEndTime<=xt.now())continue;const N=this.findLoadedParent(L,Math.max(L.overscaledZ-cs.maxOverzooming,this._source.minzoom));N&&(this._addTile(N.tileID),x[N.tileID.key]=N.tileID),E[P]=L}const S=h[h.length-1].overscaledZ;for(const P in this._tiles){const L=this._tiles[P];if(m[P]||!L.hasData())continue;let O=L.tileID;for(;O.overscaledZ>S;){O=O.scaledTo(O.overscaledZ-1);const N=this._tiles[O.key];if(N&&N.hasData()&&E[O.key]){m[P]=L.tileID;break}}}for(const P in x)m[P]||(this._coveredTiles[P]=!0,m[P]=x[P])}for(const x in m)this._tiles[x].clearFadeHold();const _=function(x,E){const T=[];for(const S in x)S in E||T.push(S);return T}(this._tiles,m);for(const x of _){const E=this._tiles[x];E.hasSymbolBuckets&&!E.holdingForFade()?E.setHoldDuration(this.map._fadeDuration):E.hasSymbolBuckets&&!E.symbolFadeFinished()||this._removeTile(+x)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(+i)}_updateRetainedTiles(i){const o={};if(0===i.length)return o;const l={},h=i.reduce((T,S)=>Math.min(T,S.overscaledZ),1/0),m=i[0].overscaledZ,_=Math.max(m-cs.maxOverzooming,this._source.minzoom),x=Math.max(m+cs.maxUnderzooming,this._source.minzoom),E={};for(const T of i){const S=this._addTile(T);o[T.key]=T,S.hasData()||h<this._source.maxzoom&&(E[T.key]=T)}this._retainLoadedChildren(E,h,x,o);for(const T of i){let S=this._tiles[T.key];if(S.hasData())continue;if(T.canonical.z>=this._source.maxzoom){const L=T.children(this._source.maxzoom)[0],O=this.getTile(L);if(O&&O.hasData()){o[L.key]=L;continue}}else{const L=T.children(this._source.maxzoom);if(o[L[0].key]&&o[L[1].key]&&o[L[2].key]&&o[L[3].key])continue}let P=S.wasRequested();for(let L=T.overscaledZ-1;L>=_;--L){const O=T.scaledTo(L);if(l[O.key]||(l[O.key]=!0,S=this.getTile(O),!S&&P&&(S=this._addTile(O)),S&&(o[O.key]=O,P=S.wasRequested(),S.hasData())))break}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const o=[];let l,h=this._tiles[i].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){l=this._loadedParentTiles[h.key];break}o.push(h.key);const m=h.scaledTo(h.overscaledZ-1);if(l=this._getLoadedTile(m),l)break;h=m}for(const m of o)this._loadedParentTiles[m]=l}}_addTile(i){let o=this._tiles[i.key];if(o)return o;o=this._cache.getAndRemove(i),o&&(this._setTileReloadTimer(i.key,o),o.tileID=i,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,o)));const l=Boolean(o);if(!l){const h=this.map?this.map.painter:null;o=new Q_(i,this._source.tileSize*i.overscaleFactor(),this.transform.tileZoom,h,this._isRaster),this._loadTile(o,this._tileLoaded.bind(this,o,i.key,o.state))}return o?(o.uses++,this._tiles[i.key]=o,l||this._source.fire(new Wo("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o):null}_setTileReloadTimer(i,o){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const l=o.getExpiryTimeout();l&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},l))}_removeTile(i){const o=this._tiles[i];o&&(o.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),o.uses>0||(o.hasData()&&"reloading"!==o.state?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(+i);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(i,o,l){const h=[],m=this.transform;if(!m)return h;const _="globe"===m.projection.name,x=po(m.center.lng);for(const E in this._tiles){const T=this._tiles[E];if(l&&T.clearQueryDebugViz(),T.holdingForFade())continue;let S;if(_){const P=T.tileID.canonical;if(0===P.z){const L=[Math.abs(sn(x,...eu(P,-1))-x),Math.abs(sn(x,...eu(P,1))-x)];S=[0,2*L.indexOf(Math.min(...L))-1]}else{const L=[Math.abs(sn(x,...eu(P,-1))-x),Math.abs(sn(x,...eu(P,0))-x),Math.abs(sn(x,...eu(P,1))-x)];S=[L.indexOf(Math.min(...L))-1]}}else S=[0];for(const P of S){const L=i.containsTile(T,m,o,P);L&&h.push(L)}}return h}getVisibleCoordinates(i){const o=this.getRenderableIds(i).map(l=>this._tiles[l].tileID);for(const l of o)l.projMatrix=this.transform.calculateProjMatrix(l.toUnwrapped());return o}hasTransition(){if(this._source.hasTransition())return!0;if(Jc(this._source.type))for(const i in this._tiles){const o=this._tiles[i];if(void 0!==o.fadeEndTime&&o.fadeEndTime>=xt.now())return!0}return!1}setFeatureState(i,o,l){this._state.updateState(i=i||"_geojsonTileLayer",o,l)}removeFeatureState(i,o,l){this._state.removeFeatureState(i=i||"_geojsonTileLayer",o,l)}getFeatureState(i,o){return this._state.getState(i=i||"_geojsonTileLayer",o)}setDependencies(i,o,l){const h=this._tiles[i];h&&h.setDependencies(o,l)}reloadTilesForDependencies(i,o){for(const l in this._tiles)this._tiles[l].hasDependency(i,o)&&this._reloadTile(+l,"reloading");this._cache.filter(l=>!l.hasDependency(i,o))}_preloadTiles(i,o){const l=new Map,h=Array.isArray(i)?i:[i],m=this.map.painter.terrain,_=this.usedForTerrain&&m?m.getScaledDemTileSize():this._source.tileSize;for(const x of h){const E=x.coveringTiles({tileSize:_,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const T of E)l.set(T.key,T);this.usedForTerrain&&x.updateElevation(!1)}Ea(Array.from(l.values()),(x,E)=>{const T=new Q_(x,this._source.tileSize*x.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(T,S=>{"raster-dem"===this._source.type&&T.dem&&this._backfillDEM(T),E(S,T)})},o)}}function mf(r,i){const o=Math.abs(2*r.wrap)-+(r.wrap<0),l=Math.abs(2*i.wrap)-+(i.wrap<0);return r.overscaledZ-i.overscaledZ||l-o||i.canonical.y-r.canonical.y||i.canonical.x-r.canonical.x}function Jc(r){return"raster"===r||"image"===r||"video"===r||"custom"===r}function eu(r,i){const o=1<<r.z;return[r.x/o+i,(r.x+1)/o+i]}cs.maxOverzooming=10,cs.maxUnderzooming=3;class tu{constructor(i,o,l){this._demTile=i,this._dem=this._demTile.dem,this._scale=o,this._offset=l}static create(i,o,l){const h=l||i.findDEMTileFor(o);if(!h||!h.dem)return;const m=h.dem,_=h.tileID,x=1<<o.canonical.z-_.canonical.z;return new tu(h,h.tileSize/St/x,[(o.canonical.x/x-_.canonical.x)*m.dim,(o.canonical.y/x-_.canonical.y)*m.dim])}tileCoordToPixel(i,o){const l=o*this._scale+this._offset[1],h=Math.floor(i*this._scale+this._offset[0]),m=Math.floor(l);return new et(h,m)}getElevationAt(i,o,l,h){const m=i*this._scale+this._offset[0],_=o*this._scale+this._offset[1],x=Math.floor(m),E=Math.floor(_),T=this._dem;return h=!!h,l?dn(dn(T.get(x,E,h),T.get(x,E+1,h),_-E),dn(T.get(x+1,E,h),T.get(x+1,E+1,h),_-E),m-x):T.get(x,E,h)}getElevationAtPixel(i,o,l){return this._dem.get(i,o,!!l)}getMeterToDEM(i){return(1<<this._demTile.tileID.canonical.z)*Jo(1,i)*this._dem.stride}}class eg{constructor(i,o){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new Ko(St,16,0),this.featureIndexArray=new ov,this.promoteId=o}insert(i,o,l,h,m,_=0){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,h,m,_);const E=this.grid;for(let T=0;T<o.length;T++){const S=o[T],P=[1/0,1/0,-1/0,-1/0];for(let L=0;L<S.length;L++){const O=S[L];P[0]=Math.min(P[0],O.x),P[1]=Math.min(P[1],O.y),P[2]=Math.max(P[2],O.x),P[3]=Math.max(P[3],O.y)}P[0]<St&&P[1]<St&&P[2]>=0&&P[3]>=0&&E.insert(x,P[0],P[1],P[2],P[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new zp(new ch(this.rawTileData)).layers,this.sourceLayerCoder=new Y_(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const i in this.vtLayers)this.vtFeatures[i]=[]}return this.vtLayers}query(i,o,l,h){this.loadVTLayers();const m=i.params||{},_=Es(m.filter),x=i.tileResult,E=i.transform,T=x.bufferedTilespaceBounds,S=this.grid.query(T.min.x,T.min.y,T.max.x,T.max.y,(N,j,G,ne)=>qg(x.bufferedTilespaceGeometry,N,j,G,ne));S.sort(ng);let P=null;E.elevation&&S.length>0&&(P=tu.create(E.elevation,this.tileID));const L={};let O;for(let N=0;N<S.length;N++){const j=S[N];if(j===O)continue;O=j;const G=this.featureIndexArray.get(j);let ne=null;this.loadMatchingFeature(L,G,_,m.layers,m.availableImages,o,l,h,(ae,te,se,he=0)=>(ne||(ne=oa(ae,this.tileID.canonical,i.tileTransform)),te.queryIntersectsFeature(x,ae,se,ne,this.z,i.transform,i.pixelPosMatrix,P,he)))}return L}loadMatchingFeature(i,o,l,h,m,_,x,E,T){const{featureIndex:S,bucketIndex:P,sourceLayerIndex:L,layoutVertexArrayOffset:O}=o,N=this.bucketLayerIDs[P];if(h&&!function(ae,te){for(let se=0;se<ae.length;se++)if(te.indexOf(ae[se])>=0)return!0;return!1}(h,N))return;const j=this.sourceLayerCoder.decode(L),G=this.vtLayers[j].feature(S);if(l.needGeometry){const ae=Ds(G,!0);if(!l.filter(new _e(this.tileID.overscaledZ),ae,this.tileID.canonical))return}else if(!l.filter(new _e(this.tileID.overscaledZ),G))return;const ne=this.getId(G,j);for(let ae=0;ae<N.length;ae++){const te=N[ae];if(h&&h.indexOf(te)<0)continue;const se=_[te];if(!se)continue;let he={};void 0!==ne&&E&&(he=E.getState(se.sourceLayer||"_geojsonTileLayer",ne));const le=_n({},x[te]);le.paint=tg(le.paint,se.paint,G,he,m),le.layout=tg(le.layout,se.layout,G,he,m);const be=!T||T(G,se,he,O);if(!be)continue;const Ee=new Wm(G,this.z,this.x,this.y,ne);Ee.layer=le;let ke=i[te];void 0===ke&&(ke=i[te]=[]),ke.push({featureIndex:S,feature:Ee,intersectionZ:be})}}lookupSymbolFeatures(i,o,l,h,m,_,x,E){const T={};this.loadVTLayers();const S=Es(m);for(const P of i)this.loadMatchingFeature(T,{bucketIndex:l,sourceLayerIndex:h,featureIndex:P,layoutVertexArrayOffset:0},S,_,x,E,o);return T}loadFeature(i){const{featureIndex:o,sourceLayerIndex:l}=i;this.loadVTLayers();const h=this.sourceLayerCoder.decode(l),m=this.vtFeatures[h];if(m[o])return m[o];const _=this.vtLayers[h].feature(o);return m[o]=_,_}hasLayer(i){for(const o of this.bucketLayerIDs)for(const l of o)if(i===l)return!0;return!1}getId(i,o){let l=i.id;if(this.promoteId){const h="string"==typeof this.promoteId?this.promoteId:this.promoteId[o];null!=h&&(l=i.properties[h]),"boolean"==typeof l&&(l=Number(l))}return l}}function tg(r,i,o,l,h){return io(r,(m,_)=>{const x=i instanceof Qe?i.get(_):null;return x&&x.evaluate?x.evaluate(o,l,h):x})}function ng(r,i){return i-r}lt(eg,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class gf{constructor(i,o){this.width=i,this.height=o,this.nextRow=0,this.image=new aa({width:i,height:o}),this.positions={},this.uploaded=!1}getDash(i,o){const l=this.getKey(i,o);return this.positions[l]}trim(){const i=this.width,o=this.height=Uo(this.nextRow);this.image.resize({width:i,height:o})}getKey(i,o){return i.join(",")+o}getDashRanges(i,o,l){const h=[];let m=i.length%2==1?-i[i.length-1]*l:0,_=i[0]*l,x=!0;h.push({left:m,right:_,isDash:x,zeroLength:0===i[0]});let E=i[0];for(let T=1;T<i.length;T++){x=!x;const S=i[T];m=E*l,E+=S,_=E*l,h.push({left:m,right:_,isDash:x,zeroLength:0===S})}return h}addRoundDash(i,o,l){const h=o/2;for(let m=-l;m<=l;m++){const _=this.width*(this.nextRow+l+m);let x=0,E=i[x];for(let T=0;T<this.width;T++){T/E.right>1&&(E=i[++x]);const S=Math.abs(T-E.left),P=Math.abs(T-E.right),L=Math.min(S,P);let O;const N=m/l*(h+1);if(E.isDash){const j=h-Math.abs(N);O=Math.sqrt(L*L+j*j)}else O=h-Math.sqrt(L*L+N*N);this.image.data[_+T]=Math.max(0,Math.min(255,O+128))}}}addRegularDash(i,o){for(let E=i.length-1;E>=0;--E){const T=i[E],S=i[E+1];T.zeroLength?i.splice(E,1):S&&S.isDash===T.isDash&&(S.left=T.left,i.splice(E,1))}const l=i[0],h=i[i.length-1];l.isDash===h.isDash&&(l.left=h.left-this.width,h.right=l.right+this.width);const m=this.width*this.nextRow;let _=0,x=i[_];for(let E=0;E<this.width;E++){E/x.right>1&&(x=i[++_]);const T=Math.abs(E-x.left),S=Math.abs(E-x.right),P=Math.min(T,S);this.image.data[m+E]=Math.max(0,Math.min(255,(x.isDash?P:-P)+o+128))}}addDash(i,o){const l=this.getKey(i,o);if(this.positions[l])return this.positions[l];const h="round"===o,m=h?7:0,_=2*m+1;if(this.nextRow+_>this.height)return Qn("LineAtlas out of space"),null;0===i.length&&i.push(1);let x=0;for(let S=0;S<i.length;S++)i[S]<0&&(Qn("Negative value is found in line dasharray, replacing values with 0"),i[S]=0),x+=i[S];if(0!==x){const S=this.width/x,P=this.getDashRanges(i,this.width,S);h?this.addRoundDash(P,S,m):this.addRegularDash(P,"square"===o?.5*S:0)}const E=this.nextRow+m;this.nextRow+=_;const T={tl:[E,m],br:[x,0]};return this.positions[l]=T,T}}lt(gf,"LineAtlas");class ig{constructor(i){const o={},l=[];for(const x in i){const E=i[x],T=o[x]={};for(const S in E.glyphs){const P=E.glyphs[+S];if(!P||0===P.bitmap.width||0===P.bitmap.height)continue;const L=P.metrics.localGlyph?2:1,O={x:0,y:0,w:P.bitmap.width+2*L,h:P.bitmap.height+2*L};l.push(O),T[S]=O}}const{w:h,h:m}=Fl(l),_=new aa({width:h||1,height:m||1});for(const x in i){const E=i[x];for(const T in E.glyphs){const S=E.glyphs[+T];if(!S||0===S.bitmap.width||0===S.bitmap.height)continue;const P=o[x][T],L=S.metrics.localGlyph?2:1;aa.copy(S.bitmap,_,{x:0,y:0},{x:P.x+L,y:P.y+L},S.bitmap)}}this.image=_,this.positions=o}}lt(ig,"GlyphAtlas");class rg{constructor(i){this.tileID=new yr(i.tileID.overscaledZ,i.tileID.wrap,i.tileID.canonical.z,i.tileID.canonical.x,i.tileID.canonical.y),this.tileZoom=i.tileZoom,this.uid=i.uid,this.zoom=i.zoom,this.canonical=i.tileID.canonical,this.pixelRatio=i.pixelRatio,this.tileSize=i.tileSize,this.source=i.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=i.showCollisionBoxes,this.collectResourceTiming=!!i.collectResourceTiming,this.returnDependencies=!!i.returnDependencies,this.promoteId=i.promoteId,this.enableTerrain=!!i.enableTerrain,this.isSymbolTile=i.isSymbolTile,this.tileTransform=ua(i.tileID.canonical,i.projection),this.projection=i.projection}parse(i,o,l,h,m){this.status="parsing",this.data=i,this.collisionBoxArray=new Qh;const _=new Y_(Object.keys(i.layers).sort()),x=new eg(this.tileID,this.promoteId);x.bucketLayerIDs=[];const E={},T=new gf(256,256),S={featureIndex:x,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:T,availableImages:l},P=o.familiesBySource[this.source];for(const he in P){const le=i.layers[he];if(!le)continue;let be=!1,Ee=!1;for(const Ae of P[he])"symbol"===Ae[0].type?be=!0:Ee=!0;if(!0===this.isSymbolTile&&!be||!1===this.isSymbolTile&&!Ee)continue;1===le.version&&Qn(`Vector tile source "${this.source}" layer "${he}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ke=_.encode(he),Xe=[];for(let Ae=0;Ae<le.length;Ae++){const Oe=le.feature(Ae),ze=x.getId(Oe,he);Xe.push({feature:Oe,id:ze,index:Ae,sourceLayerIndex:ke})}for(const Ae of P[he]){const Oe=Ae[0];void 0!==this.isSymbolTile&&"symbol"===Oe.type!==this.isSymbolTile||Oe.minzoom&&this.zoom<Math.floor(Oe.minzoom)||Oe.maxzoom&&this.zoom>=Oe.maxzoom||"none"!==Oe.visibility&&(og(Ae,this.zoom,l),(E[Oe.id]=Oe.createBucket({index:x.bucketLayerIDs.length,layers:Ae,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ke,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:l})).populate(Xe,S,this.tileID.canonical,this.tileTransform),x.bucketLayerIDs.push(Ae.map(ze=>ze.id)))}}let L,O,N,j;T.trim();const G={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ne=io(S.glyphDependencies,he=>Object.keys(he).map(Number));Object.keys(ne).length?h.send("getGlyphs",{uid:this.uid,stacks:ne},(he,le)=>{L||(L=he,O=le,se.call(this))},void 0,!1,G):O={};const ae=Object.keys(S.iconDependencies);ae.length?h.send("getImages",{icons:ae,source:this.source,tileID:this.tileID,type:"icons"},(he,le)=>{L||(L=he,N=le,se.call(this))},void 0,!1,G):N={};const te=Object.keys(S.patternDependencies);function se(){if(L)return m(L);if(O&&N&&j){const he=new ig(O),le=new w_(N,j);for(const be in E){const Ee=E[be];Ee instanceof Xa?(og(Ee.layers,this.zoom,l),L_(Ee,O,he.positions,N,le.iconPositions,this.showCollisionBoxes,l,this.tileID.canonical,this.tileZoom,this.projection)):Ee.hasPattern&&(Ee instanceof $p||Ee instanceof Rp||Ee instanceof md)&&(og(Ee.layers,this.zoom,l),Ee.addFeatures(S,this.tileID.canonical,le.patternPositions,l,this.tileTransform))}this.status="done",m(null,{buckets:Ns(E).filter(be=>!be.isEmpty()),featureIndex:x,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:he.image,lineAtlas:T,imageAtlas:le,glyphMap:this.returnDependencies?O:null,iconMap:this.returnDependencies?N:null,glyphPositions:this.returnDependencies?he.positions:null})}}te.length?h.send("getImages",{icons:te,source:this.source,tileID:this.tileID,type:"patterns"},(he,le)=>{L||(L=he,j=le,se.call(this))},void 0,!1,G):j={},se.call(this)}}function og(r,i,o){const l=new _e(i);for(const h of r)h.recalculate(l,o)}class C0{constructor(i){this.entries={},this.scheduler=i}request(i,o,l,h){const m=this.entries[i]=this.entries[i]||{callbacks:[]};if(m.result){const[_,x]=m.result;return this.scheduler?this.scheduler.add(()=>{h(_,x)},o):h(_,x),()=>{}}return m.callbacks.push(h),m.cancel||(m.cancel=l((_,x)=>{m.result=[_,x];for(const E of m.callbacks)this.scheduler?this.scheduler.add(()=>{E(_,x)},o):E(_,x);setTimeout(()=>delete this.entries[i],3e3)})),()=>{m.result||(m.callbacks=m.callbacks.filter(_=>_!==h),m.callbacks.length||(m.cancel(),delete this.entries[i]))}}}function ey(r,i,o){const l=JSON.stringify(r.request);return r.data&&(this.deduped.entries[l]={result:[null,r.data]}),this.deduped.request(l,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom},h=>{const m=Ca(r.request,(_,x,E,T)=>{_?h(_):x&&h(null,{vectorTile:o?void 0:new zp(new ch(x)),rawData:x,cacheControl:E,expires:T})});return()=>{m.cancel(),h()}},i)}d.ARRAY_TYPE=fo,d.AUTH_ERR_MSG=ac,d.Aabb=ur,d.Actor=class{constructor(r,i,o){this.target=r,this.parent=i,this.mapId=o,this.callbacks={},this.cancelCallbacks={},zs(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Ho()?r:Ue,this.scheduler=new M1}send(r,i,o,l,h=!1,m){const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);o&&(o.metadata=m,this.callbacks[_]=o);const x=ec(this.globalScope)?void 0:[];return this.target.postMessage({id:_,type:r,hasCallback:!!o,targetMapId:l,mustQueue:h,sourceMapId:this.mapId,data:Ba(i,x)},x),{cancel:()=>{o&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:l,sourceMapId:this.mapId})}}}receive(r){const i=r.data,o=i.id;if(o&&(!i.targetMapId||this.mapId===i.targetMapId))if("<cancel>"===i.type){const l=this.cancelCallbacks[o];delete this.cancelCallbacks[o],l&&l.cancel()}else if(i.mustQueue||Ho()){const l=this.callbacks[o];this.cancelCallbacks[o]=this.scheduler.add(()=>this.processTask(o,i),l&&l.metadata||{type:"message"})}else this.processTask(o,i)}processTask(r,i){if("<response>"===i.type){const o=this.callbacks[r];delete this.callbacks[r],o&&(i.error?o(Al(i.error)):o(null,Al(i.data)))}else{const o=ec(this.globalScope)?void 0:[],l=i.hasCallback?(m,_)=>{delete this.cancelCallbacks[r],this.target.postMessage({id:r,type:"<response>",sourceMapId:this.mapId,error:m?Ba(m):null,data:Ba(_,o)},o)}:m=>{},h=Al(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,h,l);else if(this.parent.getWorkerSource){const m=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,m[0],h.source)[m[1]](h,l)}else l(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},d.CanonicalTileID=rs,d.Color=ui,d.ColorMode=Is,d.CullFaceMode=mo,d.DEMData=ff,d.DataConstantProperty=ge,d.DedupedRequest=C0,d.DepthMode=Qc,d.EXTENT=St,d.Elevation=class{isDataAvailableAtPoint(r){const i=this._source();if(this.isUsingMockSource()||!i||r.y<0||r.y>1)return!1;const o=i.getSource().maxzoom,l=1<<o,h=Math.floor(r.x),m=Math.floor((r.x-h)*l),_=Math.floor(r.y*l),x=this.findDEMTileFor(new yr(o,h,o,m,_));return!(!x||!x.dem)}getAtPointOrZero(r,i=0){return this.getAtPoint(r,i)||0}getAtPoint(r,i,o=!0){if(this.isUsingMockSource())return null;null==i&&(i=null);const l=this._source();if(!l||r.y<0||r.y>1)return i;const h=l.getSource().maxzoom,m=1<<h,_=Math.floor(r.x),x=r.x-_,E=new yr(h,_,h,Math.floor(x*m),Math.floor(r.y*m)),T=this.findDEMTileFor(E);if(!T||!T.dem)return i;const S=T.dem,P=1<<T.tileID.canonical.z,L=(x*P-T.tileID.canonical.x)*S.dim,O=(r.y*P-T.tileID.canonical.y)*S.dim,N=Math.floor(L),j=Math.floor(O);return(o?this.exaggeration():1)*dn(dn(S.get(N,j),S.get(N,j+1),O-j),dn(S.get(N+1,j),S.get(N+1,j+1),O-j),L-N)}getAtTileOffset(r,i,o){const l=1<<r.canonical.z;return this.getAtPointOrZero(new Wu(r.wrap+(r.canonical.x+i/St)/l,(r.canonical.y+o/St)/l))}getAtTileOffsetFunc(r,i,o,l){return h=>{const m=this.getAtTileOffset(r,h.x,h.y),_=l.upVector(r.canonical,h.x,h.y);return Mo(_,_,m*l.upVectorScale(r.canonical,i,o).metersToTile),_}}getForTilePoints(r,i,o,l){if(this.isUsingMockSource())return!1;const h=tu.create(this,r,l);return!!h&&(i.forEach(m=>{m[2]=this.exaggeration()*h.getElevationAt(m[0],m[1],o)}),!0)}getMinMaxForTile(r){if(this.isUsingMockSource())return null;const i=this.findDEMTileFor(r);if(!i||!i.dem)return null;const o=i.dem.tree,l=i.tileID,h=1<<r.canonical.z-l.canonical.z;let m=r.canonical.x/h-l.canonical.x,_=r.canonical.y/h-l.canonical.y,x=0;for(let E=0;E<r.canonical.z-l.canonical.z&&!o.leaves[x];E++){m*=2,_*=2;const T=2*Math.floor(_)+Math.floor(m);x=o.childOffsets[x]+T,m%=1,_%=1}return{min:this.exaggeration()*o.minimums[x],max:this.exaggeration()*o.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(r,i,o){throw new Error("Pure virtual method called.")}pointCoordinate(r){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(r){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},d.ErrorEvent=gs,d.EvaluationParameters=_e,d.Event=Wo,d.Evented=jr,d.FillExtrusionBucket=md,d.Frustum=um,d.FrustumCorners=cm,d.GLOBE_METERS_TO_ECEF=Vm,d.GLOBE_RADIUS=Wa,d.GLOBE_SCALE_MATCH_LATITUDE=45,d.GLOBE_ZOOM_THRESHOLD_MAX=6,d.GLOBE_ZOOM_THRESHOLD_MIN=5,d.GlobeSharedBuffers=class{constructor(r){this._createGrid(r),this._createPoles(r)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const r of this._poleSegments)r.destroy();for(const r of this._gridSegments)r.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const r of this._wireframeSegments)r.destroy()}}_createGrid(r){const i=new pn,o=new cr,l=65;for(let h=0;h<l;h++)for(let m=0;m<l;m++)i.emplaceBack(m,h);this._gridSegments=[];for(let h=0,m=0;h<Gt.length;h++){const _=Gt[h];for(let E=0;E<_;E++)for(let T=0;T<64;T++){const S=E*l+T;o.emplaceBack(S+1,S,S+l),o.emplaceBack(S+l,S+l+1,S+1)}const x=64*_*2;this._gridSegments.push(ai.simpleSegment(0,m,(_+1)*l,x)),m+=x}this._gridBuffer=r.createVertexBuffer(i,dh.members),this._gridIndexBuffer=r.createIndexBuffer(o,!0)}_createPoles(r){const i=new cr;for(let h=0;h<=64;h++)i.emplaceBack(0,h+1,h+2);this._poleIndexBuffer=r.createIndexBuffer(i,!0);const o=new Ll,l=new Ll;this._poleSegments=[];for(let h=0,m=0;h<5;h++){const _=360/(1<<h);o.emplaceBack(0,-Wa,0,.5,0),l.emplaceBack(0,-Wa,0,.5,1);for(let x=0;x<=64;x++){const E=x/64,T=dn(0,_,E),[S,P,L]=ss(gh,p0,T,Wa);o.emplaceBack(S,P,L,E,0),l.emplaceBack(S,P,L,E,1)}this._poleSegments.push(ai.simpleSegment(m,0,66,64)),m+=66}this._poleNorthVertexBuffer=r.createVertexBuffer(o,O_,!1),this._poleSouthVertexBuffer=r.createVertexBuffer(l,O_,!1)}getGridBuffers(r){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[r]]}getPoleBuffers(r){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[r]]}getWirefameBuffers(r,i){if(!this._wireframeSegments){const o=new gr,l=64,h=l+1;this._wireframeSegments=[];for(let m=0,_=0;m<Gt.length;m++){const x=Gt[m];for(let T=0;T<x;T++)for(let S=0;S<l;S++){const P=T*h+S;o.emplaceBack(P,P+1),o.emplaceBack(P,P+h),o.emplaceBack(P,P+h+1)}const E=x*l*3;this._wireframeSegments.push(ai.simpleSegment(0,_,(x+1)*h,E)),_+=E}this._wireframeIndexBuffer=r.createIndexBuffer(o)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[i]]}},d.GlyphManager=hh,d.ImagePosition=Rm,d.LivePerformanceUtils=it,d.LngLat=fn,d.LngLatBounds=Ts,d.LocalGlyphMode=zm,d.MAX_MERCATOR_LATITUDE=es,d.MercatorCoordinate=Wu,d.ONE_EM=24,d.OverscaledTileID=yr,d.PerformanceMarkers=je,d.Properties=wt,d.RGBAImage=Po,d.Ray=Tp,d.RequestManager=class{constructor(r,i,o){this._transformRequestFn=r,this._customAccessToken=i,this._silenceAuthErrors=!!o,this._createSkuToken()}_createSkuToken(){const r=function(){let i="";for(let o=0;o<10;o++)i+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",jo,i].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=r.token,this._skuTokenExpiresAt=r.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(r,i){return this._transformRequestFn&&this._transformRequestFn(r,i)||{url:r}}normalizeStyleURL(r,i){if(!qo(r))return r;const o=so(r);return o.path=`/styles/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||i)}normalizeGlyphsURL(r,i){if(!qo(r))return r;const o=so(r);return o.path=`/fonts/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||i)}normalizeSourceURL(r,i,o,l){if(!qo(r))return r;const h=so(r);return h.path=`/v4/${h.authority}.json`,h.params.push("secure"),o&&h.params.push(`language=${o}`),l&&h.params.push(`worldview=${l}`),this._makeAPIURL(h,this._customAccessToken||i)}normalizeSpriteURL(r,i,o,l){const h=so(r);return qo(r)?(h.path=`/styles/v1${h.path}/sprite${i}${o}`,this._makeAPIURL(h,this._customAccessToken||l)):(h.path+=`${i}${o}`,Gs(h))}normalizeTileURL(r,i,o){if(this._isSkuTokenExpired()&&this._createSkuToken(),r&&!qo(r))return r;const l=so(r);l.path=l.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${i||o&&"raster"!==l.authority&&512===o?"@2x":""}${Wt.supported?".webp":"$1"}`),"raster"===l.authority?l.path=`/${Jt.RASTER_URL_PREFIX}${l.path}`:(l.path=l.path.replace(/^.+\/v4\//,"/"),l.path=`/${Jt.TILE_URL_VERSION}${l.path}`);const h=this._customAccessToken||function(m){for(const _ of m){const x=_.match(/^access_token=(.*)$/);if(x)return x[1]}return null}(l.params)||Jt.ACCESS_TOKEN;return Jt.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&l.params.push(`sku=${this._skuToken}`),this._makeAPIURL(l,h)}canonicalizeTileURL(r,i){const o=so(r);if(!o.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!o.path.match(/\.[\w]+$/))return r;let l="mapbox://";o.path.match(/^\/raster\/v1\//)?l+=`raster/${o.path.replace(`/${Jt.RASTER_URL_PREFIX}/`,"")}`:l+=`tiles/${o.path.replace(`/${Jt.TILE_URL_VERSION}/`,"")}`;let h=o.params;return i&&(h=h.filter(m=>!m.match(/^access_token=/))),h.length&&(l+=`?${h.join("&")}`),l}canonicalizeTileset(r,i){const o=!!i&&qo(i),l=[];for(const h of r.tiles||[])lc(h)?l.push(this.canonicalizeTileURL(h,o)):l.push(h);return l}_makeAPIURL(r,i){const o="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",l=so(Jt.API_URL);if(r.protocol=l.protocol,r.authority=l.authority,"http"===r.protocol){const h=r.params.indexOf("secure");h>=0&&r.params.splice(h,1)}if("/"!==l.path&&(r.path=`${l.path}${r.path}`),!Jt.REQUIRE_ACCESS_TOKEN)return Gs(r);if(i=i||Jt.ACCESS_TOKEN,!this._silenceAuthErrors){if(!i)throw new Error(`An API access token is required to use Mapbox GL. ${o}`);if("s"===i[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${o}`)}return r.params=r.params.filter(h=>-1===h.indexOf("access_token")),r.params.push(`access_token=${i||""}`),Gs(r)}},d.ResourceType=ro,d.SegmentVector=ai,d.SourceCache=cs,d.StencilMode=Ym,d.StructArrayLayout1ui2=ia,d.StructArrayLayout2f1f2i16=lr,d.StructArrayLayout2i4=pn,d.StructArrayLayout2ui4=gr,d.StructArrayLayout3f12=kr,d.StructArrayLayout3ui6=cr,d.StructArrayLayout4i8=Cn,d.StructArrayLayout5f20=Ll,d.Texture=Ad,d.Tile=Q_,d.Transitionable=Le,d.Uniform1f=Jh,d.Uniform1i=class extends _r{constructor(r){super(r),this.current=0}set(r,i,o){this.fetchUniformLocation(r,i)&&this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}},d.Uniform2f=class extends _r{constructor(r){super(r),this.current=[0,0]}set(r,i,o){this.fetchUniformLocation(r,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1])))}},d.Uniform3f=class extends _r{constructor(r){super(r),this.current=[0,0,0]}set(r,i,o){this.fetchUniformLocation(r,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2])))}},d.Uniform4f=ed,d.UniformColor=Hu,d.UniformMatrix2f=class extends _r{constructor(r){super(r),this.current=hv}set(r,i,o){if(this.fetchUniformLocation(r,i))for(let l=0;l<4;l++)if(o[l]!==this.current[l]){this.current=o,this.gl.uniformMatrix2fv(this.location,!1,o);break}}},d.UniformMatrix3f=class extends _r{constructor(r){super(r),this.current=uv}set(r,i,o){if(this.fetchUniformLocation(r,i))for(let l=0;l<9;l++)if(o[l]!==this.current[l]){this.current=o,this.gl.uniformMatrix3fv(this.location,!1,o);break}}},d.UniformMatrix4f=class extends _r{constructor(r){super(r),this.current=Fg}set(r,i,o){if(this.fetchUniformLocation(r,i)){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let l=1;l<16;l++)if(o[l]!==this.current[l]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}}},d.UnwrappedTileID=sh,d.ValidationError=at,d.VectorTileFeature=Bp,d.VectorTileWorkerSource=class extends jr{constructor(r,i,o,l,h){super(),this.actor=r,this.layerIndex=i,this.availableImages=o,this.loadVectorData=h||ey,this.loading={},this.loaded={},this.deduped=new C0(r.scheduler),this.isSpriteLoaded=l,this.scheduler=r.scheduler}loadTile(r,i){const o=r.uid,l=r&&r.request,h=l&&l.collectResourceTiming,m=this.loading[o]=new rg(r);m.abort=this.loadVectorData(r,(_,x)=>{const E=!this.loading[o];if(delete this.loading[o],E||_||!x)return m.status="done",E||(this.loaded[o]=m),i(_);const T=x.rawData,S={};x.expires&&(S.expires=x.expires),x.cacheControl&&(S.cacheControl=x.cacheControl),m.vectorTile=x.vectorTile||new zp(new ch(T));const P=()=>{m.parse(m.vectorTile,this.layerIndex,this.availableImages,this.actor,(L,O)=>{if(L||!O)return i(L);const N={};if(h){const j=bt(l);j.length>0&&(N.resourceTiming=JSON.parse(JSON.stringify(j)))}i(null,_n({rawTileData:T.slice(0)},O,S,N))})};this.isSpriteLoaded?P():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(P,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom}):P()}),this.loaded=this.loaded||{},this.loaded[o]=m})}reloadTile(r,i){const o=this.loaded,l=r.uid,h=this;if(o&&o[l]){const m=o[l];m.showCollisionBoxes=r.showCollisionBoxes,m.enableTerrain=!!r.enableTerrain,m.projection=r.projection,m.tileTransform=ua(r.tileID.canonical,r.projection);const _=(x,E)=>{const T=m.reloadCallback;T&&(delete m.reloadCallback,m.parse(m.vectorTile,h.layerIndex,this.availableImages,h.actor,T)),i(x,E)};"parsing"===m.status?m.reloadCallback=_:"done"===m.status&&(m.vectorTile?m.parse(m.vectorTile,this.layerIndex,this.availableImages,this.actor,_):_())}}abortTile(r,i){const o=r.uid,l=this.loading[o];l&&(l.abort&&l.abort(),delete this.loading[o]),i()}removeTile(r,i){const o=this.loaded,l=r.uid;o&&o[l]&&delete o[l],i()}},d.WritingMode=Lo,d.add=$a,d.addDynamicAttributes=vh,d.adjoint=function(r,i){var o=i[0],l=i[1],h=i[2],m=i[3],_=i[4],x=i[5],E=i[6],T=i[7],S=i[8];return r[0]=_*S-x*T,r[1]=h*T-l*S,r[2]=l*x-h*_,r[3]=x*E-m*S,r[4]=o*S-h*E,r[5]=h*m-o*x,r[6]=m*T-_*E,r[7]=l*E-o*T,r[8]=o*_-l*m,r},d.asyncAll=Ea,d.bezier=Ql,d.bindAll=zs,d.boundsAttributes=w0,d.bufferConvexPolygon=function(r,i){const o=[];for(let l=0;l<r.length;l++){const h=Fs(l-1,-1,r.length-1),m=Fs(l+1,-1,r.length-1),_=r[l],x=r[m],E=r[h].sub(_).unit(),T=x.sub(_).unit(),S=T.angleWithSep(E.x,E.y),P=E.add(T).unit().mult(-1*i/Math.sin(S/2));o.push(_.add(P))}return o},d.cacheEntryPossiblyAdded=function(r){rc++,rc>ll&&(r.getActor().send("enforceCacheSizeLimit",tc),rc=0)},d.calculateGlobeLabelMatrix=function(r,i){const{x:o,y:l}=r.point,h=d0(o,l,r.worldSize/r._pixelsPerMercatorPixel,0,0);return Ku(h,h,U_(ca(i)))},d.calculateGlobeMatrix=function(r){const{x:i,y:o}=r.point,{lng:l,lat:h}=r._center;return d0(i,o,r.worldSize,l,h)},d.calculateGlobeMercatorMatrix=function(r){const i=r.pixelsPerMeter,o=i/Jo(1,r.center.lat),l=sa(new Float64Array(16));return wp(l,l,[r.point.x,r.point.y,0]),Yu(l,l,[o,o,i]),Float32Array.from(l)},d.circumferenceAtLatitude=mp,d.clamp=sn,d.clearTileCache=function(r){if(!nc())return;const i=Ue.caches.delete(Lh);r&&i.catch(r).then(()=>r())},d.clipLine=C_,d.clone=function(r){var i=new fo(16);return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],i},d.clone$1=Vr,d.collisionCircleLayout=__,d.config=Jt,d.conjugate=function(r,i){return r[0]=-i[0],r[1]=-i[1],r[2]=-i[2],r[3]=i[3],r},d.create=function(){var r=new fo(16);return fo!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},d.create$1=bp,d.createExpression=Oa,d.createLayout=ut,d.createStyleLayer=function(r){return"custom"===r.type?new S1(r):new x0[r.type](r)},d.cross=rm,d.degToRad=on,d.distance=function(r,i){return Math.hypot(i[0]-r[0],i[1]-r[1],i[2]-r[2])},d.div=function(r,i,o){return r[0]=i[0]/o[0],r[1]=i[1]/o[1],r[2]=i[2]/o[2],r},d.dot=Ao,d.earthRadius=fp,d.ease=ba,d.easeCubicInOut=xa,d.ecefToLatLng=function([r,i,o]){const l=Math.hypot(r,i,o),h=Math.atan2(r,o),m=.5*Math.PI-Math.acos(-i/l);return new fn(bi(h),bi(m))},d.emitValidationErrors=qh,d.endsWith=Br,d.enforceCacheSizeLimit=function(r){ms(),Tr&&Tr.then(i=>{i.keys().then(o=>{for(let l=0;l<o.length-r;l++)i.delete(o[l])})})},d.evaluateSizeForFeature=Gp,d.evaluateSizeForZoom=lh,d.evaluateVariableOffset=l0,d.evented=ce,d.exactEquals=function(r,i){return r[0]===i[0]&&r[1]===i[1]&&r[2]===i[2]&&r[3]===i[3]},d.exactEquals$1=function(r,i){return r[0]===i[0]&&r[1]===i[1]&&r[2]===i[2]},d.exported=xt,d.exported$1=Wt,d.extend=_n,d.extend$1=_s,d.fillExtrusionHeightLift=d_,d.filterObject=Bs,d.fromMat4=function(r,i){return r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=i[4],r[4]=i[5],r[5]=i[6],r[6]=i[8],r[7]=i[9],r[8]=i[10],r},d.fromQuat=function(r,i){var o=i[0],l=i[1],h=i[2],m=i[3],_=o+o,x=l+l,E=h+h,T=o*_,S=l*_,P=l*x,L=h*_,O=h*x,N=h*E,j=m*_,G=m*x,ne=m*E;return r[0]=1-P-N,r[1]=S+ne,r[2]=L-G,r[3]=0,r[4]=S-ne,r[5]=1-T-N,r[6]=O+j,r[7]=0,r[8]=L+G,r[9]=O-j,r[10]=1-T-P,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},d.fromRotation=function(r,i){var o=Math.sin(i),l=Math.cos(i);return r[0]=l,r[1]=o,r[2]=0,r[3]=-o,r[4]=l,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},d.fromScaling=Xg,d.furthestTileCorner=function(r){const i=Math.round((r+45+360)%360/90)%4;return va[i]},d.getAABBPointSquareDist=function(r,i,o){let l=0;for(let h=0;h<2;++h){const m=o?o[h]:0;r[h]>m&&(l+=(r[h]-m)*(r[h]-m)),i[h]<m&&(l+=(m-i[h])*(m-i[h]))}return l},d.getAnchorAlignment=zl,d.getAnchorJustification=Bm,d.getBounds=function(r){let i=1/0,o=1/0,l=-1/0,h=-1/0;for(const m of r)i=Math.min(i,m.x),o=Math.min(o,m.y),l=Math.max(l,m.x),h=Math.max(h,m.y);return{min:new et(i,o),max:new et(l,h)}},d.getColumn=Da,d.getGridMatrix=function(r,i,o,l){const h=i.getNorth(),m=i.getSouth(),_=i.getWest(),x=i.getEast(),E=1<<r.z,T=x-_,S=h-m,P=T/64,L=-S/Gt[o],O=[0,P,0,L,0,0,h,_,0];if(r.z>0){const N=180/l;xv(O,O,[N/T+1,0,0,0,N/S+1,0,-.5*N/P,.5*N/L,1])}return O[2]=E,O[5]=r.x,O[8]=r.y,O},d.getImage=sc,d.getJSON=function(r,i){return Us(_n(r,{type:"json"}),i)},d.getLatitudinalLod=function(r){const i=80.051129;r=sn(r,-80.051129,i)/i*90;const o=Math.pow(Math.abs(Math.sin(on(r))),3);return Math.round(o*(Gt.length-1))},d.getMapSessionAPI=pe,d.getPerformanceMeasurement=bt,d.getProjection=as,d.getRTLTextPluginStatus=me,d.getReferrer=oo,d.getTilePoint=function(r,{x:i,y:o},l=0){return new et(((i-l)*r.scale-r.x)*St,(o*r.scale-r.y)*St)},d.getTileVec3=function(r,i,o=0){return Wi(((i.x-o)*r.scale-r.x)*St,(i.y*r.scale-r.y)*St,Vg(i.z,i.y))},d.getVideo=function(r,i){const o=Ue.document.createElement("video");o.muted=!0,o.onloadstart=function(){i(null,o)};for(let l=0;l<r.length;l++){const h=Ue.document.createElement("source");oc(r[l])||(o.crossOrigin="Anonymous"),h.src=r[l],o.appendChild(h)}return{cancel:()=>{}}},d.globeCenterToScreenPoint=function(r){const i=[0,0,0],o=sa(new Float64Array(16));return Ku(o,r.pixelMatrix,r.globeMatrix),hi(i,i,o),new et(i[0],i[1])},d.globeDenormalizeECEF=U_,d.globeECEFOrigin=function(r,i){const o=[0,0,0];return hi(o,o,lf(ca(i.canonical))),hi(o,o,r),o},d.globeNormalizeECEF=lf,d.globePixelsToTileUnits=function(r,i){return St/(512*Math.pow(2,r))*fh(ca(i))},d.globePoleMatrixForTile=function(r,i,o){const l=sa(new Float64Array(16)),h=(i/(1<<r)-.5)*Math.PI*2;return Jf(l,o.globeMatrix,h),Float32Array.from(l)},d.globeTileBounds=ca,d.globeTiltAtLngLat=jm,d.globeToMercatorTransition=mh,d.globeUseCustomAntiAliasing=function(r,i,o){const l=mh(o.zoom),h=r.style.map._antialias,m=!!i.extStandardDerivatives,_=i.extStandardDerivativesForceOff||r.terrain&&r.terrain.exaggeration()>0;return 0===l&&!h&&!_&&m},d.identity=sa,d.identity$1=am,d.invert=rd,d.isFullscreen=function(){return!!Ue.document.fullscreenElement||!!Ue.document.webkitFullscreenElement},d.isLngLatBehindGlobe=$_,d.isMapAuthenticated=function(r){return we.has(r)},d.isMapboxURL=qo,d.isSafariWithAntialiasingBug=function(r){const i=r.navigator?r.navigator.userAgent:null;return!!ec(r)&&i&&(i.match("Version/15.4")||i.match("Version/15.5")||i.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},d.latFromMercatorY=qi,d.latLngToECEF=wd,d.len=Nr,d.length=Qu,d.length$1=function(r){return Math.hypot(r[0],r[1],r[2],r[3])},d.lngFromMercatorX=Bt,d.loadVectorTile=ey,d.makeRequest=Us,d.mapValue=function(r,i,o,l,h){return sn((r-i)/(o-i)*(h-l)+l,l,h)},d.mercatorScale=qu,d.mercatorXfromLng=po,d.mercatorYfromLat=Jr,d.mercatorZfromAltitude=Jo,d.mul=tm,d.mul$1=om,d.multiply=Ku,d.multiply$1=xv,d.multiply$2=Kg,d.nextPowerOfTwo=Uo,d.normalize=Or,d.normalize$1=bv,d.normalize$2=sm,d.number=dn,d.ortho=function(r,i,o,l,h,m,_){var x=1/(i-o),E=1/(l-h),T=1/(m-_);return r[0]=-2*x,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*E,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*T,r[11]=0,r[12]=(i+o)*x,r[13]=(h+l)*E,r[14]=(_+m)*T,r[15]=1,r},d.pbf=ch,d.perspective=function(r,i,o,l,h){var m,_=1/Math.tan(i/2);return r[0]=_/o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=_,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,null!=h&&h!==1/0?(r[10]=(h+l)*(m=1/(l-h)),r[14]=2*h*l*m):(r[10]=-1,r[14]=-2*l),r},d.pick=function(r,i){const o={};for(let l=0;l<i.length;l++){const h=i[l];h in r&&(o[h]=r[h])}return o},d.plugin=Te,d.pointGeometry=et,d.polesInViewport=function(r){const i=sa(new Float64Array(16));Ku(i,r.pixelMatrix,r.globeMatrix);const o=[0,Rt,0],l=[0,Ro,0];return hi(o,o,i),hi(l,l,i),[o[0]>0&&o[0]<=r.width&&o[1]>0&&o[1]<=r.height&&!$_(r,new fn(r.center.lat,90)),l[0]>0&&l[0]<=r.width&&l[1]>0&&l[1]<=r.height&&!$_(r,new fn(r.center.lat,-90))]},d.polygonContainsPoint=kc,d.polygonIntersectsBox=qg,d.polygonIntersectsPolygon=Ug,d.polygonizeBounds=function(r,i,o=0,l=!0){const h=new et(o,o),m=r.sub(h),_=i.add(h),x=[m,new et(_.x,m.y),_,new et(m.x,_.y)];return l&&x.push(m.clone()),x},d.posAttributes=dh,d.postMapLoadEvent=oe,d.postPerformanceEvent=ve,d.postTurnstileEvent=U,d.potpack=Fl,d.prevPowerOfTwo=function(r){return r<=1?1:Math.pow(2,Math.floor(Math.log(r)/Math.LN2))},d.radToDeg=bi,d.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],d.registerForPluginStateChange=function(r){return r({pluginStatus:J,pluginURL:Q}),ce.on("pluginStateChange",r),r},d.removeAuthState=function(r){we.delete(r)},d.renderColorRamp=ld,d.resample=jg,d.rotateX=Zg,d.rotateX$1=Qg,d.rotateY=Jf,d.rotateY$1=lm,d.rotateZ=function(r,i,o){var l=Math.sin(o),h=Math.cos(o),m=i[0],_=i[1],x=i[2],E=i[3],T=i[4],S=i[5],P=i[6],L=i[7];return i!==r&&(r[8]=i[8],r[9]=i[9],r[10]=i[10],r[11]=i[11],r[12]=i[12],r[13]=i[13],r[14]=i[14],r[15]=i[15]),r[0]=m*h+T*l,r[1]=_*h+S*l,r[2]=x*h+P*l,r[3]=E*h+L*l,r[4]=T*h-m*l,r[5]=S*h-_*l,r[6]=P*h-x*l,r[7]=L*h-E*l,r},d.rotateZ$1=function(r,i,o){o*=.5;var l=i[0],h=i[1],m=i[2],_=i[3],x=Math.sin(o),E=Math.cos(o);return r[0]=l*E+h*x,r[1]=h*E-l*x,r[2]=m*E+_*x,r[3]=_*E-m*x,r},d.scale=Yu,d.scale$1=eh,d.scale$2=Mo,d.scaleAndAdd=od,d.set=function(r,i,o,l){return r[0]=i,r[1]=o,r[2]=l,r},d.setCacheLimits=function(r,i){tc=r,ll=i},d.setColumn=function(r,i,o){r[4*i+0]=o[0],r[4*i+1]=o[1],r[4*i+2]=o[2],r[4*i+3]=o[3]},d.setRTLTextPlugin=function(r,i,o=!1){if(J===W||J===K||J===q)throw new Error("setRTLTextPlugin cannot be called multiple times.");Q=xt.resolveURL(r),J=W,H=i,ue(),o||Se()},d.smoothstep=wa,d.spec=Re,d.squaredLength=function(r){var i=r[0],o=r[1],l=r[2];return i*i+o*o+l*l},d.storeAuthState=function(r,i){i?we.add(r):we.delete(r)},d.sub=ts,d.subtract=im,d.symbolSize=Zv,d.tileAABB=function(r,i,o,l,h,m,_,x,E){if("globe"===E.name)return function T1(r,i,o){const l=i/r.worldSize,h=r.globeMatrix;if(o.z<=1){const Ee=ca(o).getCorners();return V_(Ee,h,l),ur.fromPoints(Ee)}const m=bd(o),_=af(m);V_(_,h,l);const x=Number.MAX_VALUE,E=[-x,-x,-x],T=[x,x,x];if(m.contains(r.center)){for(const Xe of _)Ju(T,T,Xe),Oc(E,E,Xe);E[2]=0;const Ee=r.point,ke=[Ee.x*l,Ee.y*l,0];return Ju(T,T,ke),Oc(E,E,ke),new ur(T,E)}const S=[h[12]*l,h[13]*l,h[14]*l],P=m.getCenter(),L=sn(r.center.lat,-85.051129,es),O=sn(P.lat,-85.051129,es),N=po(r.center.lng),j=Jr(L);let G=N-po(P.lng);const ne=j-Jr(O);G>.5?G-=1:G<-.5&&(G+=1);let ae=0;Math.abs(G)>Math.abs(ne)?ae=G>=0?1:3:(ae=ne>=0?0:2,od(S,S,[h[4]*l,h[5]*l,h[6]*l],-Math.sin(on(ne>=0?m.getSouth():m.getNorth()))*Wa));const te=_[ae],se=_[(ae+1)%4],he=new h0(te,se,S),le=[sf(he,0)||te[0],sf(he,1)||te[1],sf(he,2)||te[2]],be=mh(r.zoom);if(be>0){const Ee=function({x:Xe,y:Ae,z:Oe},ze,$e,Ke,Me){const nt=1/(1<<Oe);let Dt=Xe*nt,ot=Dt+nt,dt=Ae*nt,tt=dt+nt,At=0;const tn=(Dt+ot)/2-Ke;return tn>.5?At=-1:tn<-.5&&(At=1),Dt=((Dt+At)*ze-(Ke*=ze))*$e+Ke,ot=((ot+At)*ze-Ke)*$e+Ke,dt=(dt*ze-(Me*=ze))*$e+Me,tt=(tt*ze-Me)*$e+Me,[[Dt,tt,0],[ot,tt,0],[ot,dt,0],[Dt,dt,0]]}(o,i,r._pixelsPerMercatorPixel,N,j);for(let Xe=0;Xe<_.length;Xe++)Vl(_[Xe],Ee[Xe],be);const ke=$a([],Ee[ae],Ee[(ae+1)%4]);Mo(ke,ke,.5),Vl(le,ke,be)}for(const Ee of _)Ju(T,T,Ee),Oc(E,E,Ee);return T[2]=Math.min(te[2],se[2]),Ju(T,T,le),Oc(E,E,le),new ur(T,E)}(r,i,new rs(o,l,h));const T=ua({z:o,x:l,y:h},E);return new ur([(m+T.x/T.scale)*i,i*(T.y/T.scale),_],[(m+T.x2/T.scale)*i,i*(T.y2/T.scale),x])},d.tileCornersToBounds=bd,d.tileTransform=ua,d.transformMat3=function(r,i,o){var l=i[0],h=i[1],m=i[2];return r[0]=l*o[0]+h*o[3]+m*o[6],r[1]=l*o[1]+h*o[4]+m*o[7],r[2]=l*o[2]+h*o[5]+m*o[8],r},d.transformMat4=hi,d.transformMat4$1=Nc,d.transformQuat=Fr,d.transitionTileAABBinECEF=B_,d.translate=wp,d.transpose=function(r,i){if(r===i){var o=i[1],l=i[2],h=i[5];r[1]=i[3],r[2]=i[6],r[3]=o,r[5]=i[7],r[6]=l,r[7]=h}else r[0]=i[0],r[1]=i[3],r[2]=i[6],r[3]=i[1],r[4]=i[4],r[5]=i[7],r[6]=i[2],r[7]=i[5],r[8]=i[8];return r},d.triggerPluginCompletionEvent=re,d.uniqueId=Jl,d.updateGlobeVertexNormal=function(r,i,o,l,h){const m=5*i+2;r.float32[m+0]=o,r.float32[m+1]=l,r.float32[m+2]=h},d.validateCustomStyleLayer=function(r){const i=[],o=r.id;return void 0===o&&i.push({message:`layers.${o}: missing required property "id"`}),void 0===r.render&&i.push({message:`layers.${o}: missing required method "render"`}),r.renderingMode&&"2d"!==r.renderingMode&&"3d"!==r.renderingMode&&i.push({message:`layers.${o}: property "renderingMode" must be either "2d" or "3d"`}),i},d.validateFilter=r=>Xn(Dc(r)),d.validateFog=r=>Xn(Hh(r)),d.validateLayer=r=>Xn(Sl(r)),d.validateLight=r=>Xn(ap(r)),d.validateSource=r=>Xn(Gf(r)),d.validateStyle=vn,d.validateTerrain=r=>Xn(Nu(r)),d.values=Ns,d.vectorTile=Fp,d.version=Bo,d.warnOnce=Qn,d.window=Ue,d.wrap=Fs}),Gd(0,function(d){function Ue(ee){if("number"==typeof ee||"boolean"==typeof ee||"string"==typeof ee||null==ee)return JSON.stringify(ee);if(Array.isArray(ee)){let U="[";for(const Y of ee)U+=`${Ue(Y)},`;return`${U}]`}let z="{";for(const U of Object.keys(ee).sort())z+=`${U}:${Ue(ee[U])},`;return`${z}}`}function Bo(ee){let z="";for(const U of d.refProperties)z+=`/${Ue(ee[U])}`;return z}class eo{constructor(z){this.keyCache={},z&&this.replace(z)}replace(z){this._layerConfigs={},this._layers={},this.update(z,[])}update(z,U){for(const oe of z)this._layerConfigs[oe.id]=oe,(this._layers[oe.id]=d.createStyleLayer(oe)).compileFilter(),this.keyCache[oe.id]&&delete this.keyCache[oe.id];for(const oe of U)delete this.keyCache[oe],delete this._layerConfigs[oe],delete this._layers[oe];this.familiesBySource={};const Y=function(oe,de){const ve={};for(let pe=0;pe<oe.length;pe++){const we=de&&de[oe[pe].id]||Bo(oe[pe]);de&&(de[oe[pe].id]=we);let je=ve[we];je||(je=ve[we]=[]),je.push(oe[pe])}const ye=[];for(const pe in ve)ye.push(ve[pe]);return ye}(d.values(this._layerConfigs),this.keyCache);for(const oe of Y){const de=oe.map(it=>this._layers[it.id]),ve=de[0];if("none"===ve.visibility)continue;const ye=ve.source||"";let pe=this.familiesBySource[ye];pe||(pe=this.familiesBySource[ye]={});const we=ve.sourceLayer||"_geojsonTileLayer";let je=pe[we];je||(je=pe[we]=[]),je.push(de)}}}class Jt{loadTile(z,U){const{uid:Y,encoding:oe,rawImageData:de,padding:ve,buildQuadTree:ye}=z,pe=d.window.ImageBitmap&&de instanceof d.window.ImageBitmap?this.getImageData(de,ve):de;U(null,new d.DEMData(Y,pe,oe,ve<1,ye))}getImageData(z,U){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(z.width,z.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=z.width,this.offscreenCanvas.height=z.height,this.offscreenCanvasContext.drawImage(z,0,0,z.width,z.height);const Y=this.offscreenCanvasContext.getImageData(-U,-U,z.width+2*U,z.height+2*U);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Y}}var Wt=function ee(z,U){var Y,oe=z&&z.type;if("FeatureCollection"===oe)for(Y=0;Y<z.features.length;Y++)ee(z.features[Y],U);else if("GeometryCollection"===oe)for(Y=0;Y<z.geometries.length;Y++)ee(z.geometries[Y],U);else if("Feature"===oe)ee(z.geometry,U);else if("Polygon"===oe)xi(z.coordinates,U);else if("MultiPolygon"===oe)for(Y=0;Y<z.coordinates.length;Y++)xi(z.coordinates[Y],U);return z};function xi(ee,z){if(0!==ee.length){Ji(ee[0],z);for(var U=1;U<ee.length;U++)Ji(ee[U],!z)}}function Ji(ee,z){for(var U=0,Y=0,oe=0,de=ee.length,ve=de-1;oe<de;ve=oe++){var ye=(ee[oe][0]-ee[ve][0])*(ee[ve][1]+ee[oe][1]),pe=U+ye;Y+=Math.abs(U)>=Math.abs(ye)?U-pe+ye:ye-pe+U,U=pe}U+Y>=0!=!!z&&ee.reverse()}const Vo=d.VectorTileFeature.prototype.toGeoJSON;class Kl{constructor(z){this._feature=z,this.extent=d.EXTENT,this.type=z.type,this.properties=z.tags,"id"in z&&!isNaN(z.id)&&(this.id=parseInt(z.id,10))}loadGeometry(){if(1===this._feature.type){const z=[];for(const U of this._feature.geometry)z.push([new d.pointGeometry(U[0],U[1])]);return z}{const z=[];for(const U of this._feature.geometry){const Y=[];for(const oe of U)Y.push(new d.pointGeometry(oe[0],oe[1]));z.push(Y)}return z}}toGeoJSON(z,U,Y){return Vo.call(this,z,U,Y)}}class Yl{constructor(z){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=d.EXTENT,this.length=z.length,this._features=z}feature(z){return new Kl(this._features[z])}}var jo={exports:{}},Os=d.pointGeometry,to=d.vectorTile.VectorTileFeature,et=no;function no(ee,z){this.options=z||{},this.features=ee,this.length=ee.length}function ps(ee,z){this.id="number"==typeof ee.id?ee.id:void 0,this.type=ee.type,this.rawGeometry=1===ee.type?[ee.geometry]:ee.geometry,this.properties=ee.tags,this.extent=z||4096}no.prototype.feature=function(ee){return new ps(this.features[ee],this.options.extent)},ps.prototype.loadGeometry=function(){var ee=this.rawGeometry;this.geometry=[];for(var z=0;z<ee.length;z++){for(var U=ee[z],Y=[],oe=0;oe<U.length;oe++)Y.push(new Os(U[oe][0],U[oe][1]));this.geometry.push(Y)}return this.geometry},ps.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ee=this.geometry,z=1/0,U=-1/0,Y=1/0,oe=-1/0,de=0;de<ee.length;de++)for(var ve=ee[de],ye=0;ye<ve.length;ye++){var pe=ve[ye];z=Math.min(z,pe.x),U=Math.max(U,pe.x),Y=Math.min(Y,pe.y),oe=Math.max(oe,pe.y)}return[z,Y,U,oe]},ps.prototype.toGeoJSON=to.prototype.toGeoJSON;var du=d.pbf,on=et;function bi(ee){var z=new du;return function(U,Y){for(var oe in U.layers)Y.writeMessage(3,va,U.layers[oe])}(ee,z),z.finish()}function va(ee,z){var U;z.writeVarintField(15,ee.version||1),z.writeStringField(1,ee.name||""),z.writeVarintField(5,ee.extent||4096);var Y={keys:[],values:[],keycache:{},valuecache:{}};for(U=0;U<ee.length;U++)Y.feature=ee.feature(U),z.writeMessage(2,xa,Y);var oe=Y.keys;for(U=0;U<oe.length;U++)z.writeStringField(3,oe[U]);var de=Y.values;for(U=0;U<de.length;U++)z.writeMessage(4,Fs,de[U])}function xa(ee,z){var U=ee.feature;void 0!==U.id&&z.writeVarintField(1,U.id),z.writeMessage(2,Ql,ee),z.writeVarintField(3,U.type),z.writeMessage(4,wa,U)}function Ql(ee,z){var U=ee.feature,Y=ee.keys,oe=ee.values,de=ee.keycache,ve=ee.valuecache;for(var ye in U.properties){var pe=U.properties[ye],we=de[ye];if(null!==pe){void 0===we&&(Y.push(ye),de[ye]=we=Y.length-1),z.writeVarint(we);var je=typeof pe;"string"!==je&&"boolean"!==je&&"number"!==je&&(pe=JSON.stringify(pe));var it=je+":"+pe,We=ve[it];void 0===We&&(oe.push(pe),ve[it]=We=oe.length-1),z.writeVarint(We)}}}function ba(ee,z){return(z<<3)+(7&ee)}function sn(ee){return ee<<1^ee>>31}function wa(ee,z){for(var U=ee.loadGeometry(),Y=ee.type,oe=0,de=0,ve=U.length,ye=0;ye<ve;ye++){var pe=U[ye],we=1;1===Y&&(we=pe.length),z.writeVarint(ba(1,we));for(var je=3===Y?pe.length-1:pe.length,it=0;it<je;it++){1===it&&1!==Y&&z.writeVarint(ba(2,je-1));var We=pe[it].x-oe,Et=pe[it].y-de;z.writeVarint(sn(We)),z.writeVarint(sn(Et)),oe+=We,de+=Et}3===Y&&z.writeVarint(ba(7,1))}}function Fs(ee,z){var U=typeof ee;"string"===U?z.writeStringField(1,ee):"boolean"===U?z.writeBooleanField(7,ee):"number"===U&&(ee%1!=0?z.writeDoubleField(3,ee):ee<0?z.writeSVarintField(6,ee):z.writeVarintField(5,ee))}function Ea(ee,z,U,Y,oe,de){if(oe-Y<=U)return;const ve=Y+oe>>1;Ns(ee,z,ve,Y,oe,de%2),Ea(ee,z,U,Y,ve-1,de+1),Ea(ee,z,U,ve+1,oe,de+1)}function Ns(ee,z,U,Y,oe,de){for(;oe>Y;){if(oe-Y>600){const we=oe-Y+1,je=U-Y+1,it=Math.log(we),We=.5*Math.exp(2*it/3),Et=.5*Math.sqrt(it*We*(we-We)/we)*(je-we/2<0?-1:1);Ns(ee,z,U,Math.max(Y,Math.floor(U-je*We/we+Et)),Math.min(oe,Math.floor(U+(we-je)*We/we+Et)),de)}const ve=z[2*U+de];let ye=Y,pe=oe;for(_n(ee,z,Y,U),z[2*oe+de]>ve&&_n(ee,z,Y,oe);ye<pe;){for(_n(ee,z,ye,pe),ye++,pe--;z[2*ye+de]<ve;)ye++;for(;z[2*pe+de]>ve;)pe--}z[2*Y+de]===ve?_n(ee,z,Y,pe):(pe++,_n(ee,z,pe,oe)),pe<=U&&(Y=pe+1),U<=pe&&(oe=pe-1)}}function _n(ee,z,U,Y){Ta(ee,U,Y),Ta(z,2*U,2*Y),Ta(z,2*U+1,2*Y+1)}function Ta(ee,z,U){const Y=ee[z];ee[z]=ee[U],ee[U]=Y}function Jl(ee,z,U,Y){const oe=ee-U,de=z-Y;return oe*oe+de*de}jo.exports=bi,jo.exports.fromVectorTileJs=bi,jo.exports.fromGeojsonVt=function(ee,z){z=z||{};var U={};for(var Y in ee)U[Y]=new on(ee[Y].features,z),U[Y].name=Y,U[Y].version=z.version,U[Y].extent=z.extent;return bi({layers:U})},jo.exports.GeoJSONWrapper=on;const fs=ee=>ee[0],Uo=ee=>ee[1];class $o{constructor(z,U=fs,Y=Uo,oe=64,de=Float64Array){this.nodeSize=oe,this.points=z;const ve=z.length<65536?Uint16Array:Uint32Array,ye=this.ids=new ve(z.length),pe=this.coords=new de(2*z.length);for(let we=0;we<z.length;we++)ye[we]=we,pe[2*we]=U(z[we]),pe[2*we+1]=Y(z[we]);Ea(ye,pe,oe,0,ye.length-1,0)}range(z,U,Y,oe){return function(de,ve,ye,pe,we,je,it){const We=[0,de.length-1,0],Et=[];let bt,gt;for(;We.length;){const Lt=We.pop(),an=We.pop(),Dn=We.pop();if(an-Dn<=it){for(let Wn=Dn;Wn<=an;Wn++)bt=ve[2*Wn],gt=ve[2*Wn+1],bt>=ye&&bt<=we&&gt>=pe&&gt<=je&&Et.push(de[Wn]);continue}const xt=Math.floor((Dn+an)/2);bt=ve[2*xt],gt=ve[2*xt+1],bt>=ye&&bt<=we&&gt>=pe&&gt<=je&&Et.push(de[xt]);const Un=(Lt+1)%2;(0===Lt?ye<=bt:pe<=gt)&&(We.push(Dn),We.push(xt-1),We.push(Un)),(0===Lt?we>=bt:je>=gt)&&(We.push(xt+1),We.push(an),We.push(Un))}return Et}(this.ids,this.coords,z,U,Y,oe,this.nodeSize)}within(z,U,Y){return function(oe,de,ve,ye,pe,we){const je=[0,oe.length-1,0],it=[],We=pe*pe;for(;je.length;){const Et=je.pop(),bt=je.pop(),gt=je.pop();if(bt-gt<=we){for(let Un=gt;Un<=bt;Un++)Jl(de[2*Un],de[2*Un+1],ve,ye)<=We&&it.push(oe[Un]);continue}const Lt=Math.floor((gt+bt)/2),an=de[2*Lt],Dn=de[2*Lt+1];Jl(an,Dn,ve,ye)<=We&&it.push(oe[Lt]);const xt=(Et+1)%2;(0===Et?ve-pe<=an:ye-pe<=Dn)&&(je.push(gt),je.push(Lt-1),je.push(xt)),(0===Et?ve+pe>=an:ye+pe>=Dn)&&(je.push(Lt+1),je.push(bt),je.push(xt))}return it}(this.ids,this.coords,z,U,Y,this.nodeSize)}}const zs={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ee=>ee},Br=Math.fround||(io=new Float32Array(1),ee=>(io[0]=+ee,io[0]));var io;class Bs{constructor(z){this.options=Vs(Object.create(zs),z),this.trees=new Array(this.options.maxZoom+1)}load(z){const{log:U,minZoom:Y,maxZoom:oe,nodeSize:de}=this.options;U&&console.time("total time");const ve=`prepare ${z.length} points`;U&&console.time(ve),this.points=z;let ye=[];for(let pe=0;pe<z.length;pe++)z[pe].geometry&&ye.push(pu(z[pe],pe));this.trees[oe+1]=new $o(ye,ec,mu,de,Float32Array),U&&console.timeEnd(ve);for(let pe=oe;pe>=Y;pe--){const we=+Date.now();ye=this._cluster(ye,pe),this.trees[pe]=new $o(ye,ec,mu,de,Float32Array),U&&console.log("z%d: %d clusters in %dms",pe,ye.length,+Date.now()-we)}return U&&console.timeEnd("total time"),this}getClusters(z,U){let Y=((z[0]+180)%360+360)%360-180;const oe=Math.max(-90,Math.min(90,z[1]));let de=180===z[2]?180:((z[2]+180)%360+360)%360-180;const ve=Math.max(-90,Math.min(90,z[3]));if(z[2]-z[0]>=360)Y=-180,de=180;else if(Y>de){const je=this.getClusters([Y,oe,180,ve],U),it=this.getClusters([-180,oe,de,ve],U);return je.concat(it)}const ye=this.trees[this._limitZoom(U)],pe=ye.range(hn(Y),Ho(ve),hn(de),Ho(oe)),we=[];for(const je of pe){const it=ye.points[je];we.push(it.numPoints?Qn(it):this.points[it.index])}return we}getChildren(z){const U=this._getOriginId(z),Y=this._getOriginZoom(z),oe="No cluster with the specified id.",de=this.trees[Y];if(!de)throw new Error(oe);const ve=de.points[U];if(!ve)throw new Error(oe);const ye=this.options.radius/(this.options.extent*Math.pow(2,Y-1)),pe=de.within(ve.x,ve.y,ye),we=[];for(const je of pe){const it=de.points[je];it.parentId===z&&we.push(it.numPoints?Qn(it):this.points[it.index])}if(0===we.length)throw new Error(oe);return we}getLeaves(z,U,Y){const oe=[];return this._appendLeaves(oe,z,U=U||10,Y=Y||0,0),oe}getTile(z,U,Y){const oe=this.trees[this._limitZoom(z)],de=Math.pow(2,z),{extent:ve,radius:ye}=this.options,pe=ye/ve,we=(Y-pe)/de,je=(Y+1+pe)/de,it={features:[]};return this._addTileFeatures(oe.range((U-pe)/de,we,(U+1+pe)/de,je),oe.points,U,Y,de,it),0===U&&this._addTileFeatures(oe.range(1-pe/de,we,1,je),oe.points,de,Y,de,it),U===de-1&&this._addTileFeatures(oe.range(0,we,pe/de,je),oe.points,-1,Y,de,it),it.features.length?it:null}getClusterExpansionZoom(z){let U=this._getOriginZoom(z)-1;for(;U<=this.options.maxZoom;){const Y=this.getChildren(z);if(U++,1!==Y.length)break;z=Y[0].properties.cluster_id}return U}_appendLeaves(z,U,Y,oe,de){const ve=this.getChildren(U);for(const ye of ve){const pe=ye.properties;if(pe&&pe.cluster?de+pe.point_count<=oe?de+=pe.point_count:de=this._appendLeaves(z,pe.cluster_id,Y,oe,de):de<oe?de++:z.push(ye),z.length===Y)break}return de}_addTileFeatures(z,U,Y,oe,de,ve){for(const ye of z){const pe=U[ye],we=pe.numPoints;let je,it,We;if(we)je=Go(pe),it=pe.x,We=pe.y;else{const gt=this.points[pe.index];je=gt.properties,it=hn(gt.geometry.coordinates[0]),We=Ho(gt.geometry.coordinates[1])}const Et={type:1,geometry:[[Math.round(this.options.extent*(it*de-Y)),Math.round(this.options.extent*(We*de-oe))]],tags:je};let bt;we?bt=pe.id:this.options.generateId?bt=pe.index:this.points[pe.index].id&&(bt=this.points[pe.index].id),void 0!==bt&&(Et.id=bt),ve.features.push(Et)}}_limitZoom(z){return Math.max(this.options.minZoom,Math.min(Math.floor(+z),this.options.maxZoom+1))}_cluster(z,U){const Y=[],{radius:oe,extent:de,reduce:ve,minPoints:ye}=this.options,pe=oe/(de*Math.pow(2,U));for(let we=0;we<z.length;we++){const je=z[we];if(je.zoom<=U)continue;je.zoom=U;const it=this.trees[U+1],We=it.within(je.x,je.y,pe),Et=je.numPoints||1;let bt=Et;for(const gt of We){const Lt=it.points[gt];Lt.zoom>U&&(bt+=Lt.numPoints||1)}if(bt>Et&&bt>=ye){let gt=je.x*Et,Lt=je.y*Et,an=ve&&Et>1?this._map(je,!0):null;const Dn=(we<<5)+(U+1)+this.points.length;for(const xt of We){const Un=it.points[xt];if(Un.zoom<=U)continue;Un.zoom=U;const Wn=Un.numPoints||1;gt+=Un.x*Wn,Lt+=Un.y*Wn,Un.parentId=Dn,ve&&(an||(an=this._map(je,!0)),ve(an,this._map(Un)))}je.parentId=Dn,Y.push(Vr(gt/bt,Lt/bt,Dn,bt,an))}else if(Y.push(je),bt>1)for(const gt of We){const Lt=it.points[gt];Lt.zoom<=U||(Lt.zoom=U,Y.push(Lt))}}return Y}_getOriginId(z){return z-this.points.length>>5}_getOriginZoom(z){return(z-this.points.length)%32}_map(z,U){if(z.numPoints)return U?Vs({},z.properties):z.properties;const Y=this.points[z.index].properties,oe=this.options.map(Y);return U&&oe===Y?Vs({},oe):oe}}function Vr(ee,z,U,Y,oe){return{x:Br(ee),y:Br(z),zoom:1/0,id:U,parentId:-1,numPoints:Y,properties:oe}}function pu(ee,z){const[U,Y]=ee.geometry.coordinates;return{x:Br(hn(U)),y:Br(Ho(Y)),zoom:1/0,index:z,parentId:-1}}function Qn(ee){return{type:"Feature",id:ee.id,properties:Go(ee),geometry:{type:"Point",coordinates:[(z=ee.x,360*(z-.5)),fu(ee.y)]}};var z}function Go(ee){const z=ee.numPoints,U=z>=1e4?`${Math.round(z/1e3)}k`:z>=1e3?Math.round(z/100)/10+"k":z;return Vs(Vs({},ee.properties),{cluster:!0,cluster_id:ee.id,point_count:z,point_count_abbreviated:U})}function hn(ee){return ee/360+.5}function Ho(ee){const z=Math.sin(ee*Math.PI/180),U=.5-.25*Math.log((1+z)/(1-z))/Math.PI;return U<0?0:U>1?1:U}function fu(ee){const z=(180-360*ee)*Math.PI/180;return 360*Math.atan(Math.exp(z))/Math.PI-90}function Vs(ee,z){for(const U in z)ee[U]=z[U];return ee}function ec(ee){return ee.x}function mu(ee){return ee.y}function Da(ee,z,U,Y){for(var oe,de=Y,ve=U-z>>1,ye=U-z,pe=ee[z],we=ee[z+1],je=ee[U],it=ee[U+1],We=z+3;We<U;We+=3){var Et=Lh(ee[We],ee[We+1],pe,we,je,it);if(Et>de)oe=We,de=Et;else if(Et===de){var bt=Math.abs(We-ve);bt<ye&&(oe=We,ye=bt)}}de>Y&&(oe-z>3&&Da(ee,z,oe,Y),ee[oe+2]=de,U-oe>3&&Da(ee,oe,U,Y))}function Lh(ee,z,U,Y,oe,de){var ve=oe-U,ye=de-Y;if(0!==ve||0!==ye){var pe=((ee-U)*ve+(z-Y)*ye)/(ve*ve+ye*ye);pe>1?(U=oe,Y=de):pe>0&&(U+=ve*pe,Y+=ye*pe)}return(ve=ee-U)*ve+(ye=z-Y)*ye}function Tr(ee,z,U,Y){var oe={id:void 0===ee?null:ee,type:z,geometry:U,tags:Y,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(de){var ve=de.geometry,ye=de.type;if("Point"===ye||"MultiPoint"===ye||"LineString"===ye)js(de,ve);else if("Polygon"===ye||"MultiLineString"===ye)for(var pe=0;pe<ve.length;pe++)js(de,ve[pe]);else if("MultiPolygon"===ye)for(pe=0;pe<ve.length;pe++)for(var we=0;we<ve[pe].length;we++)js(de,ve[pe][we])}(oe),oe}function js(ee,z){for(var U=0;U<z.length;U+=3)ee.minX=Math.min(ee.minX,z[U]),ee.minY=Math.min(ee.minY,z[U+1]),ee.maxX=Math.max(ee.maxX,z[U]),ee.maxY=Math.max(ee.maxY,z[U+1])}function tc(ee,z,U,Y){if(z.geometry){var oe=z.geometry.coordinates,de=z.geometry.type,ve=Math.pow(U.tolerance/((1<<U.maxZoom)*U.extent),2),ye=[],pe=z.id;if(U.promoteId?pe=z.properties[U.promoteId]:U.generateId&&(pe=Y||0),"Point"===de)ll(oe,ye);else if("MultiPoint"===de)for(var we=0;we<oe.length;we++)ll(oe[we],ye);else if("LineString"===de)nc(oe,ye,ve,!1);else if("MultiLineString"===de){if(U.lineMetrics){for(we=0;we<oe.length;we++)nc(oe[we],ye=[],ve,!1),ee.push(Tr(pe,"LineString",ye,z.properties));return}ms(oe,ye,ve,!1)}else if("Polygon"===de)ms(oe,ye,ve,!0);else{if("MultiPolygon"!==de){if("GeometryCollection"===de){for(we=0;we<z.geometry.geometries.length;we++)tc(ee,{id:pe,geometry:z.geometry.geometries[we],properties:z.properties},U,Y);return}throw new Error("Input data is not a valid GeoJSON object.")}for(we=0;we<oe.length;we++){var je=[];ms(oe[we],je,ve,!0),ye.push(je)}}ee.push(Tr(pe,de,ye,z.properties))}}function ll(ee,z){z.push(ic(ee[0])),z.push(rc(ee[1])),z.push(0)}function nc(ee,z,U,Y){for(var oe,de,ve=0,ye=0;ye<ee.length;ye++){var pe=ic(ee[ye][0]),we=rc(ee[ye][1]);z.push(pe),z.push(we),z.push(0),ye>0&&(ve+=Y?(oe*we-pe*de)/2:Math.sqrt(Math.pow(pe-oe,2)+Math.pow(we-de,2))),oe=pe,de=we}var je=z.length-3;z[2]=1,Da(z,0,je,U),z[je+2]=1,z.size=Math.abs(ve),z.start=0,z.end=z.size}function ms(ee,z,U,Y){for(var oe=0;oe<ee.length;oe++){var de=[];nc(ee[oe],de,U,Y),z.push(de)}}function ic(ee){return ee/360+.5}function rc(ee){var z=Math.sin(ee*Math.PI/180),U=.5-.25*Math.log((1+z)/(1-z))/Math.PI;return U<0?0:U>1?1:U}function ro(ee,z,U,Y,oe,de,ve,ye){if(Y/=z,de>=(U/=z)&&ve<Y)return ee;if(ve<U||de>=Y)return null;for(var pe=[],we=0;we<ee.length;we++){var je=ee[we],it=je.geometry,We=je.type,Et=0===oe?je.minX:je.minY,bt=0===oe?je.maxX:je.maxY;if(Et>=U&&bt<Y)pe.push(je);else if(!(bt<U||Et>=Y)){var gt=[];if("Point"===We||"MultiPoint"===We)gu(it,gt,U,Y,oe);else if("LineString"===We)oo(it,gt,U,Y,oe,!1,ye.lineMetrics);else if("MultiLineString"===We)Ca(it,gt,U,Y,oe,!1);else if("Polygon"===We)Ca(it,gt,U,Y,oe,!0);else if("MultiPolygon"===We)for(var Lt=0;Lt<it.length;Lt++){var an=[];Ca(it[Lt],an,U,Y,oe,!0),an.length&&gt.push(an)}if(gt.length){if(ye.lineMetrics&&"LineString"===We){for(Lt=0;Lt<gt.length;Lt++)pe.push(Tr(je.id,We,gt[Lt],je.tags));continue}"LineString"!==We&&"MultiLineString"!==We||(1===gt.length?(We="LineString",gt=gt[0]):We="MultiLineString"),"Point"!==We&&"MultiPoint"!==We||(We=3===gt.length?"Point":"MultiPoint"),pe.push(Tr(je.id,We,gt,je.tags))}}}return pe.length?pe:null}function gu(ee,z,U,Y,oe){for(var de=0;de<ee.length;de+=3){var ve=ee[de+oe];ve>=U&&ve<=Y&&(z.push(ee[de]),z.push(ee[de+1]),z.push(ee[de+2]))}}function oo(ee,z,U,Y,oe,de,ve){for(var ye,pe,we=Us(ee),je=0===oe?kh:cl,it=ee.start,We=0;We<ee.length-3;We+=3){var Et=ee[We],bt=ee[We+1],gt=ee[We+2],Lt=ee[We+3],an=ee[We+4],Dn=0===oe?Et:bt,xt=0===oe?Lt:an,Un=!1;ve&&(ye=Math.sqrt(Math.pow(Et-Lt,2)+Math.pow(bt-an,2))),Dn<U?xt>U&&(pe=je(we,Et,bt,Lt,an,U),ve&&(we.start=it+ye*pe)):Dn>Y?xt<Y&&(pe=je(we,Et,bt,Lt,an,Y),ve&&(we.start=it+ye*pe)):oc(we,Et,bt,gt),xt<U&&Dn>=U&&(pe=je(we,Et,bt,Lt,an,U),Un=!0),xt>Y&&Dn<=Y&&(pe=je(we,Et,bt,Lt,an,Y),Un=!0),!de&&Un&&(ve&&(we.end=it+ye*pe),z.push(we),we=Us(ee)),ve&&(it+=ye)}var Wn=ee.length-3;Et=ee[Wn],bt=ee[Wn+1],gt=ee[Wn+2],(Dn=0===oe?Et:bt)>=U&&Dn<=Y&&oc(we,Et,bt,gt),Wn=we.length-3,de&&Wn>=3&&(we[Wn]!==we[0]||we[Wn+1]!==we[1])&&oc(we,we[0],we[1],we[2]),we.length&&z.push(we)}function Us(ee){var z=[];return z.size=ee.size,z.start=ee.start,z.end=ee.end,z}function Ca(ee,z,U,Y,oe,de){for(var ve=0;ve<ee.length;ve++)oo(ee[ve],z,U,Y,oe,de,!1)}function oc(ee,z,U,Y){ee.push(z),ee.push(U),ee.push(Y)}function kh(ee,z,U,Y,oe,de){var ve=(de-z)/(Y-z);return ee.push(de),ee.push(U+(oe-U)*ve),ee.push(1),ve}function cl(ee,z,U,Y,oe,de){var ve=(de-U)/(oe-U);return ee.push(z+(Y-z)*ve),ee.push(de),ee.push(1),ve}function Ia(ee,z){for(var U=[],Y=0;Y<ee.length;Y++){var oe,de=ee[Y],ve=de.type;if("Point"===ve||"MultiPoint"===ve||"LineString"===ve)oe=sc(de.geometry,z);else if("MultiLineString"===ve||"Polygon"===ve){oe=[];for(var ye=0;ye<de.geometry.length;ye++)oe.push(sc(de.geometry[ye],z))}else if("MultiPolygon"===ve)for(oe=[],ye=0;ye<de.geometry.length;ye++){for(var pe=[],we=0;we<de.geometry[ye].length;we++)pe.push(sc(de.geometry[ye][we],z));oe.push(pe)}U.push(Tr(de.id,ve,oe,de.tags))}return U}function sc(ee,z){var U=[];U.size=ee.size,void 0!==ee.start&&(U.start=ee.start,U.end=ee.end);for(var Y=0;Y<ee.length;Y+=3)U.push(ee[Y]+z,ee[Y+1],ee[Y+2]);return U}function ac(ee,z){if(ee.transformed)return ee;var U,Y,oe,de=1<<ee.z,ve=ee.x,ye=ee.y;for(U=0;U<ee.features.length;U++){var pe=ee.features[U],we=pe.geometry,je=pe.type;if(pe.geometry=[],1===je)for(Y=0;Y<we.length;Y+=2)pe.geometry.push(qo(we[Y],we[Y+1],z,de,ve,ye));else for(Y=0;Y<we.length;Y++){var it=[];for(oe=0;oe<we[Y].length;oe+=2)it.push(qo(we[Y][oe],we[Y][oe+1],z,de,ve,ye));pe.geometry.push(it)}}return ee.transformed=!0,ee}function qo(ee,z,U,Y,oe,de){return[Math.round(U*(ee*Y-oe)),Math.round(U*(z*Y-de))]}function lc(ee,z,U,Y,oe){for(var de=z===oe.maxZoom?0:oe.tolerance/((1<<z)*oe.extent),ve={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:U,y:Y,z,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ye=0;ye<ee.length;ye++){ve.numFeatures++,cc(ve,ee[ye],de,oe);var pe=ee[ye].minX,we=ee[ye].minY,je=ee[ye].maxX,it=ee[ye].maxY;pe<ve.minX&&(ve.minX=pe),we<ve.minY&&(ve.minY=we),je>ve.maxX&&(ve.maxX=je),it>ve.maxY&&(ve.maxY=it)}return ve}function cc(ee,z,U,Y){var oe=z.geometry,de=z.type,ve=[];if("Point"===de||"MultiPoint"===de)for(var ye=0;ye<oe.length;ye+=3)ve.push(oe[ye]),ve.push(oe[ye+1]),ee.numPoints++,ee.numSimplified++;else if("LineString"===de)Sa(ve,oe,ee,U,!1,!1);else if("MultiLineString"===de||"Polygon"===de)for(ye=0;ye<oe.length;ye++)Sa(ve,oe[ye],ee,U,"Polygon"===de,0===ye);else if("MultiPolygon"===de)for(var pe=0;pe<oe.length;pe++){var we=oe[pe];for(ye=0;ye<we.length;ye++)Sa(ve,we[ye],ee,U,!0,0===ye)}if(ve.length){var je=z.tags||null;if("LineString"===de&&Y.lineMetrics){for(var it in je={},z.tags)je[it]=z.tags[it];je.mapbox_clip_start=oe.start/oe.size,je.mapbox_clip_end=oe.end/oe.size}var We={geometry:ve,type:"Polygon"===de||"MultiPolygon"===de?3:"LineString"===de||"MultiLineString"===de?2:1,tags:je};null!==z.id&&(We.id=z.id),ee.features.push(We)}}function Sa(ee,z,U,Y,oe,de){var ve=Y*Y;if(Y>0&&z.size<(oe?ve:Y))U.numPoints+=z.length/3;else{for(var ye=[],pe=0;pe<z.length;pe+=3)(0===Y||z[pe+2]>ve)&&(U.numSimplified++,ye.push(z[pe]),ye.push(z[pe+1])),U.numPoints++;oe&&function(we,je){for(var it=0,We=0,Et=we.length,bt=Et-2;We<Et;bt=We,We+=2)it+=(we[We]-we[bt])*(we[We+1]+we[bt+1]);if(it>0===je)for(We=0,Et=we.length;We<Et/2;We+=2){var gt=we[We],Lt=we[We+1];we[We]=we[Et-2-We],we[We+1]=we[Et-1-We],we[Et-2-We]=gt,we[Et-1-We]=Lt}}(ye,de),ee.push(ye)}}function $s(ee,z){var U=(z=this.options=function(oe,de){for(var ve in de)oe[ve]=de[ve];return oe}(Object.create(this.options),z)).debug;if(U&&console.time("preprocess data"),z.maxZoom<0||z.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(z.promoteId&&z.generateId)throw new Error("promoteId and generateId cannot be used together.");var oe,de,ve,ye,pe,we,Y=function(oe,de){var ve=[];if("FeatureCollection"===oe.type)for(var ye=0;ye<oe.features.length;ye++)tc(ve,oe.features[ye],de,ye);else tc(ve,"Feature"===oe.type?oe:{geometry:oe},de);return ve}(ee,z);this.tiles={},this.tileCoords=[],U&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",z.indexMaxZoom,z.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ye=oe=Y,pe=ro(oe,1,-1-(ve=(de=z).buffer/de.extent),ve,0,-1,2,de),we=ro(oe,1,1-ve,2+ve,0,-1,2,de),(pe||we)&&(ye=ro(oe,1,-ve,1+ve,0,-1,2,de)||[],pe&&(ye=Ia(pe,1).concat(ye)),we&&(ye=ye.concat(Ia(we,-1)))),(Y=ye).length&&this.splitTile(Y,0,0,0),U&&(Y.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ma(ee,z,U){return 32*((1<<ee)*U+z)+ee}function so(ee,z){const U=ee.tileID.canonical;if(!this._geoJSONIndex)return z(null,null);const Y=this._geoJSONIndex.getTile(U.z,U.x,U.y);if(!Y)return z(null,null);const oe=new Yl(Y.features);let de=jo.exports(oe);0===de.byteOffset&&de.byteLength===de.buffer.byteLength||(de=new Uint8Array(de)),z(null,{vectorTile:oe,rawData:de.buffer})}$s.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},$s.prototype.splitTile=function(ee,z,U,Y,oe,de,ve){for(var ye=[ee,z,U,Y],pe=this.options,we=pe.debug;ye.length;){Y=ye.pop(),U=ye.pop(),z=ye.pop(),ee=ye.pop();var je=1<<z,it=Ma(z,U,Y),We=this.tiles[it];if(!We&&(we>1&&console.time("creation"),We=this.tiles[it]=lc(ee,z,U,Y,pe),this.tileCoords.push({z,x:U,y:Y}),we)){we>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",z,U,Y,We.numFeatures,We.numPoints,We.numSimplified),console.timeEnd("creation"));var Et="z"+z;this.stats[Et]=(this.stats[Et]||0)+1,this.total++}if(We.source=ee,oe){if(z===pe.maxZoom||z===oe)continue;var bt=1<<oe-z;if(U!==Math.floor(de/bt)||Y!==Math.floor(ve/bt))continue}else if(z===pe.indexMaxZoom||We.numPoints<=pe.indexMaxPoints)continue;if(We.source=null,0!==ee.length){we>1&&console.time("clipping");var gt,Lt,an,Dn,xt,Un,Wn=.5*pe.buffer/pe.extent,Wo=.5-Wn,gs=.5+Wn,jr=1+Wn;gt=Lt=an=Dn=null,xt=ro(ee,je,U-Wn,U+gs,0,We.minX,We.maxX,pe),Un=ro(ee,je,U+Wo,U+jr,0,We.minX,We.maxX,pe),ee=null,xt&&(gt=ro(xt,je,Y-Wn,Y+gs,1,We.minY,We.maxY,pe),Lt=ro(xt,je,Y+Wo,Y+jr,1,We.minY,We.maxY,pe),xt=null),Un&&(an=ro(Un,je,Y-Wn,Y+gs,1,We.minY,We.maxY,pe),Dn=ro(Un,je,Y+Wo,Y+jr,1,We.minY,We.maxY,pe),Un=null),we>1&&console.timeEnd("clipping"),ye.push(gt||[],z+1,2*U,2*Y),ye.push(Lt||[],z+1,2*U,2*Y+1),ye.push(an||[],z+1,2*U+1,2*Y),ye.push(Dn||[],z+1,2*U+1,2*Y+1)}}},$s.prototype.getTile=function(ee,z,U){var Y=this.options,oe=Y.extent,de=Y.debug;if(ee<0||ee>24)return null;var ve=1<<ee,ye=Ma(ee,z=(z%ve+ve)%ve,U);if(this.tiles[ye])return ac(this.tiles[ye],oe);de>1&&console.log("drilling down to z%d-%d-%d",ee,z,U);for(var pe,we=ee,je=z,it=U;!pe&&we>0;)we--,je=Math.floor(je/2),it=Math.floor(it/2),pe=this.tiles[Ma(we,je,it)];return pe&&pe.source?(de>1&&console.log("found parent tile z%d-%d-%d",we,je,it),de>1&&console.time("drilling down"),this.splitTile(pe.source,we,je,it,ee,z,U),de>1&&console.timeEnd("drilling down"),this.tiles[ye]?ac(this.tiles[ye],oe):null):null};class Gs extends d.VectorTileWorkerSource{constructor(z,U,Y,oe,de){super(z,U,Y,oe,so),de&&(this.loadGeoJSON=de)}loadData(z,U){const Y=z&&z.request,oe=Y&&Y.collectResourceTiming;this.loadGeoJSON(z,(de,ve)=>{if(de||!ve)return U(de);if("object"!=typeof ve)return U(new Error(`Input data given to '${z.source}' is not a valid GeoJSON object.`));{Wt(ve,!0);try{if(z.filter){const pe=d.createExpression(z.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===pe.result)throw new Error(pe.value.map(je=>`${je.key}: ${je.message}`).join(", "));const we=ve.features.filter(je=>pe.value.evaluate({zoom:0},je));ve={type:"FeatureCollection",features:we}}this._geoJSONIndex=z.cluster?new Bs(function({superclusterOptions:pe,clusterProperties:we}){if(!we||!pe)return pe;const je={},it={},We={accumulated:null,zoom:0},Et={properties:null},bt=Object.keys(we);for(const gt of bt){const[Lt,an]=we[gt],Dn=d.createExpression(an),xt=d.createExpression("string"==typeof Lt?[Lt,["accumulated"],["get",gt]]:Lt);je[gt]=Dn.value,it[gt]=xt.value}return pe.map=gt=>{Et.properties=gt;const Lt={};for(const an of bt)Lt[an]=je[an].evaluate(We,Et);return Lt},pe.reduce=(gt,Lt)=>{Et.properties=Lt;for(const an of bt)We.accumulated=gt[an],gt[an]=it[an].evaluate(We,Et)},pe}(z)).load(ve.features):new $s(pe=ve,z.geojsonVtOptions)}catch(pe){return U(pe)}this.loaded={};const ye={};if(oe){const pe=d.getPerformanceMeasurement(Y);pe&&(ye.resourceTiming={},ye.resourceTiming[z.source]=JSON.parse(JSON.stringify(pe)))}U(null,ye)}var pe})}reloadTile(z,U){const Y=this.loaded;return Y&&Y[z.uid]?super.reloadTile(z,U):this.loadTile(z,U)}loadGeoJSON(z,U){if(z.request)d.getJSON(z.request,U);else{if("string"!=typeof z.data)return U(new Error(`Input data given to '${z.source}' is not a valid GeoJSON object.`));try{return U(null,JSON.parse(z.data))}catch{return U(new Error(`Input data given to '${z.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(z,U){try{U(null,this._geoJSONIndex.getClusterExpansionZoom(z.clusterId))}catch(Y){U(Y)}}getClusterChildren(z,U){try{U(null,this._geoJSONIndex.getChildren(z.clusterId))}catch(Y){U(Y)}}getClusterLeaves(z,U){try{U(null,this._geoJSONIndex.getLeaves(z.clusterId,z.limit,z.offset))}catch(Y){U(Y)}}}class ul{constructor(z){this.self=z,this.actor=new d.Actor(z,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=d.getProjection({name:"mercator"}),this.workerSourceTypes={vector:d.VectorTileWorkerSource,geojson:Gs},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(U,Y)=>{if(this.workerSourceTypes[U])throw new Error(`Worker source with name "${U}" already registered.`);this.workerSourceTypes[U]=Y},this.self.registerRTLTextPlugin=U=>{if(d.plugin.isParsed())throw new Error("RTL text plugin already registered.");d.plugin.applyArabicShaping=U.applyArabicShaping,d.plugin.processBidirectionalText=U.processBidirectionalText,d.plugin.processStyledBidirectionalText=U.processStyledBidirectionalText}}clearCaches(z,U,Y){delete this.layerIndexes[z],delete this.availableImages[z],delete this.workerSources[z],delete this.demWorkerSources[z],Y()}checkIfReady(z,U,Y){Y()}setReferrer(z,U){this.referrer=U}spriteLoaded(z,U){this.isSpriteLoaded[z]=U;for(const Y in this.workerSources[z]){const oe=this.workerSources[z][Y];for(const de in oe)oe[de]instanceof d.VectorTileWorkerSource&&(oe[de].isSpriteLoaded=U,oe[de].fire(new d.Event("isSpriteLoaded")))}}setImages(z,U,Y){this.availableImages[z]=U;for(const oe in this.workerSources[z]){const de=this.workerSources[z][oe];for(const ve in de)de[ve].availableImages=U}Y()}enableTerrain(z,U,Y){this.terrain=U,Y()}setProjection(z,U){this.projections[z]=d.getProjection(U)}setLayers(z,U,Y){this.getLayerIndex(z).replace(U),Y()}updateLayers(z,U,Y){this.getLayerIndex(z).update(U.layers,U.removedIds),Y()}loadTile(z,U,Y){const oe=this.enableTerrain?d.extend({enableTerrain:this.terrain},U):U;oe.projection=this.projections[z]||this.defaultProjection,this.getWorkerSource(z,U.type,U.source).loadTile(oe,Y)}loadDEMTile(z,U,Y){const oe=this.enableTerrain?d.extend({buildQuadTree:this.terrain},U):U;this.getDEMWorkerSource(z,U.source).loadTile(oe,Y)}reloadTile(z,U,Y){const oe=this.enableTerrain?d.extend({enableTerrain:this.terrain},U):U;oe.projection=this.projections[z]||this.defaultProjection,this.getWorkerSource(z,U.type,U.source).reloadTile(oe,Y)}abortTile(z,U,Y){this.getWorkerSource(z,U.type,U.source).abortTile(U,Y)}removeTile(z,U,Y){this.getWorkerSource(z,U.type,U.source).removeTile(U,Y)}removeSource(z,U,Y){if(!this.workerSources[z]||!this.workerSources[z][U.type]||!this.workerSources[z][U.type][U.source])return;const oe=this.workerSources[z][U.type][U.source];delete this.workerSources[z][U.type][U.source],void 0!==oe.removeSource?oe.removeSource(U,Y):Y()}loadWorkerSource(z,U,Y){try{this.self.importScripts(U.url),Y()}catch(oe){Y(oe.toString())}}syncRTLPluginState(z,U,Y){try{d.plugin.setState(U);const oe=d.plugin.getPluginURL();if(d.plugin.isLoaded()&&!d.plugin.isParsed()&&null!=oe){this.self.importScripts(oe);const de=d.plugin.isParsed();Y(de?void 0:new Error(`RTL Text Plugin failed to import scripts from ${oe}`),de)}}catch(oe){Y(oe.toString())}}getAvailableImages(z){let U=this.availableImages[z];return U||(U=[]),U}getLayerIndex(z){let U=this.layerIndexes[z];return U||(U=this.layerIndexes[z]=new eo),U}getWorkerSource(z,U,Y){return this.workerSources[z]||(this.workerSources[z]={}),this.workerSources[z][U]||(this.workerSources[z][U]={}),this.workerSources[z][U][Y]||(this.workerSources[z][U][Y]=new this.workerSourceTypes[U]({send:(de,ve,ye,pe,we,je)=>{this.actor.send(de,ve,ye,z,we,je)},scheduler:this.actor.scheduler},this.getLayerIndex(z),this.getAvailableImages(z),this.isSpriteLoaded[z])),this.workerSources[z][U][Y]}getDEMWorkerSource(z,U){return this.demWorkerSources[z]||(this.demWorkerSources[z]={}),this.demWorkerSources[z][U]||(this.demWorkerSources[z][U]=new Jt),this.demWorkerSources[z][U]}enforceCacheSizeLimit(z,U){d.enforceCacheSizeLimit(U)}getWorkerPerformanceMetrics(z,U,Y){Y(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new ul(self)),ul}),Gd(0,function(d){function Ue(f,a){if(Array.isArray(f)){if(!Array.isArray(a)||f.length!==a.length)return!1;for(let u=0;u<f.length;u++)if(!Ue(f[u],a[u]))return!1;return!0}if("object"==typeof f&&null!==f&&null!==a){if("object"!=typeof a||Object.keys(f).length!==Object.keys(a).length)return!1;for(const u in f)if(!Ue(f[u],a[u]))return!1;return!0}return f===a}var Bo=eo;function eo(f){return a=f,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var g,v,b=new Blob([""],{type:"text/javascript"}),D=URL.createObjectURL(b);try{v=new Worker(D),g=!0}catch{g=!1}return v&&v.terminate(),URL.revokeObjectURL(D),g}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var g=document.createElement("canvas");g.width=g.height=1;var v=g.getContext("2d");if(!v)return!1;var b=v.getImageData(0,0,1,1);return b&&b.width===g.width}()||(void 0===Jt[u=a&&a.failIfMajorPerformanceCaveat]&&(Jt[u]=function(g){var v,D,I,M,b=(D=g,I=document.createElement("canvas"),(M=Object.create(eo.webGLContextAttributes)).failIfMajorPerformanceCaveat=D,I.getContext("webgl",M)||I.getContext("experimental-webgl",M));if(!b)return!1;try{v=b.createShader(b.VERTEX_SHADER)}catch{return!1}return!(!v||b.isContextLost())&&(b.shaderSource(v,"void main() {}"),b.compileShader(v),!0===b.getShaderParameter(v,b.COMPILE_STATUS))}(u)),!Jt[u]||document.documentMode));var a,u}var Jt={};function Wt(f,a,u){const g=d.window.document.createElement(f);return void 0!==a&&(g.className=a),u&&u.appendChild(g),g}function xi(f,a,u){const g=d.window.document.createElementNS("http://www.w3.org/2000/svg",f);for(const v of Object.keys(a))g.setAttributeNS(null,v,a[v]);return u&&u.appendChild(g),g}eo.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Ji=d.window.document&&d.window.document.documentElement.style,Vo=Ji&&void 0!==Ji.userSelect?"userSelect":"WebkitUserSelect";let Kl;function Yl(){Ji&&Vo&&(Kl=Ji[Vo],Ji[Vo]="none")}function jo(){Ji&&Vo&&(Ji[Vo]=Kl)}function Os(f){f.preventDefault(),f.stopPropagation(),d.window.removeEventListener("click",Os,!0)}function to(){d.window.addEventListener("click",Os,!0),d.window.setTimeout(()=>{d.window.removeEventListener("click",Os,!0)},0)}function et(f,a){const u=f.getBoundingClientRect();return du(f,u,a)}function no(f,a){const u=f.getBoundingClientRect(),g=[];for(let v=0;v<a.length;v++)g.push(du(f,u,a[v]));return g}function ps(f){return void 0!==d.window.InstallTrigger&&2===f.button&&f.ctrlKey&&d.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:f.button}function du(f,a,u){const g=f.offsetWidth===a.width?1:f.offsetWidth/a.width;return new d.pointGeometry((u.clientX-a.left)*g,(u.clientY-a.top)*g)}function on(f,a){var u=a[0],g=a[1],v=a[2],b=a[3],D=u*b-v*g;return D?(f[0]=b*(D=1/D),f[1]=-g*D,f[2]=-v*D,f[3]=u*D,f):null}function bi(f){const{userImage:a}=f;return!!(a&&a.render&&a.render())&&(f.data.replace(new Uint8Array(a.data.buffer)),!0)}class va extends d.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new d.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(a){if(this.loaded!==a&&(this.loaded=a,a)){for(const{ids:u,callback:g}of this.requestors)this._notify(u,g);this.requestors=[]}}hasImage(a){return!!this.getImage(a)}getImage(a){return this.images[a]}addImage(a,u){this._validate(a,u)&&(this.images[a]=u)}_validate(a,u){let g=!0;return this._validateStretch(u.stretchX,u.data&&u.data.width)||(this.fire(new d.ErrorEvent(new Error(`Image "${a}" has invalid "stretchX" value`))),g=!1),this._validateStretch(u.stretchY,u.data&&u.data.height)||(this.fire(new d.ErrorEvent(new Error(`Image "${a}" has invalid "stretchY" value`))),g=!1),this._validateContent(u.content,u)||(this.fire(new d.ErrorEvent(new Error(`Image "${a}" has invalid "content" value`))),g=!1),g}_validateStretch(a,u){if(!a)return!0;let g=0;for(const v of a){if(v[0]<g||v[1]<v[0]||u<v[1])return!1;g=v[1]}return!0}_validateContent(a,u){return!(a&&(4!==a.length||a[0]<0||u.data.width<a[0]||a[1]<0||u.data.height<a[1]||a[2]<0||u.data.width<a[2]||a[3]<0||u.data.height<a[3]||a[2]<a[0]||a[3]<a[1]))}updateImage(a,u){u.version=this.images[a].version+1,this.images[a]=u,this.updatedImages[a]=!0}removeImage(a){const u=this.images[a];delete this.images[a],delete this.patterns[a],u.userImage&&u.userImage.onRemove&&u.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(a,u){let g=!0;if(!this.isLoaded())for(const v of a)this.images[v]||(g=!1);this.isLoaded()||g?this._notify(a,u):this.requestors.push({ids:a,callback:u})}_notify(a,u){const g={};for(const v of a){this.images[v]||this.fire(new d.Event("styleimagemissing",{id:v}));const b=this.images[v];b?g[v]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:Boolean(b.userImage&&b.userImage.render)}:d.warnOnce(`Image "${v}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}u(null,g)}getPixelSize(){const{width:a,height:u}=this.atlasImage;return{width:a,height:u}}getPattern(a){const u=this.patterns[a],g=this.getImage(a);if(!g)return null;if(u&&u.position.version===g.version)return u.position;if(u)u.position.version=g.version;else{const v={w:g.data.width+2,h:g.data.height+2,x:0,y:0},b=new d.ImagePosition(v,g);this.patterns[a]={bin:v,position:b}}return this._updatePatternAtlas(),this.patterns[a].position}bind(a){const u=a.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new d.Texture(a,this.atlasImage,u.RGBA),this.atlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(){const a=[];for(const b in this.patterns)a.push(this.patterns[b].bin);const{w:u,h:g}=d.potpack(a),v=this.atlasImage;v.resize({width:u||1,height:g||1});for(const b in this.patterns){const{bin:D}=this.patterns[b],I=D.x+1,M=D.y+1,R=this.images[b].data,k=R.width,B=R.height;d.RGBAImage.copy(R,v,{x:0,y:0},{x:I,y:M},{width:k,height:B}),d.RGBAImage.copy(R,v,{x:0,y:B-1},{x:I,y:M-1},{width:k,height:1}),d.RGBAImage.copy(R,v,{x:0,y:0},{x:I,y:M+B},{width:k,height:1}),d.RGBAImage.copy(R,v,{x:k-1,y:0},{x:I-1,y:M},{width:1,height:B}),d.RGBAImage.copy(R,v,{x:0,y:0},{x:I+k,y:M},{width:1,height:B})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(a){for(const u of a){if(this.callbackDispatchedThisFrame[u])continue;this.callbackDispatchedThisFrame[u]=!0;const g=this.images[u];bi(g)&&this.updateImage(u,g)}}}const xa=new d.Properties({anchor:new d.DataConstantProperty(d.spec.light.anchor),position:new class{constructor(){this.specification=d.spec.light.position}possiblyEvaluate(f,a){return function([u,g,v]){const b=d.degToRad(g+90),D=d.degToRad(v);return{x:u*Math.cos(b)*Math.sin(D),y:u*Math.sin(b)*Math.sin(D),z:u*Math.cos(D),azimuthal:g,polar:v}}(f.expression.evaluate(a))}interpolate(f,a,u){return{x:d.number(f.x,a.x,u),y:d.number(f.y,a.y,u),z:d.number(f.z,a.z,u),azimuthal:d.number(f.azimuthal,a.azimuthal,u),polar:d.number(f.polar,a.polar,u)}}},color:new d.DataConstantProperty(d.spec.light.color),intensity:new d.DataConstantProperty(d.spec.light.intensity)}),Ql="-transition";class ba extends d.Evented{constructor(a){super(),this._transitionable=new d.Transitionable(xa),this.setLight(a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(a,u={}){if(!this._validate(d.validateLight,a,u))for(const g in a){const v=a[g];d.endsWith(g,Ql)?this._transitionable.setTransition(g.slice(0,-Ql.length),v):this._transitionable.setValue(g,v)}}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,u,g){return(!g||!1!==g.validate)&&d.emitValidationErrors(this,a.call(d.validateStyle,d.extend({value:u,style:{glyphs:!0,sprite:!0},styleSpec:d.spec})))}}const sn=new d.Properties({source:new d.DataConstantProperty(d.spec.terrain.source),exaggeration:new d.DataConstantProperty(d.spec.terrain.exaggeration)}),wa="-transition";class Fs extends d.Evented{constructor(a,u){super(),this._transitionable=new d.Transitionable(sn),this.set(a),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=u}get(){return this._transitionable.serialize()}set(a){for(const u in a){const g=a[u];d.endsWith(u,wa)?this._transitionable.setTransition(u.slice(0,-wa.length),g):this._transitionable.setValue(u,g)}}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}}function Ea(f,a,u,g){const v=d.smoothstep(45,65,u),[b,D]=Ns(f,g),I=d.length(a);let M=1-Math.min(1,Math.exp((I-b)/(D-b)*-6));return M*=M*M,M=Math.min(1,1.00747*M),M*v*f.alpha}function Ns(f,a){const u=.5/Math.tan(.5*a);return[f.range[0]+u,f.range[1]+u]}const _n=new d.Properties({range:new d.DataConstantProperty(d.spec.fog.range),color:new d.DataConstantProperty(d.spec.fog.color),"high-color":new d.DataConstantProperty(d.spec.fog["high-color"]),"space-color":new d.DataConstantProperty(d.spec.fog["space-color"]),"horizon-blend":new d.DataConstantProperty(d.spec.fog["horizon-blend"]),"star-intensity":new d.DataConstantProperty(d.spec.fog["star-intensity"])}),Ta="-transition";class Jl extends d.Evented{constructor(a,u){super(),this._transitionable=new d.Transitionable(_n),this.set(a),this._transitioning=this._transitionable.untransitioned(),this._transform=u}get state(){const a=this._transform,u="globe"===a.projection.name,g=d.globeToMercatorTransition(a.zoom),v=this.properties.get("range"),b=[.5,3];return{range:u?[d.number(b[0],v[0],g),d.number(b[1],v[1],g)]:v,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(a,u={}){if(!this._validate(d.validateFog,a,u)){for(const g of Object.keys(d.spec.fog))a&&void 0===a[g]&&(a[g]=d.spec.fog[g].default);for(const g in a){const v=a[g];d.endsWith(g,Ta)?this._transitionable.setTransition(g.slice(0,-Ta.length),v):this._transitionable.setValue(g,v)}}}getOpacity(a){if(!this._transform.projection.supportsFog)return 0;const u=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:d.smoothstep(45,65,a))*u.a}getOpacityAtLatLng(a,u){return this._transform.projection.supportsFog?function(g,v,b){const D=d.MercatorCoordinate.fromLngLat(v),I=b.elevation?b.elevation.getAtPointOrZero(D):0,M=[D.x,D.y,I];return d.transformMat4(M,M,b.mercatorFogMatrix),Ea(g,M,b.pitch,b._fov)}(this.state,a,u):0}getFovAdjustedRange(a){return this._transform.projection.supportsFog?Ns(this.state,a):[0,1]}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,u,g){return(!g||!1!==g.validate)&&d.emitValidationErrors(this,a.call(d.validateStyle,d.extend({value:u,style:{glyphs:!0,sprite:!0},styleSpec:d.spec})))}}class fs{constructor(a,u){this.workerPool=a,this.actors=[],this.currentActor=0,this.id=d.uniqueId();const g=this.workerPool.acquire(this.id);for(let v=0;v<g.length;v++){const b=new fs.Actor(g[v],u,this.id);b.name=`Worker ${v}`,this.actors.push(b)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(a,u,g){d.asyncAll(this.actors,(v,b)=>{v.send(a,u,b)},g=g||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(a=>{a.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Uo(f,a,u){return a*(d.EXTENT/(f.tileSize*Math.pow(2,u-f.tileID.overscaledZ)))}fs.Actor=d.Actor;class $o{constructor(a,u,g,v){this.screenBounds=a,this.cameraPoint=u,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=g,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,v)}static createFromScreenPoints(a,u){let g,v;if(a instanceof d.pointGeometry||"number"==typeof a[0]){const b=d.pointGeometry.convert(a);g=[b],v=u.isPointAboveHorizon(b)}else{const b=d.pointGeometry.convert(a[0]),D=d.pointGeometry.convert(a[1]);g=[b,D],v=d.polygonizeBounds(b,D).every(I=>u.isPointAboveHorizon(I))}return new $o(g,u.getCameraPoint(),v,u)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(a){return d.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],a)}bufferedCameraGeometry(a){const u=this.screenBounds[0],g=1===this.screenBounds.length?this.screenBounds[0].add(new d.pointGeometry(1,1)):this.screenBounds[1],v=d.polygonizeBounds(u,g,0,!1);return this.cameraPoint.y>g.y&&(this.cameraPoint.x>u.x&&this.cameraPoint.x<g.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=g.x?v[2]=this.cameraPoint:this.cameraPoint.x<=u.x&&(v[3]=this.cameraPoint)),d.bufferConvexPolygon(v,a)}bufferedCameraGeometryGlobe(a){const u=this.screenBounds[0],g=1===this.screenBounds.length?this.screenBounds[0].add(new d.pointGeometry(1,1)):this.screenBounds[1],v=d.polygonizeBounds(u,g,a),b=this.cameraPoint.clone();switch(3*((b.y>u.y)+(b.y>g.y))+((b.x>u.x)+(b.x>g.x))){case 0:v[0]=b,v[4]=b.clone();break;case 1:v.splice(1,0,b);break;case 2:v[1]=b;break;case 3:v.splice(4,0,b);break;case 5:v.splice(2,0,b);break;case 6:v[3]=b;break;case 7:v.splice(3,0,b);break;case 8:v[2]=b}return v}containsTile(a,u,g,v=0){const b=a.queryPadding/u._pixelsPerMercatorPixel+1,D=g?this._bufferedCameraMercator(b,u):this._bufferedScreenMercator(b,u);let I=a.tileID.wrap+(D.unwrapped?v:0);const M=D.polygon.map(q=>d.getTilePoint(a.tileTransform,q,I));if(!d.polygonIntersectsBox(M,0,0,d.EXTENT,d.EXTENT))return;I=a.tileID.wrap+(this.screenGeometryMercator.unwrapped?v:0);const R=this.screenGeometryMercator.polygon.map(q=>d.getTileVec3(a.tileTransform,q,I)),k=R.map(q=>new d.pointGeometry(q[0],q[1])),B=u.getFreeCameraOptions().position||new d.MercatorCoordinate(0,0,0),$=d.getTileVec3(a.tileTransform,B,I),Z=R.map(q=>{const H=d.sub(q,q,$);return d.normalize(H,H),new d.Ray($,H)}),W=Uo(a,1,u.zoom)*u._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:k,tilespaceRays:Z,bufferedTilespaceGeometry:M,bufferedTilespaceBounds:(K=d.getBounds(M),K.min.x=d.clamp(K.min.x,0,d.EXTENT),K.min.y=d.clamp(K.min.y,0,d.EXTENT),K.max.x=d.clamp(K.max.x,0,d.EXTENT),K.max.y=d.clamp(K.max.y,0,d.EXTENT),K),tile:a,tileID:a.tileID,pixelToTileUnitsFactor:W};var K}_bufferedScreenMercator(a,u){const g=io(a);if(this._screenRaycastCache[g])return this._screenRaycastCache[g];{let v;return v="globe"===u.projection.name?this._projectAndResample(this.bufferedScreenGeometry(a),u):{polygon:this.bufferedScreenGeometry(a).map(b=>u.pointCoordinate3D(b)),unwrapped:!0},this._screenRaycastCache[g]=v,v}}_bufferedCameraMercator(a,u){const g=io(a);if(this._cameraRaycastCache[g])return this._cameraRaycastCache[g];{let v;return v="globe"===u.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(a),u):{polygon:this.bufferedCameraGeometry(a).map(b=>u.pointCoordinate3D(b)),unwrapped:!0},this._cameraRaycastCache[g]=v,v}}_projectAndResample(a,u){const g=function(b,D){const I=d.multiply([],D.pixelMatrix,D.globeMatrix),M=[0,-d.GLOBE_RADIUS,0,1],R=[0,d.GLOBE_RADIUS,0,1],k=[0,0,0,1];d.transformMat4$1(M,M,I),d.transformMat4$1(R,R,I),d.transformMat4$1(k,k,I);const B=new d.pointGeometry(M[0]/M[3],M[1]/M[3]),$=new d.pointGeometry(R[0]/R[3],R[1]/R[3]),Z=d.polygonContainsPoint(b,B)&&M[3]<k[3],W=d.polygonContainsPoint(b,$)&&R[3]<k[3];if(!Z&&!W)return null;const K=function(me,Se,Te){for(let _e=1;_e<me.length;_e++){const Ze=Br(Se.pointCoordinate3D(me[_e-1]).x),xe=Br(Se.pointCoordinate3D(me[_e]).x);if(Te<0){if(Ze<xe)return{idx:_e,t:-Ze/(xe-1-Ze)}}else if(xe<Ze)return{idx:_e,t:(1-Ze)/(xe+1-Ze)}}return null}(b,D,Z?-1:1);if(!K)return null;const{idx:q,t:H}=K;let J=q>1?zs(b.slice(0,q),D):[],Q=q<b.length?zs(b.slice(q),D):[];J=J.map(me=>new d.pointGeometry(Br(me.x),me.y)),Q=Q.map(me=>new d.pointGeometry(Br(me.x),me.y));const re=[...J];0===re.length&&re.push(Q[Q.length-1]);const ue=d.number(re[re.length-1].y,(0===Q.length?J[0]:Q[0]).y,H);let ce;return ce=Z?[new d.pointGeometry(0,ue),new d.pointGeometry(0,0),new d.pointGeometry(1,0),new d.pointGeometry(1,ue)]:[new d.pointGeometry(1,ue),new d.pointGeometry(1,1),new d.pointGeometry(0,1),new d.pointGeometry(0,ue)],re.push(...ce),0===Q.length?re.push(J[0]):re.push(...Q),{polygon:re.map(me=>new d.MercatorCoordinate(me.x,me.y)),unwrapped:!1}}(a,u);if(g)return g;const v=function(b,D){let I=!1,M=-1/0,R=0;for(let B=0;B<b.length-1;B++)b[B].x>M&&(M=b[B].x,R=B);for(let B=0;B<b.length-1;B++){const $=(R+B)%(b.length-1),Z=b[$],W=b[$+1];Math.abs(Z.x-W.x)>.5&&(Z.x<W.x?(Z.x+=1,0===$&&(b[b.length-1].x+=1)):(W.x+=1,$+1===b.length-1&&(b[0].x+=1)),I=!0)}const k=d.mercatorXfromLng(D.center.lng);return I&&k<Math.abs(k-1)&&b.forEach(B=>{B.x-=1}),{polygon:b,unwrapped:I}}(zs(a,u).map(b=>new d.pointGeometry(Br(b.x),b.y)),u);return{polygon:v.polygon.map(b=>new d.MercatorCoordinate(b.x,b.y)),unwrapped:v.unwrapped}}}function zs(f,a){return d.resample(f,u=>{const g=a.pointCoordinate3D(u);u.x=g.x,u.y=g.y},1/256)}function Br(f){return f<0?1+f%1:f%1}function io(f){return 100*f|0}function Bs(f,a,u,g,v){const b=function(D,I){if(D)return v(D);if(I){f.url&&I.tiles&&f.tiles&&delete f.tiles;const M=d.pick(d.extend(I,f),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);I.vector_layers&&(M.vectorLayers=I.vector_layers,M.vectorLayerIds=M.vectorLayers.map(R=>R.id)),M.tiles=a.canonicalizeTileset(M,f.url),v(null,M)}};return f.url?d.getJSON(a.transformRequest(a.normalizeSourceURL(f.url,null,u,g),d.ResourceType.Source),b):d.exported.frame(()=>b(null,f))}class Vr{constructor(a,u,g){this.bounds=d.LngLatBounds.convert(this.validateBounds(a)),this.minzoom=u||0,this.maxzoom=g||24}validateBounds(a){return Array.isArray(a)&&4===a.length?[Math.max(-180,a[0]),Math.max(-90,a[1]),Math.min(180,a[2]),Math.min(90,a[3])]:[-180,-90,180,90]}contains(a){const u=Math.pow(2,a.z),g=Math.floor(d.mercatorXfromLng(this.bounds.getWest())*u),v=Math.floor(d.mercatorYfromLat(this.bounds.getNorth())*u),b=Math.ceil(d.mercatorXfromLng(this.bounds.getEast())*u),D=Math.ceil(d.mercatorYfromLat(this.bounds.getSouth())*u);return a.x>=g&&a.x<b&&a.y>=v&&a.y<D}}class pu{constructor(a,u,g){this.context=a;const v=a.gl;this.buffer=v.createBuffer(),this.dynamicDraw=Boolean(g),this.context.unbindVAO(),a.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||u.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(a){const u=this.context.gl;this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Qn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Go{constructor(a,u,g,v){this.length=u.length,this.attributes=g,this.itemSize=u.bytesPerElement,this.dynamicDraw=v,this.context=a;const b=a.gl;this.buffer=b.createBuffer(),a.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||u.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(a){const u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,a.arrayBuffer)}enableAttributes(a,u){for(let g=0;g<this.attributes.length;g++){const v=u.attributes[this.attributes[g].name];void 0!==v&&a.enableVertexAttribArray(v)}}setVertexAttribPointers(a,u,g){for(let v=0;v<this.attributes.length;v++){const b=this.attributes[v],D=u.attributes[b.name];void 0!==D&&a.vertexAttribPointer(D,b.components,a[Qn[b.type]],!1,this.itemSize,b.offset+this.itemSize*(g||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class hn{constructor(a){this.gl=a.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(a){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ho extends hn{getDefault(){return d.Color.transparent}set(a){const u=this.current;(a.r!==u.r||a.g!==u.g||a.b!==u.b||a.a!==u.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class fu extends hn{getDefault(){return 1}set(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)}}class Vs extends hn{getDefault(){return 0}set(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)}}class ec extends hn{getDefault(){return[!0,!0,!0,!0]}set(a){const u=this.current;(a[0]!==u[0]||a[1]!==u[1]||a[2]!==u[2]||a[3]!==u[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class mu extends hn{getDefault(){return!0}set(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)}}class Da extends hn{getDefault(){return 255}set(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)}}class Lh extends hn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(a){const u=this.current;(a.func!==u.func||a.ref!==u.ref||a.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)}}class Tr extends hn{getDefault(){const a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]}set(a){const u=this.current;(a[0]!==u[0]||a[1]!==u[1]||a[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)}}class js extends hn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const u=this.gl;a?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=a,this.dirty=!1}}class tc extends hn{getDefault(){return[0,1]}set(a){const u=this.current;(a[0]!==u[0]||a[1]!==u[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)}}class ll extends hn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const u=this.gl;a?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=a,this.dirty=!1}}class nc extends hn{getDefault(){return this.gl.LESS}set(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)}}class ms extends hn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const u=this.gl;a?u.enable(u.BLEND):u.disable(u.BLEND),this.current=a,this.dirty=!1}}class ic extends hn{getDefault(){const a=this.gl;return[a.ONE,a.ZERO]}set(a){const u=this.current;(a[0]!==u[0]||a[1]!==u[1]||this.dirty)&&(this.gl.blendFunc(a[0],a[1]),this.current=a,this.dirty=!1)}}class rc extends hn{getDefault(){return d.Color.transparent}set(a){const u=this.current;(a.r!==u.r||a.g!==u.g||a.b!==u.b||a.a!==u.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class ro extends hn{getDefault(){return this.gl.FUNC_ADD}set(a){(a!==this.current||this.dirty)&&(this.gl.blendEquation(a),this.current=a,this.dirty=!1)}}class gu extends hn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const u=this.gl;a?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=a,this.dirty=!1}}class oo extends hn{getDefault(){return this.gl.BACK}set(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)}}class Us extends hn{getDefault(){return this.gl.CCW}set(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)}}class Ca extends hn{getDefault(){return null}set(a){(a!==this.current||this.dirty)&&(this.gl.useProgram(a),this.current=a,this.dirty=!1)}}class oc extends hn{getDefault(){return this.gl.TEXTURE0}set(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)}}class kh extends hn{getDefault(){const a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]}set(a){const u=this.current;(a[0]!==u[0]||a[1]!==u[1]||a[2]!==u[2]||a[3]!==u[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class cl extends hn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,a),this.current=a,this.dirty=!1}}class Ia extends hn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class sc extends hn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const u=this.gl;u.bindTexture(u.TEXTURE_2D,a),this.current=a,this.dirty=!1}}class ac extends hn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class qo extends hn{getDefault(){return null}set(a){const u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class lc extends hn{constructor(a){super(a),this.vao=a.extVertexArrayObject}getDefault(){return null}set(a){this.vao&&(a!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(a),this.current=a,this.dirty=!1)}}class cc extends hn{getDefault(){return 4}set(a){if(a===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}}class Sa extends hn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}}class $s extends hn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}}class Ma extends hn{constructor(a,u){super(a),this.context=a,this.parent=u}getDefault(){return null}}class so extends Ma{setDirty(){this.dirty=!0}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class Gs extends Ma{attachment(){return this.gl.DEPTH_ATTACHMENT}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,this.attachment(),u.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class ul extends Gs{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class ee{constructor(a,u,g,v){this.context=a,this.width=u,this.height=g;const b=this.framebuffer=a.gl.createFramebuffer();this.colorAttachment=new so(a,b),v&&(this.depthAttachment=new Gs(a,b))}destroy(){const a=this.context.gl,u=this.colorAttachment.get();if(u&&a.deleteTexture(u),this.depthAttachment){const g=this.depthAttachment.get();g&&a.deleteRenderbuffer(g)}a.deleteFramebuffer(this.framebuffer)}}class z{constructor(a){this.gl=a,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Ho(this),this.clearDepth=new fu(this),this.clearStencil=new Vs(this),this.colorMask=new ec(this),this.depthMask=new mu(this),this.stencilMask=new Da(this),this.stencilFunc=new Lh(this),this.stencilOp=new Tr(this),this.stencilTest=new js(this),this.depthRange=new tc(this),this.depthTest=new ll(this),this.depthFunc=new nc(this),this.blend=new ms(this),this.blendFunc=new ic(this),this.blendColor=new rc(this),this.blendEquation=new ro(this),this.cullFace=new gu(this),this.cullFaceSide=new oo(this),this.frontFace=new Us(this),this.program=new Ca(this),this.activeTexture=new oc(this),this.viewport=new kh(this),this.bindFramebuffer=new cl(this),this.bindRenderbuffer=new Ia(this),this.bindTexture=new sc(this),this.bindVertexBuffer=new ac(this),this.bindElementBuffer=new qo(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new lc(this),this.pixelStoreUnpack=new cc(this),this.pixelStoreUnpackPremultiplyAlpha=new Sa(this),this.pixelStoreUnpackFlipY=new $s(this),this.extTextureFilterAnisotropic=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=a.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=a.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=a.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=a.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.extTextureHalfFloat=a.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(a.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=a.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=a.getExtension("OES_standard_derivatives"),this.extTimerQuery=a.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(a,u){return new pu(this,a,u)}createVertexBuffer(a,u,g){return new Go(this,a,u,g)}createRenderbuffer(a,u,g){const v=this.gl,b=v.createRenderbuffer();return this.bindRenderbuffer.set(b),v.renderbufferStorage(v.RENDERBUFFER,a,u,g),this.bindRenderbuffer.set(null),b}createFramebuffer(a,u,g){return new ee(this,a,u,g)}clear({color:a,depth:u,stencil:g}){const v=this.gl;let b=0;a&&(b|=v.COLOR_BUFFER_BIT,this.clearColor.set(a),this.colorMask.set([!0,!0,!0,!0])),void 0!==u&&(b|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),void 0!==g&&(b|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),v.clear(b)}setCullFace(a){!1===a.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(a.mode),this.frontFace.set(a.frontFace))}setDepthMode(a){a.func!==this.gl.ALWAYS||a.mask?(this.depthTest.set(!0),this.depthFunc.set(a.func),this.depthMask.set(a.mask),this.depthRange.set(a.range)):this.depthTest.set(!1)}setStencilMode(a){a.test.func!==this.gl.ALWAYS||a.mask?(this.stencilTest.set(!0),this.stencilMask.set(a.mask),this.stencilOp.set([a.fail,a.depthFail,a.pass]),this.stencilFunc.set({func:a.test.func,ref:a.ref,mask:a.test.mask})):this.stencilTest.set(!1)}setColorMode(a){Ue(a.blendFunction,d.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(a.blendFunction),this.blendColor.set(a.blendColor)),this.colorMask.set(a.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class U extends d.Evented{constructor(a,u,g,v){super(),this.id=a,this.dispatcher=g,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=d.extend({type:"raster"},u),d.extend(this,d.pick(u,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Bs(this._options,this.map._requestManager,null,null,(a,u)=>{this._tileJSONRequest=null,this._loaded=!0,a?this.fire(new d.ErrorEvent(a)):u&&(d.extend(this,u),u.bounds&&(this.tileBounds=new Vr(u.bounds,this.minzoom,this.maxzoom)),d.postTurnstileEvent(u.tiles),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(a){this.map=a,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return d.extend({},this._options)}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}loadTile(a,u){const g=d.exported.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),g,this.tileSize);a.request=d.getImage(this.map._requestManager.transformRequest(v,d.ResourceType.Tile),(b,D,I,M)=>(delete a.request,a.aborted?(a.state="unloaded",u(null)):b?(a.state="errored",u(b)):D?(this.map._refreshExpiredTiles&&a.setExpiryData({cacheControl:I,expires:M}),a.setTexture(D,this.map.painter),a.state="loaded",d.cacheEntryPossiblyAdded(this.dispatcher),void u(null)):u(null)))}static loadTileData(a,u,g){a.setTexture(u,g)}static unloadTileData(a,u){a.texture&&u.saveTileTexture(a.texture)}abortTile(a,u){a.request&&(a.request.cancel(),delete a.request),u()}unloadTile(a,u){a.texture&&this.map.painter.saveTileTexture(a.texture),u()}hasTransition(){return!1}}let Y;function oe(f,a,u,g,v,b,D,I){const M=[f,u,v,a,g,b,1,1,1],R=[D,I,1],k=d.adjoint([],M),[B,$,Z]=d.transformMat3(R,R,d.transpose(k,k));return d.multiply$1(M,[B,0,0,0,$,0,0,0,Z],M)}class de extends d.Evented{constructor(a,u,g,v){super(),this.id=a,this.dispatcher=g,this.coordinates=u.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(v),this.options=u,this._dirty=!1}load(a,u){this._loaded=u||!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=d.getImage(this.map._requestManager.transformRequest(this.url,d.ResourceType.Image),(g,v)=>{if(this._imageRequest=null,this._loaded=!0,g)this.fire(new d.ErrorEvent(g));else if(v){const{HTMLImageElement:b}=d.window;this.image=v instanceof b?d.exported.getImageData(v):v,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,a&&(this.coordinates=a),this._finishLoading()}})}loaded(){return this._loaded}updateImage(a){return this.image&&a.url?(this._imageRequest&&a.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=a.url,this.load(a.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(a){this.map=a,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(a){this.coordinates=a,this._boundsArray=void 0;const u=a.map(d.MercatorCoordinate.fromLngLat);return this.tileID=function(g){let v=1/0,b=1/0,D=-1/0,I=-1/0;for(const B of g)v=Math.min(v,B.x),b=Math.min(b,B.y),D=Math.max(D,B.x),I=Math.max(I,B.y);const M=Math.max(D-v,I-b),R=Math.max(0,Math.floor(-Math.log(M)/Math.LN2)),k=Math.pow(2,R);return new d.CanonicalTileID(R,Math.floor((v+D)/2*k),Math.floor((b+I)/2*k))}(u),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(a){for(const M in this.tiles){const R=this.tiles[M];"loaded"!==R.state&&(R.state="loaded",R.texture=this.texture)}if(this._boundsArray)return;const u=d.tileTransform(this.tileID,this.map.transform.projection),[g,v,b,D]=this.coordinates.map(M=>{const R=u.projection.project(M[0],M[1]);return d.getTilePoint(u,R)._round()});this.perspectiveTransform=function(M,R,k,B,$,Z,W,K,q,H){const J=oe(0,0,M,0,0,R,M,R),Q=oe(k,B,$,Z,W,K,q,H);return d.multiply$1(Q,d.adjoint(J,J),Q),[Q[6]/Q[8]*M/d.EXTENT,Q[7]/Q[8]*R/d.EXTENT]}(this.width,this.height,g.x,g.y,v.x,v.y,D.x,D.y,b.x,b.y);const I=this._boundsArray=new d.StructArrayLayout4i8;I.emplaceBack(g.x,g.y,0,0),I.emplaceBack(v.x,v.y,d.EXTENT,0),I.emplaceBack(D.x,D.y,0,d.EXTENT),I.emplaceBack(b.x,b.y,d.EXTENT,d.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=a.createVertexBuffer(I,d.boundsAttributes.members),this.boundsSegments=d.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const a=this.map.painter.context,u=a.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new d.Texture(a,this.image,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(a)}loadTile(a,u){this.tileID&&this.tileID.equals(a.tileID.canonical)?(this.tiles[String(a.tileID.wrap)]=a,a.buckets={},u(null)):(a.state="errored",u(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const ve={vector:class extends d.Evented{constructor(f,a,u,g){if(super(),this.id=f,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,d.extend(this,d.pick(a,["url","scheme","tileSize","promoteId"])),this._options=d.extend({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g),this._tileWorkers={},this._deduped=new d.DedupedRequest}load(f){this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"}));const a=Array.isArray(this.map._language)?this.map._language.join():this.map._language,u=this.map._worldview;this._tileJSONRequest=Bs(this._options,this.map._requestManager,a,u,(g,v)=>{this._tileJSONRequest=null,this._loaded=!0,g?(a&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${a}`),u&&2!==u.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${u}`),this.fire(new d.ErrorEvent(g))):v&&(d.extend(this,v),v.bounds&&(this.tileBounds=new Vr(v.bounds,this.minzoom,this.maxzoom)),d.postTurnstileEvent(v.tiles,this.map._requestManager._customAccessToken),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"}))),f&&f(g)})}loaded(){return this._loaded}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}onAdd(f){this.map=f,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>{const f=this.map.style._getSourceCaches(this.id);for(const a of f)a.clearTiles()})}setSourceProperty(f){f(),this.reload()}setTiles(f){return this._options.tiles=f,this.reload(),this}setUrl(f){return this.url=f,this._options.url=f,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return d.extend({},this._options)}loadTile(f,a){const u=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),g={request:this.map._requestManager.transformRequest(u,d.ResourceType.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:d.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:f.isSymbolTile};if(g.request.collectResourceTiming=this._collectResourceTiming,f.actor&&"expired"!==f.state)"loading"===f.state?f.reloadCallback=a:f.request=f.actor.send("reloadTile",g,v.bind(this));else if(f.actor=this._tileWorkers[u]=this._tileWorkers[u]||this.dispatcher.getActor(),this.dispatcher.ready)f.request=f.actor.send("loadTile",g,v.bind(this),void 0,!0);else{const b=d.loadVectorTile.call({deduped:this._deduped},g,(D,I)=>{D||!I?v.call(this,D):(g.data={cacheControl:I.cacheControl,expires:I.expires,rawData:I.rawData.slice(0)},f.actor&&f.actor.send("loadTile",g,v.bind(this),void 0,!0))},!0);f.request={cancel:b}}function v(b,D){return delete f.request,f.aborted?a(null):b&&404!==b.status?a(b):(D&&D.resourceTiming&&(f.resourceTiming=D.resourceTiming),this.map._refreshExpiredTiles&&D&&f.setExpiryData(D),f.loadVectorData(D,this.map.painter),d.cacheEntryPossiblyAdded(this.dispatcher),a(null),void(f.reloadCallback&&(this.loadTile(f,f.reloadCallback),f.reloadCallback=null)))}}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.actor&&f.actor.send("abortTile",{uid:f.uid,type:this.type,source:this.id})}unloadTile(f){f.unloadVectorData(),f.actor&&f.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}},raster:U,"raster-dem":class extends U{constructor(f,a,u,g){super(f,a,u,g),this.type="raster-dem",this.maxzoom=22,this._options=d.extend({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox"}loadTile(f,a){const u=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function g(v,b){v&&(f.state="errored",a(v)),b&&(f.dem=b,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",a(null))}f.request=d.getImage(this.map._requestManager.transformRequest(u,d.ResourceType.Tile),function(v,b,D,I){if(delete f.request,f.aborted)f.state="unloaded",a(null);else if(v)f.state="errored",a(v);else if(b){this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:D,expires:I});const M=d.window.ImageBitmap&&b instanceof d.window.ImageBitmap&&(null==Y&&(Y=d.window.OffscreenCanvas&&new d.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof d.window.createImageBitmap),Y),R=1-(b.width-d.prevPowerOfTwo(b.width))/2;R<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const k=M?b:d.exported.getImageData(b,R),B={uid:f.uid,coord:f.tileID,source:this.id,rawImageData:k,encoding:this.encoding,padding:R};f.actor&&"expired"!==f.state||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",B,g.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(f){const a=f.canonical,u=Math.pow(2,a.z),g=(a.x-1+u)%u,v=0===a.x?f.wrap-1:f.wrap,b=(a.x+1+u)%u,D=a.x+1===u?f.wrap+1:f.wrap,I={};return I[new d.OverscaledTileID(f.overscaledZ,v,a.z,g,a.y).key]={backfilled:!1},I[new d.OverscaledTileID(f.overscaledZ,D,a.z,b,a.y).key]={backfilled:!1},a.y>0&&(I[new d.OverscaledTileID(f.overscaledZ,v,a.z,g,a.y-1).key]={backfilled:!1},I[new d.OverscaledTileID(f.overscaledZ,f.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},I[new d.OverscaledTileID(f.overscaledZ,D,a.z,b,a.y-1).key]={backfilled:!1}),a.y+1<u&&(I[new d.OverscaledTileID(f.overscaledZ,v,a.z,g,a.y+1).key]={backfilled:!1},I[new d.OverscaledTileID(f.overscaledZ,f.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},I[new d.OverscaledTileID(f.overscaledZ,D,a.z,b,a.y+1).key]={backfilled:!1}),I}unloadTile(f){f.demTexture&&this.map.painter.saveTileTexture(f.demTexture),f.fbo&&(f.fbo.destroy(),delete f.fbo),f.dem&&delete f.dem,delete f.neighboringTiles,f.state="unloaded"}},geojson:class extends d.Evented{constructor(f,a,u,g){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=u.getActor(),this.setEventedParent(g),this._data=a.data,this._options=d.extend({},a),this._collectResourceTiming=a.collectResourceTiming,void 0!==a.maxzoom&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId;const v=d.EXTENT/this.tileSize;this.workerOptions=d.extend({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:(void 0!==a.buffer?a.buffer:128)*v,tolerance:(void 0!==a.tolerance?a.tolerance:.375)*v,extent:d.EXTENT,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:void 0!==a.clusterMaxZoom?a.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,a.clusterMinPoints||2),extent:d.EXTENT,radius:(void 0!==a.clusterRadius?a.clusterRadius:50)*v,log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}getClusterExpansionZoom(f,a){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id},a),this}getClusterChildren(f,a){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id},a),this}getClusterLeaves(f,a,u,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:f,limit:a,offset:u},g),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new d.Event("dataloading",{dataType:"source"})),this._loaded=!1;const f=d.extend({},this.workerOptions),a=this._data;"string"==typeof a?(f.request=this.map._requestManager.transformRequest(d.exported.resolveURL(a),d.ResourceType.Source),f.request.collectResourceTiming=this._collectResourceTiming):f.data=JSON.stringify(a),this._pendingLoad=this.actor.send(`${this.type}.loadData`,f,(u,g)=>{if(this._loaded=!0,this._pendingLoad=null,u)this.fire(new d.ErrorEvent(u));else{const v={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&g&&g.resourceTiming&&g.resourceTiming[this.id]&&(v.resourceTiming=g.resourceTiming[this.id]),this.fire(new d.Event("data",v)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(f,a){const u=f.actor?"reloadTile":"loadTile";f.actor=this.actor,f.request=this.actor.send(u,{type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:d.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(g,v)=>(delete f.request,f.unloadVectorData(),f.aborted?a(null):g?a(g):(f.loadVectorData(v,this.map.painter,"reloadTile"===u),a(null))),void 0,"loadTile"===u)}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f){f.unloadVectorData(),this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return d.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends de{constructor(f,a,u,g){super(f,a,u,g),this.roundZoom=!0,this.type="video",this.options=a}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const a of f.urls)this.urls.push(this.map._requestManager.transformRequest(a,d.ResourceType.Source).url);d.getVideo(this.urls,(a,u)=>{this._loaded=!0,a?this.fire(new d.ErrorEvent(a)):u&&(this.video=u,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const a=this.video.seekable;f<a.start(0)||f>a.end(0)?this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const f=this.map.painter.context,a=f.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new d.Texture(f,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:de,canvas:class extends de{constructor(f,a,u,g){super(f,a,u,g),a.coordinates?Array.isArray(a.coordinates)&&4===a.coordinates.length&&!a.coordinates.some(v=>!Array.isArray(v)||2!==v.length||v.some(b=>"number"!=typeof b))||this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${f}`,null,'missing required property "coordinates"'))),a.animate&&"boolean"!=typeof a.animate&&this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),a.canvas?"string"==typeof a.canvas||a.canvas instanceof d.window.HTMLCanvasElement||this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${f}`,null,'missing required property "canvas"'))),this.options=a,this.animate=void 0===a.animate||a.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof d.window.HTMLCanvasElement?this.options.canvas:d.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new d.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const a=this.map.painter.context;this.texture?(f||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new d.Texture(a,this.canvas,a.gl.RGBA,{premultiply:!0}),this._prepareData(a)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends d.Evented{constructor(f,a,u,g){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=u,this._implementation=a,this.setEventedParent(g),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new d.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new d.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Vr(this._implementation.bounds,this.minzoom,this.maxzoom)),a.update=this._update.bind(this),a.clearTiles=this._clearTiles.bind(this),a.coveringTiles=this._coveringTiles.bind(this),d.extend(this,d.pick(a,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return d.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this._map=f,this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){const{x:a,y:u,z:g}=f.canonical;return this._implementation.hasTile({x:a,y:u,z:g})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,a){const{x:u,y:g,z:v}=f.tileID.canonical,b=new d.window.AbortController;f.request=Promise.resolve(this._implementation.loadTile({x:u,y:g,z:v},{signal:b.signal})).then(function(D){return delete f.request,f.aborted?(f.state="unloaded",a(null)):void 0===D?(f.state="errored",a(null)):null===D?(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",a(null)):(I=D)instanceof d.window.ImageData||I instanceof d.window.HTMLCanvasElement||I instanceof d.window.ImageBitmap||I instanceof d.window.HTMLImageElement?(this.loadTileData(f,D),f.state="loaded",void a(null)):(f.state="errored",a(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var I}.bind(this)).catch(D=>{20!==D.code&&(f.state="errored",a(D))}),f.request.cancel=()=>b.abort()}loadTileData(f,a){U.loadTileData(f,a,this._map.painter)}unloadTileData(f){U.unloadTileData(f,this._map.painter)}unloadTile(f,a){if(this.unloadTileData(f),this._implementation.unloadTile){const{x:u,y:g,z:v}=f.tileID.canonical;this._implementation.unloadTile({x:u,y:g,z:v})}a()}abortTile(f,a){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),a()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"}))}}},ye=function(f,a,u,g){const v=new ve[a.type](f,a,u,g);if(v.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${v.id}`);return d.bindAll(["load","abort","unload","serialize","prepare"],v),v};function pe(f,a){const u=d.identity([]);return d.scale(u,u,[.5*f.width,.5*-f.height,1]),d.translate(u,u,[1,-1,0]),d.multiply(u,u,f.calculateProjMatrix(a.toUnwrapped())),Float32Array.from(u)}function we(f,a,u,g,v,b,D,I=!1){const M=f.tilesIn(g,D,I);M.sort(it);const R=[];for(const B of M)R.push({wrappedTileID:B.tile.tileID.wrapped().key,queryResults:B.tile.queryRenderedFeatures(a,u,f._state,B,v,b,pe(f.transform,B.tile.tileID),I)});const k=function(B){const $={},Z={};for(const W of B){const K=W.queryResults,q=W.wrappedTileID,H=Z[q]=Z[q]||{};for(const J in K){const Q=K[J],re=H[J]=H[J]||{},ue=$[J]=$[J]||[];for(const ce of Q)re[ce.featureIndex]||(re[ce.featureIndex]=!0,ue.push(ce))}}return $}(R);for(const B in k)k[B].forEach($=>{const Z=$.feature,W=Z.layer;W&&"background"!==W.type&&"sky"!==W.type&&(Z.source=W.source,W["source-layer"]&&(Z.sourceLayer=W["source-layer"]),Z.state=void 0!==Z.id?f.getFeatureState(W["source-layer"],Z.id):{})});return k}function je(f,a){const u=f.getRenderableIds().map(b=>f.getTileByID(b)),g=[],v={};for(let b=0;b<u.length;b++){const D=u[b],I=D.tileID.canonical.key;v[I]||(v[I]=!0,D.querySourceFeatures(g,a))}return g}function it(f,a){const u=f.tileID,g=a.tileID;return u.overscaledZ-g.overscaledZ||u.canonical.y-g.canonical.y||u.wrap-g.wrap||u.canonical.x-g.canonical.x}function We(){return null!=ja.workerClass?new ja.workerClass:new d.window.Worker(ja.workerUrl)}const Et="mapboxgl_preloaded_worker_pool";class bt{constructor(){this.active={}}acquire(a){if(!this.workers)for(this.workers=[];this.workers.length<bt.workerCount;)this.workers.push(new We);return this.active[a]=!0,this.workers.slice()}release(a){delete this.active[a],0===this.numActive()&&(this.workers.forEach(u=>{u.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Et]}numActive(){return Object.keys(this.active).length}}let gt;function Lt(){return gt||(gt=new bt),gt}function an(f,a){const u={};for(const g in f)"ref"!==g&&(u[g]=f[g]);return d.refProperties.forEach(g=>{g in a&&(u[g]=a[g])}),u}function Dn(f){f=f.slice();const a=Object.create(null);for(let u=0;u<f.length;u++)a[f[u].id]=f[u];for(let u=0;u<f.length;u++)"ref"in f[u]&&(f[u]=an(f[u],a[f[u].ref]));return f}bt.workerCount=2;const xt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Un(f,a,u){u.push({command:xt.addSource,args:[f,a[f]]})}function Wn(f,a,u){a.push({command:xt.removeSource,args:[f]}),u[f]=!0}function Wo(f,a,u,g){Wn(f,u,g),Un(f,a,u)}function gs(f,a,u){let g;for(g in f[u])if(f[u].hasOwnProperty(g)&&"data"!==g&&!Ue(f[u][g],a[u][g]))return!1;for(g in a[u])if(a[u].hasOwnProperty(g)&&"data"!==g&&!Ue(f[u][g],a[u][g]))return!1;return!0}function jr(f,a,u,g,v,b){let D;for(D in a=a||{},f=f||{})f.hasOwnProperty(D)&&(Ue(f[D],a[D])||u.push({command:b,args:[g,D,a[D],v]}));for(D in a)a.hasOwnProperty(D)&&!f.hasOwnProperty(D)&&(Ue(f[D],a[D])||u.push({command:b,args:[g,D,a[D],v]}))}function Re(f){return f.id}function _s(f,a){return f[a.id]=a,f}class _i{constructor(a,u){this.reset(a,u)}reset(a,u){this.points=a||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(a){if(1===this.points.length)return this.points[0];a=d.clamp(a,0,1);let u=1,g=this._distances[u];const v=a*this.paddedLength+this.padding;for(;g<v&&u<this._distances.length;)g=this._distances[++u];const b=u-1,D=this._distances[b],I=g-D,M=I>0?(v-D)/I:0;return this.points[b].mult(1-M).add(this.points[u].mult(M))}}class ys{constructor(a,u,g){const v=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(a/g),this.yCellCount=Math.ceil(u/g);for(let D=0;D<this.xCellCount*this.yCellCount;D++)v.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=a,this.height=u,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(a,u,g,v,b){this._forEachCell(u,g,v,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(u),this.bboxes.push(g),this.bboxes.push(v),this.bboxes.push(b)}insertCircle(a,u,g,v){this._forEachCell(u-v,g-v,u+v,g+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(a),this.circles.push(u),this.circles.push(g),this.circles.push(v)}_insertBoxCell(a,u,g,v,b,D){this.boxCells[b].push(D)}_insertCircleCell(a,u,g,v,b,D){this.circleCells[b].push(D)}_query(a,u,g,v,b,D){if(g<0||a>this.width||v<0||u>this.height)return!b&&[];const I=[];if(a<=0&&u<=0&&this.width<=g&&this.height<=v){if(b)return!0;for(let M=0;M<this.boxKeys.length;M++)I.push({key:this.boxKeys[M],x1:this.bboxes[4*M],y1:this.bboxes[4*M+1],x2:this.bboxes[4*M+2],y2:this.bboxes[4*M+3]});for(let M=0;M<this.circleKeys.length;M++){const R=this.circles[3*M],k=this.circles[3*M+1],B=this.circles[3*M+2];I.push({key:this.circleKeys[M],x1:R-B,y1:k-B,x2:R+B,y2:k+B})}return D?I.filter(D):I}return this._forEachCell(a,u,g,v,this._queryCell,I,{hitTest:b,seenUids:{box:{},circle:{}}},D),b?I.length>0:I}_queryCircle(a,u,g,v,b){const D=a-g,I=a+g,M=u-g,R=u+g;if(I<0||D>this.width||R<0||M>this.height)return!v&&[];const k=[];return this._forEachCell(D,M,I,R,this._queryCellCircle,k,{hitTest:v,circle:{x:a,y:u,radius:g},seenUids:{box:{},circle:{}}},b),v?k.length>0:k}query(a,u,g,v,b){return this._query(a,u,g,v,!1,b)}hitTest(a,u,g,v,b){return this._query(a,u,g,v,!0,b)}hitTestCircle(a,u,g,v){return this._queryCircle(a,u,g,!0,v)}_queryCell(a,u,g,v,b,D,I,M){const R=I.seenUids,k=this.boxCells[b];if(null!==k){const $=this.bboxes;for(const Z of k)if(!R.box[Z]){R.box[Z]=!0;const W=4*Z;if(a<=$[W+2]&&u<=$[W+3]&&g>=$[W+0]&&v>=$[W+1]&&(!M||M(this.boxKeys[Z]))){if(I.hitTest)return D.push(!0),!0;D.push({key:this.boxKeys[Z],x1:$[W],y1:$[W+1],x2:$[W+2],y2:$[W+3]})}}}const B=this.circleCells[b];if(null!==B){const $=this.circles;for(const Z of B)if(!R.circle[Z]){R.circle[Z]=!0;const W=3*Z;if(this._circleAndRectCollide($[W],$[W+1],$[W+2],a,u,g,v)&&(!M||M(this.circleKeys[Z]))){if(I.hitTest)return D.push(!0),!0;{const K=$[W],q=$[W+1],H=$[W+2];D.push({key:this.circleKeys[Z],x1:K-H,y1:q-H,x2:K+H,y2:q+H})}}}}}_queryCellCircle(a,u,g,v,b,D,I,M){const R=I.circle,k=I.seenUids,B=this.boxCells[b];if(null!==B){const Z=this.bboxes;for(const W of B)if(!k.box[W]){k.box[W]=!0;const K=4*W;if(this._circleAndRectCollide(R.x,R.y,R.radius,Z[K+0],Z[K+1],Z[K+2],Z[K+3])&&(!M||M(this.boxKeys[W])))return D.push(!0),!0}}const $=this.circleCells[b];if(null!==$){const Z=this.circles;for(const W of $)if(!k.circle[W]){k.circle[W]=!0;const K=3*W;if(this._circlesCollide(Z[K],Z[K+1],Z[K+2],R.x,R.y,R.radius)&&(!M||M(this.circleKeys[W])))return D.push(!0),!0}}}_forEachCell(a,u,g,v,b,D,I,M){const R=this._convertToXCellCoord(a),k=this._convertToYCellCoord(u),B=this._convertToXCellCoord(g),$=this._convertToYCellCoord(v);for(let Z=R;Z<=B;Z++)for(let W=k;W<=$;W++)if(b.call(this,a,u,g,v,this.xCellCount*W+Z,D,I,M))return}_convertToXCellCoord(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}_convertToYCellCoord(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}_circlesCollide(a,u,g,v,b,D){const I=v-a,M=b-u,R=g+D;return R*R>I*I+M*M}_circleAndRectCollide(a,u,g,v,b,D,I){const M=(D-v)/2,R=Math.abs(a-(v+M));if(R>M+g)return!1;const k=(I-b)/2,B=Math.abs(u-(b+k));if(B>k+g)return!1;if(R<=M||B<=k)return!0;const $=R-M,Z=B-k;return $*$+Z*Z<=g*g}}const Hd=Math.tan(85*Math.PI/180);function Ur(f,a,u,g,v,b,D){const I=d.create();if(u)if("globe"===b.name){const M=d.calculateGlobeLabelMatrix(v,a);d.multiply(I,I,M)}else{const M=on([],D);I[0]=M[0],I[1]=M[1],I[4]=M[2],I[5]=M[3],g||d.rotateZ(I,I,v.angle)}else d.multiply(I,v.labelPlaneMatrix,f);return I}function _u(f,a,u,g,v,b,D){const I=Ur(f,a,u,g,v,b,D);return"globe"===b.name&&u||(I[2]=I[6]=I[10]=I[14]=0),I}function qd(f,a,u,g,v,b,D){if(u){if("globe"===b.name){const I=Ur(f,a,u,g,v,b,D);return d.invert(I,I),d.multiply(I,f,I),I}{const I=d.clone(f),M=d.identity([]);return M[0]=D[0],M[1]=D[1],M[4]=D[2],M[5]=D[3],d.multiply(I,I,M),g||d.rotateZ(I,I,-v.angle),I}}return v.glCoordMatrix}function pr(f,a,u,g){const v=[f,a,u,1];u?d.transformMat4$1(v,v,g):si(v,v,g);const b=v[3];return v[0]/=b,v[1]/=b,v[2]/=b,v}function st(f,a){return Math.min(.5+f/a*.5,1.5)}function ln(f,a){const u=f[0]/f[3],g=f[1]/f[3];return u>=-a[0]&&u<=a[0]&&g>=-a[1]&&g<=a[1]}function _t(f,a,u,g,v,b,D,I,M,R){const k=u.transform,B=g?f.textSizeData:f.iconSizeData,$=d.evaluateSizeForZoom(B,u.transform.zoom),Z="globe"===k.projection.name,W=[256/u.width*2+1,256/u.height*2+1],K=g?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;K.clear();let q=null;Z&&(q=g?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);const H=f.lineVertexArray,J=g?f.text.placedSymbolArray:f.icon.placedSymbolArray,Q=u.transform.width/u.transform.height;let re,ue=!1;for(let ce=0;ce<J.length;ce++){const me=J.get(ce),{numGlyphs:Se,writingMode:Te}=me;if(Te!==d.WritingMode.vertical||ue||re===d.WritingMode.horizontal||(ue=!0),re=Te,(me.hidden||Te===d.WritingMode.vertical)&&!ue){wi(Se,K);continue}ue=!1;const _e=new d.pointGeometry(me.tileAnchorX,me.tileAnchorY);let{x:Ze,y:xe,z:Le}=k.projection.projectTilePoint(_e.x,_e.y,R.canonical);if(M){const[wt,ft,It]=M(_e);Ze+=wt,xe+=ft,Le+=It}const Ce=[Ze,xe,Le,1];if(d.transformMat4$1(Ce,Ce,a),!ln(Ce,W)){wi(Se,K);continue}const He=st(u.transform.cameraToCenterDistance,Ce[3]),Pe=d.evaluateSizeForFeature(B,$,me),Fe=D?Pe/He:Pe*He,Qe=pr(Ze,xe,Le,v);if(Qe[3]<=0){wi(Se,K);continue}let ge={};const Ie=D?null:M,ht=Xt(me,Fe,!1,I,a,v,b,f.glyphOffsetArray,H,K,q,Qe,_e,ge,Q,Ie,k.projection,R,D);ue=ht.useVertical,Ie&&ht.needsFlipping&&(ge={}),(ht.notEnoughRoom||ue||ht.needsFlipping&&Xt(me,Fe,!0,I,a,v,b,f.glyphOffsetArray,H,K,q,Qe,_e,ge,Q,Ie,k.projection,R,D).notEnoughRoom)&&wi(Se,K)}g?(f.text.dynamicLayoutVertexBuffer.updateData(K),q&&f.text.globeExtVertexBuffer.updateData(q)):(f.icon.dynamicLayoutVertexBuffer.updateData(K),q&&f.icon.globeExtVertexBuffer.updateData(q))}function $r(f,a,u,g,v,b,D,I,M,R,k,B,$,Z,W,K){const{lineStartIndex:q,glyphStartIndex:H,segment:J}=I,Q=H+I.numGlyphs,re=q+I.lineLength,ue=a.getoffsetX(H),ce=a.getoffsetX(Q-1),me=kt(f*ue,u,g,v,b,D,J,q,re,M,R,k,B,$,!0,Z,W,K);if(!me)return null;const Se=kt(f*ce,u,g,v,b,D,J,q,re,M,R,k,B,$,!0,Z,W,K);return Se?{first:me,last:Se}:null}function In(f,a,u,g){return f===d.WritingMode.horizontal&&Math.abs(g)>Math.abs(u)?{useVertical:!0}:f===d.WritingMode.vertical?g>0?{needsFlipping:!0}:null:0!==a&&(0===(v=u)||Math.abs(g/v)>Hd)?1===a?{needsFlipping:!0}:null:u<0?{needsFlipping:!0}:null;var v}function Xt(f,a,u,g,v,b,D,I,M,R,k,B,$,Z,W,K,q,H,J){const Q=a/24,re=f.lineOffsetX*Q,ue=f.lineOffsetY*Q,{lineStartIndex:ce,glyphStartIndex:me,numGlyphs:Se,segment:Te,writingMode:_e,flipState:Ze}=f,xe=ce+f.lineLength,Le=Ce=>{if(k){const[Qe,ge,Ie]=Ce.up,ht=R.length;d.updateGlobeVertexNormal(k,ht+0,Qe,ge,Ie),d.updateGlobeVertexNormal(k,ht+1,Qe,ge,Ie),d.updateGlobeVertexNormal(k,ht+2,Qe,ge,Ie),d.updateGlobeVertexNormal(k,ht+3,Qe,ge,Ie)}const[He,Pe,Fe]=Ce.point;d.addDynamicAttributes(R,He,Pe,Fe,Ce.angle)};if(Se>1){const Ce=$r(Q,I,re,ue,u,B,$,f,M,b,Z,K,!1,q,H,J);if(!Ce)return{notEnoughRoom:!0};if(g&&!u){let[He,Pe,Fe]=Ce.first.point,[Qe,ge,Ie]=Ce.last.point;[He,Pe]=pr(He,Pe,Fe,D),[Qe,ge]=pr(Qe,ge,Ie,D);const ht=In(_e,Ze,(Qe-He)*W,ge-Pe);if(f.flipState=ht&&ht.needsFlipping?1:2,ht)return ht}Le(Ce.first);for(let He=me+1;He<me+Se-1;He++){const Pe=kt(Q*I.getoffsetX(He),re,ue,u,B,$,Te,ce,xe,M,b,Z,K,!1,!1,q,H,J);if(!Pe)return R.length-=4*(He-me),{notEnoughRoom:!0};Le(Pe)}Le(Ce.last)}else{if(g&&!u){const He=pr($.x,$.y,0,v),Pe=ce+Te+1,Fe=new d.pointGeometry(M.getx(Pe),M.gety(Pe)),Qe=pr(Fe.x,Fe.y,0,v),ge=Qe[3]>0?Qe:Hs($,Fe,He,1,v,void 0,q,H.canonical),Ie=In(_e,Ze,(ge[0]-He[0])*W,ge[1]-He[1]);if(f.flipState=Ie&&Ie.needsFlipping?1:2,Ie)return Ie}const Ce=kt(Q*I.getoffsetX(me),re,ue,u,B,$,Te,ce,xe,M,b,Z,K,!1,!1,q,H,J);if(!Ce)return{notEnoughRoom:!0};Le(Ce)}return{}}function uc(f,a,u,g,v){const{x:b,y:D,z:I}=g.projectTilePoint(f.x,f.y,a);if(!v)return pr(b,D,I,u);const[M,R,k]=v(f);return pr(b+M,D+R,I+k,u)}function Hs(f,a,u,g,v,b,D,I){const M=uc(f.sub(a)._unit()._add(f),I,v,D,b);return d.sub(M,u,M),d.normalize(M,M),d.scaleAndAdd(M,u,M,g)}function kt(f,a,u,g,v,b,D,I,M,R,k,B,$,Z,W,K,q,H){const J=g?f-a:f+a;let Q=J>0?1:-1,re=0;g&&(Q*=-1,re=Math.PI),Q<0&&(re+=Math.PI);let ue=I+D+(Q>0?0:1)|0,ce=v,me=v,Se=0,Te=0;const _e=Math.abs(J),Ze=[],xe=[];let Le=b,Ce=Le;const He=()=>Hs(Ce,Le,me,_e-Se+1,k,$,K,q.canonical);for(;Se+Te<=_e;){if(ue+=Q,ue<I||ue>=M)return null;if(me=ce,Ce=Le,Ze.push(me),Z&&xe.push(Ce),Le=new d.pointGeometry(R.getx(ue),R.gety(ue)),ce=B[ue],!ce){const It=uc(Le,q.canonical,k,K,$);ce=It[3]>0?B[ue]=It:He()}Se+=Te,Te=d.distance(me,ce)}W&&$&&(B[ue]&&(ce=He(),Te=d.distance(me,ce)),B[ue]=ce);const Pe=(_e-Se)/Te,Fe=Le.sub(Ce)._mult(Pe)._add(Ce),Qe=d.sub([],ce,me),ge=d.scaleAndAdd([],me,Qe,Pe);let Ie=[0,0,1],ht=Qe[0],wt=Qe[1];if(H&&(Ie=K.upVector(q.canonical,Fe.x,Fe.y),0!==Ie[0]||0!==Ie[1]||1!==Ie[2])){const It=[Ie[2],0,-Ie[0]],Zt=d.cross([],Ie,It);d.normalize(It,It),d.normalize(Zt,Zt),ht=d.dot(Qe,It),wt=d.dot(Qe,Zt)}if(u){const It=d.cross([],Ie,Qe);d.normalize(It,It),d.scaleAndAdd(ge,ge,It,u*Q)}const ft=re+Math.atan2(wt,ht);return Ze.push(ge),Z&&xe.push(Fe),{point:ge,angle:ft,path:Ze,tilePath:xe,up:Ie}}function wi(f,a){const u=a.length,g=u+4*f;a.resize(g),a.float32.fill(-1/0,4*u,4*g)}function si(f,a,u){const g=a[0],v=a[1];return f[0]=u[0]*g+u[4]*v+u[12],f[1]=u[1]*g+u[5]*v+u[13],f[3]=u[3]*g+u[7]*v+u[15],f}const rt=100;class qs{constructor(a,u,g=new ys(a.width+200,a.height+200,25),v=new ys(a.width+200,a.height+200,25)){this.transform=a,this.grid=g,this.ignoredGrid=v,this.pitchfactor=Math.cos(a._pitch)*a.cameraToCenterDistance,this.screenRightBoundary=a.width+rt,this.screenBottomBoundary=a.height+rt,this.gridRightBoundary=a.width+200,this.gridBottomBoundary=a.height+200,this.fogState=u}placeCollisionBox(a,u,g,v,b,D,I,M){let R=g.projectedAnchorX,k=g.projectedAnchorY,B=g.projectedAnchorZ;const $=g.elevation,Z=g.tileID,W=a.getProjection();if($&&Z){const[ce,me,Se]=W.upVector(Z.canonical,g.tileAnchorX,g.tileAnchorY),Te=W.upVectorScale(Z.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;R+=ce*$*Te,k+=me*$*Te,B+=Se*$*Te}const K=this.projectAndGetPerspectiveRatio(I,R,k,B,g.tileID,"globe"===W.name||!!$||this.transform.pitch>0,W),q=D*K.perspectiveRatio,H=(g.x1*u+v.x-g.padding)*q+K.point.x,J=(g.y1*u+v.y-g.padding)*q+K.point.y,Q=(g.x2*u+v.x+g.padding)*q+K.point.x,re=(g.y2*u+v.y+g.padding)*q+K.point.y,ue=K.perspectiveRatio<=.55||K.occluded;return!this.isInsideGrid(H,J,Q,re)||!b&&this.grid.hitTest(H,J,Q,re,M)||ue?{box:[],offscreen:!1,occluded:K.occluded}:{box:[H,J,Q,re],offscreen:this.isOffscreen(H,J,Q,re),occluded:!1}}placeCollisionCircles(a,u,g,v,b,D,I,M,R,k,B,$,Z,W,K){const q=[],H=this.transform.elevation,J=a.getProjection(),Q=H?H.getAtTileOffsetFunc(K,this.transform.center.lat,this.transform.worldSize,J):null,re=new d.pointGeometry(g.tileAnchorX,g.tileAnchorY);let{x:ue,y:ce,z:me}=J.projectTilePoint(re.x,re.y,K.canonical);if(Q){const[Fe,Qe,ge]=Q(re);ue+=Fe,ce+=Qe,me+=ge}const Se="globe"===J.name,Te=this.projectAndGetPerspectiveRatio(I,ue,ce,me,K,Se||!!H||this.transform.pitch>0,J),{perspectiveRatio:_e}=Te,Ze=(B?D/_e:D*_e)/d.ONE_EM,xe=pr(ue,ce,me,M),Le=Te.signedDistanceFromCamera>0?$r(Ze,b,g.lineOffsetX*Ze,g.lineOffsetY*Ze,!1,xe,re,g,v,M,{},H&&!B?Q:null,B&&!!H,J,K,B):null;let Ce=!1,He=!1,Pe=!0;if(Le&&!Te.occluded){const Fe=.5*Z*_e+W,Qe=new d.pointGeometry(-100,-100),ge=new d.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Ie=new _i,{first:ht,last:wt}=Le,ft=ht.path.length;let It=[];for(let ut=ft-1;ut>=1;ut--)It.push(ht.path[ut]);for(let ut=1;ut<wt.path.length;ut++)It.push(wt.path[ut]);const Zt=2.5*Fe;R&&(It=It.map(([ut,xn,pn],kn)=>(Q&&!Se&&(pn=Q(kn<ft-1?ht.tilePath[ft-1-kn]:wt.tilePath[kn-ft+2])[2]),pr(ut,xn,pn,R))),It.some(ut=>ut[3]<=0)&&(It=[]));let mt=[];if(It.length>0){let ut=1/0,xn=-1/0,pn=1/0,kn=-1/0;for(const Cn of It)ut=Math.min(ut,Cn[0]),pn=Math.min(pn,Cn[1]),xn=Math.max(xn,Cn[0]),kn=Math.max(kn,Cn[1]);xn>=Qe.x&&ut<=ge.x&&kn>=Qe.y&&pn<=ge.y&&(mt=[It.map(Cn=>new d.pointGeometry(Cn[0],Cn[1]))],(ut<Qe.x||xn>ge.x||pn<Qe.y||kn>ge.y)&&(mt=d.clipLine(mt,Qe.x,Qe.y,ge.x,ge.y)))}for(const ut of mt){Ie.reset(ut,.25*Fe);let xn=0;xn=Ie.length<=.5*Fe?1:Math.ceil(Ie.paddedLength/Zt)+1;for(let pn=0;pn<xn;pn++){const kn=pn/Math.max(xn-1,1),Cn=Ie.lerp(kn),Hi=Cn.x+rt,Qr=Cn.y+rt;q.push(Hi,Qr,Fe,0);const ar=Hi-Fe,Do=Qr-Fe,$n=Hi+Fe,Nn=Qr+Fe;if(Pe=Pe&&this.isOffscreen(ar,Do,$n,Nn),He=He||this.isInsideGrid(ar,Do,$n,Nn),!u&&this.grid.hitTestCircle(Hi,Qr,Fe,$)&&(Ce=!0,!k))return{circles:[],offscreen:!1,collisionDetected:Ce,occluded:!1}}}}return{circles:!k&&Ce||!He?[]:q,offscreen:Pe,collisionDetected:Ce,occluded:Te.occluded}}queryRenderedSymbols(a){if(0===a.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const u=[];let g=1/0,v=1/0,b=-1/0,D=-1/0;for(const k of a){const B=new d.pointGeometry(k.x+rt,k.y+rt);g=Math.min(g,B.x),v=Math.min(v,B.y),b=Math.max(b,B.x),D=Math.max(D,B.y),u.push(B)}const I=this.grid.query(g,v,b,D).concat(this.ignoredGrid.query(g,v,b,D)),M={},R={};for(const k of I){const B=k.key;if(void 0===M[B.bucketInstanceId]&&(M[B.bucketInstanceId]={}),M[B.bucketInstanceId][B.featureIndex])continue;const $=[new d.pointGeometry(k.x1,k.y1),new d.pointGeometry(k.x2,k.y1),new d.pointGeometry(k.x2,k.y2),new d.pointGeometry(k.x1,k.y2)];d.polygonIntersectsPolygon(u,$)&&(M[B.bucketInstanceId][B.featureIndex]=!0,void 0===R[B.bucketInstanceId]&&(R[B.bucketInstanceId]=[]),R[B.bucketInstanceId].push(B.featureIndex))}return R}insertCollisionBox(a,u,g,v,b){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:v,collisionGroupID:b},a[0],a[1],a[2],a[3])}insertCollisionCircles(a,u,g,v,b){const D=u?this.ignoredGrid:this.grid,I={bucketInstanceId:g,featureIndex:v,collisionGroupID:b};for(let M=0;M<a.length;M+=4)D.insertCircle(I,a[M],a[M+1],a[M+2])}projectAndGetPerspectiveRatio(a,u,g,v,b,D,I){const M=[u,g,v,1];let R=!1;if(v||this.transform.pitch>0){d.transformMat4$1(M,M,a);const B="globe"===I.name;this.fogState&&b&&!B&&(R=function(Z,W,K,q,H,J){const Q=J.calculateFogTileMatrix(H),re=[W,K,q];return d.transformMat4(re,re,Q),Ea(Z,re,J.pitch,J._fov)}(this.fogState,u,g,v,b.toUnwrapped(),this.transform)>.9)}else si(M,M,a);const k=M[3];return{point:new d.pointGeometry((M[0]/k+1)/2*this.transform.width+rt,(-M[1]/k+1)/2*this.transform.height+rt),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(I)/k*.5,1.5),signedDistanceFromCamera:k,occluded:D&&M[2]>k||R}}isOffscreen(a,u,g,v){return g<rt||a>=this.screenRightBoundary||v<rt||u>this.screenBottomBoundary}isInsideGrid(a,u,g,v){return g>=0&&a<this.gridRightBoundary&&v>=0&&u<this.gridBottomBoundary}getViewportMatrix(){const a=d.identity([]);return d.translate(a,a,[-100,-100,0]),a}}function jt(f,a,u){const g=a.createTileMatrix(f,f.worldSize,u.toUnwrapped());return d.multiply(new Float32Array(16),f.projMatrix,g)}function Tn(f,a,u){if(a.projection.name===u.projection.name)return f.projMatrix;const g=u.clone();return g.setProjection(a.projection),jt(g,a.getProjection(),f)}function hc(f,a,u){return a.name===u.projection.name?f.projMatrix:jt(u,a,f)}class Wd{constructor(a,u,g,v){this.opacity=a?Math.max(0,Math.min(1,a.opacity+(a.placed?u:-u))):v&&g?1:0,this.placed=g}isHidden(){return 0===this.opacity&&!this.placed}}class Ws{constructor(a,u,g,v,b,D=!1){this.text=new Wd(a?a.text:null,u,g,b),this.icon=new Wd(a?a.icon:null,u,v,b),this.clipped=D}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Zs{constructor(a,u,g,v=!1){this.text=a,this.icon=u,this.skipFade=g,this.clipped=v}}class er{constructor(){this.invProjMatrix=d.create(),this.viewportMatrix=d.create(),this.circles=[]}}class Zd{constructor(a,u,g,v,b){this.bucketInstanceId=a,this.featureIndex=u,this.sourceLayerIndex=g,this.bucketIndex=v,this.tileID=b}}class Dr{constructor(a){this.crossSourceCollisions=a,this.maxGroupID=0,this.collisionGroups={}}get(a){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[a]){const u=++this.maxGroupID;this.collisionGroups[a]={ID:u,predicate:g=>g.collisionGroupID===u}}return this.collisionGroups[a]}}function ui(f,a,u,g,v){const{horizontalAlign:b,verticalAlign:D}=d.getAnchorAlignment(f),I=-(b-.5)*a,M=-(D-.5)*u,R=d.evaluateVariableOffset(f,g);return new d.pointGeometry(I+R[0]*v,M+R[1]*v)}function Gr(f,a,u,g,v){const b=new d.pointGeometry(f,a);return u&&b._rotate(g?v:-v),b}class Xd{constructor(a,u,g,v,b){this.transform=a.clone(),this.projection=a.projection.name,this.collisionIndex=new qs(this.transform,b),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new Dr(g),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(a,u,g,v){const b=g.getBucket(u),D=g.latestFeatureIndex;if(!b||!D||u.id!==b.layerIds[0])return;const I=b.layers[0].layout,M=g.collisionBoxArray,R=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),k=g.tileSize/d.EXTENT,B=g.tileID.toUnwrapped();this.transform.setProjection(b.projection);const $=(Z=g.tileID,W=b.getProjection(),K=this.transform,W.name===this.projection?K.calculateProjMatrix(Z.toUnwrapped()):jt(K,W,Z));var Z,W,K;const q="map"===I.get("text-pitch-alignment"),H="map"===I.get("text-rotation-alignment");u.compileFilter();const J=u.dynamicFilter(),Q=u.dynamicFilterNeedsFeature(),re=this.transform.calculatePixelsToTileUnitsMatrix(g),ue=_u($,g.tileID.canonical,q,H,this.transform,b.getProjection(),re);let ce=null;if(q){const Te=qd($,g.tileID.canonical,q,H,this.transform,b.getProjection(),re);ce=d.multiply([],this.transform.labelPlaneMatrix,Te)}let me=null;J&&g.latestFeatureIndex&&(me={unwrappedTileID:B,dynamicFilter:J,dynamicFilterNeedsFeature:Q,featureIndex:g.latestFeatureIndex}),this.retainedQueryData[b.bucketInstanceId]=new Zd(b.bucketInstanceId,D,b.sourceLayerIndex,b.index,g.tileID);const Se={bucket:b,layout:I,posMatrix:$,textLabelPlaneMatrix:ue,labelToScreenMatrix:ce,clippingData:me,scale:R,textPixelRatio:k,holdingForFade:g.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:d.evaluateSizeForZoom(b.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:d.evaluateSizeForZoom(b.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(v)for(const Te of b.sortKeyRanges){const{sortKey:_e,symbolInstanceStart:Ze,symbolInstanceEnd:xe}=Te;a.push({sortKey:_e,symbolInstanceStart:Ze,symbolInstanceEnd:xe,parameters:Se})}else a.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:Se})}attemptAnchorPlacement(a,u,g,v,b,D,I,M,R,k,B,$,Z,W,K,q,H,J){const{textOffset0:Q,textOffset1:re,crossTileID:ue}=$,ce=[Q,re],me=ui(a,g,v,ce,b),Se=this.collisionIndex.placeCollisionBox(W,b,u,Gr(me.x,me.y,D,I,this.transform.angle),B,M,R,k.predicate);if(q){const Te=W.getSymbolInstanceIconSize(J,this.transform.zoom,$.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(W,Te,q,Gr(me.x,me.y,D,I,this.transform.angle),B,M,R,k.predicate).box.length)return}if(Se.box.length>0){let Te;return this.prevPlacement&&this.prevPlacement.variableOffsets[ue]&&this.prevPlacement.placements[ue]&&this.prevPlacement.placements[ue].text&&(Te=this.prevPlacement.variableOffsets[ue].anchor),this.variableOffsets[ue]={textOffset:ce,width:g,height:v,anchor:a,textScale:b,prevAnchor:Te},this.markUsedJustification(W,a,$,K),W.allowVerticalPlacement&&(this.markUsedOrientation(W,K,$),this.placedOrientations[ue]=K),{shift:me,placedGlyphBoxes:Se}}}placeLayerBucketPart(a,u,g,v){const{bucket:b,layout:D,posMatrix:I,textLabelPlaneMatrix:M,labelToScreenMatrix:R,clippingData:k,textPixelRatio:B,holdingForFade:$,collisionBoxArray:Z,partiallyEvaluatedTextSize:W,partiallyEvaluatedIconSize:K,collisionGroup:q}=a.parameters,H=D.get("text-optional"),J=D.get("icon-optional"),Q=D.get("text-allow-overlap"),re=D.get("icon-allow-overlap"),ue="map"===D.get("text-rotation-alignment"),ce="map"===D.get("text-pitch-alignment"),me="none"!==D.get("icon-text-fit"),Se="viewport-y"===D.get("symbol-z-order");this.transform.setProjection(b.projection);let Te=Q&&(re||!b.hasIconData()||J),_e=re&&(Q||!b.hasTextData()||H);!b.collisionArrays&&Z&&b.deserializeCollisionBoxes(Z),g&&v&&b.updateCollisionDebugBuffers(this.transform.zoom,Z);const Ze=(xe,Le,Ce)=>{const{crossTileID:He,numVerticalGlyphVertices:Pe}=xe;if(k){const $n={zoom:this.transform.zoom,pitch:this.transform.pitch};let Nn=null;if(k.dynamicFilterNeedsFeature){const bn=this.retainedQueryData[b.bucketInstanceId];Nn=k.featureIndex.loadFeature({featureIndex:xe.featureIndex,bucketIndex:bn.bucketIndex,sourceLayerIndex:bn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,k.dynamicFilter)($n,Nn,this.retainedQueryData[b.bucketInstanceId].tileID.canonical,new d.pointGeometry(xe.tileAnchorX,xe.tileAnchorY),this.transform.calculateDistanceTileData(k.unwrappedTileID)))return this.placements[He]=new Zs(!1,!1,!1,!0),void(u[He]=!0)}if(u[He])return;if($)return void(this.placements[He]=new Zs(!1,!1,!1));let Fe=!1,Qe=!1,ge=!0,Ie=!1,ht=!1,wt=null,ft={box:null,offscreen:null,occluded:null},It={box:null,offscreen:null,occluded:null},Zt=null,mt=null,ut=null,xn=0,pn=0,kn=0;Ce.textFeatureIndex?xn=Ce.textFeatureIndex:xe.useRuntimeCollisionCircles&&(xn=xe.featureIndex),Ce.verticalTextFeatureIndex&&(pn=Ce.verticalTextFeatureIndex);const Cn=$n=>{$n.tileID=this.retainedQueryData[b.bucketInstanceId].tileID;const Nn=this.transform.elevation;(Nn||$n.elevation)&&($n.elevation=Nn?Nn.getAtTileOffset($n.tileID,$n.tileAnchorX,$n.tileAnchorY):0)},Hi=Ce.textBox;if(Hi){Cn(Hi);const $n=bn=>{let ii=d.WritingMode.horizontal;if(b.allowVerticalPlacement&&!bn&&this.prevPlacement){const yi=this.prevPlacement.placedOrientations[He];yi&&(this.placedOrientations[He]=yi,ii=yi,this.markUsedOrientation(b,ii,xe))}return ii},Nn=(bn,ii)=>{if(b.allowVerticalPlacement&&Pe>0&&Ce.verticalTextBox){for(const yi of b.writingModes)if(yi===d.WritingMode.vertical?(ft=ii(),It=ft):ft=bn(),ft&&ft.box&&ft.box.length)break}else ft=bn()};if(D.get("text-variable-anchor")){let bn=D.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[He]){const Gn=this.prevPlacement.variableOffsets[He];bn.indexOf(Gn.anchor)>0&&(bn=bn.filter(lr=>lr!==Gn.anchor),bn.unshift(Gn.anchor))}const ii=(Gn,lr,Pl)=>{const kr=b.getSymbolInstanceTextSize(W,xe,this.transform.zoom,Le),cr=(Gn.x2-Gn.x1)*kr+2*Gn.padding,uo=(Gn.y2-Gn.y1)*kr+2*Gn.padding,ho=me&&!re?lr:null;ho&&Cn(ho);let Qo={box:[],offscreen:!1,occluded:!1};const Ll=Q?2*bn.length:bn.length;for(let na=0;na<Ll;++na){const gr=this.attemptAnchorPlacement(bn[na%bn.length],Gn,cr,uo,kr,ue,ce,B,I,q,na>=bn.length,xe,Le,b,Pl,ho,W,K);if(gr&&(Qo=gr.placedGlyphBoxes,Qo&&Qo.box&&Qo.box.length)){Fe=!0,wt=gr.shift;break}}return Qo};Nn(()=>ii(Hi,Ce.iconBox,d.WritingMode.horizontal),()=>{const Gn=Ce.verticalTextBox;return Gn&&Cn(Gn),b.allowVerticalPlacement&&!(ft&&ft.box&&ft.box.length)&&Pe>0&&Gn?ii(Gn,Ce.verticalIconBox,d.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),ft&&(Fe=ft.box,ge=ft.offscreen,Ie=ft.occluded);const yi=$n(ft&&ft.box);if(!Fe&&this.prevPlacement){const Gn=this.prevPlacement.variableOffsets[He];Gn&&(this.variableOffsets[He]=Gn,this.markUsedJustification(b,Gn.anchor,xe,yi))}}else{const bn=(ii,yi)=>{const Gn=b.getSymbolInstanceTextSize(W,xe,this.transform.zoom,Le),lr=this.collisionIndex.placeCollisionBox(b,Gn,ii,new d.pointGeometry(0,0),Q,B,I,q.predicate);return lr&&lr.box&&lr.box.length&&(this.markUsedOrientation(b,yi,xe),this.placedOrientations[He]=yi),lr};Nn(()=>bn(Hi,d.WritingMode.horizontal),()=>{const ii=Ce.verticalTextBox;return b.allowVerticalPlacement&&Pe>0&&ii?(Cn(ii),bn(ii,d.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),$n(ft&&ft.box&&ft.box.length)}}if(Zt=ft,Fe=Zt&&Zt.box&&Zt.box.length>0,ge=Zt&&Zt.offscreen,Ie=Zt&&Zt.occluded,xe.useRuntimeCollisionCircles){const $n=b.text.placedSymbolArray.get(xe.centerJustifiedTextSymbolIndex>=0?xe.centerJustifiedTextSymbolIndex:xe.verticalPlacedTextSymbolIndex),Nn=d.evaluateSizeForFeature(b.textSizeData,W,$n),bn=D.get("text-padding");mt=this.collisionIndex.placeCollisionCircles(b,Q,$n,b.lineVertexArray,b.glyphOffsetArray,Nn,I,M,R,g,ce,q.predicate,xe.collisionCircleDiameter*Nn/d.ONE_EM,bn,this.retainedQueryData[b.bucketInstanceId].tileID),Fe=Q||mt.circles.length>0&&!mt.collisionDetected,ge=ge&&mt.offscreen,Ie=mt.occluded}if(Ce.iconFeatureIndex&&(kn=Ce.iconFeatureIndex),Ce.iconBox){const $n=Nn=>{Cn(Nn);const bn=me&&wt?Gr(wt.x,wt.y,ue,ce,this.transform.angle):new d.pointGeometry(0,0),ii=b.getSymbolInstanceIconSize(K,this.transform.zoom,xe.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(b,ii,Nn,bn,re,B,I,q.predicate)};It&&It.box&&It.box.length&&Ce.verticalIconBox?(ut=$n(Ce.verticalIconBox),Qe=ut.box.length>0):(ut=$n(Ce.iconBox),Qe=ut.box.length>0),ge=ge&&ut.offscreen,ht=ut.occluded}const Qr=H||0===xe.numHorizontalGlyphVertices&&0===Pe,ar=J||0===xe.numIconVertices;if(Qr||ar?ar?Qr||(Qe=Qe&&Fe):Fe=Qe&&Fe:Qe=Fe=Qe&&Fe,Fe&&Zt&&Zt.box&&this.collisionIndex.insertCollisionBox(Zt.box,D.get("text-ignore-placement"),b.bucketInstanceId,It&&It.box&&pn?pn:xn,q.ID),Qe&&ut&&this.collisionIndex.insertCollisionBox(ut.box,D.get("icon-ignore-placement"),b.bucketInstanceId,kn,q.ID),mt&&(Fe&&this.collisionIndex.insertCollisionCircles(mt.circles,D.get("text-ignore-placement"),b.bucketInstanceId,xn,q.ID),g)){const $n=b.bucketInstanceId;let Nn=this.collisionCircleArrays[$n];void 0===Nn&&(Nn=this.collisionCircleArrays[$n]=new er);for(let bn=0;bn<mt.circles.length;bn+=4)Nn.circles.push(mt.circles[bn+0]),Nn.circles.push(mt.circles[bn+1]),Nn.circles.push(mt.circles[bn+2]),Nn.circles.push(mt.collisionDetected?1:0)}const Do="globe"!==b.projection.name;Te=Te&&(Do||!Ie),_e=_e&&(Do||!ht),this.placements[He]=new Zs(Fe||Te,Qe||_e,ge||b.justReloaded),u[He]=!0};if(Se){const xe=b.getSortedSymbolIndexes(this.transform.angle);for(let Le=xe.length-1;Le>=0;--Le){const Ce=xe[Le];Ze(b.symbolInstances.get(Ce),Ce,b.collisionArrays[Ce])}}else for(let xe=a.symbolInstanceStart;xe<a.symbolInstanceEnd;xe++)Ze(b.symbolInstances.get(xe),xe,b.collisionArrays[xe]);if(g&&b.bucketInstanceId in this.collisionCircleArrays){const xe=this.collisionCircleArrays[b.bucketInstanceId];d.invert(xe.invProjMatrix,I),xe.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(a,u,g,v){const{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:D,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:M,crossTileID:R}=g,k=d.getAnchorJustification(u),B=v===d.WritingMode.vertical?M:"left"===k?b:"center"===k?D:"right"===k?I:-1;b>=0&&(a.text.placedSymbolArray.get(b).crossTileID=B>=0&&b!==B?0:R),D>=0&&(a.text.placedSymbolArray.get(D).crossTileID=B>=0&&D!==B?0:R),I>=0&&(a.text.placedSymbolArray.get(I).crossTileID=B>=0&&I!==B?0:R),M>=0&&(a.text.placedSymbolArray.get(M).crossTileID=B>=0&&M!==B?0:R)}markUsedOrientation(a,u,g){const v=u===d.WritingMode.horizontal||u===d.WritingMode.horizontalOnly?u:0,b=u===d.WritingMode.vertical?u:0,{leftJustifiedTextSymbolIndex:D,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:M,verticalPlacedTextSymbolIndex:R}=g,k=a.text.placedSymbolArray;D>=0&&(k.get(D).placedOrientation=v),I>=0&&(k.get(I).placedOrientation=v),M>=0&&(k.get(M).placedOrientation=v),R>=0&&(k.get(R).placedOrientation=b)}commit(a){this.commitTime=a,this.zoomAtLastRecencyCheck=this.transform.zoom;const u=this.prevPlacement;let g=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;const v=u?u.symbolFadeChange(a):1,b=u?u.opacities:{},D=u?u.variableOffsets:{},I=u?u.placedOrientations:{};for(const M in this.placements){const R=this.placements[M],k=b[M];k?(this.opacities[M]=new Ws(k,v,R.text,R.icon,null,R.clipped),g=g||R.text!==k.text.placed||R.icon!==k.icon.placed):(this.opacities[M]=new Ws(null,v,R.text,R.icon,R.skipFade,R.clipped),g=g||R.text||R.icon)}for(const M in b){const R=b[M];if(!this.opacities[M]){const k=new Ws(R,v,!1,!1);k.isHidden()||(this.opacities[M]=k,g=g||R.text.placed||R.icon.placed)}}for(const M in D)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=D[M]);for(const M in I)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=I[M]);g?this.lastPlacementChangeTime=a:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:a)}updateLayerOpacities(a,u){const g={};for(const v of u){const b=v.getBucket(a);b&&v.latestFeatureIndex&&a.id===b.layerIds[0]&&this.updateBucketOpacities(b,g,v.collisionBoxArray)}}updateBucketOpacities(a,u,g){a.hasTextData()&&a.text.opacityVertexArray.clear(),a.hasIconData()&&a.icon.opacityVertexArray.clear(),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexArray.clear(),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexArray.clear();const v=a.layers[0].layout,b=!!a.layers[0].dynamicFilter(),D=new Ws(null,0,!1,!1,!0),I=v.get("text-allow-overlap"),M=v.get("icon-allow-overlap"),R=v.get("text-variable-anchor"),k="map"===v.get("text-rotation-alignment"),B="map"===v.get("text-pitch-alignment"),$="none"!==v.get("icon-text-fit"),Z=new Ws(null,0,I&&(M||!a.hasIconData()||v.get("icon-optional")),M&&(I||!a.hasTextData()||v.get("text-optional")),!0);!a.collisionArrays&&g&&(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData())&&a.deserializeCollisionBoxes(g);const W=(q,H,J)=>{for(let Q=0;Q<H/4;Q++)q.opacityVertexArray.emplaceBack(J)};let K=0;for(let q=0;q<a.symbolInstances.length;q++){const H=a.symbolInstances.get(q),{numHorizontalGlyphVertices:J,numVerticalGlyphVertices:Q,crossTileID:re,numIconVertices:ue}=H;let ce=this.opacities[re];u[re]?ce=D:ce||(ce=Z,this.opacities[re]=ce),u[re]=!0;const me=J>0||Q>0,Se=ue>0,Te=this.placedOrientations[re],_e=Te===d.WritingMode.vertical,Ze=Te===d.WritingMode.horizontal||Te===d.WritingMode.horizontalOnly;if(!me&&!Se||ce.isHidden()||K++,me){const xe=Ut(ce.text);W(a.text,J,_e?pc:xe),W(a.text,Q,Ze?pc:xe);const Le=ce.text.isHidden(),{leftJustifiedTextSymbolIndex:Ce,centerJustifiedTextSymbolIndex:He,rightJustifiedTextSymbolIndex:Pe,verticalPlacedTextSymbolIndex:Fe}=H,Qe=a.text.placedSymbolArray,ge=Le||_e?1:0;Ce>=0&&(Qe.get(Ce).hidden=ge),He>=0&&(Qe.get(He).hidden=ge),Pe>=0&&(Qe.get(Pe).hidden=ge),Fe>=0&&(Qe.get(Fe).hidden=Le||Ze?1:0);const Ie=this.variableOffsets[re];Ie&&this.markUsedJustification(a,Ie.anchor,H,Te);const ht=this.placedOrientations[re];ht&&(this.markUsedJustification(a,"left",H,ht),this.markUsedOrientation(a,ht,H))}if(Se){const xe=Ut(ce.icon),{placedIconSymbolIndex:Le,verticalPlacedIconSymbolIndex:Ce}=H,He=a.icon.placedSymbolArray,Pe=ce.icon.isHidden()?1:0;Le>=0&&(W(a.icon,ue,_e?pc:xe),He.get(Le).hidden=Pe),Ce>=0&&(W(a.icon,H.numVerticalIconVertices,Ze?pc:xe),He.get(Ce).hidden=Pe)}if(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData()){const xe=a.collisionArrays[q];if(xe){let Le=new d.pointGeometry(0,0),Ce=!0;if(xe.textBox||xe.verticalTextBox){if(R){const Pe=this.variableOffsets[re];Pe?(Le=ui(Pe.anchor,Pe.width,Pe.height,Pe.textOffset,Pe.textScale),k&&Le._rotate(B?this.transform.angle:-this.transform.angle)):Ce=!1}b&&(Ce=!ce.clipped),xe.textBox&&tr(a.textCollisionBox.collisionVertexArray,ce.text.placed,!Ce||_e,Le.x,Le.y),xe.verticalTextBox&&tr(a.textCollisionBox.collisionVertexArray,ce.text.placed,!Ce||Ze,Le.x,Le.y)}const He=Ce&&Boolean(!Ze&&xe.verticalIconBox);xe.iconBox&&tr(a.iconCollisionBox.collisionVertexArray,ce.icon.placed,He,$?Le.x:0,$?Le.y:0),xe.verticalIconBox&&tr(a.iconCollisionBox.collisionVertexArray,ce.icon.placed,!He,$?Le.x:0,$?Le.y:0)}}}if(a.fullyClipped=0===K,a.sortFeatures(this.transform.angle),this.retainedQueryData[a.bucketInstanceId]&&(this.retainedQueryData[a.bucketInstanceId].featureSortOrder=a.featureSortOrder),a.hasTextData()&&a.text.opacityVertexBuffer&&a.text.opacityVertexBuffer.updateData(a.text.opacityVertexArray),a.hasIconData()&&a.icon.opacityVertexBuffer&&a.icon.opacityVertexBuffer.updateData(a.icon.opacityVertexArray),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexBuffer&&a.iconCollisionBox.collisionVertexBuffer.updateData(a.iconCollisionBox.collisionVertexArray),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexBuffer&&a.textCollisionBox.collisionVertexBuffer.updateData(a.textCollisionBox.collisionVertexArray),a.bucketInstanceId in this.collisionCircleArrays){const q=this.collisionCircleArrays[a.bucketInstanceId];a.placementInvProjMatrix=q.invProjMatrix,a.placementViewportMatrix=q.viewportMatrix,a.collisionCircleArray=q.circles,delete this.collisionCircleArrays[a.bucketInstanceId]}}symbolFadeChange(a){return 0===this.fadeDuration?1:(a-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(a){return Math.max(0,(this.transform.zoom-a)/1.5)}hasTransitions(a){return this.stale||a-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(a,u){const g=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*g>a}setStale(){this.stale=!0}}function tr(f,a,u,g,v){f.emplaceBack(a?1:0,u?1:0,g||0,v||0),f.emplaceBack(a?1:0,u?1:0,g||0,v||0),f.emplaceBack(a?1:0,u?1:0,g||0,v||0),f.emplaceBack(a?1:0,u?1:0,g||0,v||0)}const xo=Math.pow(2,25),zf=Math.pow(2,24),yu=Math.pow(2,17),Ei=Math.pow(2,16),dc=Math.pow(2,9),Kd=Math.pow(2,8),Bi=Math.pow(2,1);function Ut(f){if(0===f.opacity&&!f.placed)return 0;if(1===f.opacity&&f.placed)return 4294967295;const a=f.placed?1:0,u=Math.floor(127*f.opacity);return u*xo+a*zf+u*yu+a*Ei+u*dc+a*Kd+u*Bi+a}const pc=0;class Yd{constructor(a){this._sortAcrossTiles="viewport-y"!==a.layout.get("symbol-z-order")&&void 0!==a.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(a,u,g,v,b){const D=this._bucketParts;for(;this._currentTileIndex<a.length;)if(u.getBucketParts(D,v,a[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,D.sort((I,M)=>I.sortKey-M.sortKey));this._currentPartIndex<D.length;){const I=D[this._currentPartIndex];if(u.placeLayerBucketPart(I,this._seenCrossTileIDs,g,0===I.symbolInstanceStart),this._currentPartIndex++,b())return!0}return!1}}class Xs{constructor(a,u,g,v,b,D,I,M){this.placement=new Xd(a,b,D,I,M),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(a,u,g){const v=d.exported.now(),b=()=>{const D=d.exported.now()-v;return!this._forceFullPlacement&&D>2};for(;this._currentPlacementIndex>=0;){const D=u[a[this._currentPlacementIndex]],I=this.placement.collisionIndex.transform.zoom;if("symbol"===D.type&&(!D.minzoom||D.minzoom<=I)&&(!D.maxzoom||D.maxzoom>I)){if(this._inProgressLayer||(this._inProgressLayer=new Yd(D)),this._inProgressLayer.continuePlacement(g[D.source],this.placement,this._showCollisionBoxes,D,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(a){return this.placement.commit(a),this.placement}}const Sn=512/d.EXTENT/2;class Rh{constructor(a,u,g){this.tileID=a,this.indexedSymbolInstances={},this.bucketInstanceId=g;for(let v=0;v<u.length;v++){const b=u.get(v),D=b.key;this.indexedSymbolInstances[D]||(this.indexedSymbolInstances[D]=[]),this.indexedSymbolInstances[D].push({crossTileID:b.crossTileID,coord:this.getScaledCoordinates(b,a)})}}getScaledCoordinates(a,u){const g=Sn/Math.pow(2,u.canonical.z-this.tileID.canonical.z);return{x:Math.floor((u.canonical.x*d.EXTENT+a.tileAnchorX)*g),y:Math.floor((u.canonical.y*d.EXTENT+a.tileAnchorY)*g)}}findMatches(a,u,g){const v=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z);for(let b=0;b<a.length;b++){const D=a.get(b);if(D.crossTileID)continue;const I=this.indexedSymbolInstances[D.key];if(!I)continue;const M=this.getScaledCoordinates(D,u);for(const R of I)if(Math.abs(R.coord.x-M.x)<=v&&Math.abs(R.coord.y-M.y)<=v&&!g[R.crossTileID]){g[R.crossTileID]=!0,D.crossTileID=R.crossTileID;break}}}}class Hr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class hl{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(a){const u=Math.round((a-this.lng)/360);if(0!==u)for(const g in this.indexes){const v=this.indexes[g],b={};for(const D in v){const I=v[D];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+u),b[I.tileID.key]=I}this.indexes[g]=b}this.lng=a}addBucket(a,u,g){if(this.indexes[a.overscaledZ]&&this.indexes[a.overscaledZ][a.key]){if(this.indexes[a.overscaledZ][a.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(a.overscaledZ,this.indexes[a.overscaledZ][a.key])}for(let b=0;b<u.symbolInstances.length;b++)u.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[a.overscaledZ]||(this.usedCrossTileIDs[a.overscaledZ]={});const v=this.usedCrossTileIDs[a.overscaledZ];for(const b in this.indexes){const D=this.indexes[b];if(Number(b)>a.overscaledZ)for(const I in D){const M=D[I];M.tileID.isChildOf(a)&&M.findMatches(u.symbolInstances,a,v)}else{const I=D[a.scaledTo(Number(b)).key];I&&I.findMatches(u.symbolInstances,a,v)}}for(let b=0;b<u.symbolInstances.length;b++){const D=u.symbolInstances.get(b);D.crossTileID||(D.crossTileID=g.generate(),v[D.crossTileID]=!0)}return void 0===this.indexes[a.overscaledZ]&&(this.indexes[a.overscaledZ]={}),this.indexes[a.overscaledZ][a.key]=new Rh(a,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(a,u){for(const g in u.indexedSymbolInstances)for(const v of u.indexedSymbolInstances[g])delete this.usedCrossTileIDs[a][v.crossTileID]}removeStaleBuckets(a){let u=!1;for(const g in this.indexes){const v=this.indexes[g];for(const b in v)a[v[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,v[b]),delete v[b],u=!0)}return u}}class dl{constructor(){this.layerIndexes={},this.crossTileIDs=new Hr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(a,u,g,v){let b=this.layerIndexes[a.id];void 0===b&&(b=this.layerIndexes[a.id]=new hl);let D=!1;const I={};"globe"!==v.name&&b.handleWrapJump(g);for(const M of u){const R=M.getBucket(a);R&&a.id===R.layerIds[0]&&(R.bucketInstanceId||(R.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(M.tileID,R,this.crossTileIDs)&&(D=!0),I[R.bucketInstanceId]=!0)}return b.removeStaleBuckets(I)&&(D=!0),D}pruneUnusedLayers(a){const u={};a.forEach(g=>{u[g]=!0});for(const g in this.layerIndexes)u[g]||delete this.layerIndexes[g]}}const fc=(f,a)=>d.emitValidationErrors(f,a&&a.filter(u=>"source.canvas"!==u.identifier)),Qd=d.pick(xt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),pl=d.pick(xt,["setCenter","setZoom","setBearing","setPitch"]),vs={version:8,layers:[],sources:{}},Aa={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Ti extends d.Evented{constructor(a,u={}){super(),this.map=a,this.dispatcher=new fs(Lt(),this),this.imageManager=new va,this.imageManager.setEventedParent(this),this.glyphManager=new d.GlyphManager(a._requestManager,u.localFontFamily?d.LocalGlyphMode.all:u.localIdeographFontFamily?d.LocalGlyphMode.ideographs:d.LocalGlyphMode.none,u.localFontFamily||u.localIdeographFontFamily),this.crossTileSymbolIndex=new dl,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",d.getReferrer());const g=this;this._rtlTextPluginCallback=Ti.registerForPluginStateChange(v=>{g.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(b,D)=>{if(d.triggerPluginCompletionEvent(b),D&&D.every(I=>I))for(const I in g._sourceCaches){const M=g._sourceCaches[I],R=M.getSource().type;"vector"!==R&&"geojson"!==R||M.reload()}})}),this.on("data",v=>{if("source"!==v.dataType||"metadata"!==v.sourceDataType)return;const b=this.getSource(v.sourceId);if(b&&b.vectorLayerIds)for(const D in this._layers){const I=this._layers[D];I.source===b.id&&this._validateLayer(I)}})}loadURL(a,u={}){this.fire(new d.Event("dataloading",{dataType:"style"}));const g="boolean"==typeof u.validate?u.validate:!d.isMapboxURL(a);a=this.map._requestManager.normalizeStyleURL(a,u.accessToken);const v=this.map._requestManager.transformRequest(a,d.ResourceType.Style);this._request=d.getJSON(v,(b,D)=>{this._request=null,b?this.fire(new d.ErrorEvent(b)):D&&this._load(D,g)})}loadJSON(a,u={}){this.fire(new d.Event("dataloading",{dataType:"style"})),this._request=d.exported.frame(()=>{this._request=null,this._load(a,!1!==u.validate)})}loadEmpty(){this.fire(new d.Event("dataloading",{dataType:"style"})),this._load(vs,!1)}_updateLayerCount(a,u){const g=u?1:-1;a.is3D()&&(this._num3DLayers+=g),"circle"===a.type&&(this._numCircleLayers+=g),"symbol"===a.type&&(this._numSymbolLayers+=g)}_load(a,u){if(u&&fc(this,d.validateStyle(a)))return;this._loaded=!0,this.stylesheet=d.clone$1(a),this._updateMapProjection();for(const v in a.sources)this.addSource(v,a.sources[v],{validate:!1});this._changed=!1,a.sprite?this._loadSprite(a.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(a.glyphs);const g=Dn(this.stylesheet.layers);this._order=g.map(v=>v.id),this._layers={},this._serializedLayers={};for(let v of g)v=d.createStyleLayer(v),v.setEventedParent(this,{layer:{id:v.id}}),this._layers[v.id]=v,this._serializedLayers[v.id]=v.serialize(),this._updateLayerCount(v,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new ba(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new d.Event("data",{dataType:"style"})),this.fire(new d.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(a){a?this.stylesheet.projection=a:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(a){this._spriteRequest=function(u,g,v){let b,D,I;const M=d.exported.devicePixelRatio>1?"@2x":"";let R=d.getJSON(g.transformRequest(g.normalizeSpriteURL(u,M,".json"),d.ResourceType.SpriteJSON),($,Z)=>{R=null,I||(I=$,b=Z,B())}),k=d.getImage(g.transformRequest(g.normalizeSpriteURL(u,M,".png"),d.ResourceType.SpriteImage),($,Z)=>{k=null,I||(I=$,D=Z,B())});function B(){if(I)v(I);else if(b&&D){const $=d.exported.getImageData(D),Z={};for(const W in b){const{width:K,height:q,x:H,y:J,sdf:Q,pixelRatio:re,stretchX:ue,stretchY:ce,content:me}=b[W],Se=new d.RGBAImage({width:K,height:q});d.RGBAImage.copy($,Se,{x:H,y:J},{x:0,y:0},{width:K,height:q}),Z[W]={data:Se,pixelRatio:re,sdf:Q,stretchX:ue,stretchY:ce,content:me}}v(null,Z)}}return{cancel(){R&&(R.cancel(),R=null),k&&(k.cancel(),k=null)}}}(a,this.map._requestManager,(u,g)=>{if(this._spriteRequest=null,u)this.fire(new d.ErrorEvent(u));else if(g)for(const v in g)this.imageManager.addImage(v,g[v]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new d.Event("data",{dataType:"style"}))})}_validateLayer(a){const u=this.getSource(a.source);if(!u)return;const g=a.sourceLayer;g&&("geojson"===u.type||u.vectorLayerIds&&-1===u.vectorLayerIds.indexOf(g))&&this.fire(new d.ErrorEvent(new Error(`Source layer "${g}" does not exist on source "${u.id}" as specified by style layer "${a.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const a in this._sourceCaches)if(!this._sourceCaches[a].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(a){const u=[];for(const g of a){const v=this._layers[g];"custom"!==v.type&&u.push(v.serialize())}return u}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const a in this._sourceCaches)if(this._sourceCaches[a].hasTransition())return!0;for(const a in this._layers)if(this._layers[a].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(a){return!!this.terrain&&Aa[a.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(a){if(!this._loaded)return;const u=this._changed;if(this._changed){const v=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(v.length||b.length)&&this._updateWorkerLayers(v,b);for(const D in this._updatedSources){const I=this._updatedSources[D];"reload"===I?this._reloadSource(D):"clear"===I&&this._clearSource(D)}this._updateTilesForChangedImages();for(const D in this._updatedPaintProps)this._layers[D].updateTransitions(a);this.light.updateTransitions(a),this.fog&&this.fog.updateTransitions(a),this._resetUpdates()}const g={};for(const v in this._sourceCaches){const b=this._sourceCaches[v];g[v]=b.used,b.used=!1}for(const v of this._order){const b=this._layers[v];if(b.recalculate(a,this._availableImages),!b.isHidden(a.zoom)){const I=this._getLayerSourceCache(b);I&&(I.used=!0)}const D=this.map.painter;if(D){const I=b.getProgramIds();if(!I)continue;const M=b.getProgramConfiguration(a.zoom);for(const R of I)D.useProgram(R,M)}}for(const v in g){const b=this._sourceCaches[v];g[v]!==b.used&&b.getSource().fire(new d.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:b.getSource().id}))}this.light.recalculate(a),this.terrain&&this.terrain.recalculate(a),this.fog&&this.fog.recalculate(a),this.z=a.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),u&&this.fire(new d.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const a=Object.keys(this._changedImages);if(a.length){for(const u in this._sourceCaches)this._sourceCaches[u].reloadTilesForDependencies(["icons","patterns"],a);this._changedImages={}}}_updateWorkerLayers(a,u){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(a),removedIds:u})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(a){if(this._checkLoaded(),fc(this,d.validateStyle(a)))return!1;(a=d.clone$1(a)).layers=Dn(a.layers);const u=function(v,b){if(!v)return[{command:xt.setStyle,args:[b]}];let D=[];try{if(!Ue(v.version,b.version))return[{command:xt.setStyle,args:[b]}];Ue(v.center,b.center)||D.push({command:xt.setCenter,args:[b.center]}),Ue(v.zoom,b.zoom)||D.push({command:xt.setZoom,args:[b.zoom]}),Ue(v.bearing,b.bearing)||D.push({command:xt.setBearing,args:[b.bearing]}),Ue(v.pitch,b.pitch)||D.push({command:xt.setPitch,args:[b.pitch]}),Ue(v.sprite,b.sprite)||D.push({command:xt.setSprite,args:[b.sprite]}),Ue(v.glyphs,b.glyphs)||D.push({command:xt.setGlyphs,args:[b.glyphs]}),Ue(v.transition,b.transition)||D.push({command:xt.setTransition,args:[b.transition]}),Ue(v.light,b.light)||D.push({command:xt.setLight,args:[b.light]}),Ue(v.fog,b.fog)||D.push({command:xt.setFog,args:[b.fog]}),Ue(v.projection,b.projection)||D.push({command:xt.setProjection,args:[b.projection]});const I={},M=[];!function(B,$,Z,W){let K;for(K in $=$||{},B=B||{})B.hasOwnProperty(K)&&($.hasOwnProperty(K)||Wn(K,Z,W));for(K in $)$.hasOwnProperty(K)&&(B.hasOwnProperty(K)?Ue(B[K],$[K])||("geojson"===B[K].type&&"geojson"===$[K].type&&gs(B,$,K)?Z.push({command:xt.setGeoJSONSourceData,args:[K,$[K].data]}):Wo(K,$,Z,W)):Un(K,$,Z))}(v.sources,b.sources,M,I);const R=[];v.layers&&v.layers.forEach(B=>{B.source&&I[B.source]?D.push({command:xt.removeLayer,args:[B.id]}):R.push(B)});let k=v.terrain;k&&I[k.source]&&(D.push({command:xt.setTerrain,args:[void 0]}),k=void 0),D=D.concat(M),Ue(k,b.terrain)||D.push({command:xt.setTerrain,args:[b.terrain]}),function(B,$,Z){$=$||[];const W=(B=B||[]).map(Re),K=$.map(Re),q=B.reduce(_s,{}),H=$.reduce(_s,{}),J=W.slice(),Q=Object.create(null);let re,ue,ce,me,Se,Te,_e;for(re=0,ue=0;re<W.length;re++)ce=W[re],H.hasOwnProperty(ce)?ue++:(Z.push({command:xt.removeLayer,args:[ce]}),J.splice(J.indexOf(ce,ue),1));for(re=0,ue=0;re<K.length;re++)ce=K[K.length-1-re],J[J.length-1-re]!==ce&&(q.hasOwnProperty(ce)?(Z.push({command:xt.removeLayer,args:[ce]}),J.splice(J.lastIndexOf(ce,J.length-ue),1)):ue++,Te=J[J.length-re],Z.push({command:xt.addLayer,args:[H[ce],Te]}),J.splice(J.length-re,0,ce),Q[ce]=!0);for(re=0;re<K.length;re++)if(ce=K[re],me=q[ce],Se=H[ce],!Q[ce]&&!Ue(me,Se))if(Ue(me.source,Se.source)&&Ue(me["source-layer"],Se["source-layer"])&&Ue(me.type,Se.type)){for(_e in jr(me.layout,Se.layout,Z,ce,null,xt.setLayoutProperty),jr(me.paint,Se.paint,Z,ce,null,xt.setPaintProperty),Ue(me.filter,Se.filter)||Z.push({command:xt.setFilter,args:[ce,Se.filter]}),Ue(me.minzoom,Se.minzoom)&&Ue(me.maxzoom,Se.maxzoom)||Z.push({command:xt.setLayerZoomRange,args:[ce,Se.minzoom,Se.maxzoom]}),me)me.hasOwnProperty(_e)&&"layout"!==_e&&"paint"!==_e&&"filter"!==_e&&"metadata"!==_e&&"minzoom"!==_e&&"maxzoom"!==_e&&(0===_e.indexOf("paint.")?jr(me[_e],Se[_e],Z,ce,_e.slice(6),xt.setPaintProperty):Ue(me[_e],Se[_e])||Z.push({command:xt.setLayerProperty,args:[ce,_e,Se[_e]]}));for(_e in Se)Se.hasOwnProperty(_e)&&!me.hasOwnProperty(_e)&&"layout"!==_e&&"paint"!==_e&&"filter"!==_e&&"metadata"!==_e&&"minzoom"!==_e&&"maxzoom"!==_e&&(0===_e.indexOf("paint.")?jr(me[_e],Se[_e],Z,ce,_e.slice(6),xt.setPaintProperty):Ue(me[_e],Se[_e])||Z.push({command:xt.setLayerProperty,args:[ce,_e,Se[_e]]}))}else Z.push({command:xt.removeLayer,args:[ce]}),Te=J[J.lastIndexOf(ce)+1],Z.push({command:xt.addLayer,args:[Se,Te]})}(R,b.layers,D)}catch(I){console.warn("Unable to compute style diff:",I),D=[{command:xt.setStyle,args:[b]}]}return D}(this.serialize(),a).filter(v=>!(v.command in pl));if(0===u.length)return!1;const g=u.filter(v=>!(v.command in Qd));if(g.length>0)throw new Error(`Unimplemented: ${g.map(v=>v.command).join(", ")}.`);return u.forEach(v=>{"setTransition"!==v.command&&"setProjection"!==v.command&&this[v.command].apply(this,v.args)}),this.stylesheet=a,this._updateMapProjection(),!0}addImage(a,u){return this.getImage(a)?this.fire(new d.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(a,u),this._afterImageUpdated(a),this)}updateImage(a,u){this.imageManager.updateImage(a,u)}getImage(a){return this.imageManager.getImage(a)}removeImage(a){return this.getImage(a)?(this.imageManager.removeImage(a),this._afterImageUpdated(a),this):this.fire(new d.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(a){this._availableImages=this.imageManager.listImages(),this._changedImages[a]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new d.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(a,u,g={}){if(this._checkLoaded(),void 0!==this.getSource(a))throw new Error("There is already a source with this ID");if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(d.validateSource,`sources.${a}`,u,null,g))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);const v=ye(a,u,this.dispatcher,this);v.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(a),source:v.serialize(),sourceId:a}));const b=D=>{const I=(D?"symbol:":"other:")+a,M=this._sourceCaches[I]=new d.SourceCache(I,v,D);(D?this._symbolSourceCaches:this._otherSourceCaches)[a]=M,M.style=this,M.onAdd(this.map)};b(!1),"vector"!==u.type&&"geojson"!==u.type||b(!0),v.onAdd&&v.onAdd(this.map),this._changed=!0}removeSource(a){this._checkLoaded();const u=this.getSource(a);if(!u)throw new Error("There is no source with this ID");for(const v in this._layers)if(this._layers[v].source===a)return this.fire(new d.ErrorEvent(new Error(`Source "${a}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.get().source===a)return this.fire(new d.ErrorEvent(new Error(`Source "${a}" cannot be removed while terrain is using it.`)));const g=this._getSourceCaches(a);for(const v of g)delete this._sourceCaches[v.id],delete this._updatedSources[v.id],v.fire(new d.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles();return delete this._otherSourceCaches[a],delete this._symbolSourceCaches[a],u.setEventedParent(null),u.onRemove&&u.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(a,u){this._checkLoaded(),this.getSource(a).setData(u),this._changed=!0}getSource(a){const u=this._getSourceCache(a);return u&&u.getSource()}_getSources(){const a=[];for(const u in this._otherSourceCaches){const g=this._getSourceCache(u);g&&a.push(g.getSource())}return a}addLayer(a,u,g={}){this._checkLoaded();const v=a.id;if(this.getLayer(v))return void this.fire(new d.ErrorEvent(new Error(`Layer with id "${v}" already exists on this map`)));let b;if("custom"===a.type){if(fc(this,d.validateCustomStyleLayer(a)))return;b=d.createStyleLayer(a)}else{if("object"==typeof a.source&&(this.addSource(v,a.source),a=d.clone$1(a),a=d.extend(a,{source:v})),this._validate(d.validateLayer,`layers.${v}`,a,{arrayIndex:-1},g))return;b=d.createStyleLayer(a),this._validateLayer(b),b.setEventedParent(this,{layer:{id:v}}),this._serializedLayers[b.id]=b.serialize(),this._updateLayerCount(b,!0)}const D=u?this._order.indexOf(u):this._order.length;if(u&&-1===D)return void this.fire(new d.ErrorEvent(new Error(`Layer with id "${u}" does not exist on this map.`)));this._order.splice(D,0,v),this._layerOrderChanged=!0,this._layers[v]=b;const I=this._getLayerSourceCache(b);if(this._removedLayers[v]&&b.source&&I&&"custom"!==b.type){const M=this._removedLayers[v];delete this._removedLayers[v],M.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",I.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(a,u){if(this._checkLoaded(),this._changed=!0,!this._layers[a])return void this.fire(new d.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be moved.`)));if(a===u)return;const g=this._order.indexOf(a);this._order.splice(g,1);const v=u?this._order.indexOf(u):this._order.length;u&&-1===v?this.fire(new d.ErrorEvent(new Error(`Layer with id "${u}" does not exist on this map.`))):(this._order.splice(v,0,a),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(a){this._checkLoaded();const u=this._layers[a];if(!u)return void this.fire(new d.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be removed.`)));u.setEventedParent(null),this._updateLayerCount(u,!1);const g=this._order.indexOf(a);this._order.splice(g,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[a]=u,delete this._layers[a],delete this._serializedLayers[a],delete this._updatedLayers[a],delete this._updatedPaintProps[a],u.onRemove&&u.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(a){return this._layers[a]}hasLayer(a){return a in this._layers}hasLayerType(a){for(const u in this._layers)if(this._layers[u].type===a)return!0;return!1}setLayerZoomRange(a,u,g){this._checkLoaded();const v=this.getLayer(a);v?v.minzoom===u&&v.maxzoom===g||(null!=u&&(v.minzoom=u),null!=g&&(v.maxzoom=g),this._updateLayer(v)):this.fire(new d.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(a,u,g={}){this._checkLoaded();const v=this.getLayer(a);if(v){if(!Ue(v.filter,u))return null==u?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(d.validateFilter,`layers.${v.id}.filter`,u,{layerType:v.type},g)||(v.filter=d.clone$1(u),this._updateLayer(v)))}else this.fire(new d.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be filtered.`)))}getFilter(a){const u=this.getLayer(a);return u&&d.clone$1(u.filter)}setLayoutProperty(a,u,g,v={}){this._checkLoaded();const b=this.getLayer(a);b?Ue(b.getLayoutProperty(u),g)||(b.setLayoutProperty(u,g,v),this._updateLayer(b)):this.fire(new d.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(a,u){const g=this.getLayer(a);if(g)return g.getLayoutProperty(u);this.fire(new d.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style.`)))}setPaintProperty(a,u,g,v={}){this._checkLoaded();const b=this.getLayer(a);b?Ue(b.getPaintProperty(u),g)||(b.setPaintProperty(u,g,v)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[a]=!0):this.fire(new d.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(a,u){const g=this.getLayer(a);return g&&g.getPaintProperty(u)}setFeatureState(a,u){this._checkLoaded();const g=a.source,v=a.sourceLayer,b=this.getSource(g);if(!b)return void this.fire(new d.ErrorEvent(new Error(`The source '${g}' does not exist in the map's style.`)));const D=b.type;if("geojson"===D&&v)return void this.fire(new d.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===D&&!v)return void this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===a.id&&this.fire(new d.ErrorEvent(new Error("The feature id parameter must be provided.")));const I=this._getSourceCaches(g);for(const M of I)M.setFeatureState(v,a.id,u)}removeFeatureState(a,u){this._checkLoaded();const g=a.source,v=this.getSource(g);if(!v)return void this.fire(new d.ErrorEvent(new Error(`The source '${g}' does not exist in the map's style.`)));const b=v.type,D="vector"===b?a.sourceLayer:void 0;if("vector"===b&&!D)return void this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(u&&"string"!=typeof a.id&&"number"!=typeof a.id)return void this.fire(new d.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const I=this._getSourceCaches(g);for(const M of I)M.removeFeatureState(D,a.id,u)}getFeatureState(a){this._checkLoaded();const u=a.source,g=a.sourceLayer,v=this.getSource(u);if(v){if("vector"!==v.type||g)return void 0===a.id&&this.fire(new d.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(u)[0].getFeatureState(g,a.id);this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new d.ErrorEvent(new Error(`The source '${u}' does not exist in the map's style.`)))}getTransition(){return d.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const a={};for(const u in this._sourceCaches){const g=this._sourceCaches[u].getSource();a[g.id]||(a[g.id]=g.serialize())}return d.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:a,layers:this._serializeLayers(this._order)},u=>void 0!==u)}_updateLayer(a){this._updatedLayers[a.id]=!0;const u=this._getLayerSourceCache(a);a.source&&!this._updatedSources[a.source]&&u&&"raster"!==u.getSource().type&&(this._updatedSources[a.source]="reload",u.pause()),this._changed=!0,a.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(a){const u=D=>"fill-extrusion"===this._layers[D].type,g={},v=[];for(let D=this._order.length-1;D>=0;D--){const I=this._order[D];if(u(I)){g[I]=D;for(const M of a){const R=M[I];if(R)for(const k of R)v.push(k)}}}v.sort((D,I)=>I.intersectionZ-D.intersectionZ);const b=[];for(let D=this._order.length-1;D>=0;D--){const I=this._order[D];if(u(I))for(let M=v.length-1;M>=0;M--){const R=v[M].feature;if(g[R.layer.id]<D)break;b.push(R),v.pop()}else for(const M of a){const R=M[I];if(R)for(const k of R)b.push(k.feature)}}return b}queryRenderedFeatures(a,u,g){u&&u.filter&&this._validate(d.validateFilter,"queryRenderedFeatures.filter",u.filter,null,u);const v={};if(u&&u.layers){if(!Array.isArray(u.layers))return this.fire(new d.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const M of u.layers){const R=this._layers[M];if(!R)return this.fire(new d.ErrorEvent(new Error(`The layer '${M}' does not exist in the map's style and cannot be queried for features.`))),[];v[R.source]=!0}}const b=[];u.availableImages=this._availableImages;const D=u&&u.layers?u.layers.some(M=>{const R=this.getLayer(M);return R&&R.is3D()}):this.has3DLayers(),I=$o.createFromScreenPoints(a,g);for(const M in this._sourceCaches){const R=this._sourceCaches[M].getSource().id;u.layers&&!v[R]||b.push(we(this._sourceCaches[M],this._layers,this._serializedLayers,I,u,g,D,!!this.map._showQueryGeometry))}return this.placement&&b.push(function(M,R,k,B,$,Z,W){const K={},q=Z.queryRenderedSymbols(B),H=[];for(const J of Object.keys(q).map(Number))H.push(W[J]);H.sort(it);for(const J of H){const Q=J.featureIndex.lookupSymbolFeatures(q[J.bucketInstanceId],R,J.bucketIndex,J.sourceLayerIndex,$.filter,$.layers,$.availableImages,M);for(const re in Q){const ue=K[re]=K[re]||[],ce=Q[re];ce.sort((me,Se)=>{const Te=J.featureSortOrder;if(Te){const _e=Te.indexOf(me.featureIndex);return Te.indexOf(Se.featureIndex)-_e}return Se.featureIndex-me.featureIndex});for(const me of ce)ue.push(me)}}for(const J in K)K[J].forEach(Q=>{const re=Q.feature,ue=k(M[J]).getFeatureState(re.layer["source-layer"],re.id);re.source=re.layer.source,re.layer["source-layer"]&&(re.sourceLayer=re.layer["source-layer"]),re.state=ue});return K}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),I.screenGeometry,u,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(a,u){u&&u.filter&&this._validate(d.validateFilter,"querySourceFeatures.filter",u.filter,null,u);const g=this._getSourceCaches(a);let v=[];for(const b of g)v=v.concat(je(b,u));return v}addSourceType(a,u,g){return Ti.getSourceType(a)?g(new Error(`A source type called "${a}" already exists.`)):(Ti.setSourceType(a,u),u.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:a,url:u.workerSourceURL},g):g(null,null))}getLight(){return this.light.getLight()}setLight(a,u={}){this._checkLoaded();const g=this.light.getLight();let v=!1;for(const D in a)if(!Ue(a[D],g[D])){v=!0;break}if(!v)return;const b=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(a,u),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(a,u=1){if(this._checkLoaded(),!a)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===u){if("object"==typeof a.source){const g="terrain-dem-src";this.addSource(g,a.source),a=d.clone$1(a),a=d.extend(a,{source:g})}if(this._validate(d.validateTerrain,"terrain",a))return}if(!this.terrain||this.terrain&&u!==this.terrain.drapeRenderMode)this._createTerrain(a,u);else{const g=this.terrain,v=g.get();for(const b of Object.keys(d.spec.terrain))!a.hasOwnProperty(b)&&d.spec.terrain[b].default&&(a[b]=d.spec.terrain[b].default);for(const b in a)if(!Ue(a[b],v[b])){g.set(a),this.stylesheet.terrain=a;const D=this._setTransitionParameters({duration:0});g.updateTransitions(D);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(a){const u=this.fog=new Jl(a,this.map.transform);this.stylesheet.fog=a;const g=this._setTransitionParameters({duration:0});u.updateTransitions(g)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const a of this.map._markers)a._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(a){if(this._checkLoaded(),!a)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const u=this.fog,g=u.get();0===Object.keys(a).length&&u.set(a);for(const v in a)if(!Ue(a[v],g[v])){u.set(a),this.stylesheet.fog=a;const b=this._setTransitionParameters({duration:0});u.updateTransitions(b);break}}else this._createFog(a);this._markersNeedUpdate=!0}_setTransitionParameters(a){return{now:d.exported.now(),transition:d.extend(a,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const a=this._order.filter(g=>this.isLayerDraped(this._layers[g])),u=this._order.filter(g=>!this.isLayerDraped(this._layers[g]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...a),this._drapedFirstOrder.push(...u)}_createTerrain(a,u){const g=this.terrain=new Fs(a,u);this.stylesheet.terrain=a,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const v=this._setTransitionParameters({duration:0});g.updateTransitions(v)}_force3DLayerUpdate(){for(const a in this._layers){const u=this._layers[a];"fill-extrusion"===u.type&&this._updateLayer(u)}}_forceSymbolLayerUpdate(){for(const a in this._layers){const u=this._layers[a];"symbol"===u.type&&this._updateLayer(u)}}_validate(a,u,g,v,b={}){return(!b||!1!==b.validate)&&fc(this,a.call(d.validateStyle,d.extend({key:u,style:this.serialize(),value:g,styleSpec:d.spec},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),d.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this._sourceCaches)this._sourceCaches[a].clearTiles(),this._sourceCaches[a].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(a){const u=this._getSourceCaches(a);for(const g of u)g.clearTiles()}_reloadSource(a){const u=this._getSourceCaches(a);for(const g of u)g.resume(),g.reload()}_reloadSources(){for(const a of this._getSources())a.reload&&a.reload()}_updateSources(a){for(const u in this._sourceCaches)this._sourceCaches[u].update(a)}_generateCollisionBoxes(){for(const a in this._sourceCaches){const u=this._sourceCaches[a];u.resume(),u.reload()}}_updatePlacement(a,u,g,v,b=!1){let D=!1,I=!1;const M={};for(const R of this._order){const k=this._layers[R];if("symbol"!==k.type)continue;if(!M[k.source]){const $=this._getLayerSourceCache(k);if(!$)continue;M[k.source]=$.getRenderableIds(!0).map(Z=>$.getTileByID(Z)).sort((Z,W)=>W.tileID.overscaledZ-Z.tileID.overscaledZ||(Z.tileID.isLessThan(W.tileID)?-1:1))}const B=this.crossTileSymbolIndex.addLayer(k,M[k.source],a.center.lng,a.projection);D=D||B}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),b=b||this._layerOrderChanged||0===g,this._layerOrderChanged&&this.fire(new d.Event("neworder")),(b||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(d.exported.now(),a.zoom))&&(this.pauseablePlacement=new Xs(a,this._order,b,u,g,v,this.placement,this.fog&&a.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,M),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(d.exported.now()),I=!0),D&&this.pauseablePlacement.placement.setStale()),I||D)for(const R of this._order){const k=this._layers[R];"symbol"===k.type&&this.placement.updateLayerOpacities(k,M[k.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(d.exported.now())}_releaseSymbolFadeTiles(){for(const a in this._sourceCaches)this._sourceCaches[a].releaseSymbolFadeTiles()}getImages(a,u,g){this.imageManager.getImages(u.icons,g),this._updateTilesForChangedImages();const v=b=>{b&&b.setDependencies(u.tileID.key,u.type,u.icons)};v(this._otherSourceCaches[u.source]),v(this._symbolSourceCaches[u.source])}getGlyphs(a,u,g){this.glyphManager.getGlyphs(u.stacks,g)}getResource(a,u,g){return d.makeRequest(u,g)}_getSourceCache(a){return this._otherSourceCaches[a]}_getLayerSourceCache(a){return"symbol"===a.type?this._symbolSourceCaches[a.source]:this._otherSourceCaches[a.source]}_getSourceCaches(a){const u=[];return this._otherSourceCaches[a]&&u.push(this._otherSourceCaches[a]),this._symbolSourceCaches[a]&&u.push(this._symbolSourceCaches[a]),u}_isSourceCacheLoaded(a){const u=this._getSourceCaches(a);return 0===u.length?(this.fire(new d.ErrorEvent(new Error(`There is no source with ID '${a}'`))),!1):u.every(g=>g.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ti.getSourceType=function(f){return ve[f]},Ti.setSourceType=function(f,a){ve[f]=a},Ti.registerForPluginStateChange=d.registerForPluginStateChange;var mc="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",gc="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",$t="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",vu="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",xu="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let qr={},_c={};const bu=[];Vi(mc,bu),Vi($t,bu),Vi(vu,bu),Vi(xu,bu),qr=Ct("",$t),_c=Ct(xu,vu);const Zo=Ct("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),ao=mc,wu="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var Jd={background:Ct("uniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform vec4 u_color;varying vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(u_color);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:Ct("uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:Ct("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:Ct("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ct("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:Ct("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ct("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ct("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ct("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:Ct("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:Ct("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:Ct("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:Ct("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:Ct("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(color,NdotL);\n#else\nv_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef LIGHTING_3D_MODE\nv_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));\n#else\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:Ct("uniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,v_NdotL)*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_NdotL=NdotL;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:Ct("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ct("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting(gl_FragColor);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:Ct("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:Ct("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:Ct("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:Ct("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:Ct("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:Ct("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:Ct("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:Ct("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Ct("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",gc),skyboxGradient:Ct("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",gc),skyboxCapture:Ct("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ct("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;\n#ifdef GLOBE_POLES\nvec3 up_vector=normalize(globe_pos)*u_tile_up_scale;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:Ct("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function Vi(f,a){const u=f.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let g of u)if(g=g.trim(),"#"===g[0]&&g.includes("if")&&!g.includes("endif")){g=g.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const v=g.split(" ");for(const b of v)a.includes(b)||a.push(b)}}function Ct(f,a){const u=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,g=a.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),v={},b=[...bu];return Vi(f,b),Vi(a,b),{fragmentSource:f=f.replace(u,(D,I,M,R,k)=>(v[k]=!0,"define"===I?`\n#ifndef HAS_UNIFORM_u_${k}\nvarying ${M} ${R} ${k};\n#else\nuniform ${M} ${R} u_${k};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${k}\n    ${M} ${R} ${k} = u_${k};\n#endif\n`)),vertexSource:a=a.replace(u,(D,I,M,R,k)=>{const B="float"===R?"vec2":"vec4",$=k.match(/color/)?"color":B;return v[k]?"define"===I?`\n#ifndef HAS_UNIFORM_u_${k}\nuniform lowp float u_${k}_t;\nattribute ${M} ${B} a_${k};\nvarying ${M} ${R} ${k};\n#else\nuniform ${M} ${R} u_${k};\n#endif\n`:"vec4"===$?`\n#ifndef HAS_UNIFORM_u_${k}\n    ${k} = a_${k};\n#else\n    ${M} ${R} ${k} = u_${k};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${k}\n    ${k} = unpack_mix_${$}(a_${k}, u_${k}_t);\n#else\n    ${M} ${R} ${k} = u_${k};\n#endif\n`:"define"===I?`\n#ifndef HAS_UNIFORM_u_${k}\nuniform lowp float u_${k}_t;\nattribute ${M} ${B} a_${k};\n#else\nuniform ${M} ${R} u_${k};\n#endif\n`:"vec4"===$?`\n#ifndef HAS_UNIFORM_u_${k}\n    ${M} ${R} ${k} = a_${k};\n#else\n    ${M} ${R} ${k} = u_${k};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${k}\n    ${M} ${R} ${k} = unpack_mix_${$}(a_${k}, u_${k}_t);\n#else\n    ${M} ${R} ${k} = u_${k};\n#endif\n`}),staticAttributes:g,usedDefines:b}}class Bf{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(a,u,g,v,b,D,I){this.context=a;let M=this.boundPaintVertexBuffers.length!==v.length;for(let k=0;!M&&k<v.length;k++)this.boundPaintVertexBuffers[k]!==v[k]&&(M=!0);let R=this.boundDynamicVertexBuffers.length!==I.length;for(let k=0;!R&&k<I.length;k++)this.boundDynamicVertexBuffers[k]!==I[k]&&(R=!0);if(!a.extVertexArrayObject||!this.vao||this.boundProgram!==u||this.boundLayoutVertexBuffer!==g||M||R||this.boundIndexBuffer!==b||this.boundVertexOffset!==D)this.freshBind(u,g,v,b,D,I);else{a.bindVertexArrayOES.set(this.vao);for(const k of I)k&&k.bind();b&&b.dynamicDraw&&b.bind()}}freshBind(a,u,g,v,b,D){let I;const M=a.numAttributes,R=this.context,k=R.gl;if(R.extVertexArrayObject)this.vao&&this.destroy(),this.vao=R.extVertexArrayObject.createVertexArrayOES(),R.bindVertexArrayOES.set(this.vao),I=0,this.boundProgram=a,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=v,this.boundVertexOffset=b,this.boundDynamicVertexBuffers=D;else{I=R.currentNumAttributes||0;for(let B=M;B<I;B++)k.disableVertexAttribArray(B)}u.enableAttributes(k,a),u.bind(),u.setVertexAttribPointers(k,a,b);for(const B of g)B.enableAttributes(k,a),B.bind(),B.setVertexAttribPointers(k,a,b);for(const B of D)B&&(B.enableAttributes(k,a),B.bind(),B.setVertexAttribPointers(k,a,b));v&&v.bind(),R.currentNumAttributes=M}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Eu(f,a){const u=Math.pow(2,a.canonical.z),g=a.canonical.y;return[new d.MercatorCoordinate(0,g/u).toLngLat().lat,new d.MercatorCoordinate(0,(g+1)/u).toLngLat().lat]}function Ks(f,a,u,g,v,b,D){const I=f.context,M=I.gl,R=u.fbo;if(!R)return;f.prepareDrawTile();const k=f.useProgram("hillshade");I.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,R.colorAttachment.get());const B=((K,q,H,J)=>{const Q=H.paint.get("hillshade-shadow-color"),re=H.paint.get("hillshade-highlight-color"),ue=H.paint.get("hillshade-accent-color");let ce=H.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===H.paint.get("hillshade-illumination-anchor")&&(ce-=K.transform.angle);const me=!K.options.moving;return{u_matrix:J||K.transform.calculateProjMatrix(q.tileID.toUnwrapped(),me),u_image:0,u_latrange:Eu(0,q.tileID),u_light:[H.paint.get("hillshade-exaggeration"),ce],u_shadow:Q,u_highlight:re,u_accent:ue}})(f,u,g,f.terrain?a.projMatrix:null);f.prepareDrawProgram(I,k,a.toUnwrapped());const{tileBoundsBuffer:$,tileBoundsIndexBuffer:Z,tileBoundsSegments:W}=f.getTileBoundsBuffers(u);k.draw(I,M.TRIANGLES,v,b,D,d.CullFaceMode.disabled,B,g.id,$,Z,W)}function yn(f,a,u){if(!a.needsDEMTextureUpload)return;const g=f.context,v=g.gl;g.pixelStoreUnpackPremultiplyAlpha.set(!1),a.demTexture=a.demTexture||f.getTileTexture(u.stride);const b=u.getPixels();a.demTexture?a.demTexture.update(b,{premultiply:!1}):a.demTexture=new d.Texture(g,b,v.RGBA,{premultiply:!1}),a.needsDEMTextureUpload=!1}function Pa(f,a,u,g,v,b){const D=f.context,I=D.gl;if(!a.dem)return;const M=a.dem;if(D.activeTexture.set(I.TEXTURE1),yn(f,a,M),!a.demTexture)return;a.demTexture.bind(I.NEAREST,I.CLAMP_TO_EDGE);const R=M.dim;D.activeTexture.set(I.TEXTURE0);let k=a.fbo;if(!k){const W=new d.Texture(D,{width:R,height:R,data:null},I.RGBA);W.bind(I.LINEAR,I.CLAMP_TO_EDGE),k=a.fbo=D.createFramebuffer(R,R,!0),k.colorAttachment.set(W.texture)}D.bindFramebuffer.set(k.framebuffer),D.viewport.set([0,0,R,R]);const{tileBoundsBuffer:B,tileBoundsIndexBuffer:$,tileBoundsSegments:Z}=f.getMercatorTileBoundsBuffers();f.useProgram("hillshadePrepare").draw(D,I.TRIANGLES,g,v,b,d.CullFaceMode.disabled,((W,K)=>{const q=K.stride,H=d.create();return d.ortho(H,0,d.EXTENT,-d.EXTENT,0,0,1),d.translate(H,H,[0,-d.EXTENT,0]),{u_matrix:H,u_image:1,u_dimension:[q,q],u_zoom:W.overscaledZ,u_unpack:K.unpackVector}})(a.tileID,M),u.id,B,$,Z),a.needsHillshadePrepare=!1}const La=f=>({u_matrix:new d.UniformMatrix4f(f),u_image0:new d.Uniform1i(f),u_skirt_height:new d.Uniform1f(f)}),fl=(f,a)=>({u_matrix:f,u_image0:0,u_skirt_height:a}),Tu=(f,a,u,g,v,b,D,I,M,R,k,B,$,Z)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:a,u_normalize_matrix:Float32Array.from(g),u_merc_matrix:u,u_zoom_transition:v,u_merc_center:b,u_image0:0,u_frustum_tl:D,u_frustum_tr:I,u_frustum_br:M,u_frustum_bl:R,u_globe_pos:k,u_globe_radius:B,u_viewport:$,u_grid_matrix:Z?Float32Array.from(Z):new Float32Array(9)});function lo(f,a){return null!=f&&null!=a&&!(!f.hasData()||!a.hasData())&&null!=f.demTexture&&null!=a.demTexture&&f.tileID.key!==a.tileID.key}const bo=new class{constructor(){this.operations={}}newMorphing(f,a,u,g,v){if(f in this.operations){const b=this.operations[f];b.to.tileID.key!==u.tileID.key&&(b.queued=u)}else this.operations[f]={startTime:g,phase:0,duration:v,from:a,to:u,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const a=this.operations[f];return{from:a.from,to:a.to,phase:a.phase}}update(f){for(const a in this.operations){const u=this.operations[a];for(u.phase=(f-u.startTime)/u.duration;u.phase>=1||!this._validOp(u);)if(!this._nextOp(u,f)){delete this.operations[a];break}}}_nextOp(f,a){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=a,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},ml={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Zn(f,a){const u=1<<f.z;return!a&&(0===f.x||f.x===u-1)||0===f.y||f.y===u-1}const yc=f=>({u_matrix:f});function vc(f,a,u,g,v){if(v>0){const b=d.exported.now(),D=(b-f.timeAdded)/v,I=a?(b-a.timeAdded)/v:-1,M=u.getSource(),R=g.coveringZoomLevel({tileSize:M.tileSize,roundZoom:M.roundZoom}),k=!a||Math.abs(a.tileID.overscaledZ-R)>Math.abs(f.tileID.overscaledZ-R),B=k&&f.refreshedUponExpiration?1:d.clamp(k?D:1-I,0,1);return f.refreshedUponExpiration&&D>=1&&(f.refreshedUponExpiration=!1),a?{opacity:1,mix:1-B}:{opacity:B,mix:0}}return{opacity:1,mix:0}}class dn extends d.SourceCache{constructor(a){const u={type:"raster-dem",maxzoom:a.transform.maxZoom},g=new fs(Lt(),null),v=ye("mock-dem",u,g,a.style);super("mock-dem",v,!1),v.setEventedParent(this),this._sourceLoaded=!0}_loadTile(a,u){a.state="loaded",u(null)}}class fr extends d.SourceCache{constructor(a){const u=ye("proxy",{type:"geojson",maxzoom:a.transform.maxZoom},new fs(Lt(),null),a.style);super("proxy",u,!1),u.setEventedParent(this),this.map=this.getSource().map=a,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(a,u,g){if(a.freezeTileCoverage)return;this.transform=a;const v=a.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((b,D)=>{if(b[D.key]="",!this._tiles[D.key]){const I=new d.Tile(D,this._source.tileSize*D.overscaleFactor(),a.tileZoom);I.state="loaded",this._tiles[D.key]=I}return b},{});for(const b in this._tiles)b in v||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(a){const u=this.proxyCachedFBO[a];if(void 0!==u){const g=Object.values(u);this.renderCachePool.push(...g),delete this.proxyCachedFBO[a]}}deallocRenderCache(){this.renderCache.forEach(a=>a.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Oh extends d.OverscaledTileID{constructor(a,u,g){super(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y),this.proxyTileKey=u,this.projMatrix=g}}class Fh extends d.Elevation{constructor(a,u){super(),this.painter=a,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[g,v,b]=function(M){const R=new d.StructArrayLayout4i8,k=new d.StructArrayLayout3ui6,B=131;R.reserve(17161),k.reserve(33800);const $=d.EXTENT/128,Z=d.EXTENT+$/2,W=Z+$;for(let q=-$;q<W;q+=$)for(let H=-$;H<W;H+=$){const J=H<0||H>Z||q<0||q>Z?24575:0,Q=d.clamp(Math.round(H),0,d.EXTENT),re=d.clamp(Math.round(q),0,d.EXTENT);R.emplaceBack(Q+J,re,Q,re)}const K=(q,H)=>{const J=H*B+q;k.emplaceBack(J+1,J,J+B),k.emplaceBack(J+B,J+B+1,J+1)};for(let q=1;q<129;q++)for(let H=1;H<129;H++)K(H,q);return[0,129].forEach(q=>{for(let H=0;H<130;H++)K(H,q),K(q,H)}),[R,k,32768]}(),D=a.context;this.gridBuffer=D.createVertexBuffer(g,d.boundsAttributes.members),this.gridIndexBuffer=D.createIndexBuffer(v),this.gridSegments=d.SegmentVector.simpleSegment(0,0,g.length,v.length),this.gridNoSkirtSegments=d.SegmentVector.simpleSegment(0,0,g.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new fr(u.map),this.orthoMatrix=d.create(),d.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,d.EXTENT,0,d.EXTENT,0,1);const I=D.gl;this._overlapStencilMode=new d.StencilMode({func:I.GEQUAL,mask:255},0,255,I.KEEP,I.KEEP,I.REPLACE),this._previousZoom=a.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=u,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new dn(u.map)}set style(a){a.on("data",this._onStyleDataEvent.bind(this)),a.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=a,this._checkRenderCacheEfficiency()}update(a,u,g){if(a&&a.terrain){this._style!==a&&(this.style=a),this.enabled=!0;const v=a.terrain.properties;this.sourceCache=0===a.terrain.drapeRenderMode?this._mockSourceCache:a._getSourceCache(v.get("source")),this._exaggeration=v.get("exaggeration");const b=()=>{this.sourceCache.used&&d.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const D=this.getScaledDemTileSize();this.sourceCache.update(u,D,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,b(),this._initializing=!0),b(),u.updateElevation(!0,g),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(u),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(a){this._findCoveringTileCache[a]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const a=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==a.efficiency&&d.warnOnce(`Terrain render cache efficiency is not optimal (${a.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${a.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(a){a.coord&&"source"===a.dataType?this._clearRenderCacheForTile(a.sourceCacheId,a.coord):"style"===a.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const a in this._style._sourceCaches)this._style._sourceCaches[a].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(a=>a.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const a=2*this.proxySourceCache.getSource().tileSize;return[a,a]}set useVertexMorphing(a){this._useVertexMorphing=a}updateTileBinding(a){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const u=this.proxySourceCache,g=this.painter.transform;this._initializing&&(this._initializing=0===g._centerAltitude&&-1===this.getAtPointOrZero(d.MercatorCoordinate.fromLngLat(g.center),-1),this._emptyDEMTextureDirty=!this._initializing);const v=this.proxyCoords=u.getIds().map(M=>{const R=u.getTileByID(M).tileID;return R.projMatrix=g.calculateProjMatrix(R.toUnwrapped()),R});(function(M,R){const k=R.transform.pointCoordinate(R.transform.getCameraPoint()),B=new d.pointGeometry(k.x,k.y);M.sort(($,Z)=>{if(Z.overscaledZ-$.overscaledZ)return Z.overscaledZ-$.overscaledZ;const W=new d.pointGeometry($.canonical.x+(1<<$.canonical.z)*$.wrap,$.canonical.y),K=new d.pointGeometry(Z.canonical.x+(1<<Z.canonical.z)*Z.wrap,Z.canonical.y),q=B.mult(1<<$.canonical.z);return q.x-=.5,q.y-=.5,q.distSqr(W)-q.distSqr(K)})})(v,this.painter),this._previousZoom=g.zoom;const b=this.proxyToSource||{};this.proxyToSource={},v.forEach(M=>{this.proxyToSource[M.key]={}}),this.terrainTileForTile={};const D=this._style._sourceCaches;for(const M in D){const R=D[M];if(!R.used||(R!==this.sourceCache&&this.resetTileLookupCache(R.id),this._setupProxiedCoordsForOrtho(R,a[M],b),R.usedForTerrain))continue;const k=a[M];R.getSource().reparseOverscaled&&this._assignTerrainTiles(k)}this.proxiedCoords[u.id]=v.map(M=>new Oh(M,M.key,this.orthoMatrix)),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1,this._updateTimestamp=d.exported.now();const I={};this._visibleDemTiles=[];for(const M of this.proxyCoords){const R=this.terrainTileForTile[M.key];if(!R)continue;const k=R.tileID.key;k in I||(this._visibleDemTiles.push(R),I[k]=k)}}_assignTerrainTiles(a){this._initializing||a.forEach(u=>{if(this.terrainTileForTile[u.key])return;const g=this._findTileCoveringTileID(u,this.sourceCache);g&&(this.terrainTileForTile[u.key]=g)})}_prepareDEMTextures(){const a=this.painter.context,u=a.gl;for(const g in this.terrainTileForTile){const v=this.terrainTileForTile[g],b=v.dem;!b||v.demTexture&&!v.needsDEMTextureUpload||(a.activeTexture.set(u.TEXTURE1),yn(this.painter,v,b))}}_prepareDemTileUniforms(a,u,g,v){if(!u||null==u.demTexture)return!1;const b=a.tileID.canonical,D=Math.pow(2,u.tileID.canonical.z-b.z),I=v||"";return g[`u_dem_tl${I}`]=[b.x*D%1,b.y*D%1],g[`u_dem_scale${I}`]=D,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const a=this.painter.context,u=a.gl;if(!this._emptyDepthBufferTexture){const g=new d.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new d.Texture(a,g,u.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let a=0;const u=this._visibleDemTiles.reduce((g,v)=>{if(!v.dem)return g;const b=v.dem.tree.minimums[0];return b>0&&a++,g+b},0);return a?u/a:0}_updateEmptyDEMTexture(){const a=this.painter.context,u=a.gl;a.activeTexture.set(u.TEXTURE2);const g=this._getLoadedAreaMinimum(),v=new d.RGBAImage({width:1,height:1},new Uint8Array(d.DEMData.pack(g,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(v,{premultiply:!1}):b=this._emptyDEMTexture=new d.Texture(a,v,u.RGBA,{premultiply:!1}),b}setupElevationDraw(a,u,g){const v=this.painter.context,b=v.gl,D=(I=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:d.DEMData.getUnpackVector(I),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var I;D.u_dem_size=this.sourceCache.getSource().tileSize,D.u_exaggeration=this.exaggeration();let M=null,R=null,k=1;if(g&&g.morphing&&this._useVertexMorphing){const B=g.morphing.srcDemTile,$=g.morphing.dstDemTile;k=g.morphing.phase,B&&$&&(this._prepareDemTileUniforms(a,B,D,"_prev")&&(R=B),this._prepareDemTileUniforms(a,$,D)&&(M=$))}if(R&&M?(v.activeTexture.set(b.TEXTURE2),M.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),v.activeTexture.set(b.TEXTURE4),R.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),D.u_dem_lerp=k):(M=this.terrainTileForTile[a.tileID.key],v.activeTexture.set(b.TEXTURE2),(this._prepareDemTileUniforms(a,M,D)?M.demTexture:this.emptyDEMTexture).bind(b.NEAREST,b.CLAMP_TO_EDGE)),v.activeTexture.set(b.TEXTURE3),g&&g.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),this._depthFBO&&(D.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),D.u_depth_size_inv=[1,1]),g&&g.useMeterToDem&&M){const B=(1<<M.tileID.canonical.z)*d.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;D.u_meter_to_dem=B}if(g&&g.labelPlaneMatrixInv&&(D.u_label_plane_matrix_inv=g.labelPlaneMatrixInv),u.setTerrainUniformValues(v,D),"globe"===this.painter.transform.projection.name){const B=this.globeUniformValues(this.painter.transform,a.tileID.canonical,g&&g.useDenormalizedUpVectorScale);u.setGlobeUniformValues(v,B)}}globeUniformValues(a,u,g){const v=a.projection;return{u_tile_tl_up:v.upVector(u,0,0),u_tile_tr_up:v.upVector(u,d.EXTENT,0),u_tile_br_up:v.upVector(u,d.EXTENT,d.EXTENT),u_tile_bl_up:v.upVector(u,0,d.EXTENT),u_tile_up_scale:g?d.GLOBE_METERS_TO_ECEF:v.upVectorScale(u,a.center.lat,a.worldSize).metersToTile}}renderToBackBuffer(a){const u=this.painter,g=this.painter.context;0!==a.length&&(g.bindFramebuffer.set(null),g.viewport.set([0,0,u.width,u.height]),u.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(v,b,D,I,M){if("globe"===v.transform.projection.name)!function(R,k,B,$,Z){const W=R.context,K=W.gl;let q,H;const J=R.options.showTerrainWireframe?2:0,Q=R.transform,re=d.globeUseCustomAntiAliasing(R,W,Q),ue=(He,Pe)=>{if(H===He)return;const Fe=[ml[He],"PROJECTION_GLOBE_VIEW"];re&&Fe.push("CUSTOM_ANTIALIASING"),Pe&&Fe.push(ml[J]),q=R.useProgram("globeRaster",null,Fe),H=He},ce=R.colorModeForRenderPass(),me=new d.DepthMode(K.LEQUAL,d.DepthMode.ReadWrite,R.depthRangeFor3D);bo.update(Z);const Se=d.calculateGlobeMercatorMatrix(Q),Te=[d.mercatorXfromLng(Q.center.lng),d.mercatorYfromLat(Q.center.lat)],_e=J?[!1,!0]:[!1],Ze=R.globeSharedBuffers,xe=[Q.width*d.exported.devicePixelRatio,Q.height*d.exported.devicePixelRatio],Le=Float32Array.from(Q.globeMatrix),Ce={useDenormalizedUpVectorScale:!0};if(_e.forEach(He=>{H=-1;const Pe=He?K.LINES:K.TRIANGLES;for(const Fe of $){const Qe=B.getTile(Fe),ge=d.StencilMode.disabled,Ie=k.prevTerrainTileForTile[Fe.key],ht=k.terrainTileForTile[Fe.key];lo(Ie,ht)&&bo.newMorphing(Fe.key,Ie,ht,Z,250),W.activeTexture.set(K.TEXTURE0),Qe.texture.bind(K.LINEAR,K.CLAMP_TO_EDGE);const wt=bo.getMorphValuesForProxy(Fe.key),ft=wt?1:0;wt&&d.extend$1(Ce,{morphing:{srcDemTile:wt.from,dstDemTile:wt.to,phase:d.easeCubicInOut(wt.phase)}});const It=d.tileCornersToBounds(Fe.canonical),Zt=d.getLatitudinalLod(It.getCenter().lat),mt=d.getGridMatrix(Fe.canonical,It,Zt,Q.worldSize/Q._pixelsPerMercatorPixel),ut=d.globeNormalizeECEF(d.globeTileBounds(Fe.canonical)),xn=Tu(Q.projMatrix,Le,Se,ut,d.globeToMercatorTransition(Q.zoom),Te,Q.frustumCorners.TL,Q.frustumCorners.TR,Q.frustumCorners.BR,Q.frustumCorners.BL,Q.globeCenterInViewSpace,Q.globeRadius,xe,mt);if(ue(ft,He),k.setupElevationDraw(Qe,q,Ce),R.prepareDrawProgram(W,q,Fe.toUnwrapped()),Ze){const[pn,kn,Cn]=He?Ze.getWirefameBuffers(R.context,Zt):Ze.getGridBuffers(Zt);q.draw(W,Pe,me,ge,ce,d.CullFaceMode.backCCW,xn,"globe_raster",pn,kn,Cn)}}}),Ze){const He=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];re&&He.push("CUSTOM_ANTIALIASING"),q=R.useProgram("globeRaster",null,He);for(const Pe of $){const{x:Fe,y:Qe,z:ge}=Pe.canonical,Ie=0===Qe,ht=Qe===(1<<ge)-1,[wt,ft,It,Zt]=Ze.getPoleBuffers(ge);if(Zt&&(Ie||ht)){const mt=B.getTile(Pe);W.activeTexture.set(K.TEXTURE0),mt.texture.bind(K.LINEAR,K.CLAMP_TO_EDGE);let ut=d.globePoleMatrixForTile(ge,Fe,Q);const xn=d.globeNormalizeECEF(d.globeTileBounds(Pe.canonical)),pn=(kn,Cn)=>kn.draw(W,K.TRIANGLES,me,d.StencilMode.disabled,ce,d.CullFaceMode.disabled,Tu(Q.projMatrix,ut,ut,xn,0,Te,Q.frustumCorners.TL,Q.frustumCorners.TR,Q.frustumCorners.BR,Q.frustumCorners.BL,Q.globeCenterInViewSpace,Q.globeRadius,xe),"globe_pole_raster",Cn,It,Zt);k.setupElevationDraw(mt,q,Ce),R.prepareDrawProgram(W,q,Pe.toUnwrapped()),Ie&&pn(q,wt),ht&&(ut=d.scale(d.create(),ut,[1,-1,1]),pn(q,ft))}}}}(v,b,D,I,M);else{const R=v.context,k=R.gl;let B,$;const Z=v.options.showTerrainWireframe?2:0,W=(Q,re)=>{if($===Q)return;const ue=[ml[Q]];re&&ue.push(ml[Z]),B=v.useProgram("terrainRaster",null,ue),$=Q},K=v.colorModeForRenderPass(),q=new d.DepthMode(k.LEQUAL,d.DepthMode.ReadWrite,v.depthRangeFor3D);bo.update(M);const H=v.transform,J=6*Math.pow(1.5,22-H.zoom)*b.exaggeration();(Z?[!1,!0]:[!1]).forEach(Q=>{$=-1;const re=Q?k.LINES:k.TRIANGLES,[ue,ce]=Q?b.getWirefameBuffer():[b.gridIndexBuffer,b.gridSegments];for(const me of I){const Se=D.getTile(me),Te=d.StencilMode.disabled,_e=b.prevTerrainTileForTile[me.key],Ze=b.terrainTileForTile[me.key];lo(_e,Ze)&&bo.newMorphing(me.key,_e,Ze,M,250),R.activeTexture.set(k.TEXTURE0),Se.texture.bind(k.LINEAR,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST);const xe=bo.getMorphValuesForProxy(me.key),Le=xe?1:0;let Ce;xe&&(Ce={morphing:{srcDemTile:xe.from,dstDemTile:xe.to,phase:d.easeCubicInOut(xe.phase)}});const He=fl(me.projMatrix,Zn(me.canonical,H.renderWorldCopies)?J/10:J);W(Le,Q),b.setupElevationDraw(Se,B,Ce),v.prepareDrawProgram(R,B,me.toUnwrapped()),B.draw(R,re,q,Te,K,d.CullFaceMode.backCCW,He,"terrain_raster",b.gridBuffer,ue,ce)}})}}(u,this,this.proxySourceCache,a,this._updateTimestamp),this.renderingToTexture=!0,u.gpuTimingDeferredRenderEnd(),a.splice(0,a.length))}renderBatch(a){if(0===this._drapedRenderBatches.length)return a+1;this.renderingToTexture=!0;const u=this.painter,g=this.painter.context,v=this.proxySourceCache,b=this.proxiedCoords[v.id],D=this._drapedRenderBatches.shift(),I=[],M=u.style.order;let R=0;for(const k of b){const B=v.getTileByID(k.proxyTileKey),$=v.proxyCachedFBO[k.key]?v.proxyCachedFBO[k.key][a]:void 0,Z=void 0!==$?v.renderCache[$]:this.pool[R++],W=void 0!==$;if(B.texture=Z.tex,W&&!Z.dirty){I.push(B.tileID);continue}let K;g.bindFramebuffer.set(Z.fb.framebuffer),this.renderedToTile=!1,Z.dirty&&(g.clear({color:d.Color.transparent,stencil:0}),Z.dirty=!1);for(let q=D.start;q<=D.end;++q){const H=u.style._layers[M[q]];if(H.isHidden(u.transform.zoom))continue;const J=u.style._getLayerSourceCache(H),Q=J?this.proxyToSource[k.key][J.id]:[k];if(!Q)continue;const re=Q;g.viewport.set([0,0,Z.fb.width,Z.fb.height]),K!==(J?J.id:null)&&(this._setupStencil(Z,Q,H,J),K=J?J.id:null),u.renderLayer(u,J,H,re)}this.renderedToTile?(Z.dirty=!0,I.push(B.tileID)):W||--R,5===R&&(R=0,this.renderToBackBuffer(I))}return this.renderToBackBuffer(I),this.renderingToTexture=!1,g.bindFramebuffer.set(null),g.viewport.set([0,0,u.width,u.height]),D.end+1}postRender(){}renderCacheEfficiency(a){const u=a.order.length;if(0===u)return{efficiency:100};let g,v=0,b=0,D=!1;for(let I=0;I<u;++I){const M=a._layers[a.order[I]];this._style.isLayerDraped(M)?(D&&++v,++b):D||(D=!0,g=M.id)}return 0===b?{efficiency:100}:{efficiency:100*(1-v/b),firstUndrapedLayer:g}}getMinElevationBelowMSL(){let a=0;return this._visibleDemTiles.filter(u=>u.dem).forEach(u=>{a=Math.min(a,u.dem.tree.minimums[0])}),0===a?a:(a-30)*this._exaggeration}raycast(a,u,g){if(!this._visibleDemTiles)return null;const v=this._visibleDemTiles.filter(b=>b.dem).map(b=>{const D=b.tileID,I=1<<D.overscaledZ,{x:M,y:R}=D.canonical,k=M/I,B=(M+1)/I,$=R/I,Z=(R+1)/I;return{minx:k,miny:$,maxx:B,maxy:Z,t:b.dem.tree.raycastRoot(k,$,B,Z,a,u,g),tile:b}});v.sort((b,D)=>(null!==b.t?b.t:Number.MAX_VALUE)-(null!==D.t?D.t:Number.MAX_VALUE));for(const b of v){if(null==b.t)return null;const D=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,a,u,g);if(null!=D)return D}return null}_createFBO(){const a=this.painter.context,u=a.gl,g=this.drapeBufferSize;a.activeTexture.set(u.TEXTURE0);const v=new d.Texture(a,{width:g[0],height:g[1],data:null},u.RGBA);v.bind(u.LINEAR,u.CLAMP_TO_EDGE);const b=a.createFramebuffer(g[0],g[1],!1);return b.colorAttachment.set(v.texture),b.depthAttachment=new ul(a,b.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=a.createRenderbuffer(a.gl.DEPTH_STENCIL,g[0],g[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),a.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),a.extTextureFilterAnisotropic&&!a.extTextureFilterAnisotropicForceOff&&u.texParameterf(u.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax),{fb:b,tex:v,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const a in this._style._sourceCaches)if(this._style._sourceCaches[a].hasTransition())return!0;return this._style.order.some(a=>{const u=this._style._layers[a],g=u.isHidden(this.painter.transform.zoom);return"custom"!==u.type&&!g&&u.hasTransition()})}_clearRasterFadeFromRenderCache(){let a=!1;for(const u in this._style._sourceCaches)if(this._style._sourceCaches[u]._source instanceof U){a=!0;break}if(a)for(let u=0;u<this._style.order.length;++u){const g=this._style._layers[this._style.order[u]],v=g.isHidden(this.painter.transform.zoom),b=this._style._getLayerSourceCache(g);if("raster"!==g.type||v||!b)continue;const D=g.paint.get("raster-fade-duration");for(const I of this.proxyCoords){const M=this.proxyToSource[I.key][b.id];if(M)for(const R of M){const k=vc(b.getTile(R),b.findLoadedParent(R,0),b,this.painter.transform,D);(1!==k.opacity||0!==k.mix)&&this._clearRenderCacheForTile(b.id,R)}}}}_setupDrapedRenderBatches(){const a=this._style.order,u=a.length;if(0===u)return;const g=[];let v,b=0,D=this._style._layers[a[b]];for(;!this._style.isLayerDraped(D)&&D.isHidden(this.painter.transform.zoom)&&++b<u;)D=this._style._layers[a[b]];for(;b<u;++b){const I=this._style._layers[a[b]];I.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(I)?void 0===v&&(v=b):void 0!==v&&(g.push({start:v,end:b-1}),v=void 0))}void 0!==v&&g.push({start:v,end:b-1}),this._drapedRenderBatches=g}_setupRenderCache(a){const u=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,u.renderCache.length>u.renderCachePool.length){const D=Object.values(u.proxyCachedFBO);u.proxyCachedFBO={};for(let I=0;I<D.length;++I){const M=Object.values(D[I]);u.renderCachePool.push(...M)}}return}this._clearRasterFadeFromRenderCache();const g=this.proxyCoords,v=this._tilesDirty;for(let D=g.length-1;D>=0;D--){const I=g[D];if(u.getTileByID(I.key),void 0!==u.proxyCachedFBO[I.key]){const M=a[I.key],R=this.proxyToSource[I.key];let k=0;for(const B in R){const $=R[B],Z=M[B];if(!Z||Z.length!==$.length||$.some((W,K)=>W!==Z[K]||v[B]&&v[B].hasOwnProperty(W.key))){k=-1;break}++k}for(const B in u.proxyCachedFBO[I.key])u.renderCache[u.proxyCachedFBO[I.key][B]].dirty=k<0||k!==Object.values(M).length}}const b=[...this._drapedRenderBatches];b.sort((D,I)=>I.end-I.start-(D.end-D.start));for(const D of b)for(const I of g){if(u.proxyCachedFBO[I.key])continue;let M=u.renderCachePool.pop();void 0===M&&u.renderCache.length<50&&(M=u.renderCache.length,u.renderCache.push(this._createFBO())),void 0!==M&&(u.proxyCachedFBO[I.key]={},u.proxyCachedFBO[I.key][D.start]=M,u.renderCache[M].dirty=!0)}this._tilesDirty={}}_setupStencil(a,u,g,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,D=b.gl;if(u.length<=1)return void(this._overlapStencilType=!1);let I;if(g.isTileClipped())I=u.length,this._overlapStencilMode.test={func:D.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(u[0].overscaledZ>u[u.length-1].overscaledZ))return void(this._overlapStencilType=!1);I=1,this._overlapStencilMode.test={func:D.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+I>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=I,this._overlapStencilMode.ref=this._stencilRef,g.isTileClipped()&&this._renderTileClippingMasks(u,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(a){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[a.key]),this._overlapStencilMode):d.StencilMode.disabled}_renderTileClippingMasks(a,u){const g=this.painter,v=this.painter.context,b=v.gl;g._tileClippingMaskIDs={},v.setColorMode(d.ColorMode.disabled),v.setDepthMode(d.DepthMode.disabled);const D=g.useProgram("clippingMask");for(const I of a){const M=g._tileClippingMaskIDs[I.key]=--u;D.draw(v,b.TRIANGLES,d.DepthMode.disabled,new d.StencilMode({func:b.ALWAYS,mask:0},M,255,b.KEEP,b.KEEP,b.REPLACE),d.ColorMode.disabled,d.CullFaceMode.disabled,yc(I.projMatrix),"$clipping",g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}}pointCoordinate(a){const u=this.painter.transform;if(a.x<0||a.x>u.width||a.y<0||a.y>u.height)return null;const g=[a.x,a.y,1,1];d.transformMat4$1(g,g,u.pixelMatrixInverse),d.scale$1(g,g,1/g[3]),g[0]/=u.worldSize,g[1]/=u.worldSize;const v=u._camera.position,b=d.mercatorZfromAltitude(1,u.center.lat),D=[v[0],v[1],v[2]/b,0],I=d.subtract([],g.slice(0,3),D);d.normalize(I,I);const M=this.raycast(D,I,this._exaggeration);return null!==M&&M?(d.scaleAndAdd(D,D,I,M),D[3]=D[2],D[2]*=b,D):null}drawDepth(){const a=this.painter,u=a.context,g=this.proxySourceCache,v=Math.ceil(a.width),b=Math.ceil(a.height);if(!this._depthFBO||this._depthFBO.width===v&&this._depthFBO.height===b||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const D=u.gl,I=u.createFramebuffer(v,b,!0);u.activeTexture.set(D.TEXTURE0);const M=new d.Texture(u,{width:v,height:b,data:null},D.RGBA);M.bind(D.NEAREST,D.CLAMP_TO_EDGE),I.colorAttachment.set(M.texture);const R=u.createRenderbuffer(u.gl.DEPTH_COMPONENT16,v,b);I.depthAttachment.set(R),this._depthFBO=I,this._depthTexture=M}u.bindFramebuffer.set(this._depthFBO.framebuffer),u.viewport.set([0,0,v,b]),function(D,I,M,R){if("globe"===D.transform.projection.name)return;const k=D.context,B=k.gl;k.clear({depth:1});const $=D.useProgram("terrainDepth"),Z=new d.DepthMode(B.LESS,d.DepthMode.ReadWrite,D.depthRangeFor3D);for(const W of R){const K=M.getTile(W),q=fl(W.projMatrix,0);I.setupElevationDraw(K,$),$.draw(k,B.TRIANGLES,Z,d.StencilMode.disabled,d.ColorMode.unblended,d.CullFaceMode.backCCW,q,"terrain_depth",I.gridBuffer,I.gridIndexBuffer,I.gridNoSkirtSegments)}}(a,this,g,this.proxyCoords)}_setupProxiedCoordsForOrtho(a,u,g){if(a.getSource()instanceof de)return this._setupProxiedCoordsForImageSource(a,u,g);this._findCoveringTileCache[a.id]=this._findCoveringTileCache[a.id]||{};const v=this.proxiedCoords[a.id]=[],b=this.proxyCoords;for(let I=0;I<b.length;I++){const M=b[I],R=this._findTileCoveringTileID(M,a);if(R){const k=this._createProxiedId(M,R,g[M.key]&&g[M.key][a.id]);v.push(k),this.proxyToSource[M.key][a.id]=[k]}}let D=!1;for(let I=0;I<u.length;I++){const M=a.getTile(u[I]);if(!M||!M.hasData())continue;const R=this._findTileCoveringTileID(M.tileID,this.proxySourceCache);if(R&&R.tileID.canonical.z!==M.tileID.canonical.z){const k=this.proxyToSource[R.tileID.key][a.id],B=this._createProxiedId(R.tileID,M,g[R.tileID.key]&&g[R.tileID.key][a.id]);k?k.splice(k.length-1,0,B):this.proxyToSource[R.tileID.key][a.id]=[B],v.push(B),D=!0}}this._sourceTilesOverlap[a.id]=D}_setupProxiedCoordsForImageSource(a,u,g){if(!a.getSource().loaded())return;const v=this.proxiedCoords[a.id]=[],b=this.proxyCoords,D=a.getSource(),I=new d.pointGeometry(D.tileID.x,D.tileID.y)._div(1<<D.tileID.z),M=D.coordinates.map(d.MercatorCoordinate.fromLngLat).reduce((k,B)=>(k.min.x=Math.min(k.min.x,B.x-I.x),k.min.y=Math.min(k.min.y,B.y-I.y),k.max.x=Math.max(k.max.x,B.x-I.x),k.max.y=Math.max(k.max.y,B.y-I.y),k),{min:new d.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new d.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),R=(k,B)=>{const $=k.wrap+k.canonical.x/(1<<k.canonical.z),Z=k.canonical.y/(1<<k.canonical.z),W=d.EXTENT/(1<<k.canonical.z),K=B.wrap+B.canonical.x/(1<<B.canonical.z),q=B.canonical.y/(1<<B.canonical.z);return $+W<K+M.min.x||$>K+M.max.x||Z+W<q+M.min.y||Z>q+M.max.y};for(let k=0;k<b.length;k++){const B=b[k];for(let $=0;$<u.length;$++){const Z=a.getTile(u[$]);if(!Z||!Z.hasData()||R(B,Z.tileID))continue;const W=this._createProxiedId(B,Z,g[B.key]&&g[B.key][a.id]),K=this.proxyToSource[B.key][a.id];K?K.push(W):this.proxyToSource[B.key][a.id]=[W],v.push(W)}}}_createProxiedId(a,u,g){let v=this.orthoMatrix;if(g){const b=g.find(D=>D.key===u.tileID.key);if(b)return b}if(u.tileID.key!==a.key){const b=a.canonical.z-u.tileID.canonical.z;let D,I,M;v=d.create();const R=u.tileID.wrap-a.wrap<<a.overscaledZ;b>0?(D=d.EXTENT>>b,I=D*((u.tileID.canonical.x<<b)-a.canonical.x+R),M=D*((u.tileID.canonical.y<<b)-a.canonical.y)):(D=d.EXTENT<<-b,I=d.EXTENT*(u.tileID.canonical.x-(a.canonical.x+R<<-b)),M=d.EXTENT*(u.tileID.canonical.y-(a.canonical.y<<-b))),d.ortho(v,0,D,0,D,0,1),d.translate(v,v,[I,M,0])}return new Oh(u.tileID,a.key,v)}_findTileCoveringTileID(a,u){let g=u.getTile(a);if(g&&g.hasData())return g;const v=this._findCoveringTileCache[u.id],b=v[a.key];if(g=b?u.getTileByID(b):null,g&&g.hasData()||null===b)return g;let D=g?g.tileID:a,I=D.overscaledZ;const M=u.getSource().minzoom,R=[];if(!b){const B=u.getSource().maxzoom;if(a.canonical.z>=B){const $=a.canonical.z-B;u.getSource().reparseOverscaled?(I=Math.max(a.canonical.z+2,u.transform.tileZoom),D=new d.OverscaledTileID(I,a.wrap,B,a.canonical.x>>$,a.canonical.y>>$)):0!==$&&(I=B,D=new d.OverscaledTileID(I,a.wrap,B,a.canonical.x>>$,a.canonical.y>>$))}D.key!==a.key&&(R.push(D.key),g=u.getTile(D))}const k=B=>{R.forEach($=>{v[$]=B}),R.length=0};for(I-=1;I>=M&&(!g||!g.hasData());I--){g&&k(g.tileID.key);const B=D.calculateScaledKey(I);if(g=u.getTileByID(B),g&&g.hasData())break;const $=v[B];if(null===$)break;void 0===$?R.push(B):g=u.getTileByID($)}return k(g?g.tileID.key:null),g&&g.hasData()?g:null}findDEMTileFor(a){return this.enabled?this._findTileCoveringTileID(a,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(a,u){let g=this._tilesDirty[a];g||(g=this._tilesDirty[a]={}),g[u.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const a=function(u){let g=0;const v=new d.StructArrayLayout2ui4,b=131;for(let D=1;D<129;D++){for(let I=1;I<129;I++)g=D*b+I,v.emplaceBack(g,g+1),v.emplaceBack(g,g+b),v.emplaceBack(g+1,g+b),128===D&&v.emplaceBack(g+b,g+b+1);v.emplaceBack(g+1,g+1+b)}return v}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(a),this.wireframeSegments=d.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,a.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Pi{static cacheKey(a,u,g,v){let b=`${u}${v?v.cacheKey:""}`;for(const D of g)a.usedDefines.includes(D)&&(b+=`/${D}`);return b}constructor(a,u,g,v,b,D){const I=a.gl;this.program=I.createProgram();const M=function(q){const H=[];for(let J=0;J<q.length;J++){if(null===q[J])continue;const Q=q[J].split(" ");H.push(Q.pop())}return H}(g.staticAttributes),R=v?v.getBinderAttributes():[],k=M.concat(R);let B=v?v.defines():[];B=B.concat(D.map(q=>`#define ${q}`));const $=B.concat(a.extStandardDerivatives?"#extension GL_OES_standard_derivatives : enable\n".concat(wu):wu,wu,ao,Zo.fragmentSource,_c.fragmentSource,g.fragmentSource).join("\n"),Z=B.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",ao,Zo.vertexSource,_c.vertexSource,qr.vertexSource,g.vertexSource).join("\n"),W=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(W,$),I.compileShader(W),I.attachShader(this.program,W);const K=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())this.failedToCreate=!0;else{I.shaderSource(K,Z),I.compileShader(K),I.attachShader(this.program,K),this.attributes={},this.numAttributes=k.length;for(let q=0;q<this.numAttributes;q++)k[q]&&(I.bindAttribLocation(this.program,q,k[q]),this.attributes[k[q]]=q);I.linkProgram(this.program),I.deleteShader(K),I.deleteShader(W),this.fixedUniforms=b(a),this.binderUniforms=v?v.getUniforms(a):[],D.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new d.Uniform1i(q=a),u_dem_prev:new d.Uniform1i(q),u_dem_unpack:new d.Uniform4f(q),u_dem_tl:new d.Uniform2f(q),u_dem_scale:new d.Uniform1f(q),u_dem_tl_prev:new d.Uniform2f(q),u_dem_scale_prev:new d.Uniform1f(q),u_dem_size:new d.Uniform1f(q),u_dem_lerp:new d.Uniform1f(q),u_exaggeration:new d.Uniform1f(q),u_depth:new d.Uniform1i(q),u_depth_size_inv:new d.Uniform2f(q),u_meter_to_dem:new d.Uniform1f(q),u_label_plane_matrix_inv:new d.UniformMatrix4f(q)}),D.includes("GLOBE")&&(this.globeUniforms=(q=>({u_tile_tl_up:new d.Uniform3f(q),u_tile_tr_up:new d.Uniform3f(q),u_tile_br_up:new d.Uniform3f(q),u_tile_bl_up:new d.Uniform3f(q),u_tile_up_scale:new d.Uniform1f(q)}))(a)),D.includes("FOG")&&(this.fogUniforms=(q=>({u_fog_matrix:new d.UniformMatrix4f(q),u_fog_range:new d.Uniform2f(q),u_fog_color:new d.Uniform4f(q),u_fog_horizon_blend:new d.Uniform1f(q),u_fog_temporal_offset:new d.Uniform1f(q),u_frustum_tl:new d.Uniform3f(q),u_frustum_tr:new d.Uniform3f(q),u_frustum_br:new d.Uniform3f(q),u_frustum_bl:new d.Uniform3f(q),u_globe_pos:new d.Uniform3f(q),u_globe_radius:new d.Uniform1f(q),u_globe_transition:new d.Uniform1f(q),u_is_globe:new d.Uniform1i(q),u_viewport:new d.Uniform2f(q)}))(a))}var q}setTerrainUniformValues(a,u){if(!this.terrainUniforms)return;const g=this.terrainUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const v in u)g[v]&&g[v].set(this.program,v,u[v])}}setGlobeUniformValues(a,u){if(!this.globeUniforms)return;const g=this.globeUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const v in u)g[v]&&g[v].set(this.program,v,u[v])}}setFogUniformValues(a,u){if(!this.fogUniforms)return;const g=this.fogUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const v in u)g[v].set(this.program,v,u[v])}}draw(a,u,g,v,b,D,I,M,R,k,B,$,Z,W,K){const q=a.gl;if(this.failedToCreate)return;a.program.set(this.program),a.setDepthMode(g),a.setStencilMode(v),a.setColorMode(b),a.setCullFace(D);for(const J of Object.keys(this.fixedUniforms))this.fixedUniforms[J].set(this.program,J,I[J]);W&&W.setUniforms(this.program,a,this.binderUniforms,$,{zoom:Z});const H={[q.LINES]:2,[q.TRIANGLES]:3,[q.LINE_STRIP]:1}[u];for(const J of B.get()){const Q=J.vaos||(J.vaos={});(Q[M]||(Q[M]=new Bf)).bind(a,this,R,W?W.getPaintVertexBuffers():[],k,J.vertexOffset,K||[]),q.drawElements(u,J.primitiveLength*H,q.UNSIGNED_SHORT,J.primitiveOffset*H*2)}}}function ji(f,a){const u=Math.pow(2,a.tileID.overscaledZ),g=a.tileSize*Math.pow(2,f.transform.tileZoom)/u,v=g*(a.tileID.canonical.x+a.tileID.wrap*u),b=g*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_tile_units_to_pixels:1/Uo(a,1,f.transform.tileZoom),u_pixel_coord_upper:[v>>16,b>>16],u_pixel_coord_lower:[65535&v,65535&b]}}const Vn=d.create(),nr=(f,a,u,g,v,b,D,I,M,R,k)=>{const B=a.style.light,$=B.properties.get("position"),Z=[$.x,$.y,$.z],W=d.create$1();"viewport"===B.properties.get("anchor")&&(d.fromRotation(W,-a.transform.angle),d.transformMat3(Z,Z,W));const K=B.properties.get("color"),q=a.transform,H={u_matrix:f,u_lightpos:Z,u_lightintensity:B.properties.get("intensity"),u_lightcolor:[K.r,K.g,K.b],u_vertical_gradient:+u,u_opacity:g,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Vn,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:v,u_edge_radius:b};return"globe"===q.projection.name&&(H.u_tile_id=[D.canonical.x,D.canonical.y,1<<D.canonical.z],H.u_zoom_transition=M,H.u_inv_rot_matrix=k,H.u_merc_center=R,H.u_up_dir=q.projection.upVector(new d.CanonicalTileID(0,0,0),R[0]*d.EXTENT,R[1]*d.EXTENT),H.u_height_lift=I),H},mr=(f,a,u,g,v,b,D,I,M,R,k,B)=>{const $=nr(f,a,u,g,v,b,D,M,R,k,B),Z={u_height_factor:-Math.pow(2,D.overscaledZ)/I.tileSize/8};return d.extend($,ji(a,I),Z)},Ys=f=>({u_matrix:f}),ir=(f,a,u)=>d.extend(Ys(f),ji(a,u)),Cr=(f,a)=>({u_matrix:f,u_world:a}),pt=(f,a,u,g)=>d.extend(ir(f,a,u),{u_world:g}),rn=d.create(),ei=(f,a,u,g,v,b)=>{const D=f.transform,I="globe"===D.projection.name;let M;if("map"===b.paint.get("circle-pitch-alignment"))if(I){const k=d.globePixelsToTileUnits(D.zoom,a.canonical)*D._pixelsPerMercatorPixel;M=Float32Array.from([k,0,0,k])}else M=D.calculatePixelsToTileUnitsMatrix(u);else M=new Float32Array([D.pixelsToGLUnits[0],0,0,D.pixelsToGLUnits[1]]);const R={u_camera_to_center_distance:D.cameraToCenterDistance,u_matrix:f.translatePosMatrix(a.projMatrix,u,b.paint.get("circle-translate"),b.paint.get("circle-translate-anchor")),u_device_pixel_ratio:d.exported.devicePixelRatio,u_extrude_scale:M,u_inv_rot_matrix:rn,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(I){R.u_inv_rot_matrix=g,R.u_merc_center=v,R.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],R.u_zoom_transition=d.globeToMercatorTransition(D.zoom);const k=v[0]*d.EXTENT,B=v[1]*d.EXTENT;R.u_up_dir=D.projection.upVector(new d.CanonicalTileID(0,0,0),k,B)}return R},Wr=f=>{const a=[];return"map"===f.paint.get("circle-pitch-alignment")&&a.push("PITCH_WITH_MAP"),"map"===f.paint.get("circle-pitch-scale")&&a.push("SCALE_WITH_MAP"),a},wo=(f,a,u,g)=>{const v=d.EXTENT/u.tileSize;return{u_matrix:f,u_camera_to_center_distance:a.getCameraToCenterDistance(g),u_extrude_scale:[a.pixelsToGLUnits[0]/v,a.pixelsToGLUnits[1]/v]}},ci=(f,a,u=1)=>({u_matrix:f,u_color:a,u_overlay:0,u_overlay_scale:u}),Qs=d.create(),ti=(f,a,u,g,v,b,D)=>{const I=f.transform,M="globe"===I.projection.name,R=M?d.globePixelsToTileUnits(I.zoom,a.canonical)*I._pixelsPerMercatorPixel:Uo(u,1,b),k={u_matrix:a.projMatrix,u_extrude_scale:R,u_intensity:D,u_inv_rot_matrix:Qs,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(M){k.u_inv_rot_matrix=g,k.u_merc_center=v,k.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],k.u_zoom_transition=d.globeToMercatorTransition(I.zoom);const B=v[0]*d.EXTENT,$=v[1]*d.EXTENT;k.u_up_dir=I.projection.upVector(new d.CanonicalTileID(0,0,0),B,$)}return k},ka=(f,a,u,g,v,b,D)=>{const I=f.transform,M=I.calculatePixelsToTileUnitsMatrix(a);return{u_matrix:gl(f,a,u,g),u_pixels_to_tile_units:M,u_device_pixel_ratio:b,u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:v,u_texsize:xs(u)?a.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:en(a,f.transform),u_alpha_discard_threshold:0,u_trim_offset:D}},Ir=(f,a,u,g,v)=>{const b=f.transform;return{u_matrix:gl(f,a,u,g),u_texsize:a.imageAtlasTexture.size,u_pixels_to_tile_units:b.calculatePixelsToTileUnitsMatrix(a),u_device_pixel_ratio:v,u_image:0,u_tile_units_to_pixels:en(a,b),u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function en(f,a){return 1/Uo(f,1,a.tileZoom)}function gl(f,a,u,g){return f.translatePosMatrix(g||a.tileID.projMatrix,a,u.paint.get("line-translate"),u.paint.get("line-translate-anchor"))}function xs(f){const a=f.paint.get("line-dasharray").value;return a.value||"constant"!==a.kind}const Du=(f,a,u,g,v,b)=>{return{u_matrix:f,u_tl_parent:a,u_scale_parent:u,u_fade_t:g.mix,u_opacity:g.opacity*v.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:v.paint.get("raster-brightness-min"),u_brightness_high:v.paint.get("raster-brightness-max"),u_saturation_factor:(I=v.paint.get("raster-saturation"),I>0?1-1/(1.001-I):-I),u_contrast_factor:(D=v.paint.get("raster-contrast"),D>0?1/(1-D):1+D),u_spin_weights:bs(v.paint.get("raster-hue-rotate")),u_perspective_transform:b};var D,I};function bs(f){f*=Math.PI/180;const a=Math.sin(f),u=Math.cos(f);return[(2*u+1)/3,(-Math.sqrt(3)*a-u+1)/3,(Math.sqrt(3)*a-u+1)/3]}const Ui=d.create(),Js=(f,a,u,g,v,b,D,I,M,R,k,B,$,Z,W,K)=>{const q=v.transform,H={u_is_size_zoom_constant:+("constant"===f||"source"===f),u_is_size_feature_constant:+("constant"===f||"camera"===f),u_size_t:a?a.uSizeT:0,u_size:a?a.uSize:0,u_camera_to_center_distance:q.cameraToCenterDistance,u_rotate_symbol:+u,u_aspect_ratio:q.width/q.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:D,u_coord_matrix:I,u_is_text:+M,u_pitch_with_map:+g,u_texsize:R,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ui,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Ui,u_up_vector:[0,-1,0]};return"globe"===K.name&&(H.u_tile_id=[k.canonical.x,k.canonical.y,1<<k.canonical.z],H.u_zoom_transition=B,H.u_inv_rot_matrix=Z,H.u_merc_center=$,H.u_camera_forward=q._camera.forward(),H.u_ecef_origin=d.globeECEFOrigin(q.globeMatrix,k.toUnwrapped()),H.u_tile_matrix=Float32Array.from(q.globeMatrix),H.u_up_vector=W),H},Ra=(f,a,u,g,v,b,D,I,M,R,k,B,$,Z,W,K,q)=>d.extend(Js(f,a,u,g,v,b,D,I,M,R,B,$,Z,W,K,q),{u_gamma_scale:g?v.transform.cameraToCenterDistance*Math.cos(v.terrain?0:v.transform._pitch):1,u_device_pixel_ratio:d.exported.devicePixelRatio,u_is_halo:+k}),Sr=(f,a,u,g,v,b,D,I,M,R,k,B,$,Z,W,K)=>d.extend(Ra(f,a,u,g,v,b,D,I,!0,M,!0,k,B,$,Z,W,K),{u_texsize_icon:R,u_texture_icon:1}),_l=(f,a,u)=>({u_matrix:f,u_opacity:a,u_color:u}),Cu=(f,a,u,g,v)=>d.extend(function(b,D,I){const M=D.imageManager.getPattern(b.toString()),{width:R,height:k}=D.imageManager.getPixelSize(),B=Math.pow(2,I.tileID.overscaledZ),$=I.tileSize*Math.pow(2,D.transform.tileZoom)/B,Z=$*(I.tileID.canonical.x+I.tileID.wrap*B),W=$*I.tileID.canonical.y;return{u_image:0,u_pattern_tl:M.tl,u_pattern_br:M.br,u_texsize:[R,k],u_pattern_size:M.displaySize,u_tile_units_to_pixels:1/Uo(I,1,D.transform.tileZoom),u_pixel_coord_upper:[Z>>16,W>>16],u_pixel_coord_lower:[65535&Z,65535&W]}}(g,u,v),{u_matrix:f,u_opacity:a}),Jn={fillExtrusion:f=>({u_matrix:new d.UniformMatrix4f(f),u_lightpos:new d.Uniform3f(f),u_lightintensity:new d.Uniform1f(f),u_lightcolor:new d.Uniform3f(f),u_vertical_gradient:new d.Uniform1f(f),u_opacity:new d.Uniform1f(f),u_edge_radius:new d.Uniform1f(f),u_ao:new d.Uniform2f(f),u_tile_id:new d.Uniform3f(f),u_zoom_transition:new d.Uniform1f(f),u_inv_rot_matrix:new d.UniformMatrix4f(f),u_merc_center:new d.Uniform2f(f),u_up_dir:new d.Uniform3f(f),u_height_lift:new d.Uniform1f(f)}),fillExtrusionPattern:f=>({u_matrix:new d.UniformMatrix4f(f),u_lightpos:new d.Uniform3f(f),u_lightintensity:new d.Uniform1f(f),u_lightcolor:new d.Uniform3f(f),u_vertical_gradient:new d.Uniform1f(f),u_height_factor:new d.Uniform1f(f),u_edge_radius:new d.Uniform1f(f),u_ao:new d.Uniform2f(f),u_tile_id:new d.Uniform3f(f),u_zoom_transition:new d.Uniform1f(f),u_inv_rot_matrix:new d.UniformMatrix4f(f),u_merc_center:new d.Uniform2f(f),u_up_dir:new d.Uniform3f(f),u_height_lift:new d.Uniform1f(f),u_image:new d.Uniform1i(f),u_texsize:new d.Uniform2f(f),u_pixel_coord_upper:new d.Uniform2f(f),u_pixel_coord_lower:new d.Uniform2f(f),u_tile_units_to_pixels:new d.Uniform1f(f),u_opacity:new d.Uniform1f(f)}),fill:f=>({u_matrix:new d.UniformMatrix4f(f)}),fillPattern:f=>({u_matrix:new d.UniformMatrix4f(f),u_image:new d.Uniform1i(f),u_texsize:new d.Uniform2f(f),u_pixel_coord_upper:new d.Uniform2f(f),u_pixel_coord_lower:new d.Uniform2f(f),u_tile_units_to_pixels:new d.Uniform1f(f)}),fillOutline:f=>({u_matrix:new d.UniformMatrix4f(f),u_world:new d.Uniform2f(f)}),fillOutlinePattern:f=>({u_matrix:new d.UniformMatrix4f(f),u_world:new d.Uniform2f(f),u_image:new d.Uniform1i(f),u_texsize:new d.Uniform2f(f),u_pixel_coord_upper:new d.Uniform2f(f),u_pixel_coord_lower:new d.Uniform2f(f),u_tile_units_to_pixels:new d.Uniform1f(f)}),circle:f=>({u_camera_to_center_distance:new d.Uniform1f(f),u_extrude_scale:new d.UniformMatrix2f(f),u_device_pixel_ratio:new d.Uniform1f(f),u_matrix:new d.UniformMatrix4f(f),u_inv_rot_matrix:new d.UniformMatrix4f(f),u_merc_center:new d.Uniform2f(f),u_tile_id:new d.Uniform3f(f),u_zoom_transition:new d.Uniform1f(f),u_up_dir:new d.Uniform3f(f)}),collisionBox:f=>({u_matrix:new d.UniformMatrix4f(f),u_camera_to_center_distance:new d.Uniform1f(f),u_extrude_scale:new d.Uniform2f(f)}),collisionCircle:f=>({u_matrix:new d.UniformMatrix4f(f),u_inv_matrix:new d.UniformMatrix4f(f),u_camera_to_center_distance:new d.Uniform1f(f),u_viewport_size:new d.Uniform2f(f)}),debug:f=>({u_color:new d.UniformColor(f),u_matrix:new d.UniformMatrix4f(f),u_overlay:new d.Uniform1i(f),u_overlay_scale:new d.Uniform1f(f)}),clippingMask:f=>({u_matrix:new d.UniformMatrix4f(f)}),heatmap:f=>({u_extrude_scale:new d.Uniform1f(f),u_intensity:new d.Uniform1f(f),u_matrix:new d.UniformMatrix4f(f),u_inv_rot_matrix:new d.UniformMatrix4f(f),u_merc_center:new d.Uniform2f(f),u_tile_id:new d.Uniform3f(f),u_zoom_transition:new d.Uniform1f(f),u_up_dir:new d.Uniform3f(f)}),heatmapTexture:f=>({u_image:new d.Uniform1i(f),u_color_ramp:new d.Uniform1i(f),u_opacity:new d.Uniform1f(f)}),hillshade:f=>({u_matrix:new d.UniformMatrix4f(f),u_image:new d.Uniform1i(f),u_latrange:new d.Uniform2f(f),u_light:new d.Uniform2f(f),u_shadow:new d.UniformColor(f),u_highlight:new d.UniformColor(f),u_accent:new d.UniformColor(f)}),hillshadePrepare:f=>({u_matrix:new d.UniformMatrix4f(f),u_image:new d.Uniform1i(f),u_dimension:new d.Uniform2f(f),u_zoom:new d.Uniform1f(f),u_unpack:new d.Uniform4f(f)}),line:f=>({u_matrix:new d.UniformMatrix4f(f),u_pixels_to_tile_units:new d.UniformMatrix2f(f),u_device_pixel_ratio:new d.Uniform1f(f),u_units_to_pixels:new d.Uniform2f(f),u_dash_image:new d.Uniform1i(f),u_gradient_image:new d.Uniform1i(f),u_image_height:new d.Uniform1f(f),u_texsize:new d.Uniform2f(f),u_tile_units_to_pixels:new d.Uniform1f(f),u_alpha_discard_threshold:new d.Uniform1f(f),u_trim_offset:new d.Uniform2f(f)}),linePattern:f=>({u_matrix:new d.UniformMatrix4f(f),u_texsize:new d.Uniform2f(f),u_pixels_to_tile_units:new d.UniformMatrix2f(f),u_device_pixel_ratio:new d.Uniform1f(f),u_image:new d.Uniform1i(f),u_units_to_pixels:new d.Uniform2f(f),u_tile_units_to_pixels:new d.Uniform1f(f),u_alpha_discard_threshold:new d.Uniform1f(f)}),raster:f=>({u_matrix:new d.UniformMatrix4f(f),u_tl_parent:new d.Uniform2f(f),u_scale_parent:new d.Uniform1f(f),u_fade_t:new d.Uniform1f(f),u_opacity:new d.Uniform1f(f),u_image0:new d.Uniform1i(f),u_image1:new d.Uniform1i(f),u_brightness_low:new d.Uniform1f(f),u_brightness_high:new d.Uniform1f(f),u_saturation_factor:new d.Uniform1f(f),u_contrast_factor:new d.Uniform1f(f),u_spin_weights:new d.Uniform3f(f),u_perspective_transform:new d.Uniform2f(f)}),symbolIcon:f=>({u_is_size_zoom_constant:new d.Uniform1i(f),u_is_size_feature_constant:new d.Uniform1i(f),u_size_t:new d.Uniform1f(f),u_size:new d.Uniform1f(f),u_camera_to_center_distance:new d.Uniform1f(f),u_rotate_symbol:new d.Uniform1i(f),u_aspect_ratio:new d.Uniform1f(f),u_fade_change:new d.Uniform1f(f),u_matrix:new d.UniformMatrix4f(f),u_label_plane_matrix:new d.UniformMatrix4f(f),u_coord_matrix:new d.UniformMatrix4f(f),u_is_text:new d.Uniform1i(f),u_pitch_with_map:new d.Uniform1i(f),u_texsize:new d.Uniform2f(f),u_tile_id:new d.Uniform3f(f),u_zoom_transition:new d.Uniform1f(f),u_inv_rot_matrix:new d.UniformMatrix4f(f),u_merc_center:new d.Uniform2f(f),u_camera_forward:new d.Uniform3f(f),u_tile_matrix:new d.UniformMatrix4f(f),u_up_vector:new d.Uniform3f(f),u_ecef_origin:new d.Uniform3f(f),u_texture:new d.Uniform1i(f)}),symbolSDF:f=>({u_is_size_zoom_constant:new d.Uniform1i(f),u_is_size_feature_constant:new d.Uniform1i(f),u_size_t:new d.Uniform1f(f),u_size:new d.Uniform1f(f),u_camera_to_center_distance:new d.Uniform1f(f),u_rotate_symbol:new d.Uniform1i(f),u_aspect_ratio:new d.Uniform1f(f),u_fade_change:new d.Uniform1f(f),u_matrix:new d.UniformMatrix4f(f),u_label_plane_matrix:new d.UniformMatrix4f(f),u_coord_matrix:new d.UniformMatrix4f(f),u_is_text:new d.Uniform1i(f),u_pitch_with_map:new d.Uniform1i(f),u_texsize:new d.Uniform2f(f),u_texture:new d.Uniform1i(f),u_gamma_scale:new d.Uniform1f(f),u_device_pixel_ratio:new d.Uniform1f(f),u_tile_id:new d.Uniform3f(f),u_zoom_transition:new d.Uniform1f(f),u_inv_rot_matrix:new d.UniformMatrix4f(f),u_merc_center:new d.Uniform2f(f),u_camera_forward:new d.Uniform3f(f),u_tile_matrix:new d.UniformMatrix4f(f),u_up_vector:new d.Uniform3f(f),u_ecef_origin:new d.Uniform3f(f),u_is_halo:new d.Uniform1i(f)}),symbolTextAndIcon:f=>({u_is_size_zoom_constant:new d.Uniform1i(f),u_is_size_feature_constant:new d.Uniform1i(f),u_size_t:new d.Uniform1f(f),u_size:new d.Uniform1f(f),u_camera_to_center_distance:new d.Uniform1f(f),u_rotate_symbol:new d.Uniform1i(f),u_aspect_ratio:new d.Uniform1f(f),u_fade_change:new d.Uniform1f(f),u_matrix:new d.UniformMatrix4f(f),u_label_plane_matrix:new d.UniformMatrix4f(f),u_coord_matrix:new d.UniformMatrix4f(f),u_is_text:new d.Uniform1i(f),u_pitch_with_map:new d.Uniform1i(f),u_texsize:new d.Uniform2f(f),u_texsize_icon:new d.Uniform2f(f),u_texture:new d.Uniform1i(f),u_texture_icon:new d.Uniform1i(f),u_gamma_scale:new d.Uniform1f(f),u_device_pixel_ratio:new d.Uniform1f(f),u_is_halo:new d.Uniform1i(f)}),background:f=>({u_matrix:new d.UniformMatrix4f(f),u_opacity:new d.Uniform1f(f),u_color:new d.UniformColor(f)}),backgroundPattern:f=>({u_matrix:new d.UniformMatrix4f(f),u_opacity:new d.Uniform1f(f),u_image:new d.Uniform1i(f),u_pattern_tl:new d.Uniform2f(f),u_pattern_br:new d.Uniform2f(f),u_texsize:new d.Uniform2f(f),u_pattern_size:new d.Uniform2f(f),u_pixel_coord_upper:new d.Uniform2f(f),u_pixel_coord_lower:new d.Uniform2f(f),u_tile_units_to_pixels:new d.Uniform1f(f)}),terrainRaster:La,terrainDepth:La,skybox:f=>({u_matrix:new d.UniformMatrix4f(f),u_sun_direction:new d.Uniform3f(f),u_cubemap:new d.Uniform1i(f),u_opacity:new d.Uniform1f(f),u_temporal_offset:new d.Uniform1f(f)}),skyboxGradient:f=>({u_matrix:new d.UniformMatrix4f(f),u_color_ramp:new d.Uniform1i(f),u_center_direction:new d.Uniform3f(f),u_radius:new d.Uniform1f(f),u_opacity:new d.Uniform1f(f),u_temporal_offset:new d.Uniform1f(f)}),skyboxCapture:f=>({u_matrix_3f:new d.UniformMatrix3f(f),u_sun_direction:new d.Uniform3f(f),u_sun_intensity:new d.Uniform1f(f),u_color_tint_r:new d.Uniform4f(f),u_color_tint_m:new d.Uniform4f(f),u_luminance:new d.Uniform1f(f)}),globeRaster:f=>({u_proj_matrix:new d.UniformMatrix4f(f),u_globe_matrix:new d.UniformMatrix4f(f),u_normalize_matrix:new d.UniformMatrix4f(f),u_merc_matrix:new d.UniformMatrix4f(f),u_zoom_transition:new d.Uniform1f(f),u_merc_center:new d.Uniform2f(f),u_image0:new d.Uniform1i(f),u_grid_matrix:new d.UniformMatrix3f(f),u_frustum_tl:new d.Uniform3f(f),u_frustum_tr:new d.Uniform3f(f),u_frustum_br:new d.Uniform3f(f),u_frustum_bl:new d.Uniform3f(f),u_globe_pos:new d.Uniform3f(f),u_globe_radius:new d.Uniform1f(f),u_viewport:new d.Uniform2f(f)}),globeAtmosphere:f=>({u_frustum_tl:new d.Uniform3f(f),u_frustum_tr:new d.Uniform3f(f),u_frustum_br:new d.Uniform3f(f),u_frustum_bl:new d.Uniform3f(f),u_horizon:new d.Uniform1f(f),u_transition:new d.Uniform1f(f),u_fadeout_range:new d.Uniform1f(f),u_color:new d.Uniform4f(f),u_high_color:new d.Uniform4f(f),u_space_color:new d.Uniform4f(f),u_star_intensity:new d.Uniform1f(f),u_star_density:new d.Uniform1f(f),u_star_size:new d.Uniform1f(f),u_temporal_offset:new d.Uniform1f(f),u_horizon_angle:new d.Uniform1f(f),u_rotation_matrix:new d.UniformMatrix4f(f)})};let yl;function ep(f,a,u,g,v,b,D){const I=f.context,M=I.gl,R=f.transform,k=f.useProgram("collisionBox"),B=[];let $=0,Z=0;for(let re=0;re<g.length;re++){const ue=g[re],ce=a.getTile(ue),me=ce.getBucket(u);if(!me)continue;const Se=Tn(ue,me,R);let Te=Se;0===v[0]&&0===v[1]||(Te=f.translatePosMatrix(Se,ce,v,b));const _e=D?me.textCollisionBox:me.iconCollisionBox,Ze=me.collisionCircleArray;if(Ze.length>0){const xe=d.create(),Le=Te;d.mul(xe,me.placementInvProjMatrix,R.glCoordMatrix),d.mul(xe,xe,me.placementViewportMatrix),B.push({circleArray:Ze,circleOffset:Z,transform:Le,invTransform:xe,projection:me.getProjection()}),$+=Ze.length/4,Z=$}_e&&(f.terrain&&f.terrain.setupElevationDraw(ce,k),k.draw(I,M.LINES,d.DepthMode.disabled,d.StencilMode.disabled,f.colorModeForRenderPass(),d.CullFaceMode.disabled,wo(Te,R,ce,me.getProjection()),u.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,null,R.zoom,null,[_e.collisionVertexBuffer,_e.collisionVertexBufferExt]))}if(!D||!B.length)return;const W=f.useProgram("collisionCircle"),K=new d.StructArrayLayout2f1f2i16;K.resize(4*$),K._trim();let q=0;for(const re of B)for(let ue=0;ue<re.circleArray.length/4;ue++){const ce=4*ue,me=re.circleArray[ce+0],Se=re.circleArray[ce+1],Te=re.circleArray[ce+2],_e=re.circleArray[ce+3];K.emplace(q++,me,Se,Te,_e,0),K.emplace(q++,me,Se,Te,_e,1),K.emplace(q++,me,Se,Te,_e,2),K.emplace(q++,me,Se,Te,_e,3)}(!yl||yl.length<2*$)&&(yl=function(re){const ue=2*re,ce=new d.StructArrayLayout3ui6;ce.resize(ue),ce._trim();for(let me=0;me<ue;me++){const Se=6*me;ce.uint16[Se+0]=4*me+0,ce.uint16[Se+1]=4*me+1,ce.uint16[Se+2]=4*me+2,ce.uint16[Se+3]=4*me+2,ce.uint16[Se+4]=4*me+3,ce.uint16[Se+5]=4*me+0}return ce}($));const H=I.createIndexBuffer(yl,!0),J=I.createVertexBuffer(K,d.collisionCircleLayout.members,!0);for(const re of B){const ue={u_matrix:re.transform,u_inv_matrix:re.invTransform,u_camera_to_center_distance:(Q=R).getCameraToCenterDistance(re.projection),u_viewport_size:[Q.width,Q.height]};W.draw(I,M.TRIANGLES,d.DepthMode.disabled,d.StencilMode.disabled,f.colorModeForRenderPass(),d.CullFaceMode.disabled,ue,u.id,J,H,d.SegmentVector.simpleSegment(0,2*re.circleOffset,re.circleArray.length,re.circleArray.length/2),null,R.zoom)}var Q;J.destroy(),H.destroy()}const ea=d.create();function Nh({width:f,height:a,anchor:u,textOffset:g,textScale:v},b){const{horizontalAlign:D,verticalAlign:I}=d.getAnchorAlignment(u),M=-(D-.5)*f,R=-(I-.5)*a,k=d.evaluateVariableOffset(u,g);return new d.pointGeometry((M/v+k[0])*b,(R/v+k[1])*b)}function vl(f,a,u,g,v,b,D,I,M,R,k){const B=f.text.placedSymbolArray,$=f.text.dynamicLayoutVertexArray,Z=f.icon.dynamicLayoutVertexArray,W={},K=f.getProjection(),q=hc(I,K,b),H=b.elevation,J=K.upVectorScale(I.canonical,b.center.lat,b.worldSize).metersToTile;$.clear();for(let Q=0;Q<B.length;Q++){const re=B.get(Q),{tileAnchorX:ue,tileAnchorY:ce,numGlyphs:me}=re,Se=f.allowVerticalPlacement&&!re.placedOrientation,Te=re.hidden||!re.crossTileID||Se?null:g[re.crossTileID];if(Te){let _e=0,Ze=0,xe=0;if(H){const ht=H?H.getAtTileOffset(I,ue,ce):0,[wt,ft,It]=K.upVector(I.canonical,ue,ce);_e=ht*wt*J,Ze=ht*ft*J,xe=ht*It*J}let[Le,Ce,He,Pe]=pr(re.projectedAnchorX+_e,re.projectedAnchorY+Ze,re.projectedAnchorZ+xe,u?q:D);const Fe=st(b.getCameraToCenterDistance(K),Pe);let Qe=v.evaluateSizeForFeature(f.textSizeData,R,re)*Fe/d.ONE_EM;u&&(Qe*=f.tilePixelRatio/M);const ge=Nh(Te,Qe);u?(({x:Le,y:Ce,z:He}=K.projectTilePoint(ue+ge.x,ce+ge.y,I.canonical)),[Le,Ce,He]=pr(Le+_e,Ce+Ze,He+xe,D)):(a&&ge._rotate(-b.angle),Le+=ge.x,Ce+=ge.y,He=0);const Ie=f.allowVerticalPlacement&&re.placedOrientation===d.WritingMode.vertical?Math.PI/2:0;for(let ht=0;ht<me;ht++)d.addDynamicAttributes($,Le,Ce,He,Ie);k&&re.associatedIconIndex>=0&&(W[re.associatedIconIndex]={x:Le,y:Ce,z:He,angle:Ie})}else wi(me,$)}if(k){Z.clear();const Q=f.icon.placedSymbolArray;for(let re=0;re<Q.length;re++){const ue=Q.get(re),{numGlyphs:ce}=ue,me=W[re];if(ue.hidden||!me)wi(ce,Z);else{const{x:Se,y:Te,z:_e,angle:Ze}=me;for(let xe=0;xe<ce;xe++)d.addDynamicAttributes(Z,Se,Te,_e,Ze)}}f.icon.dynamicLayoutVertexBuffer.updateData(Z)}f.text.dynamicLayoutVertexBuffer.updateData($)}function xc(f,a,u){return u.iconsInText&&a?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function Zr(f,a,u,g,v,b,D,I,M,R,k,B){const $=f.context,Z=$.gl,W=f.transform,K="map"===I,q="map"===M,H=K&&"point"!==u.layout.get("symbol-placement"),J=K&&!q&&!H,Q=void 0!==u.layout.get("symbol-sort-key").constantOr(1);let re=!1;const ue=f.depthModeForSublayer(0,d.DepthMode.ReadOnly),ce=[d.mercatorXfromLng(W.center.lng),d.mercatorYfromLat(W.center.lat)],me=u.layout.get("text-variable-anchor"),Se="globe"===W.projection.name,Te=[],_e=[0,-1,0];let Ze=_e;!Se&&!W.mercatorFromTransition||K||(Ze=function(xe){const Le=xe._camera.getWorldToCamera(xe.worldSize,1),Ce=d.multiply([],Le,xe.globeMatrix);d.invert(Ce,Ce);const He=[0,0,0],Pe=[0,1,0,0];return d.transformMat4$1(Pe,Pe,Ce),He[0]=Pe[0],He[1]=Pe[1],He[2]=Pe[2],d.normalize(He,He),He}(W));for(const xe of g){const Le=a.getTile(xe),Ce=Le.getBucket(u);if(!Ce||"mercator"===Ce.projection.name&&Se)continue;const He=v?Ce.text:Ce.icon;if(!He||Ce.fullyClipped||!He.segments.get().length)continue;const Pe=He.programConfigurations.get(u.id),Fe=v||Ce.sdfIcons,Qe=v?Ce.textSizeData:Ce.iconSizeData,ge=q||0!==W.pitch,Ie=d.evaluateSizeForZoom(Qe,W.zoom);let ht,wt,ft,It,Zt=[0,0],mt=null;if(v){if(wt=Le.glyphAtlasTexture,ft=Z.LINEAR,ht=Le.glyphAtlasTexture.size,Ce.iconsInText){Zt=Le.imageAtlasTexture.size,mt=Le.imageAtlasTexture;const uo="composite"===Qe.kind||"camera"===Qe.kind;It=ge||f.options.rotating||f.options.zooming||uo?Z.LINEAR:Z.NEAREST}}else{const uo=1!==u.layout.get("icon-size").constantOr(0)||Ce.iconsNeedLinear;wt=Le.imageAtlasTexture,ft=Fe||f.options.rotating||f.options.zooming||uo||ge?Z.LINEAR:Z.NEAREST,ht=Le.imageAtlasTexture.size}const ut="globe"===Ce.projection.name,xn=ut?Ze:_e,pn=ut?d.globeToMercatorTransition(W.zoom):0,kn=hc(xe,Ce.getProjection(),W),Cn=W.calculatePixelsToTileUnitsMatrix(Le),Hi=Ur(kn,Le.tileID.canonical,q,K,W,Ce.getProjection(),Cn),Qr=f.terrain&&q&&H?d.invert(d.create(),Hi):ea,ar=qd(kn,Le.tileID.canonical,q,K,W,Ce.getProjection(),Cn),Do=me&&Ce.hasTextData(),$n="none"!==u.layout.get("icon-text-fit")&&Do&&Ce.hasIconData();if(H){const uo=W.elevation,ho=uo?uo.getAtTileOffsetFunc(xe,W.center.lat,W.worldSize,Ce.getProjection()):null,Qo=_u(kn,Le.tileID.canonical,q,K,W,Ce.getProjection(),Cn);_t(Ce,kn,f,v,Qo,ar,q,R,ho,xe)}const Nn=H||v&&me||$n,bn=f.translatePosMatrix(kn,Le,b,D),ii=Nn?ea:Hi,yi=f.translatePosMatrix(ar,Le,b,D,!0),Gn=Ce.getProjection().createInversionMatrix(W,xe.canonical),lr=[];f.terrainRenderModeElevated()&&q&&lr.push("PITCH_WITH_MAP_TERRAIN"),ut&&lr.push("PROJECTION_GLOBE_VIEW"),Nn&&lr.push("PROJECTED_POS_ON_VIEWPORT");const Pl=Fe&&0!==u.paint.get(v?"text-halo-width":"icon-halo-width").constantOr(1);let kr;kr=Fe?Ce.iconsInText?Sr(Qe.kind,Ie,J,q,f,bn,ii,yi,ht,Zt,xe,pn,ce,Gn,xn,Ce.getProjection()):Ra(Qe.kind,Ie,J,q,f,bn,ii,yi,v,ht,!0,xe,pn,ce,Gn,xn,Ce.getProjection()):Js(Qe.kind,Ie,J,q,f,bn,ii,yi,v,ht,xe,pn,ce,Gn,xn,Ce.getProjection());const cr={program:f.useProgram(xc(Fe,v,Ce),Pe,lr),buffers:He,uniformValues:kr,atlasTexture:wt,atlasTextureIcon:mt,atlasInterpolation:ft,atlasInterpolationIcon:It,isSDF:Fe,hasHalo:Pl,tile:Le,labelPlaneMatrixInv:Qr};if(Q&&Ce.canOverlap){re=!0;const uo=He.segments.get();for(const ho of uo)Te.push({segments:new d.SegmentVector([ho]),sortKey:ho.sortKey,state:cr})}else Te.push({segments:He.segments,sortKey:0,state:cr})}re&&Te.sort((xe,Le)=>xe.sortKey-Le.sortKey);for(const xe of Te){const Le=xe.state;if(f.terrain&&f.terrain.setupElevationDraw(Le.tile,Le.program,{useDepthForOcclusion:!Se,labelPlaneMatrixInv:Le.labelPlaneMatrixInv}),$.activeTexture.set(Z.TEXTURE0),Le.atlasTexture.bind(Le.atlasInterpolation,Z.CLAMP_TO_EDGE),Le.atlasTextureIcon&&($.activeTexture.set(Z.TEXTURE1),Le.atlasTextureIcon&&Le.atlasTextureIcon.bind(Le.atlasInterpolationIcon,Z.CLAMP_TO_EDGE)),Le.isSDF){const Ce=Le.uniformValues;Le.hasHalo&&(Ce.u_is_halo=1,$i(Le.buffers,xe.segments,u,f,Le.program,ue,k,B,Ce)),Ce.u_is_halo=0}$i(Le.buffers,xe.segments,u,f,Le.program,ue,k,B,Le.uniformValues)}}function $i(f,a,u,g,v,b,D,I,M){const R=g.context,k=[f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.globeExtVertexBuffer];v.draw(R,R.gl.TRIANGLES,b,D,I,d.CullFaceMode.disabled,M,u.id,f.layoutVertexBuffer,f.indexBuffer,a,u.paint,g.transform.zoom,f.programConfigurations.get(u.id),k)}function tp(f,a,u,g,v,b,D){const I=f.context.gl,M=u.paint.get("fill-pattern"),R=M&&M.constantOr(1);let k,B,$,Z,W;D?(B=R&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",k=I.LINES):(B=R?"fillPattern":"fill",k=I.TRIANGLES);for(const K of g){const q=a.getTile(K);if(R&&!q.patternsLoaded())continue;const H=q.getBucket(u);if(!H)continue;f.prepareDrawTile();const J=H.programConfigurations.get(u.id),Q=f.useProgram(B,J);R&&(f.context.activeTexture.set(I.TEXTURE0),q.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),J.updatePaintBuffers());const re=M.constantOr(null);if(re&&q.imageAtlas){const ce=q.imageAtlas.patternPositions[re.toString()];ce&&J.setConstantPatternPositions(ce)}const ue=f.translatePosMatrix(K.projMatrix,q,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor"));if(D){Z=H.indexBuffer2,W=H.segments2;const ce=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[I.drawingBufferWidth,I.drawingBufferHeight];$="fillOutlinePattern"===B&&R?pt(ue,f,q,ce):Cr(ue,ce)}else Z=H.indexBuffer,W=H.segments,$=R?ir(ue,f,q):Ys(ue);f.prepareDrawProgram(f.context,Q,K.toUnwrapped()),Q.draw(f.context,k,v,f.stencilModeForClipping(K),b,d.CullFaceMode.disabled,$,u.id,H.layoutVertexBuffer,Z,W,u.paint,f.transform.zoom,J)}}function rr(f,a,u,g,v,b,D){const I=f.context,M=I.gl,R=f.transform,k=u.paint.get("fill-extrusion-pattern"),B=k.constantOr(1),$=u.paint.get("fill-extrusion-opacity"),Z=[u.paint.get("fill-extrusion-ambient-occlusion-intensity"),u.paint.get("fill-extrusion-ambient-occlusion-radius")],W=u.layout.get("fill-extrusion-edge-radius"),K="globe"===R.projection.name?d.fillExtrusionHeightLift():0,q="globe"===R.projection.name,H=q?d.globeToMercatorTransition(R.zoom):0,J=[d.mercatorXfromLng(R.center.lng),d.mercatorYfromLat(R.center.lat)],Q=[];q&&(Q.push("PROJECTION_GLOBE_VIEW"),f.style.terrainSetForDrapingOnly()&&Q.push("TERRAIN")),Z[0]>0&&Q.push("FAUX_AO");for(const re of g){const ue=a.getTile(re),ce=ue.getBucket(u);if(!ce||ce.projection.name!==R.projection.name)continue;const me=ce.programConfigurations.get(u.id),Se=f.useProgram(B?"fillExtrusionPattern":"fillExtrusion",me,Q);if(f.terrain){const He=f.terrain;if(f.style.terrainSetForDrapingOnly())He.setupElevationDraw(ue,Se,{useMeterToDem:!0});else{if(!ce.enableTerrain)continue;if(He.setupElevationDraw(ue,Se,{useMeterToDem:!0}),Eo(I,a,re,ce,u,He),!ce.centroidVertexBuffer){const Pe=Se.attributes.a_centroid_pos;void 0!==Pe&&M.vertexAttrib2f(Pe,0,0)}}}B&&(f.context.activeTexture.set(M.TEXTURE0),ue.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),me.updatePaintBuffers());const Te=k.constantOr(null);if(Te&&ue.imageAtlas){const He=ue.imageAtlas.patternPositions[Te.toString()];He&&me.setConstantPatternPositions(He)}const _e=f.translatePosMatrix(re.projMatrix,ue,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),Ze=R.projection.createInversionMatrix(R,re.canonical),xe=u.paint.get("fill-extrusion-vertical-gradient"),Le=B?mr(_e,f,xe,$,Z,W,re,ue,K,H,J,Ze):nr(_e,f,xe,$,Z,W,re,K,H,J,Ze);f.prepareDrawProgram(I,Se,re.toUnwrapped());const Ce=[];f.terrain&&Ce.push(ce.centroidVertexBuffer),q&&Ce.push(ce.layoutVertexExtBuffer),Se.draw(I,I.gl.TRIANGLES,v,b,D,d.CullFaceMode.backCCW,Le,u.id,ce.layoutVertexBuffer,ce.indexBuffer,ce.segments,u.paint,f.transform.zoom,me,Ce)}}function Eo(f,a,u,g,v,b){const D=[H=>{let J=H.canonical.x-1,Q=H.wrap;return J<0&&(J=(1<<H.canonical.z)-1,Q--),new d.OverscaledTileID(H.overscaledZ,Q,H.canonical.z,J,H.canonical.y)},H=>{let J=H.canonical.x+1,Q=H.wrap;return J===1<<H.canonical.z&&(J=0,Q++),new d.OverscaledTileID(H.overscaledZ,Q,H.canonical.z,J,H.canonical.y)},H=>new d.OverscaledTileID(H.overscaledZ,H.wrap,H.canonical.z,H.canonical.x,(0===H.canonical.y?1<<H.canonical.z:H.canonical.y)-1),H=>new d.OverscaledTileID(H.overscaledZ,H.wrap,H.canonical.z,H.canonical.x,H.canonical.y===(1<<H.canonical.z)-1?0:H.canonical.y+1)],I=H=>{const J=a.getSource().minzoom,Q=ue=>{const ce=a.getTileByID(ue);if(ce&&ce.hasData())return ce.getBucket(v)},re=[0,-1,1];for(const ue of re){if(H.overscaledZ+ue<J)continue;const ce=Q(H.calculateScaledKey(H.overscaledZ+ue));if(ce)return ce}},M=[0,0,0],R=(H,J)=>(M[0]=Math.min(H.min.y,J.min.y),M[1]=Math.max(H.max.y,J.max.y),M[2]=d.EXTENT-J.min.x>H.max.x?J.min.x-d.EXTENT:H.max.x,M),k=(H,J)=>(M[0]=Math.min(H.min.x,J.min.x),M[1]=Math.max(H.max.x,J.max.x),M[2]=d.EXTENT-J.min.y>H.max.y?J.min.y-d.EXTENT:H.max.y,M),B=[(H,J)=>R(H,J),(H,J)=>R(J,H),(H,J)=>k(H,J),(H,J)=>k(J,H)],$=new d.pointGeometry(0,0);let Z,W,K;const q=(H,J,Q,re,ue)=>{const ce=[[re?Q:H,re?H:Q,0],[re?Q:J,re?J:Q,0]],me=ue<0?d.EXTENT+ue:ue,Se=[re?me:(H+J)/2,re?(H+J)/2:me,0];return 0===Q&&ue<0||0!==Q&&ue>0?b.getForTilePoints(K,[Se],!0,W):ce.push(Se),b.getForTilePoints(u,ce,!0,Z),Math.max(ce[0][2],ce[1][2],Se[2])/b.exaggeration()};for(let H=0;H<4;H++){const J=(H<2?1:5)-H,Q=g.borders[H];if(0===Q.length)continue;const re=K=D[H](u),ue=I(re);if(!(ue&&ue instanceof d.FillExtrusionBucket&&ue.enableTerrain)||g.borderDoneWithNeighborZ[H]===ue.canonical.z&&ue.borderDoneWithNeighborZ[J]===g.canonical.z||(W=b.findDEMTileFor(re),!W||!W.dem))continue;if(!Z){const Te=b.findDEMTileFor(u);if(!Te||!Te.dem)return;Z=Te}const ce=ue.borders[J];let me=0;const Se=ue.borderDoneWithNeighborZ[J]!==g.canonical.z;if(g.canonical.z===ue.canonical.z){for(let Te=0;Te<Q.length;Te++){const _e=g.featuresOnBorder[Q[Te]],Ze=_e.borders[H];let xe;for(;me<ce.length&&(xe=ue.featuresOnBorder[ce[me]],!(xe.borders[J][1]>Ze[0]+3));)Se&&ue.encodeCentroid(void 0,xe,!1),me++;if(xe&&me<ce.length){const Le=me;let Ce=0;for(;!(xe.borders[J][0]>Ze[1]-3)&&(Ce++,++me!==ce.length);)xe=ue.featuresOnBorder[ce[me]];if(xe=ue.featuresOnBorder[ce[Le]],_e.intersectsCount()>1||xe.intersectsCount()>1||1!==Ce){1!==Ce&&(me=Le),g.encodeCentroid(void 0,_e,!1),Se&&ue.encodeCentroid(void 0,xe,!1);continue}const He=B[H](_e,xe),Pe=H%2?d.EXTENT-1:0;$.x=q(He[0],Math.min(d.EXTENT-1,He[1]),Pe,H<2,He[2]),$.y=0,g.encodeCentroid($,_e,!1),Se&&ue.encodeCentroid($,xe,!1)}else g.encodeCentroid(void 0,_e,!1)}g.borderDoneWithNeighborZ[H]=ue.canonical.z,g.needsCentroidUpdate=!0,Se&&(ue.borderDoneWithNeighborZ[J]=g.canonical.z,ue.needsCentroidUpdate=!0)}else{for(const Te of Q)g.encodeCentroid(void 0,g.featuresOnBorder[Te],!1);if(Se){for(const Te of ce)ue.encodeCentroid(void 0,ue.featuresOnBorder[Te],!1);ue.borderDoneWithNeighborZ[J]=g.canonical.z,ue.needsCentroidUpdate=!0}g.borderDoneWithNeighborZ[H]=ue.canonical.z,g.needsCentroidUpdate=!0}}(g.needsCentroidUpdate||!g.centroidVertexBuffer&&0!==g.centroidVertexArray.length)&&g.uploadCentroid(f)}const zh=new d.Color(1,0,0,1),Iu=new d.Color(0,1,0,1),xl=new d.Color(0,0,1,1),Xr=new d.Color(1,0,1,1),np=new d.Color(0,1,1,1);function Vf(f,a,u){const g=f.context,v=f.transform,b=g.gl,D="globe"===v.projection.name,I=D?["PROJECTION_GLOBE_VIEW"]:null;let M=u.projMatrix;if(D&&d.globeToMercatorTransition(v.zoom)>0){const _e=d.transitionTileAABBinECEF(u.canonical,v),Ze=d.globeDenormalizeECEF(_e);M=d.multiply(new Float32Array(16),v.globeMatrix,Ze),d.multiply(M,v.projMatrix,M)}const R=f.useProgram("debug",null,I),k=a.getTileByID(u.key);f.terrain&&f.terrain.setupElevationDraw(k,R);const B=d.DepthMode.disabled,$=d.StencilMode.disabled,Z=f.colorModeForRenderPass(),W="$debug";g.activeTexture.set(b.TEXTURE0),f.emptyTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),D?k._makeGlobeTileDebugBuffers(f.context,v):k._makeDebugTileBoundsBuffers(f.context,v.projection);const K=k._tileDebugBuffer||f.debugBuffer,q=k._tileDebugIndexBuffer||f.debugIndexBuffer,H=k._tileDebugSegments||f.debugSegments;R.draw(g,b.LINE_STRIP,B,$,Z,d.CullFaceMode.disabled,ci(M,d.Color.red),W,K,q,H,null,null,null,[k._globeTileDebugBorderBuffer]);const J=k.latestRawTileData,Q=Math.floor((J&&J.byteLength||0)/1024),re=a.getTile(u).tileSize,ue=512/Math.min(re,512)*(u.overscaledZ/v.zoom)*.5;let ce=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(ce+=` => ${u.overscaledZ}`),ce+=` ${Q}kb`,function(_e,Ze){_e.initDebugOverlayCanvas();const xe=_e.debugOverlayCanvas,Le=_e.context.gl,Ce=_e.debugOverlayCanvas.getContext("2d");Ce.clearRect(0,0,xe.width,xe.height),Ce.shadowColor="white",Ce.shadowBlur=2,Ce.lineWidth=1.5,Ce.strokeStyle="white",Ce.textBaseline="top",Ce.font="bold 36px Open Sans, sans-serif",Ce.fillText(Ze,5,5),Ce.strokeText(Ze,5,5),_e.debugOverlayTexture.update(xe),_e.debugOverlayTexture.bind(Le.LINEAR,Le.CLAMP_TO_EDGE)}(f,ce);const me=k._tileDebugTextBuffer||f.debugBuffer,Se=k._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,Te=k._tileDebugTextSegments||f.debugSegments;R.draw(g,b.TRIANGLES,B,$,d.ColorMode.alphaBlended,d.CullFaceMode.disabled,ci(M,d.Color.transparent,ue),W,me,Se,Te,null,null,null,[k._globeTileDebugTextBuffer])}function Bh(f,a,u,g){ws(f,0,a+u/2,f.transform.width,u,g)}function Su(f,a,u,g){ws(f,a-u/2,0,u,f.transform.height,g)}function ws(f,a,u,g,v,b){const D=f.context,I=D.gl;I.enable(I.SCISSOR_TEST),I.scissor(a*d.exported.devicePixelRatio,u*d.exported.devicePixelRatio,g*d.exported.devicePixelRatio,v*d.exported.devicePixelRatio),D.clear({color:b}),I.disable(I.SCISSOR_TEST)}const Mu=d.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:jf}=Mu;function co(f,a,u,g){f.emplaceBack(a,u,g)}class bl{constructor(a){this.vertexArray=new d.StructArrayLayout3f12,this.indices=new d.StructArrayLayout3ui6,co(this.vertexArray,-1,-1,1),co(this.vertexArray,1,-1,1),co(this.vertexArray,-1,1,1),co(this.vertexArray,1,1,1),co(this.vertexArray,-1,-1,-1),co(this.vertexArray,1,-1,-1),co(this.vertexArray,-1,1,-1),co(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=a.createVertexBuffer(this.vertexArray,jf),this.indexBuffer=a.createIndexBuffer(this.indices),this.segment=d.SegmentVector.simpleSegment(0,0,36,12)}}function wl(f,a,u,g,v,b){const D=f.gl,I=a.paint.get("sky-atmosphere-color"),M=a.paint.get("sky-atmosphere-halo-color"),R=a.paint.get("sky-atmosphere-sun-intensity"),k={u_matrix_3f:d.fromMat4(d.create$1(),g),u_sun_direction:v,u_sun_intensity:R,u_color_tint_r:[(W=I).r,W.g,W.b,W.a],u_color_tint_m:[(K=M).r,K.g,K.b,K.a],u_luminance:5e-5};var W,K;D.framebufferTexture2D(D.FRAMEBUFFER,D.COLOR_ATTACHMENT0,D.TEXTURE_CUBE_MAP_POSITIVE_X+b,a.skyboxTexture,0),u.draw(f,D.TRIANGLES,d.DepthMode.disabled,d.StencilMode.disabled,d.ColorMode.unblended,d.CullFaceMode.frontCW,k,"skyboxCapture",a.skyboxGeometry.vertexBuffer,a.skyboxGeometry.indexBuffer,a.skyboxGeometry.segment)}const ip=d.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Mn{constructor(a){const u=new d.StructArrayLayout5f20;u.emplaceBack(-1,1,1,0,0),u.emplaceBack(1,1,1,1,0),u.emplaceBack(1,-1,1,1,1),u.emplaceBack(-1,-1,1,0,1);const g=new d.StructArrayLayout3ui6;g.emplaceBack(0,1,2),g.emplaceBack(2,3,0),this.vertexBuffer=a.createVertexBuffer(u,ip.members),this.indexBuffer=a.createIndexBuffer(g),this.segments=d.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Au={symbol:function(f,a,u,g,v){if("translucent"!==f.renderPass)return;const b=d.StencilMode.disabled,D=f.colorModeForRenderPass();u.layout.get("text-variable-anchor")&&function(I,M,R,k,B,$,Z){const W=M.transform,K="map"===B,q="map"===$;for(const H of I){const J=k.getTile(H),Q=J.getBucket(R);if(!Q||!Q.text||!Q.text.segments.get().length)continue;const re=d.evaluateSizeForZoom(Q.textSizeData,W.zoom),ue=hc(H,Q.getProjection(),W),ce=W.calculatePixelsToTileUnitsMatrix(J),me=Ur(ue,J.tileID.canonical,q,K,W,Q.getProjection(),ce),Se="none"!==R.layout.get("icon-text-fit")&&Q.hasIconData();if(re){const Te=Math.pow(2,W.zoom-J.tileID.overscaledZ);vl(Q,K,q,Z,d.symbolSize,W,me,H,Te,re,Se)}}}(g,f,u,a,u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),v),0!==u.paint.get("icon-opacity").constantOr(1)&&Zr(f,a,u,g,!1,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),u.layout.get("icon-rotation-alignment"),u.layout.get("icon-pitch-alignment"),u.layout.get("icon-keep-upright"),b,D),0!==u.paint.get("text-opacity").constantOr(1)&&Zr(f,a,u,g,!0,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),u.layout.get("text-keep-upright"),b,D),a.map.showCollisionBoxes&&(ep(f,a,u,g,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),!0),ep(f,a,u,g,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),!1))},circle:function(f,a,u,g){if("translucent"!==f.renderPass)return;const v=u.paint.get("circle-opacity"),b=u.paint.get("circle-stroke-width"),D=u.paint.get("circle-stroke-opacity"),I=void 0!==u.layout.get("circle-sort-key").constantOr(1);if(0===v.constantOr(1)&&(0===b.constantOr(1)||0===D.constantOr(1)))return;const M=f.context,R=M.gl,k=f.transform,B=f.depthModeForSublayer(0,d.DepthMode.ReadOnly),$=d.StencilMode.disabled,Z=f.colorModeForRenderPass(),W="globe"===k.projection.name,K=[d.mercatorXfromLng(k.center.lng),d.mercatorYfromLat(k.center.lat)],q=[];for(let J=0;J<g.length;J++){const Q=g[J],re=a.getTile(Q),ue=re.getBucket(u);if(!ue||ue.projection.name!==k.projection.name)continue;const ce=ue.programConfigurations.get(u.id),me=Wr(u);W&&me.push("PROJECTION_GLOBE_VIEW");const Se=f.useProgram("circle",ce,me),Te=ue.layoutVertexBuffer,_e=ue.globeExtVertexBuffer,Ze=ue.indexBuffer,xe=k.projection.createInversionMatrix(k,Q.canonical),Le={programConfiguration:ce,program:Se,layoutVertexBuffer:Te,globeExtVertexBuffer:_e,indexBuffer:Ze,uniformValues:ei(f,Q,re,xe,K,u),tile:re};if(I){const Ce=ue.segments.get();for(const He of Ce)q.push({segments:new d.SegmentVector([He]),sortKey:He.sortKey,state:Le})}else q.push({segments:ue.segments,sortKey:0,state:Le})}I&&q.sort((J,Q)=>J.sortKey-Q.sortKey);const H={useDepthForOcclusion:!W};for(const J of q){const{programConfiguration:Q,program:re,layoutVertexBuffer:ue,globeExtVertexBuffer:ce,indexBuffer:me,uniformValues:Se,tile:Te}=J.state,_e=J.segments;f.terrain&&f.terrain.setupElevationDraw(Te,re,H),f.prepareDrawProgram(M,re,Te.tileID.toUnwrapped()),re.draw(M,R.TRIANGLES,B,$,Z,d.CullFaceMode.disabled,Se,u.id,ue,me,_e,u.paint,k.zoom,Q,[ce])}},heatmap:function(f,a,u,g){if(0!==u.paint.get("heatmap-opacity"))if("offscreen"===f.renderPass){const v=f.context,b=v.gl,D=d.StencilMode.disabled,I=new d.ColorMode([b.ONE,b.ONE],d.Color.transparent,[!0,!0,!0,!0]);(function(Z,W,K,q){const H=Z.gl,J=W.width*q,Q=W.height*q;Z.activeTexture.set(H.TEXTURE1),Z.viewport.set([0,0,J,Q]);let re=K.heatmapFbo;if(!re||re&&(re.width!==J||re.height!==Q)){re&&re.destroy();const ue=H.createTexture();H.bindTexture(H.TEXTURE_2D,ue),H.texParameteri(H.TEXTURE_2D,H.TEXTURE_WRAP_S,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_2D,H.TEXTURE_WRAP_T,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_2D,H.TEXTURE_MIN_FILTER,H.LINEAR),H.texParameteri(H.TEXTURE_2D,H.TEXTURE_MAG_FILTER,H.LINEAR),re=K.heatmapFbo=Z.createFramebuffer(J,Q,!1),function(ce,me,Se,Te,_e,Ze){const xe=ce.gl;xe.texImage2D(xe.TEXTURE_2D,0,xe.RGBA,_e,Ze,0,xe.RGBA,ce.extRenderToTextureHalfFloat?ce.extTextureHalfFloat.HALF_FLOAT_OES:xe.UNSIGNED_BYTE,null),Te.colorAttachment.set(Se)}(Z,0,ue,re,J,Q)}else H.bindTexture(H.TEXTURE_2D,re.colorAttachment.get()),Z.bindFramebuffer.set(re.framebuffer)})(v,f,u,"globe"===f.transform.projection.name?.5:.25),v.clear({color:d.Color.transparent});const M=f.transform,R="globe"===M.projection.name,k=R?["PROJECTION_GLOBE_VIEW"]:null,B=R?d.CullFaceMode.frontCCW:d.CullFaceMode.disabled,$=[d.mercatorXfromLng(M.center.lng),d.mercatorYfromLat(M.center.lat)];for(let Z=0;Z<g.length;Z++){const W=g[Z];if(a.hasRenderableParent(W))continue;const K=a.getTile(W),q=K.getBucket(u);if(!q||q.projection.name!==M.projection.name)continue;const H=q.programConfigurations.get(u.id),J=f.useProgram("heatmap",H,k),{zoom:Q}=f.transform;f.terrain&&f.terrain.setupElevationDraw(K,J),f.prepareDrawProgram(v,J,W.toUnwrapped());const re=M.projection.createInversionMatrix(M,W.canonical);J.draw(v,b.TRIANGLES,d.DepthMode.disabled,D,I,B,ti(f,W,K,re,$,Q,u.paint.get("heatmap-intensity")),u.id,q.layoutVertexBuffer,q.indexBuffer,q.segments,u.paint,f.transform.zoom,H,R?[q.globeExtVertexBuffer]:null)}v.viewport.set([0,0,f.width,f.height])}else"translucent"===f.renderPass&&(f.context.setColorMode(f.colorModeForRenderPass()),function(v,b){const D=v.context,I=D.gl,M=b.heatmapFbo;if(!M)return;D.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,M.colorAttachment.get()),D.activeTexture.set(I.TEXTURE1);let R=b.colorRampTexture;R||(R=b.colorRampTexture=new d.Texture(D,b.colorRamp,I.RGBA)),R.bind(I.LINEAR,I.CLAMP_TO_EDGE),v.useProgram("heatmapTexture").draw(D,I.TRIANGLES,d.DepthMode.disabled,d.StencilMode.disabled,v.colorModeForRenderPass(),d.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:b.paint.get("heatmap-opacity")},b.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,b.paint,v.transform.zoom)}(f,u))},line:function(f,a,u,g){if("translucent"!==f.renderPass)return;const v=u.paint.get("line-opacity"),b=u.paint.get("line-width");if(0===v.constantOr(1)||0===b.constantOr(1))return;const D=f.depthModeForSublayer(0,d.DepthMode.ReadOnly),I=f.colorModeForRenderPass(),M=f.terrain&&f.terrain.renderingToTexture?1:d.exported.devicePixelRatio,R=u.paint.get("line-dasharray"),k=R.constantOr(1),B=u.layout.get("line-cap"),$=u.paint.get("line-pattern"),Z=$.constantOr(1),W=u.paint.get("line-gradient"),K=Z?"linePattern":"line",q=f.context,H=q.gl,J=(re=>{const ue=[];xs(re)&&ue.push("RENDER_LINE_DASH"),re.paint.get("line-gradient")&&ue.push("RENDER_LINE_GRADIENT");const ce=re.paint.get("line-trim-offset");0===ce[0]&&0===ce[1]||ue.push("RENDER_LINE_TRIM_OFFSET");const me=re.paint.get("line-pattern").constantOr(1),Se=1!==re.paint.get("line-opacity").constantOr(1);return!me&&Se&&ue.push("RENDER_LINE_ALPHA_DISCARD"),ue})(u);let Q=J.includes("RENDER_LINE_ALPHA_DISCARD");f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(Q=!1);for(const re of g){const ue=a.getTile(re);if(Z&&!ue.patternsLoaded())continue;const ce=ue.getBucket(u);if(!ce)continue;f.prepareDrawTile();const me=ce.programConfigurations.get(u.id),Se=f.useProgram(K,me,J),Te=$.constantOr(null);if(Te&&ue.imageAtlas){const Fe=ue.imageAtlas.patternPositions[Te.toString()];Fe&&me.setConstantPatternPositions(Fe)}const _e=R.constantOr(null),Ze=B.constantOr(null);if(!Z&&_e&&Ze&&ue.lineAtlas){const Fe=ue.lineAtlas.getDash(_e,Ze);Fe&&me.setConstantPatternPositions(Fe)}let[xe,Le]=u.paint.get("line-trim-offset");("round"===Ze||"square"===Ze)&&xe!==Le&&(0===xe&&(xe-=1),1===Le&&(Le+=1));const Ce=f.terrain?re.projMatrix:null,He=Z?Ir(f,ue,u,Ce,M):ka(f,ue,u,Ce,ce.lineClipsArray.length,M,[xe,Le]);if(W){const Fe=ce.gradients[u.id];let Qe=Fe.texture;if(u.gradientVersion!==Fe.version){let ge=256;if(u.stepInterpolant){const Ie=a.getSource().maxzoom,ht=re.canonical.z===Ie?Math.ceil(1<<f.transform.maxZoom-re.canonical.z):1;ge=d.clamp(d.nextPowerOfTwo(ce.maxLineLength/d.EXTENT*1024*ht),256,q.maxTextureSize)}Fe.gradient=d.renderColorRamp({expression:u.gradientExpression(),evaluationKey:"lineProgress",resolution:ge,image:Fe.gradient||void 0,clips:ce.lineClipsArray}),Fe.texture?Fe.texture.update(Fe.gradient):Fe.texture=new d.Texture(q,Fe.gradient,H.RGBA),Fe.version=u.gradientVersion,Qe=Fe.texture}q.activeTexture.set(H.TEXTURE1),Qe.bind(u.stepInterpolant?H.NEAREST:H.LINEAR,H.CLAMP_TO_EDGE)}k&&(q.activeTexture.set(H.TEXTURE0),ue.lineAtlasTexture.bind(H.LINEAR,H.REPEAT),me.updatePaintBuffers()),Z&&(q.activeTexture.set(H.TEXTURE0),ue.imageAtlasTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),me.updatePaintBuffers()),f.prepareDrawProgram(q,Se,re.toUnwrapped());const Pe=Fe=>{Se.draw(q,H.TRIANGLES,D,Fe,I,d.CullFaceMode.disabled,He,u.id,ce.layoutVertexBuffer,ce.indexBuffer,ce.segments,u.paint,f.transform.zoom,me,[ce.layoutVertexBuffer2])};if(Q){const Fe=f.stencilModeForClipping(re).ref;0===Fe&&f.terrain&&q.clear({stencil:0});const Qe={func:H.EQUAL,mask:255};He.u_alpha_discard_threshold=.8,Pe(new d.StencilMode(Qe,Fe,255,H.KEEP,H.KEEP,H.INVERT)),He.u_alpha_discard_threshold=0,Pe(new d.StencilMode(Qe,Fe,255,H.KEEP,H.KEEP,H.KEEP))}else Pe(f.stencilModeForClipping(re))}Q&&(f.resetStencilClippingMasks(),f.terrain&&q.clear({stencil:0}))},fill:function(f,a,u,g){const v=u.paint.get("fill-color"),b=u.paint.get("fill-opacity");if(0===b.constantOr(1))return;const D=f.colorModeForRenderPass(),I=u.paint.get("fill-pattern"),M=f.opaquePassEnabledForLayer()&&!I.constantOr(1)&&1===v.constantOr(d.Color.transparent).a&&1===b.constantOr(0)?"opaque":"translucent";if(f.renderPass===M){const R=f.depthModeForSublayer(1,"opaque"===f.renderPass?d.DepthMode.ReadWrite:d.DepthMode.ReadOnly);tp(f,a,u,g,R,D,!1)}if("translucent"===f.renderPass&&u.paint.get("fill-antialias")){const R=f.depthModeForSublayer(u.getPaintProperty("fill-outline-color")?2:0,d.DepthMode.ReadOnly);tp(f,a,u,g,R,D,!0)}},"fill-extrusion":function(f,a,u,g){const v=u.paint.get("fill-extrusion-opacity");if(0!==v&&"translucent"===f.renderPass){const b=new d.DepthMode(f.context.gl.LEQUAL,d.DepthMode.ReadWrite,f.depthRangeFor3D);if(1!==v||u.paint.get("fill-extrusion-pattern").constantOr(1))rr(f,a,u,g,b,d.StencilMode.disabled,d.ColorMode.disabled),rr(f,a,u,g,b,f.stencilModeFor3D(),f.colorModeForRenderPass()),f.resetStencilClippingMasks();else{const D=f.colorModeForRenderPass();rr(f,a,u,g,b,d.StencilMode.disabled,D)}}},hillshade:function(f,a,u,g){if("offscreen"!==f.renderPass&&"translucent"!==f.renderPass)return;const v=f.context,b=f.depthModeForSublayer(0,d.DepthMode.ReadOnly),D=f.colorModeForRenderPass(),I=f.terrain&&f.terrain.renderingToTexture,[M,R]="translucent"!==f.renderPass||I?[{},g]:f.stencilConfigForOverlap(g);for(const k of R){const B=a.getTile(k);if(B.needsHillshadePrepare&&"offscreen"===f.renderPass)Pa(f,B,u,b,d.StencilMode.disabled,D);else if("translucent"===f.renderPass){const $=I&&f.terrain?f.terrain.stencilModeForRTTOverlap(k):M[k.overscaledZ];Ks(f,k,B,u,b,$,D)}}v.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,a,u,g,v,b){if("translucent"!==f.renderPass||0===u.paint.get("raster-opacity")||!g.length)return;const D=f.context,I=D.gl,M=a.getSource(),R=f.useProgram("raster"),k=f.colorModeForRenderPass(),B=f.terrain&&f.terrain.renderingToTexture,[$,Z]=M instanceof de||B?[{},g]:f.stencilConfigForOverlap(g),W=Z[Z.length-1].overscaledZ,K=!f.options.moving;for(const q of Z){const H=B?d.DepthMode.disabled:f.depthModeForSublayer(q.overscaledZ-W,1===u.paint.get("raster-opacity")?d.DepthMode.ReadWrite:d.DepthMode.ReadOnly,I.LESS),J=q.toUnwrapped(),Q=a.getTile(q);if(B&&(!Q||!Q.hasData()))continue;const re=B?q.projMatrix:f.transform.calculateProjMatrix(J,K),ue=f.terrain&&B?f.terrain.stencilModeForRTTOverlap(q):$[q.overscaledZ],ce=b?0:u.paint.get("raster-fade-duration");Q.registerFadeDuration(ce);const me=a.findLoadedParent(q,0),Se=vc(Q,me,a,f.transform,ce);let Te,_e;f.terrain&&f.terrain.prepareDrawTile();const Ze="nearest"===u.paint.get("raster-resampling")?I.NEAREST:I.LINEAR;D.activeTexture.set(I.TEXTURE0),Q.texture.bind(Ze,I.CLAMP_TO_EDGE),D.activeTexture.set(I.TEXTURE1),me?(me.texture.bind(Ze,I.CLAMP_TO_EDGE),Te=Math.pow(2,me.tileID.overscaledZ-Q.tileID.overscaledZ),_e=[Q.tileID.canonical.x*Te%1,Q.tileID.canonical.y*Te%1]):Q.texture.bind(Ze,I.CLAMP_TO_EDGE);const xe=Du(re,_e||[0,0],Te||1,Se,u,M instanceof de?M.perspectiveTransform:[0,0]);if(f.prepareDrawProgram(D,R,J),M instanceof de)M.boundsBuffer&&M.boundsSegments&&R.draw(D,I.TRIANGLES,H,d.StencilMode.disabled,k,d.CullFaceMode.disabled,xe,u.id,M.boundsBuffer,f.quadTriangleIndexBuffer,M.boundsSegments);else{const{tileBoundsBuffer:Le,tileBoundsIndexBuffer:Ce,tileBoundsSegments:He}=f.getTileBoundsBuffers(Q);R.draw(D,I.TRIANGLES,H,ue,k,d.CullFaceMode.disabled,xe,u.id,Le,Ce,He)}}f.resetStencilClippingMasks()},background:function(f,a,u,g){const v=u.paint.get("background-color"),b=u.paint.get("background-opacity");if(0===b)return;const D=f.context,I=D.gl,M=f.transform,R=M.tileSize,k=u.paint.get("background-pattern");if(f.isPatternMissing(k))return;const B=!k&&1===v.a&&1===b&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==B)return;const $=d.StencilMode.disabled,Z=f.depthModeForSublayer(0,"opaque"===B?d.DepthMode.ReadWrite:d.DepthMode.ReadOnly),W=f.colorModeForRenderPass(),K=f.useProgram(k?"backgroundPattern":"background");let q,H=g;H||(q=f.getBackgroundTiles(),H=Object.values(q).map(J=>J.tileID)),k&&(D.activeTexture.set(I.TEXTURE0),f.imageManager.bind(f.context));for(const J of H){const Q=J.toUnwrapped(),re=g?J.projMatrix:f.transform.calculateProjMatrix(Q);f.prepareDrawTile();const ue=a?a.getTile(J):q?q[J.key]:new d.Tile(J,R,M.zoom,f),ce=k?Cu(re,b,f,k,{tileID:J,tileSize:R}):_l(re,b,v);f.prepareDrawProgram(D,K,Q);const{tileBoundsBuffer:me,tileBoundsIndexBuffer:Se,tileBoundsSegments:Te}=f.getTileBoundsBuffers(ue);K.draw(D,I.TRIANGLES,Z,$,W,d.CullFaceMode.disabled,ce,u.id,me,Se,Te)}},sky:function(f,a,u){const g=f.transform,v="mercator"===g.projection.name||"globe"===g.projection.name?1:d.smoothstep(7,8,g.zoom),b=u.paint.get("sky-opacity")*v;if(0===b)return;const D=f.context,I=u.paint.get("sky-type"),M=new d.DepthMode(D.gl.LEQUAL,d.DepthMode.ReadOnly,[0,1]),R=f.frameCounter/1e3%1;"atmosphere"===I?"offscreen"===f.renderPass?u.needsSkyboxCapture(f)&&(function(k,B,$,Z){const W=k.context,K=W.gl;let q=B.skyboxFbo;if(!q){q=B.skyboxFbo=W.createFramebuffer(32,32,!1),B.skyboxGeometry=new bl(W),B.skyboxTexture=W.gl.createTexture(),K.bindTexture(K.TEXTURE_CUBE_MAP,B.skyboxTexture),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_WRAP_S,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_WRAP_T,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_MIN_FILTER,K.LINEAR),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_MAG_FILTER,K.LINEAR);for(let re=0;re<6;++re)K.texImage2D(K.TEXTURE_CUBE_MAP_POSITIVE_X+re,0,K.RGBA,32,32,0,K.RGBA,K.UNSIGNED_BYTE,null)}W.bindFramebuffer.set(q.framebuffer),W.viewport.set([0,0,32,32]);const H=B.getCenter(k,!0),J=k.useProgram("skyboxCapture"),Q=new Float64Array(16);d.identity(Q),d.rotateY(Q,Q,.5*-Math.PI),wl(W,B,J,Q,H,0),d.identity(Q),d.rotateY(Q,Q,.5*Math.PI),wl(W,B,J,Q,H,1),d.identity(Q),d.rotateX(Q,Q,.5*-Math.PI),wl(W,B,J,Q,H,2),d.identity(Q),d.rotateX(Q,Q,.5*Math.PI),wl(W,B,J,Q,H,3),d.identity(Q),wl(W,B,J,Q,H,4),d.identity(Q),d.rotateY(Q,Q,Math.PI),wl(W,B,J,Q,H,5),W.viewport.set([0,0,k.width,k.height])}(f,u),u.markSkyboxValid(f)):"sky"===f.renderPass&&function(k,B,$,Z,W){const K=k.context,q=K.gl,H=k.transform,J=k.useProgram("skybox");K.activeTexture.set(q.TEXTURE0),q.bindTexture(q.TEXTURE_CUBE_MAP,B.skyboxTexture);const Q={u_matrix:H.skyboxMatrix,u_sun_direction:B.getCenter(k,!1),u_cubemap:0,u_opacity:Z,u_temporal_offset:W};k.prepareDrawProgram(K,J),J.draw(K,q.TRIANGLES,$,d.StencilMode.disabled,k.colorModeForRenderPass(),d.CullFaceMode.backCW,Q,"skybox",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(f,u,M,b,R):"gradient"===I&&"sky"===f.renderPass&&function(k,B,$,Z,W){const K=k.context,q=K.gl,H=k.transform,J=k.useProgram("skyboxGradient");B.skyboxGeometry||(B.skyboxGeometry=new bl(K)),K.activeTexture.set(q.TEXTURE0);let Q=B.colorRampTexture;Q||(Q=B.colorRampTexture=new d.Texture(K,B.colorRamp,q.RGBA)),Q.bind(q.LINEAR,q.CLAMP_TO_EDGE);const re=(ue=H.skyboxMatrix,ce=B.getCenter(k,!1),me=B.paint.get("sky-gradient-radius"),Se=Z,Te=W,{u_matrix:ue,u_color_ramp:0,u_center_direction:ce,u_radius:d.degToRad(me),u_opacity:Se,u_temporal_offset:Te});var ue,ce,me,Se,Te;k.prepareDrawProgram(K,J),J.draw(K,q.TRIANGLES,$,d.StencilMode.disabled,k.colorModeForRenderPass(),d.CullFaceMode.backCW,re,"skyboxGradient",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(f,u,M,b,R)},debug:function(f,a,u){for(let g=0;g<u.length;g++)Vf(f,a,u[g])},custom:function(f,a,u){const g=f.context,v=u.implementation;if(f.transform.projection.unsupportedLayers&&f.transform.projection.unsupportedLayers.includes("custom"))d.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===f.renderPass){const b=v.prerender;b&&(f.setCustomLayerDefaults(),g.setColorMode(f.colorModeForRenderPass()),b.call(v,g.gl,f.transform.customLayerMatrix()),g.setDirty(),f.setBaseState())}else if("translucent"===f.renderPass){f.setCustomLayerDefaults(),g.setColorMode(f.colorModeForRenderPass()),g.setStencilMode(d.StencilMode.disabled);const b="3d"===v.renderingMode?new d.DepthMode(f.context.gl.LEQUAL,d.DepthMode.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,d.DepthMode.ReadOnly);g.setDepthMode(b),v.render(g.gl,f.transform.customLayerMatrix()),g.setDirty(),f.setBaseState(),g.bindFramebuffer.set(null)}}};class kg{constructor(a,u){this.context=new z(a),this.transform=u,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=d.SourceCache.maxUnderzooming+d.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new dl,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(a,u){const g=!!a&&!!a.terrain&&this.transform.projection.supportsTerrain;if(!(g||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Fh(this,a));const v=this._terrain;this.transform.elevation=g?v:null,v.update(a,this.transform,u)}_updateFog(a){const u=a.fog;if(!u||"globe"===this.transform.projection.name||u.getOpacity(this.transform.pitch)<1||u.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[g,v]=u.getFovAdjustedRange(this.transform._fov);if(g>v)return void(this.transform.fogCullDistSq=null);const b=g+.78*(v-g);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(a,u){if(this.width=a*d.exported.devicePixelRatio,this.height=u*d.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style.order)this.style._layers[g].resize()}setup(){const a=this.context,u=new d.StructArrayLayout2i4;u.emplaceBack(0,0),u.emplaceBack(d.EXTENT,0),u.emplaceBack(0,d.EXTENT),u.emplaceBack(d.EXTENT,d.EXTENT),this.tileExtentBuffer=a.createVertexBuffer(u,d.posAttributes.members),this.tileExtentSegments=d.SegmentVector.simpleSegment(0,0,4,2);const g=new d.StructArrayLayout2i4;g.emplaceBack(0,0),g.emplaceBack(d.EXTENT,0),g.emplaceBack(0,d.EXTENT),g.emplaceBack(d.EXTENT,d.EXTENT),this.debugBuffer=a.createVertexBuffer(g,d.posAttributes.members),this.debugSegments=d.SegmentVector.simpleSegment(0,0,4,5);const v=new d.StructArrayLayout2i4;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=a.createVertexBuffer(v,d.posAttributes.members),this.viewportSegments=d.SegmentVector.simpleSegment(0,0,4,2);const b=new d.StructArrayLayout4i8;b.emplaceBack(0,0,0,0),b.emplaceBack(d.EXTENT,0,d.EXTENT,0),b.emplaceBack(0,d.EXTENT,0,d.EXTENT),b.emplaceBack(d.EXTENT,d.EXTENT,d.EXTENT,d.EXTENT),this.mercatorBoundsBuffer=a.createVertexBuffer(b,d.boundsAttributes.members),this.mercatorBoundsSegments=d.SegmentVector.simpleSegment(0,0,4,2);const D=new d.StructArrayLayout3ui6;D.emplaceBack(0,1,2),D.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=a.createIndexBuffer(D);const I=new d.StructArrayLayout1ui2;for(const R of[0,1,3,2,0])I.emplaceBack(R);this.debugIndexBuffer=a.createIndexBuffer(I),this.emptyTexture=new d.Texture(a,new d.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),a.gl.RGBA),this.identityMat=d.create();const M=this.context.gl;this.stencilClearMode=new d.StencilMode({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO),this.loadTimeStamps.push(d.window.performance.now()),this.atmosphereBuffer=new Mn(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(a){return a._makeTileBoundsBuffers(this.context,this.transform.projection),a._tileBoundsBuffer?{tileBoundsBuffer:a._tileBoundsBuffer,tileBoundsIndexBuffer:a._tileBoundsIndexBuffer,tileBoundsSegments:a._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const a=this.context,u=a.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(a,u.TRIANGLES,d.DepthMode.disabled,this.stencilClearMode,d.ColorMode.disabled,d.CullFaceMode.disabled,yc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(a,u,g){if(!u||this.currentStencilSource===u.id||!a.isTileClipped()||!g||0===g.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let I=!1;for(const M of g)if(void 0===this._tileClippingMaskIDs[M.key]){I=!0;break}if(!I)return}this.currentStencilSource=u.id;const v=this.context,b=v.gl;this.nextStencilID+g.length>256&&this.clearStencil(),v.setColorMode(d.ColorMode.disabled),v.setDepthMode(d.DepthMode.disabled);const D=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const I of g){const M=u.getTile(I),R=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,{tileBoundsBuffer:k,tileBoundsIndexBuffer:B,tileBoundsSegments:$}=this.getTileBoundsBuffers(M);D.draw(v,b.TRIANGLES,d.DepthMode.disabled,new d.StencilMode({func:b.ALWAYS,mask:0},R,255,b.KEEP,b.KEEP,b.REPLACE),d.ColorMode.disabled,d.CullFaceMode.disabled,yc(I.projMatrix),"$clipping",k,B,$)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const a=this.nextStencilID++,u=this.context.gl;return new d.StencilMode({func:u.NOTEQUAL,mask:255},a,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(a){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(a);const u=this.context.gl;return new d.StencilMode({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[a.key],0,u.KEEP,u.KEEP,u.REPLACE)}stencilConfigForOverlap(a){const u=this.context.gl,g=a.sort((D,I)=>I.overscaledZ-D.overscaledZ),v=g[g.length-1].overscaledZ,b=g[0].overscaledZ-v+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const D={};for(let I=0;I<b;I++)D[I+v]=new d.StencilMode({func:u.GEQUAL,mask:255},I+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=b,[D,g]}return[{[v]:d.StencilMode.disabled},g]}colorModeForRenderPass(){const a=this.context.gl;return this._showOverdrawInspector?new d.ColorMode([a.CONSTANT_COLOR,a.ONE],new d.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?d.ColorMode.unblended:d.ColorMode.alphaBlended}depthModeForSublayer(a,u,g){if(!this.opaquePassEnabledForLayer())return d.DepthMode.disabled;const v=1-((1+this.currentLayer)*this.numSublayers+a)*this.depthEpsilon;return new d.DepthMode(g||this.context.gl.LEQUAL,u,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(a,u){this.style=a,this.options=u,this.imageManager=a.imageManager,this.glyphManager=a.glyphManager,this.symbolFadeChange=a.placement.symbolFadeChange(d.exported.now()),this.imageManager.beginFrame();const g=this.style.order,v=this.style._sourceCaches;for(const M in v){const R=v[M];R.used&&R.prepare(this.context)}const b={},D={},I={};for(const M in v){const R=v[M];b[M]=R.getVisibleCoordinates(),D[M]=b[M].slice().reverse(),I[M]=R.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let M=0;M<g.length;M++)if(this.style._layers[g[M]].is3D()){this.opaquePassCutoff=M;break}if(this.terrain&&(this.terrain.updateTileBinding(I),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new d.GlobeSharedBuffers(this.context)),d.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const M of g){const R=this.style._layers[M],k=a._getLayerSourceCache(R);if(!R.hasOffscreenPass()||R.isHidden(this.transform.zoom))continue;const B=k?D[k.id]:void 0;("custom"===R.type||R.isSky()||B&&B.length)&&this.renderLayer(this,k,R,B)}if(this.depthRangeFor3D=[0,1-(a.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:u.showOverdrawInspector?d.Color.black:d.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){const M=this.style._layers[g[this.currentLayer]],R=a._getLayerSourceCache(M);if(M.isSky())continue;const k=R?D[R.id]:void 0;this._renderTileClippingMasks(M,R,k),this.renderLayer(this,R,M,k)}if(this.style.fog&&this.transform.projection.supportsFog&&function(M,R){const k=M.context,B=k.gl,$=M.transform,Z=new d.DepthMode(B.LEQUAL,d.DepthMode.ReadOnly,[0,1]),W=M.useProgram("globeAtmosphere",null,"globe"===$.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),K=d.globeToMercatorTransition($.zoom),q=R.properties.get("color").toArray01(),H=R.properties.get("high-color").toArray01(),J=R.properties.get("space-color").toArray01PremultipliedAlpha(),Q=d.identity$1([]);d.rotateY$1(Q,Q,-d.degToRad($._center.lng)),d.rotateX$1(Q,Q,d.degToRad($._center.lat)),d.rotateZ$1(Q,Q,$.angle),d.rotateX$1(Q,Q,-$._pitch);const re=d.fromQuat(new Float32Array(16),Q),ue=d.mapValue(R.properties.get("star-intensity"),0,1,0,.25),me=d.mapValue(R.properties.get("horizon-blend"),0,1,5e-4,.25),Se=d.globeUseCustomAntiAliasing(M,k,$)&&5e-4===me?$.worldSize/(2*Math.PI*1.025)-1:$.globeRadius,Te=M.frameCounter/1e3%1,_e=d.length($.globeCenterInViewSpace),Ze=Math.sqrt(Math.pow(_e,2)-Math.pow(Se,2)),xe=Math.acos(Ze/_e),Le={u_frustum_tl:$.frustumCorners.TL,u_frustum_tr:$.frustumCorners.TR,u_frustum_br:$.frustumCorners.BR,u_frustum_bl:$.frustumCorners.BL,u_horizon:$.frustumCorners.horizon,u_transition:K,u_fadeout_range:me,u_color:q,u_high_color:H,u_space_color:J,u_star_intensity:ue,u_star_size:5*d.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Te,u_horizon_angle:xe,u_rotation_matrix:re};M.prepareDrawProgram(k,W);const Ce=M.atmosphereBuffer;Ce&&W.draw(k,B.TRIANGLES,Z,d.StencilMode.disabled,d.ColorMode.alphaBlended,d.CullFaceMode.backCW,Le,"skybox",Ce.vertexBuffer,Ce.indexBuffer,Ce.segments)}(this,this.style.fog),this.renderPass="sky",(d.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){const M=this.style._layers[g[this.currentLayer]],R=a._getLayerSourceCache(M);M.isSky()&&this.renderLayer(this,R,M,R?D[R.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<g.length;){const M=this.style._layers[g[this.currentLayer]],R=a._getLayerSourceCache(M);if(M.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(M)){if(M.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const k=R?("symbol"===M.type?I:D)[R.id]:void 0;this._renderTileClippingMasks(M,R,R?b[R.id]:void 0),this.renderLayer(this,R,M,k),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let M=null;d.values(this.style._layers).forEach(R=>{const k=a._getLayerSourceCache(R);k&&!R.isHidden(this.transform.zoom)&&(!M||M.getSource().maxzoom<k.getSource().maxzoom)&&(M=k)}),M&&this.options.showTileBoundaries&&Au.debug(this,M,M.getVisibleCoordinates())}this.options.showPadding&&function(M){const R=M.transform.padding;Bh(M,M.transform.height-(R.top||0),3,zh),Bh(M,R.bottom||0,3,Iu),Su(M,R.left||0,3,xl),Su(M,M.transform.width-(R.right||0),3,Xr);const k=M.transform.centerPoint;var B,$,Z,W;ws(B=M,($=k.x)-1,(Z=M.transform.height-k.y)-10,2,20,W=np),ws(B,$-10,Z-1,20,2,W)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(d.window.performance.now()),this.saveCanvasCopy())}}renderLayer(a,u,g,v){g.isHidden(this.transform.zoom)||("background"===g.type||"sky"===g.type||"custom"===g.type||v&&v.length)&&(this.id=g.id,this.gpuTimingStart(g),a.transform.projection.unsupportedLayers&&a.transform.projection.unsupportedLayers.includes(g.type)||Au[g.type](a,u,g,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(a){if(!this.options.gpuTiming)return;const u=this.context.extTimerQuery;let g=this.gpuTimers[a.id];g||(g=this.gpuTimers[a.id]={calls:0,cpuTime:0,query:u.createQueryEXT()}),g.calls++,u.beginQueryEXT(u.TIME_ELAPSED_EXT,g.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const a=this.context.extTimerQuery,u=a.createQueryEXT();this.deferredRenderGpuTimeQueries.push(u),a.beginQueryEXT(a.TIME_ELAPSED_EXT,u)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const a=this.context.extTimerQuery;a.endQueryEXT(a.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery;a.endQueryEXT(a.TIME_ELAPSED_EXT)}collectGpuTimers(){const a=this.gpuTimers;return this.gpuTimers={},a}collectDeferredRenderGpuQueries(){const a=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],a}queryGpuTimers(a){const u={};for(const g in a){const v=a[g],b=this.context.extTimerQuery,D=b.getQueryObjectEXT(v.query,b.QUERY_RESULT_EXT)/1e6;b.deleteQueryEXT(v.query),u[g]=D}return u}queryGpuTimeDeferredRender(a){if(!this.options.gpuTimingDeferredRender)return 0;const u=this.context.extTimerQuery;let g=0;for(const v of a)g+=u.getQueryObjectEXT(v,u.QUERY_RESULT_EXT)/1e6,u.deleteQueryEXT(v);return g}translatePosMatrix(a,u,g,v,b){if(!g[0]&&!g[1])return a;const D=b?"map"===v?this.transform.angle:0:"viewport"===v?-this.transform.angle:0;if(D){const R=Math.sin(D),k=Math.cos(D);g=[g[0]*k-g[1]*R,g[0]*R+g[1]*k]}const I=[b?g[0]:Uo(u,g[0],this.transform.zoom),b?g[1]:Uo(u,g[1],this.transform.zoom),0],M=new Float32Array(16);return d.translate(M,a,I),M}saveTileTexture(a){const u=this._tileTextures[a.size[0]];u?u.push(a):this._tileTextures[a.size[0]]=[a]}getTileTexture(a){const u=this._tileTextures[a];return u&&u.length>0?u.pop():null}isPatternMissing(a){return null===a||void 0!==a&&!this.imageManager.getPattern(a.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const a=this.terrain&&this.terrain.renderingToTexture,u=this.terrain&&0===this.terrain.exaggeration(),g=this.style&&this.style.fog,v=[];return this.terrainRenderModeElevated()&&v.push("TERRAIN"),"globe"===this.transform.projection.name&&v.push("GLOBE"),u&&v.push("ZERO_EXAGGERATION"),g&&!a&&0!==g.getOpacity(this.transform.pitch)&&v.push("FOG"),a&&v.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&v.push("OVERDRAW_INSPECTOR"),v}useProgram(a,u,g){this.cache=this.cache||{};const v=g||[],b=this.currentGlobalDefines().concat(v),D=Pi.cacheKey(Jd[a],a,b,u);return this.cache[D]||(this.cache[D]=new Pi(this.context,a,Jd[a],u,Jn[a],b)),this.cache[D]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const a=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(a.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=d.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new d.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(a,u,g){if(this.terrain&&this.terrain.renderingToTexture)return;const v=this.style.fog;if(v){const b=v.getOpacity(this.transform.pitch),D=((I,M,R,k,B,$,Z,W,K,q,H)=>{const J=I.transform,Q=M.properties.get("color").toArray01();Q[3]=k;const re=I.frameCounter/1e3%1;return{u_fog_matrix:R?J.calculateFogTileMatrix(R):I.identityMat,u_fog_range:M.getFovAdjustedRange(J._fov),u_fog_color:Q,u_fog_horizon_blend:M.properties.get("horizon-blend"),u_fog_temporal_offset:re,u_frustum_tl:B,u_frustum_tr:$,u_frustum_br:Z,u_frustum_bl:W,u_globe_pos:K,u_globe_radius:q,u_viewport:H,u_globe_transition:d.globeToMercatorTransition(J.zoom),u_is_globe:+("globe"===J.projection.name)}})(this,v,g,b,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*d.exported.devicePixelRatio,this.transform.height*d.exported.devicePixelRatio]);u.setFogUniformValues(a,D)}}setTileLoadedFlag(a){this.tileLoaded=a}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const a=this.context.gl,u=a.createTexture();return a.bindTexture(a.TEXTURE_2D,u),a.copyTexImage2D(a.TEXTURE_2D,0,a.RGBA,0,0,a.drawingBufferWidth,a.drawingBufferHeight,0),u}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const a=this.style&&this.style.fog;return!!a&&0!==a.getOpacity(this.transform.pitch)}getBackgroundTiles(){const a=this._backgroundTiles,u=this._backgroundTiles={},g=this.transform.coveringTiles({tileSize:512});for(const v of g)u[v.key]=a[v.key]||new d.Tile(v,512,this.transform.tileZoom,this);return u}clearBackgroundTiles(){this._backgroundTiles={}}}class Vh{constructor(a=0,u=0,g=0,v=0){if(isNaN(a)||a<0||isNaN(u)||u<0||isNaN(g)||g<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=a,this.bottom=u,this.left=g,this.right=v}interpolate(a,u,g){return null!=u.top&&null!=a.top&&(this.top=d.number(a.top,u.top,g)),null!=u.bottom&&null!=a.bottom&&(this.bottom=d.number(a.bottom,u.bottom,g)),null!=u.left&&null!=a.left&&(this.left=d.number(a.left,u.left,g)),null!=u.right&&null!=a.right&&(this.right=d.number(a.right,u.right,g)),this}getCenter(a,u){const g=d.clamp((this.left+a-this.right)/2,0,a),v=d.clamp((this.top+u-this.bottom)/2,0,u);return new d.pointGeometry(g,v)}equals(a){return this.top===a.top&&this.bottom===a.bottom&&this.left===a.left&&this.right===a.right}clone(){return new Vh(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function bc(f,a){const u=d.getColumn(f,3);d.fromQuat(f,a),d.setColumn(f,3,u)}function rp(f,a){const u=d.identity$1([]);return d.rotateZ$1(u,u,-a),d.rotateX$1(u,u,-f),u}function Uf(f,a){const u=[f[0],f[1],0],g=[a[0],a[1],0];if(d.length(u)>=1e-15){const D=d.normalize([],u);d.scale$2(g,D,d.dot(g,D)),a[0]=g[0],a[1]=g[1]}const v=d.cross([],a,f);if(d.len(v)<1e-15)return null;const b=Math.atan2(-v[1],v[0]);return rp(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),b)}class Pu{constructor(a,u){this.position=a,this.orientation=u}get position(){return this._position}set position(a){if(a){const u=a instanceof d.MercatorCoordinate?a:new d.MercatorCoordinate(a[0],a[1],a[2]);this._renderWorldCopies&&(u.x=d.wrap(u.x,0,1)),this._position=u}else this._position=null}lookAtPoint(a,u){if(this.orientation=null,!this.position)return;const g=this._elevation?this._elevation.getAtPointOrZero(d.MercatorCoordinate.fromLngLat(a)):0,v=this.position,b=d.MercatorCoordinate.fromLngLat(a,g),D=[b.x-v.x,b.y-v.y,b.z-v.z];u||(u=[0,0,1]),u[2]=Math.abs(u[2]),this.orientation=Uf(D,u)}setPitchBearing(a,u){this.orientation=rp(d.degToRad(a),d.degToRad(-u))}}class wc{constructor(a,u){this._transform=d.identity([]),this.orientation=u,this.position=a}get mercatorPosition(){const a=this.position;return new d.MercatorCoordinate(a[0],a[1],a[2])}get position(){const a=d.getColumn(this._transform,3);return[a[0],a[1],a[2]]}set position(a){var u;a&&d.setColumn(this._transform,3,[(u=a)[0],u[1],u[2],1])}get orientation(){return this._orientation}set orientation(a){this._orientation=a||d.identity$1([]),a&&bc(this._transform,this._orientation)}getPitchBearing(){const a=this.forward(),u=this.right();return{bearing:Math.atan2(-u[1],u[0]),pitch:Math.atan2(Math.sqrt(a[0]*a[0]+a[1]*a[1]),-a[2])}}setPitchBearing(a,u){this._orientation=rp(a,u),bc(this._transform,this._orientation)}forward(){const a=d.getColumn(this._transform,2);return[-a[0],-a[1],-a[2]]}up(){const a=d.getColumn(this._transform,1);return[-a[0],-a[1],-a[2]]}right(){const a=d.getColumn(this._transform,0);return[a[0],a[1],a[2]]}getCameraToWorld(a,u){const g=new Float64Array(16);return d.invert(g,this.getWorldToCamera(a,u)),g}getWorldToCameraPosition(a,u,g){const v=this.position;d.scale$2(v,v,-a);const b=new Float64Array(16);return d.fromScaling(b,[g,g,g]),d.translate(b,b,v),b[10]*=u,b}getWorldToCamera(a,u){const g=new Float64Array(16),v=new Float64Array(4),b=this.position;return d.conjugate(v,this._orientation),d.scale$2(b,b,-a),d.fromQuat(g,v),d.translate(g,g,b),g[1]*=-1,g[5]*=-1,g[9]*=-1,g[13]*=-1,g[8]*=u,g[9]*=u,g[10]*=u,g[11]*=u,g}getCameraToClipPerspective(a,u,g,v){const b=new Float64Array(16);return d.perspective(b,a,u,g,v),b}getDistanceToElevation(a,u=!1){const g=0===a?0:d.mercatorZfromAltitude(a,u?d.latFromMercatorY(this.position[1]):this.position[1]),v=this.forward();return(g-this.position[2])/v[2]}clone(){return new wc([...this.position],[...this.orientation])}}function jh(f,a){const u=Oa(f.projection,f.zoom,f.width,f.height),g=function(b,D,I,M,R){const k=new d.LngLat(I.lng-180*Mr,I.lat),B=new d.LngLat(I.lng+180*Mr,I.lat),$=b.project(k.lng,k.lat),Z=b.project(B.lng,B.lat),W=-Math.atan2(Z.y-$.y,Z.x-$.x),K=d.MercatorCoordinate.fromLngLat(I);K.y=d.clamp(K.y,-.999975,.999975);const q=K.toLngLat(),H=b.project(q.lng,q.lat),J=d.MercatorCoordinate.fromLngLat(q);J.x+=Mr;const Q=J.toLngLat(),re=b.project(Q.lng,Q.lat),ue=Fa(re.x-H.x,re.y-H.y,W),ce=d.MercatorCoordinate.fromLngLat(q);ce.y+=Mr;const me=ce.toLngLat(),Se=b.project(me.lng,me.lat),Te=Fa(Se.x-H.x,Se.y-H.y,W),_e=Math.abs(ue.x)/Math.abs(Te.y),Ze=d.identity([]);d.rotateZ(Ze,Ze,-W*(1-(R?0:M)));const xe=d.identity([]);return d.scale(xe,xe,[1,1-(1-_e)*M,1]),xe[4]=-Te.x/Te.y*M,d.rotateZ(xe,xe,W),d.multiply(xe,Ze,xe),xe}(f.projection,0,f.center,u,a),v=Lu(f);return d.scale(g,g,[v,v,1]),g}function Lu(f){const a=f.projection,u=Oa(f.projection,f.zoom,f.width,f.height),g=ku(a,f.center),v=ku(a,d.LngLat.convert(a.center));return Math.pow(2,g*u+(1-u)*v)}function Oa(f,a,u,g,v=1/0){const b=f.range;if(!b)return 0;const D=Math.min(v,Math.max(u,g)),I=Math.log(D/1024)/Math.LN2;return d.smoothstep(b[0]+I,b[1]+I,a)}const Mr=1/4e4;function ku(f,a){const u=d.clamp(a.lat,-d.MAX_MERCATOR_LATITUDE,d.MAX_MERCATOR_LATITUDE),g=new d.LngLat(a.lng-180*Mr,u),v=new d.LngLat(a.lng+180*Mr,u),b=f.project(g.lng,u),D=f.project(v.lng,u),I=d.MercatorCoordinate.fromLngLat(g),M=d.MercatorCoordinate.fromLngLat(v),R=D.x-b.x,k=D.y-b.y,B=M.x-I.x,$=M.y-I.y,Z=Math.sqrt((B*B+$*$)/(R*R+k*k));return Math.log(Z)/Math.LN2}function Fa(f,a,u){const g=Math.cos(u),v=Math.sin(u);return{x:f*g-a*v,y:f*v+a*g}}class Na{constructor(a,u,g,v,b,D,I){this.tileSize=512,this._renderWorldCopies=void 0===b||b,this._minZoom=a||0,this._maxZoom=u||22,this._minPitch=g??0,this._maxPitch=v??60,this.setProjection(D),this.setMaxBounds(I),this.width=0,this.height=0,this._center=new d.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Vh,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new wc,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const a=new Na(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return a._elevation=this._elevation,a._centerAltitude=this._centerAltitude,a._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,a.tileSize=this.tileSize,a.mercatorFromTransition=this.mercatorFromTransition,a.width=this.width,a.height=this.height,a.cameraElevationReference=this.cameraElevationReference,a._center=this._center,a._setZoom(this.zoom),a._seaLevelZoom=this._seaLevelZoom,a.angle=this.angle,a._fov=this._fov,a._pitch=this._pitch,a._nearZ=this._nearZ,a._farZ=this._farZ,a._averageElevation=this._averageElevation,a._unmodified=this._unmodified,a._edgeInsets=this._edgeInsets.clone(),a._camera=this._camera.clone(),a._calcMatrices(),a.freezeTileCoverage=this.freezeTileCoverage,a.frustumCorners=this.frustumCorners,a}get elevation(){return this._elevation}set elevation(a){this._elevation!==a&&(this._elevation=a,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(a,u=!1){const g=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||g)&&this._updateCameraOnTerrain(),(a||g)&&this._constrainCamera(u),this._calcMatrices()}getProjection(){return d.pick(this.projection,["name","center","parallels"])}setProjection(a){this.projectionOptions=a||{name:"mercator"};const u=this.projection?this.getProjection():void 0;this.projection=d.getProjection(this.projectionOptions);const g=!Ue(u,this.getProjection());return g&&this._calcMatrices(),this.mercatorFromTransition=!1,g}setMercatorFromTransition(){const a=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=d.getProjection({name:"mercator"});const u=a!==this.projection.name;return u&&this._calcMatrices(),u}get minZoom(){return this._minZoom}set minZoom(a){this._minZoom!==a&&(this._minZoom=a,this.zoom=Math.max(this.zoom,a))}get maxZoom(){return this._maxZoom}set maxZoom(a){this._maxZoom!==a&&(this._maxZoom=a,this.zoom=Math.min(this.zoom,a))}get minPitch(){return this._minPitch}set minPitch(a){this._minPitch!==a&&(this._minPitch=a,this.pitch=Math.max(this.pitch,a))}get maxPitch(){return this._maxPitch}set maxPitch(a){this._maxPitch!==a&&(this._maxPitch=a,this.pitch=Math.min(this.pitch,a))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(a){void 0===a?a=!0:null===a&&(a=!1),this._renderWorldCopies=a}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const a=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get cameraWorldSize(){const a=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return d.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new d.pointGeometry(this.width,this.height)}get bearing(){return d.wrap(this.rotation,-180,180)}set bearing(a){this.rotation=a}get rotation(){return-this.angle/Math.PI*180}set rotation(a){const u=-a*Math.PI/180;var g,v,b,D,I,M,R,k,B,$;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=(g=new d.ARRAY_TYPE(4),d.ARRAY_TYPE!=Float32Array&&(g[1]=0,g[2]=0),g[0]=1,g[3]=1,g),v=this.rotationMatrix,D=this.angle,I=(b=this.rotationMatrix)[0],M=b[1],R=b[2],k=b[3],B=Math.sin(D),$=Math.cos(D),v[0]=I*$+R*B,v[1]=M*$+k*B,v[2]=I*-B+R*$,v[3]=M*-B+k*$)}get pitch(){return this._pitch/Math.PI*180}set pitch(a){const u=d.clamp(a,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())}get aspect(){return this.width/this.height}get fovX(){return this._fov}get fovY(){const a=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/a)}set fov(a){a=Math.max(.01,Math.min(60,a)),this._fov!==a&&(this._unmodified=!1,this._fov=d.degToRad(a),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(a){this._averageElevation=a,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(a){const u=Math.min(Math.max(a,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._setZoom(u),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(a){this._zoom=a,this.scale=this.zoomScale(a),this.tileZoom=Math.floor(a),this.zoomFraction=a-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const a=this._elevation;this._centerAltitude=a.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=a.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const a=this._elevation,u=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],g=this.horizonLineFromTop();let v=0,b=0;for(let D=0;D<u.length;D++){const I=new d.pointGeometry(u[D][0]*this.width,g+u[D][1]*(this.height-g)),M=a.pointCoordinate(I);if(!M)continue;const R=1/Math.hypot(M[0]-this._camera.position[0],M[1]-this._camera.position[1]);v+=M[3]*R,b+=R}return 0===b?NaN:v/b}get center(){return this._center}set center(a){a.lat===this._center.lat&&a.lng===this._center.lng||(this._unmodified=!1,this._center=a,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const a=this._seaLevelZoom,u=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),g=this.pixelsPerMeter/this.worldSize*u,v=this._mercatorZfromZoom(a),b=this._mercatorZfromZoom(this._maxZoom),D=Math.max(v-g,b);this._setZoom(this._zoomFromMercatorZ(D))}get padding(){return this._edgeInsets.toJSON()}set padding(a){this._edgeInsets.equals(a)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,a,1),this._calcMatrices())}computeZoomRelativeTo(a){const u=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,a.toAltitude()));let g;g=a.z<this._camera.position[2]?[u.x,u.y,u.z]:[a.x,a.y,a.z];const v=d.length(d.sub([],this._camera.position,g));return d.clamp(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(a){if(!this.height||!a.position&&!a.orientation)return;this._updateCameraState();let u=!1;if(a.orientation&&!d.exactEquals(a.orientation,this._camera.orientation)&&(u=this._setCameraOrientation(a.orientation)),a.position){const g=[a.position.x,a.position.y,a.position.z];d.exactEquals$1(g,this._camera.position)||(this._setCameraPosition(g),u=!0)}u&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const a=this._camera.position,u=new Pu;return u.position=new d.MercatorCoordinate(a[0],a[1],a[2]),u.orientation=this._camera.orientation,u._elevation=this.elevation,u._renderWorldCopies=this.renderWorldCopies,u}_setCameraOrientation(a){if(!d.length$1(a))return!1;d.normalize$1(a,a);const u=d.transformQuat([],[0,0,-1],a),g=d.transformQuat([],[0,-1,0],a);if(g[2]<0)return!1;const v=Uf(u,g);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(a){const u=this.zoomScale(this.minZoom)*this.tileSize,g=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;a[2]=d.clamp(a[2],v/g,v/u),this._camera.position=a}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(a){return this._edgeInsets.equals(a)}interpolatePadding(a,u,g){this._unmodified=!1,this._edgeInsets.interpolate(a,u,g),this._constrain(),this._calcMatrices()}coveringZoomLevel(a){const u=(a.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/a.tileSize));return Math.max(0,u)}getVisibleUnwrappedCoordinates(a){const u=[new d.UnwrappedTileID(0,a)];if(this.renderWorldCopies){const g=this.pointCoordinate(new d.pointGeometry(0,0)),v=this.pointCoordinate(new d.pointGeometry(this.width,0)),b=this.pointCoordinate(new d.pointGeometry(this.width,this.height)),D=this.pointCoordinate(new d.pointGeometry(0,this.height)),I=Math.floor(Math.min(g.x,v.x,b.x,D.x)),M=Math.floor(Math.max(g.x,v.x,b.x,D.x)),R=1;for(let k=I-R;k<=M+R;k++)0!==k&&u.push(new d.UnwrappedTileID(k,a))}return u}coveringTiles(a){let u=this.coveringZoomLevel(a);const g=u,v=this.elevation&&!a.isTerrainDEM,b="mercator"===this.projection.name;if(void 0!==a.minzoom&&u<a.minzoom)return[];void 0!==a.maxzoom&&u>a.maxzoom&&(u=a.maxzoom);const D=this.locationCoordinate(this.center),I=this.center.lat,M=1<<u,R=[M*D.x,M*D.y,0],k="globe"===this.projection.name,B=!k,$=d.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u,B),Z=k?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),W=M*d.mercatorZfromAltitude(1,this.center.lat),K=this._camera.position[2]/d.mercatorZfromAltitude(1,this.center.lat),q=[M*Z.x,M*Z.y,K*(B?1:W)],H=this.cameraToCenterDistance/a.tileSize*(a.roundZoom?1:.502),J=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?u:0,Q=a.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,re=a.isTerrainDEM?-Q:this._elevation?this._elevation.getMinElevationBelowMSL():0,ue=this.projection.isReprojectedInTileSpace?Lu(this):1,ce=Pe=>{const Qe=new d.MercatorCoordinate(Pe.x+25e-6,Pe.y,Pe.z),ge=new d.MercatorCoordinate(Pe.x,Pe.y+25e-6,Pe.z),Ie=Pe.toLngLat(),ht=Qe.toLngLat(),wt=ge.toLngLat(),ft=this.locationCoordinate(Ie),It=this.locationCoordinate(ht),Zt=this.locationCoordinate(wt),mt=Math.hypot(It.x-ft.x,It.y-ft.y),ut=Math.hypot(Zt.x-ft.x,Zt.y-ft.y);return Math.sqrt(mt*ut)*ue/25e-6},me=Pe=>{const Fe=Q,Qe=re;return{aabb:d.tileAABB(this,M,0,0,0,Pe,Qe,Fe,this.projection),zoom:0,x:0,y:0,minZ:Qe,maxZ:Fe,wrap:Pe,fullyVisible:!1}},Se=[];let Te=[];const _e=u,Ze=a.reparseOverscaled?g:u,xe=Pe=>Pe*Pe,Le=xe((K-this._centerAltitude)*W),Ce=Pe=>{if(!this._elevation||!Pe.tileID||!b)return;const Fe=this._elevation.getMinMaxForTile(Pe.tileID),Qe=Pe.aabb;Fe?(Qe.min[2]=Fe.min,Qe.max[2]=Fe.max,Qe.center[2]=(Qe.min[2]+Qe.max[2])/2):(Pe.shouldSplit=He(Pe),Pe.shouldSplit||(Qe.min[2]=Qe.max[2]=Qe.center[2]=this._centerAltitude))},He=Pe=>{if(Pe.zoom<J)return!0;if(Pe.zoom===_e)return!1;if(null!=Pe.shouldSplit)return Pe.shouldSplit;const Fe=Pe.aabb.distanceX(q),Qe=Pe.aabb.distanceY(q);let ge=Le,Ie=1;if(k){ge=xe(Pe.aabb.distanceZ(q));const ft=Math.pow(2,Pe.zoom),It=d.latFromMercatorY((Pe.y+1)/ft),Zt=d.latFromMercatorY(Pe.y/ft),mt=Math.min(Math.max(I,It),Zt),ut=d.circumferenceAtLatitude(mt)/d.circumferenceAtLatitude(I);if(Ie=mt===I?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,ut/this._mercatorScaleRatio),this.zoom<=d.GLOBE_ZOOM_THRESHOLD_MIN&&Pe.zoom===_e-1&&ut>=.9)return!0}else if(v&&(ge=xe(Pe.aabb.distanceZ(q)*W)),this.projection.isReprojectedInTileSpace&&g<=5){const ft=Math.pow(2,Pe.zoom),It=ce(new d.MercatorCoordinate((Pe.x+.5)/ft,(Pe.y+.5)/ft));Ie=It>.85?1:It}const ht=Fe*Fe+Qe*Qe+ge;return ht<xe((1<<_e-Pe.zoom)*H*Ie*((ft,It)=>{if(It*xe(.707)<ft)return 1;const Zt=Math.sqrt(It/ft);return Zt/(1.4144271570014144+(Math.pow(1.1,Zt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(ge,Le),ht))};if(this.renderWorldCopies)for(let Pe=1;Pe<=3;Pe++)Se.push(me(-Pe)),Se.push(me(Pe));for(Se.push(me(0));Se.length>0;){const Pe=Se.pop(),Fe=Pe.x,Qe=Pe.y;let ge=Pe.fullyVisible;if(!ge){const Ie=Pe.aabb.intersects($);if(0===Ie)continue;ge=2===Ie}if(Pe.zoom!==_e&&He(Pe))for(let Ie=0;Ie<4;Ie++){const ht=(Fe<<1)+Ie%2,wt=(Qe<<1)+(Ie>>1),ft={aabb:b?Pe.aabb.quadrant(Ie):d.tileAABB(this,M,Pe.zoom+1,ht,wt,Pe.wrap,Pe.minZ,Pe.maxZ,this.projection),zoom:Pe.zoom+1,x:ht,y:wt,wrap:Pe.wrap,fullyVisible:ge,tileID:void 0,shouldSplit:void 0,minZ:Pe.minZ,maxZ:Pe.maxZ};v&&!k&&(ft.tileID=new d.OverscaledTileID(Pe.zoom+1===_e?Ze:Pe.zoom+1,Pe.wrap,Pe.zoom+1,ht,wt),Ce(ft)),Se.push(ft)}else{const Ie=Pe.zoom===_e?Ze:Pe.zoom;if(a.minzoom&&a.minzoom>Ie)continue;const ht=R[0]-(.5+Fe+(Pe.wrap<<Pe.zoom))*(1<<u-Pe.zoom),wt=R[1]-.5-Qe,ft=Pe.tileID?Pe.tileID:new d.OverscaledTileID(Ie,Pe.wrap,Pe.zoom,Fe,Qe);Te.push({tileID:ft,distanceSq:ht*ht+wt*wt})}}if(this.fogCullDistSq){const Pe=this.fogCullDistSq,Fe=this.horizonLineFromTop();Te=Te.filter(Qe=>{const ge=[0,0,0,1],Ie=[d.EXTENT,d.EXTENT,0,1],ht=this.calculateFogTileMatrix(Qe.tileID.toUnwrapped());d.transformMat4$1(ge,ge,ht),d.transformMat4$1(Ie,Ie,ht);const wt=d.getAABBPointSquareDist(ge,Ie);if(0===wt)return!0;let ft=!1;const It=this._elevation;if(It&&wt>Pe&&0!==Fe){const Zt=this.calculateProjMatrix(Qe.tileID.toUnwrapped());let mt;a.isTerrainDEM||(mt=It.getMinMaxForTile(Qe.tileID)),mt||(mt={min:re,max:Q});const ut=d.furthestTileCorner(this.rotation),xn=[ut[0]*d.EXTENT,ut[1]*d.EXTENT,mt.max];d.transformMat4(xn,xn,Zt),ft=(1-xn[1])*this.height*.5<Fe}return wt<Pe||ft})}return Te.sort((Pe,Fe)=>Pe.distanceSq-Fe.distanceSq).map(Pe=>Pe.tileID)}resize(a,u){this.width=a,this.height=u,this.pixelsToGLUnits=[2/a,-2/u],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(a){return Math.pow(2,a)}scaleZoom(a){return Math.log(a)/Math.LN2}project(a){const u=d.clamp(a.lat,-d.MAX_MERCATOR_LATITUDE,d.MAX_MERCATOR_LATITUDE),g=this.projection.project(a.lng,u);return new d.pointGeometry(g.x*this.worldSize,g.y*this.worldSize)}unproject(a){return this.projection.unproject(a.x/this.worldSize,a.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(a,u){let g,v;const b=this.centerPoint;if("globe"===this.projection.name){const I=this.worldSize;g=(u.x-b.x)/I,v=(u.y-b.y)/I}else{const I=this.pointCoordinate(u),M=this.pointCoordinate(b);g=I.x-M.x,v=I.y-M.y}const D=this.locationCoordinate(a);this.setLocation(new d.MercatorCoordinate(D.x-g,D.y-v))}setLocation(a){this.center=this.coordinateLocation(a),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(a){return this.projection.locationPoint(this,a)}locationPoint3D(a){return this.projection.locationPoint(this,a,!0)}pointLocation(a){return this.coordinateLocation(this.pointCoordinate(a))}pointLocation3D(a){return this.coordinateLocation(this.pointCoordinate3D(a))}locationCoordinate(a,u){const g=u?d.mercatorZfromAltitude(u,a.lat):void 0,v=this.projection.project(a.lng,a.lat);return new d.MercatorCoordinate(v.x,v.y,g)}coordinateLocation(a){return this.projection.unproject(a.x,a.y)}pointRayIntersection(a,u){const g=u??this._centerAltitude,v=[a.x,a.y,0,1],b=[a.x,a.y,1,1];d.transformMat4$1(v,v,this.pixelMatrixInverse),d.transformMat4$1(b,b,this.pixelMatrixInverse);const D=b[3];d.scale$1(v,v,1/v[3]),d.scale$1(b,b,1/D);const I=v[2],M=b[2];return{p0:v,p1:b,t:I===M?0:(g-I)/(M-I)}}screenPointToMercatorRay(a){const u=[a.x,a.y,0,1],g=[a.x,a.y,1,1];return d.transformMat4$1(u,u,this.pixelMatrixInverse),d.transformMat4$1(g,g,this.pixelMatrixInverse),d.scale$1(u,u,1/u[3]),d.scale$1(g,g,1/g[3]),u[2]=d.mercatorZfromAltitude(u[2],this._center.lat)*this.worldSize,g[2]=d.mercatorZfromAltitude(g[2],this._center.lat)*this.worldSize,d.scale$1(u,u,1/this.worldSize),d.scale$1(g,g,1/this.worldSize),new d.Ray([u[0],u[1],u[2]],d.normalize([],d.sub([],g,u)))}rayIntersectionCoordinate(a){const{p0:u,p1:g,t:v}=a,b=d.mercatorZfromAltitude(u[2],this._center.lat),D=d.mercatorZfromAltitude(g[2],this._center.lat);return new d.MercatorCoordinate(d.number(u[0],g[0],v)/this.worldSize,d.number(u[1],g[1],v)/this.worldSize,d.number(b,D,v))}pointCoordinate(a,u=this._centerAltitude){return this.projection.pointCoordinate(this,a.x,a.y,u)}pointCoordinate3D(a){if(!this.elevation)return this.pointCoordinate(a);let u=this.projection.pointCoordinate3D(this,a.x,a.y);if(u)return new d.MercatorCoordinate(u[0],u[1],u[2]);let g=0,v=this.horizonLineFromTop();if(a.y>v)return this.pointCoordinate(a);const b=.02*v,D=a.clone();for(let I=0;I<10&&v-g>b;I++){D.y=d.number(g,v,.66);const M=this.projection.pointCoordinate3D(this,D.x,D.y);M?(v=D.y,u=M):g=D.y}return u?new d.MercatorCoordinate(u[0],u[1],u[2]):this.pointCoordinate(a)}isPointAboveHorizon(a){return this.projection.isPointAboveHorizon(this,a)}_coordinatePoint(a,u){const g=u&&this.elevation?this.elevation.getAtPointOrZero(a,this._centerAltitude):this._centerAltitude,v=[a.x*this.worldSize,a.y*this.worldSize,g+a.toAltitude(),1];return d.transformMat4$1(v,v,this.pixelMatrix),v[3]>0?new d.pointGeometry(v[0]/v[3],v[1]/v[3]):new d.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getGlobeBounds(){const{top:a,left:u}=this._edgeInsets,g=this.height-this._edgeInsets.bottom,v=this.width-this._edgeInsets.right,b=this.pointCoordinate3D(new d.pointGeometry(u,a)),D=this.pointCoordinate3D(new d.pointGeometry(v,a)),I=this.pointCoordinate3D(new d.pointGeometry(v,g)),M=this.pointCoordinate3D(new d.pointGeometry(u,g));let R=Math.min(b.x,M.x),k=Math.max(D.x,I.x),B=Math.min(b.y,D.y),$=Math.max(M.y,I.y);const Z=Math.pow(2,-this.zoom)/16,W=(ce,me,Se,Te)=>{const _e=(ce+Se)/2,Ze=(me+Te)/2,xe=new d.pointGeometry(_e,Ze),Le=this.pointCoordinate3D(xe),Ce=Math.max(0,R-Le.x,B-Le.y,Le.x-k,Le.y-$);R=Math.min(R,Le.x),k=Math.max(k,Le.x),B=Math.min(B,Le.y),$=Math.max($,Le.y),Ce>Z&&(W(ce,me,_e,Ze),W(_e,Ze,Se,Te))};W(u,a,v,a),W(v,a,v,g),W(v,g,u,g),W(u,g,u,a);const[K,q]=d.polesInViewport(this),H=K||q,J=K?90:d.latFromMercatorY(B),Q=H?180:d.lngFromMercatorX(k),re=q?-90:d.latFromMercatorY($),ue=H?-180:d.lngFromMercatorX(R);return new d.LngLatBounds(new d.LngLat(ue,re),new d.LngLat(Q,J))}_getBounds(a,u){if("globe"===this.projection.name)return this._getGlobeBounds();const g=new d.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),v=new d.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),b=new d.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),D=new d.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let I=this.pointCoordinate(g,a),M=this.pointCoordinate(v,a);const R=this.pointCoordinate(b,u),k=this.pointCoordinate(D,u),B=($,Z)=>(Z.y-$.y)/(Z.x-$.x);return I.y>1&&M.y>=0?I=new d.MercatorCoordinate((1-k.y)/B(k,I)+k.x,1):I.y<0&&M.y<=1&&(I=new d.MercatorCoordinate(-k.y/B(k,I)+k.x,0)),M.y>1&&I.y>=0?M=new d.MercatorCoordinate((1-R.y)/B(R,M)+R.x,1):M.y<0&&I.y<=1&&(M=new d.MercatorCoordinate(-R.y/B(R,M)+R.x,0)),(new d.LngLatBounds).extend(this.coordinateLocation(I)).extend(this.coordinateLocation(M)).extend(this.coordinateLocation(k)).extend(this.coordinateLocation(R))}_getBounds3D(){const a=this.elevation;if(!a.visibleDemTiles.length||a.isUsingMockSource())return this._getBounds(0,0);const u=a.visibleDemTiles.reduce((g,v)=>{if(v.dem){const b=v.dem.tree;g.min=Math.min(g.min,b.minimums[0]),g.max=Math.max(g.max,b.maximums[0])}return g},{min:Number.MAX_VALUE,max:0});return this._getBounds(u.min*a.exaggeration(),u.max*a.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(a=!0){const u=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,g=this.height/2-u*(1-this._horizonShift);return a?Math.max(0,g):g}getMaxBounds(){return this.maxBounds}setMaxBounds(a){this.maxBounds=a,this.minLat=-d.MAX_MERCATOR_LATITUDE,this.maxLat=d.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,a&&(this.minLat=a.getSouth(),this.maxLat=a.getNorth(),this.minLng=a.getWest(),this.maxLng=a.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=d.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=d.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=d.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=d.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(a,u){return this.projection.createTileMatrix(this,u,a)}calculateDistanceTileData(a){const u=a.key,g=this._distanceTileDataCache;if(g[u])return g[u];const v=a.canonical,b=1/this.height,D=this.cameraWorldSize,I=D/this.zoomScale(v.z),M=(v.x+Math.pow(2,v.z)*a.wrap)*I,R=v.y*I,k=this.point;k.x*=D/this.worldSize,k.y*=D/this.worldSize;const B=this.angle,$=Math.sin(-B),Z=-Math.cos(-B);return g[u]={bearing:[$,Z],center:[(k.x-M)*b,(k.y-R)*b],scale:I/d.EXTENT*b},g[u]}calculateFogTileMatrix(a){const u=a.key,g=this._fogTileMatrixCache;if(g[u])return g[u];const v=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,a);return d.multiply(v,this.worldToFogMatrix,v),g[u]=new Float32Array(v),g[u]}calculateProjMatrix(a,u=!1){const g=a.key,v=u?this._alignedProjMatrixCache:this._projMatrixCache;if(v[g])return v[g];const b=this.calculatePosMatrix(a,this.worldSize);return d.multiply(b,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:u?this.alignedProjMatrix:this.projMatrix,b),v[g]=new Float32Array(b),v[g]}calculatePixelsToTileUnitsMatrix(a){const u=a.tileID.key,g=this._pixelsToTileUnitsCache;if(g[u])return g[u];const v=function(b,D){const{scale:I}=b.tileTransform,M=I*d.EXTENT/(b.tileSize*Math.pow(2,D.zoom-b.tileID.overscaledZ+b.tileID.canonical.z));return R=new Float32Array(4),$=(k=D.inverseAdjustmentMatrix)[1],Z=k[2],W=k[3],q=(B=[M,M])[1],R[0]=k[0]*(K=B[0]),R[1]=$*K,R[2]=Z*q,R[3]=W*q,R;var R,k,B,$,Z,W,K,q}(a,this);return g[u]=v,g[u]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const a=this._elevation;this._updateCameraState();const u=d.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(u),v=this._camera.forward(),b=d.mercatorZfromAltitude(1,this._center.lat);g[2]/=b,v[2]/=b,d.normalize(v,v);const D=a.raycast(g,v,a.exaggeration());if(D){const I=d.scaleAndAdd([],g,v,D),M=new d.MercatorCoordinate(I[0],I[1],d.mercatorZfromAltitude(I[2],d.latFromMercatorY(I[1]))),R=(M.z+d.length([M.x-g[0],M.y-g[1],M.z-g[2]*b]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(R),this._centerAltitude=M.toAltitude(),this._center=this.coordinateLocation(M),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(a=!1){if(!this._elevation)return;const u=this._elevation,g=d.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(g),b=u.getAtPointOrZero(new d.MercatorCoordinate(...v)),D=this.pixelsPerMeter/this.worldSize*b,I=this._minimumHeightOverTerrain(),M=v[2]-D;if(M<=I)if(M<0||a){const R=this.locationCoordinate(this._center,this._centerAltitude),k=[v[0],v[1],R.z-v[2]],B=d.length(k);k[2]-=(I-M)/this._pixelsPerMercatorPixel;const $=d.length(k);if(0===$)return;d.scale$2(k,k,B/$*this._pixelsPerMercatorPixel),this._camera.position=[v[0],v[1],R.z*this._pixelsPerMercatorPixel-k[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const a="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||a){const $=this.center;return $.lat=d.clamp($.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!a)&&($.lng=d.clamp($.lng,this.minLng,this.maxLng)),this.center=$,void(this._constraining=!1)}const u=this._unmodified,{x:g,y:v}=this.point;let b=0,D=g,I=v;const M=this.width/2,R=this.height/2,k=this.worldMinY*this.scale,B=this.worldMaxY*this.scale;if(v-R<k&&(I=k+R),v+R>B&&(I=B-R),B-k<this.height&&(b=Math.max(b,this.height/(B-k)),I=(B+k)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const $=this.worldMinX*this.scale,Z=this.worldMaxX*this.scale,W=this.worldSize/2-($+Z)/2;D=(g+W+this.worldSize)%this.worldSize-W,D-M<$&&(D=$+M),D+M>Z&&(D=Z-M),Z-$<this.width&&(b=Math.max(b,this.width/(Z-$)),D=(Z+$)/2)}D===g&&I===v||(this.center=this.unproject(new d.pointGeometry(D,I))),b&&(this.zoom+=this.scaleZoom(b)),this._constrainCamera(),this._unmodified=u,this._constraining=!1}_minZoomForBounds(){let a=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(a=Math.max(a,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),a}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const a=this.centerOffset,u=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=d.mercatorZfromAltitude(1,this.center.lat)/d.mercatorZfromAltitude(1,d.GLOBE_SCALE_MATCH_LATITUDE));const g=Oa(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,g),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const v=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?u:1),b=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);b[8]=2*-a.x/this.width,b[9]=2*a.y/this.height;let D=d.mul([],b,v);if(this.projection.isReprojectedInTileSpace){const ue=this.locationCoordinate(this.center),ce=d.identity([]);d.translate(ce,ce,[ue.x*this.worldSize,ue.y*this.worldSize,0]),d.multiply(ce,ce,jh(this)),d.translate(ce,ce,[-ue.x*this.worldSize,-ue.y*this.worldSize,0]),d.multiply(D,D,ce),this.inverseAdjustmentMatrix=function(me){const Se=jh(me,!0);return on([],[Se[0],Se[1],Se[4],Se[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=d.scale([],D,[this.worldSize,this.worldSize,this.worldSize/u,1]),this.projMatrix=D,this.invProjMatrix=d.invert(new Float64Array(16),this.projMatrix);const I=d.invert([],b);this.frustumCorners=d.FrustumCorners.fromInvProjectionMatrix(I,this.horizonLineFromTop(),this.height);const M=new Float32Array(16);d.identity(M),d.scale(M,M,[1,-1,1]),d.rotateX(M,M,this._pitch),d.rotateZ(M,M,this.angle);const R=d.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),k=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;R[8]=2*-a.x/this.width,R[9]=2*(a.y+k)/this.height,this.skyboxMatrix=d.multiply(M,R,M);const B=this.point,$=B.x,Z=B.y,W=this.width%2/2,K=this.height%2/2,q=Math.cos(this.angle),H=Math.sin(this.angle),J=$-Math.round($)+q*W+H*K,Q=Z-Math.round(Z)+q*K+H*W,re=new Float64Array(D);if(d.translate(re,re,[J>.5?J-1:J,Q>.5?Q-1:Q,0]),this.alignedProjMatrix=re,D=d.create(),d.scale(D,D,[this.width/2,-this.height/2,1]),d.translate(D,D,[1,-1,0]),this.labelPlaneMatrix=D,D=d.create(),d.scale(D,D,[1,-1,1]),d.translate(D,D,[-1,-1,0]),d.scale(D,D,[2/this.width,2/this.height,1]),this.glCoordMatrix=D,this.pixelMatrix=d.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},D=d.invert(new Float64Array(16),this.pixelMatrix),!D)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=D,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=d.calculateGlobeMatrix(this);const ue=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=d.transformMat4(ue,ue,v),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=D;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const a=this.cameraWorldSizeForFog,u=this.cameraPixelsPerMeter,g=this._camera.position,v=1/this.height/this._pixelsPerMercatorPixel,b=[a,a,u];d.scale$2(b,b,v),d.scale$2(g,g,-1),d.multiply$2(g,g,b);const D=d.create();d.translate(D,D,g),d.scale(D,D,b),this.mercatorFogMatrix=D,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(a,u,v)}_computeCameraPosition(a){const u=(a=a||this.pixelsPerMeter)/this.pixelsPerMeter,g=this._camera.forward(),v=this.point,b=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*u-a/this.worldSize*this._centerAltitude;return[v.x/this.worldSize-g[0]*b,v.y/this.worldSize-g[1]*b,a/this.worldSize*this._centerAltitude-g[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(a){const u=this._maxCameraBoundsDistance()*Math.cos(this._pitch),g=this._camera.position[2],v=a[2];let b=1;this.projection.wrap&&(this.center=this.center.wrap()),v>0&&(b=Math.min((u-g)/v,1)),this._camera.position=d.scaleAndAdd([],this._camera.position,a,b),this._updateStateFromCamera()}_updateStateFromCamera(){const a=this._camera.position,u=this._camera.forward(),{pitch:g,bearing:v}=this._camera.getPitchBearing(),b=d.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,D=this._mercatorZfromZoom(this._maxZoom)*Math.cos(d.degToRad(this._maxPitch)),I=Math.max((a[2]-b)/Math.cos(g),D),M=this._zoomFromMercatorZ(I);d.scaleAndAdd(a,a,u,I),this._pitch=d.clamp(g,d.degToRad(this.minPitch),d.degToRad(this.maxPitch)),this.angle=d.wrap(v,-Math.PI,Math.PI),this._setZoom(d.clamp(M,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new d.MercatorCoordinate(a[0],a[1],a[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(a){return Math.pow(2,a)*this.tileSize}_mercatorZfromZoom(a){return this.cameraToCenterDistance/this._worldSizeFromZoom(a)}_minimumHeightOverTerrain(){const a=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(a)}_zoomFromMercatorZ(a){return this.scaleZoom(this.cameraToCenterDistance/(a*this.tileSize))}zoomFromMercatorZAdjusted(a){const u=D=>{const I=this.getCameraToCenterDistance(this.projection,D);return this.scaleZoom(I/(a*this.tileSize))};let g,v=u(this.zoom),b=Math.abs(v-u(v));for(;g!==b;)v=u(v),g=b,b=Math.abs(v-u(v));return v}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(d.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(a,u){const g=Math.min(a.x,u.x),v=Math.max(a.x,u.x),b=Math.min(a.y,u.y),D=Math.max(a.y,u.y);if(b<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const I=[new d.pointGeometry(g,b),new d.pointGeometry(v,D),new d.pointGeometry(g,D),new d.pointGeometry(v,b)],M=this.renderWorldCopies?-3:0,R=this.renderWorldCopies?4:1;for(const k of I){const B=this.pointRayIntersection(k);if(B.t<0)return!0;const $=this.rayIntersectionCoordinate(B);if($.x<M||$.y<0||$.x>R||$.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+d.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new d.pointGeometry(0,0),new d.pointGeometry(this.width,this.height))}zoomDeltaToMovement(a,u){const g=d.length(d.sub([],this._camera.position,a)),v=this._zoomFromMercatorZ(g)+u;return g-this._mercatorZfromZoom(v)}getCameraPoint(){if("globe"===this.projection.name){const a=function([u,g,v],b){const D=[u,g,v,1];d.transformMat4$1(D,D,b);const I=D[3]=Math.max(D[3],1e-6);return D[0]/=I,D[1]/=I,D[2]/=I,D}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new d.pointGeometry(a[0],a[1])}{const a=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new d.pointGeometry(0,a))}}getCameraToCenterDistance(a,u=this.zoom){const g=Oa(a,u,this.width,this.height,1024),v=a.pixelSpaceConversion(this.center.lat,this.worldSize,g);return.5/Math.tan(.5*this._fov)*this.height*v}getWorldToCameraMatrix(){const a=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&d.multiply(a,a,this.globeMatrix),a}}function Ec(f,a){let u=!1,g=null;const v=()=>{g=null,u&&(f(),g=setTimeout(v,a),u=!1)};return()=>(u=!0,g||v(),g)}class at{constructor(a){this._hashName=a&&encodeURIComponent(a),d.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Ec(this._updateHashUnthrottled.bind(this),300)}addTo(a){return this._map=a,d.window.addEventListener("hashchange",this._onHashChange,!1),a.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),d.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const a=this._map;if(!a)return"";const u=Kr(a);if(this._hashName){const g=this._hashName;let v=!1;const b=d.window.location.hash.slice(1).split("&").map(D=>{const I=D.split("=")[0];return I===g?(v=!0,`${I}=${u}`):D}).filter(D=>D);return v||b.push(`${g}=${u}`),`#${b.join("&")}`}return`#${u}`}_getCurrentHash(){const a=d.window.location.hash.replace("#","");if(this._hashName){let u;return a.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(u=g)}),(u&&u[1]||"").split("/")}return a.split("/")}_onHashChange(){const a=this._map;if(!a)return!1;const u=this._getCurrentHash();if(u.length>=3&&!u.some(g=>isNaN(g))){const g=a.dragRotate.isEnabled()&&a.touchZoomRotate.isEnabled()?+(u[3]||0):a.getBearing();return a.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:g,pitch:+(u[4]||0)}),!0}return!1}_updateHashUnthrottled(){const a=d.window.location.href.replace(/(#.+)?$/,this.getHashString());d.window.history.replaceState(d.window.history.state,null,a)}}function Kr(f,a){const u=f.getCenter(),g=Math.round(100*f.getZoom())/100,v=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,v),D=Math.round(u.lng*b)/b,I=Math.round(u.lat*b)/b,M=f.getBearing(),R=f.getPitch();let k=a?`/${D}/${I}/${g}`:`${g}/${I}/${D}`;return(M||R)&&(k+="/"+Math.round(10*M)/10),R&&(k+=`/${Math.round(R)}`),k}const El={linearity:.3,easing:d.bezier(0,0,.3,1)},op=d.extend({deceleration:2500,maxSpeed:1400},El),Ru=d.extend({deceleration:20,maxSpeed:1400},El),Tl=d.extend({deceleration:1e3,maxSpeed:360},El),Yr=d.extend({deceleration:1e3,maxSpeed:90},El);class Dl{constructor(a){this._map=a,this.clear()}clear(){this._inertiaBuffer=[]}record(a){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:d.exported.now(),settings:a})}_drainInertiaBuffer(){const a=this._inertiaBuffer,u=d.exported.now();for(;a.length>0&&u-a[0].time>160;)a.shift()}_onMoveEnd(a){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const u={zoom:0,bearing:0,pitch:0,pan:new d.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)u.zoom+=b.zoomDelta||0,u.bearing+=b.bearingDelta||0,u.pitch+=b.pitchDelta||0,b.panDelta&&u.pan._add(b.panDelta),b.around&&(u.around=b.around),b.pinchAround&&(u.pinchAround=b.pinchAround);const g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(u.pan.mag()){const b=Es(u.pan.mag(),g,d.extend({},op,a||{}));v.offset=u.pan.mult(b.amount/u.pan.mag()),v.center=this._map.transform.center,Cl(v,b)}if(u.zoom){const b=Es(u.zoom,g,Ru);v.zoom=this._map.transform.zoom+b.amount,Cl(v,b)}if(u.bearing){const b=Es(u.bearing,g,Tl);v.bearing=this._map.transform.bearing+d.clamp(b.amount,-179,179),Cl(v,b)}if(u.pitch){const b=Es(u.pitch,g,Yr);v.pitch=this._map.transform.pitch+b.amount,Cl(v,b)}if(v.zoom||v.bearing){const b=void 0===u.pinchAround?u.around:u.pinchAround;v.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),v.noMoveStart=!0,v}}function Cl(f,a){(!f.duration||f.duration<a.duration)&&(f.duration=a.duration,f.easing=a.easing)}function Es(f,a,u){const{maxSpeed:g,linearity:v,deceleration:b}=u,D=d.clamp(f*v/(a/1e3),-g,g),I=Math.abs(D)/(b*v);return{easing:u.easing,duration:1e3*I,amount:D*(I/2)}}class Ar extends d.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,u,g,v={}){const b=et(u.getCanvasContainer(),g),D=u.unproject(b);super(a,d.extend({point:b,lngLat:D,originalEvent:g},v)),this._defaultPrevented=!1,this.target=u}}class Ou extends d.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,u,g){const v="touchend"===a?g.changedTouches:g.touches,b=no(u.getCanvasContainer(),v),D=b.map(M=>u.unproject(M)),I=b.reduce((M,R,k,B)=>M.add(R.div(B.length)),new d.pointGeometry(0,0));super(a,{points:b,point:I,lngLats:D,lngLat:u.unproject(I),originalEvent:g}),this._defaultPrevented=!1}}class ni extends d.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,u,g){super(a,{originalEvent:g}),this._defaultPrevented=!1}}class $f{constructor(a,u){this._map=a,this._clickTolerance=u.clickTolerance}reset(){this._mousedownPos=void 0}wheel(a){return this._firePreventable(new ni(a.type,this._map,a))}mousedown(a,u){return this._mousedownPos=u,this._firePreventable(new Ar(a.type,this._map,a))}mouseup(a){this._map.fire(new Ar(a.type,this._map,a))}preclick(a){const u=d.extend({},a);u.type="preclick",this._map.fire(new Ar(u.type,this._map,u))}click(a,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||(this.preclick(a),this._map.fire(new Ar(a.type,this._map,a)))}dblclick(a){return this._firePreventable(new Ar(a.type,this._map,a))}mouseover(a){this._map.fire(new Ar(a.type,this._map,a))}mouseout(a){this._map.fire(new Ar(a.type,this._map,a))}touchstart(a){return this._firePreventable(new Ou(a.type,this._map,a))}touchmove(a){this._map.fire(new Ou(a.type,this._map,a))}touchend(a){this._map.fire(new Ou(a.type,this._map,a))}touchcancel(a){this._map.fire(new Ou(a.type,this._map,a))}_firePreventable(a){if(this._map.fire(a),a.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Rg{constructor(a){this._map=a}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(a){this._map.fire(new Ar(a.type,this._map,a))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ar("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(a){this._delayContextMenu?this._contextMenuEvent=a:this._map.fire(new Ar(a.type,this._map,a)),this._map.listens("contextmenu")&&a.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Tc{constructor(a,u){this._map=a,this._el=a.getCanvasContainer(),this._container=a.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(a,u){this.isEnabled()&&a.shiftKey&&0===a.button&&(Yl(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(a,u){if(!this._active)return;const g=u,v=this._startPos,b=this._lastPos;if(!v||!b||b.equals(g)||!this._box&&g.dist(v)<this._clickTolerance)return;this._lastPos=g,this._box||(this._box=Wt("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",a));const D=Math.min(v.x,g.x),I=Math.max(v.x,g.x),M=Math.min(v.y,g.y),R=Math.max(v.y,g.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${D}px,${M}px)`,this._box.style.width=I-D+"px",this._box.style.height=R-M+"px")})}mouseupWindow(a,u){if(!this._active)return;const g=this._startPos,v=u;if(g&&0===a.button){if(this.reset(),to(),g.x!==v.x||g.y!==v.y)return this._map.fire(new d.Event("boxzoomend",{originalEvent:a})),{cameraAnimation:b=>b.fitScreenCoordinates(g,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",a)}}keydown(a){this._active&&27===a.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",a))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),jo(),delete this._startPos,delete this._lastPos}_fireEvent(a,u){return this._map.fire(new d.Event(a,{originalEvent:u}))}}function Li(f,a){const u={};for(let g=0;g<f.length;g++)u[f[g].identifier]=a[g];return u}class Uh{constructor(a){this.reset(),this.numTouches=a.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(a,u,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=a.timeStamp),g.length===this.numTouches&&(this.centroid=function(v){const b=new d.pointGeometry(0,0);for(const D of v)b._add(D);return b.div(v.length)}(u),this.touches=Li(g,u)))}touchmove(a,u,g){if(this.aborted||!this.centroid)return;const v=Li(g,u);for(const b in this.touches){const D=this.touches[b],I=v[b];(!I||I.dist(D)>30)&&(this.aborted=!0)}}touchend(a,u,g){if((!this.centroid||a.timeStamp-this.startTime>500)&&(this.aborted=!0),0===g.length){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class Il{constructor(a){this.singleTap=new Uh(a),this.numTaps=a.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(a,u,g){this.singleTap.touchstart(a,u,g)}touchmove(a,u,g){this.singleTap.touchmove(a,u,g)}touchend(a,u,g){const v=this.singleTap.touchend(a,u,g);if(v){const b=a.timeStamp-this.lastTime<500,D=!this.lastTap||this.lastTap.dist(v)<30;if(b&&D||this.reset(),this.count++,this.lastTime=a.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class za{constructor(){this._zoomIn=new Il({numTouches:1,numTaps:2}),this._zoomOut=new Il({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(a,u,g){this._zoomIn.touchstart(a,u,g),this._zoomOut.touchstart(a,u,g)}touchmove(a,u,g){this._zoomIn.touchmove(a,u,g),this._zoomOut.touchmove(a,u,g)}touchend(a,u,g){const v=this._zoomIn.touchend(a,u,g),b=this._zoomOut.touchend(a,u,g);return v?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:D=>D.easeTo({duration:300,zoom:D.getZoom()+1,around:D.unproject(v)},{originalEvent:a})}):b?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:D=>D.easeTo({duration:300,zoom:D.getZoom()-1,around:D.unproject(b)},{originalEvent:a})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const or={0:1,2:2};class Dc{constructor(a){this.reset(),this._clickTolerance=a.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(a,u){return!1}_move(a,u){return{}}mousedown(a,u){if(this._lastPoint)return;const g=ps(a);this._correctButton(a,g)&&(this._lastPoint=u,this._eventButton=g)}mousemoveWindow(a,u){const g=this._lastPoint;if(g)if(a.preventDefault(),null!=this._eventButton&&function(v,b){const D=or[b];return void 0===v.buttons||(v.buttons&D)!==D}(a,this._eventButton))this.reset();else if(this._moved||!(u.dist(g)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(g,u)}mouseupWindow(a){this._lastPoint&&ps(a)===this._eventButton&&(this._moved&&to(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Cc extends Dc{mousedown(a,u){super.mousedown(a,u),this._lastPoint&&(this._active=!0)}_correctButton(a,u){return 0===u&&!a.ctrlKey}_move(a,u){return{around:u,panDelta:u.sub(a)}}}class $h extends Dc{_correctButton(a,u){return 0===u&&a.ctrlKey||2===u}_move(a,u){const g=.8*(u.x-a.x);if(g)return this._active=!0,{bearingDelta:g}}contextmenu(a){a.preventDefault()}}class Xo extends Dc{_correctButton(a,u){return 0===u&&a.ctrlKey||2===u}_move(a,u){const g=-.5*(u.y-a.y);if(g)return this._active=!0,{pitchDelta:g}}contextmenu(a){a.preventDefault()}}class Gh{constructor(a,u){this._map=a,this._el=a.getCanvasContainer(),this._minTouches=1,this._clickTolerance=u.clickTolerance||1,this.reset(),d.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new d.pointGeometry(0,0)}touchstart(a,u,g){return this._calculateTransform(a,u,g)}touchmove(a,u,g){if(this._active&&!(g.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===g.length&&!d.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return a.cancelable&&a.preventDefault(),this._calculateTransform(a,u,g)}}touchend(a,u,g){this._calculateTransform(a,u,g),this._active&&g.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(a,u,g){g.length>0&&(this._active=!0);const v=Li(g,u),b=new d.pointGeometry(0,0),D=new d.pointGeometry(0,0);let I=0;for(const R in v){const k=v[R],B=this._touches[R];B&&(b._add(k),D._add(k.sub(B)),I++,v[R]=k)}if(this._touches=v,I<this._minTouches||!D.mag())return;const M=D.div(I);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(I),panDelta:M}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Wt("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Sl{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(a){}_move(a,u,g){return{}}touchstart(a,u,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([u[0],u[1]]))}touchmove(a,u,g){const v=this._firstTwoTouches;if(!v)return;a.preventDefault();const[b,D]=v,I=Ot(g,u,b),M=Ot(g,u,D);if(!I||!M)return;const R=this._aroundCenter?null:I.add(M).div(2);return this._move([I,M],R,a)}touchend(a,u,g){if(!this._firstTwoTouches)return;const[v,b]=this._firstTwoTouches,D=Ot(g,u,v),I=Ot(g,u,b);D&&I||(this._active&&to(),this.reset())}touchcancel(){this.reset()}enable(a){this._enabled=!0,this._aroundCenter=!!a&&"center"===a.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ot(f,a,u){for(let g=0;g<f.length;g++)if(f[g].identifier===u)return a[g]}function Fu(f,a){return Math.log(f/a)/Math.LN2}class Gf extends Sl{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(a){this._startDistance=this._distance=a[0].dist(a[1])}_move(a,u){const g=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(Fu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Fu(this._distance,g),pinchAround:u}}}function sp(f,a){return 180*f.angleWith(a)/Math.PI}class ap extends Sl{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])}_move(a,u){const g=this._vector;if(this._vector=a[0].sub(a[1]),g&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:sp(this._vector,g),pinchAround:u}}_isBelowThreshold(a){this._minDiameter=Math.min(this._minDiameter,a.mag());const u=25/(Math.PI*this._minDiameter)*360,g=this._startVector;if(!g)return!1;const v=sp(a,g);return Math.abs(v)<u}}function Nu(f){return Math.abs(f.y)>Math.abs(f.x)}class Hh extends Sl{constructor(a){super(),this._map=a}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(a){this._lastPoints=a,Nu(a[0].sub(a[1]))&&(this._valid=!1)}_move(a,u,g){const v=this._lastPoints;if(!v)return;const b=a[0].sub(v[0]),D=a[1].sub(v[1]);return this._map._cooperativeGestures&&!d.isFullscreen()&&g.touches.length<3||(this._valid=this.gestureBeginsVertically(b,D,g.timeStamp),!this._valid)?void 0:(this._lastPoints=a,this._active=!0,{pitchDelta:(b.y+D.y)/2*-.5})}gestureBeginsVertically(a,u,g){if(void 0!==this._valid)return this._valid;const v=a.mag()>=2,b=u.mag()>=2;if(!v&&!b)return;if(!v||!b)return null==this._firstMove&&(this._firstMove=g),g-this._firstMove<100&&void 0;const D=a.y>0==u.y>0;return Nu(a)&&Nu(u)&&D}}const lp={panStep:100,bearingStep:15,pitchStep:10};class sr{constructor(){const a=lp;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(a){if(a.altKey||a.ctrlKey||a.metaKey)return;let u=0,g=0,v=0,b=0,D=0;switch(a.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:a.shiftKey?g=-1:(a.preventDefault(),b=-1);break;case 39:a.shiftKey?g=1:(a.preventDefault(),b=1);break;case 38:a.shiftKey?v=1:(a.preventDefault(),D=-1);break;case 40:a.shiftKey?v=-1:(a.preventDefault(),D=1);break;default:return}return this._rotationDisabled&&(g=0,v=0),{cameraAnimation:I=>{const M=I.getZoom();I.easeTo({duration:300,easeId:"keyboardHandler",easing:Je,zoom:u?Math.round(M)+u*(a.shiftKey?2:1):M,bearing:I.getBearing()+g*this._bearingStep,pitch:I.getPitch()+v*this._pitchStep,offset:[-b*this._panStep,-D*this._panStep],center:I.getCenter()},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Je(f){return f*(2-f)}const vn=4.000244140625;class Pr{constructor(a,u){this._map=a,this._el=a.getCanvasContainer(),this._handler=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,d.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(a){this._defaultZoomRate=a}setWheelZoomRate(a){this._wheelZoomRate=a}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(a){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!a&&"center"===a.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(a){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(a.ctrlKey||a.metaKey||this.isZooming()||d.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let u=a.deltaMode===d.window.WheelEvent.DOM_DELTA_LINE?40*a.deltaY:a.deltaY;const g=d.exported.now(),v=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,0!==u&&u%vn==0?this._type="wheel":0!==u&&Math.abs(u)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,a)):this._type||(this._type=Math.abs(v*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),a.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=a,this._delta-=u,this._active||this._start(a)),a.preventDefault()}_onTimeout(a){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)}_start(a){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const u=et(this._el,a);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:u,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const a=this._map.transform;"wheel"===this._type&&a.projection.wrap&&(a._center.lng>=180||a._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const u=()=>a._terrainEnabled()&&this._aroundCoord?a.computeZoomRelativeTo(this._aroundCoord):a.zoom;if(0!==this._delta){const M="wheel"===this._type&&Math.abs(this._delta)>vn?this._wheelZoomRate:this._defaultZoomRate;let R=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&0!==R&&(R=1/R);const k=u(),B=Math.pow(2,k),$="number"==typeof this._targetZoom?a.zoomScale(this._targetZoom):B;this._targetZoom=Math.min(a.maxZoom,Math.max(a.minZoom,a.scaleZoom($*R))),"wheel"===this._type&&(this._startZoom=k,this._easing=this._smoothOutEasing(200)),this._delta=0}const g="number"==typeof this._targetZoom?this._targetZoom:u(),v=this._startZoom,b=this._easing;let D,I=!1;if("wheel"===this._type&&v&&b){const M=Math.min((d.exported.now()-this._lastWheelEventTime)/200,1),R=b(M);D=d.number(v,g,R),M<1?this._frameId||(this._frameId=!0):I=!0}else D=g,I=!0;return this._active=!0,I&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!I,zoomDelta:D-u(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(a){let u=d.ease;if(this._prevEase){const g=this._prevEase,v=(d.exported.now()-g.start)/g.duration,b=g.easing(v+.01)-g.easing(v),D=.27/Math.sqrt(b*b+1e-4)*.01,I=Math.sqrt(.0729-D*D);u=d.bezier(D,I,.25,1)}return this._prevEase={start:d.exported.now(),duration:a,easing:u},u}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Wt("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(d.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Lr{constructor(a,u){this._clickZoom=a,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Xn{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(a,u){return a.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:g.getZoom()+(a.shiftKey?-1:1),around:g.unproject(u)},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class qh{constructor(){this._tap=new Il({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(a,u,g){this._swipePoint||(this._tapTime&&a.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?g.length>0&&(this._swipePoint=u[0],this._swipeTouch=g[0].identifier):this._tap.touchstart(a,u,g))}touchmove(a,u,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;const v=u[0],b=v.y-this._swipePoint.y;return this._swipePoint=v,a.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(a,u,g)}touchend(a,u,g){this._tapTime?this._swipePoint&&0===g.length&&this.reset():this._tap.touchend(a,u,g)&&(this._tapTime=a.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ko{constructor(a,u,g){this._el=a,this._mousePan=u,this._touchPan=g}enable(a){this._inertiaOptions=a||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Di{constructor(a,u,g){this._pitchWithRotate=a.pitchWithRotate,this._mouseRotate=u,this._mousePitch=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ml{constructor(a,u,g,v){this._el=a,this._touchZoom=u,this._touchRotate=g,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(a){this._touchZoom.enable(a),this._rotationDisabled||this._touchRotate.enable(a),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const lt=f=>f.zoom||f.drag||f.pitch||f.rotate;class Hf extends d.Event{}class cp{constructor(){this.constants=[1,1,.01],this.radius=0}setup(a,u){const g=d.sub([],u,a);this.radius=d.length(g[2]<0?d.div([],g,this.constants):[g[0],g[1],0])}projectRay(a){d.div(a,a,this.constants),d.normalize(a,a),d.mul$1(a,a,this.constants);const u=d.scale$2([],a,this.radius);if(u[2]>0){const g=d.scale$2([],[0,0,1],d.dot(u,[0,0,1])),v=d.scale$2([],d.normalize([],[u[0],u[1],0]),this.radius),b=d.add([],u,d.scale$2([],d.sub([],d.add([],v,g),u),2));u[0]=b[0],u[1]=b[1]}return u}}function Ba(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class Al{constructor(a,u){this._map=a,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Dl(a),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new cp,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(u),d.bindAll(["handleEvent","handleWindowEvent"],this);const g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[d.window.document,"mousemove",{capture:!0}],[d.window.document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[d.window,"blur",void 0]];for(const[v,b,D]of this._listeners)v.addEventListener(b,v===d.window.document?this.handleWindowEvent:this.handleEvent,D)}destroy(){for(const[a,u,g]of this._listeners)a.removeEventListener(u,a===d.window.document?this.handleWindowEvent:this.handleEvent,g)}_addDefaultHandlers(a){const u=this._map,g=u.getCanvasContainer();this._add("mapEvent",new $f(u,a));const v=u.boxZoom=new Tc(u,a);this._add("boxZoom",v);const b=new za,D=new Xn;u.doubleClickZoom=new Lr(D,b),this._add("tapZoom",b),this._add("clickZoom",D);const I=new qh;this._add("tapDragZoom",I);const M=u.touchPitch=new Hh(u);this._add("touchPitch",M);const R=new $h(a),k=new Xo(a);u.dragRotate=new Di(a,R,k),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",k,["mouseRotate"]);const B=new Cc(a),$=new Gh(u,a);u.dragPan=new Ko(g,B,$),this._add("mousePan",B),this._add("touchPan",$,["touchZoom","touchRotate"]);const Z=new ap,W=new Gf;u.touchZoomRotate=new Ml(g,W,Z,I),this._add("touchRotate",Z,["touchPan","touchZoom"]),this._add("touchZoom",W,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Rg(u));const K=u.scrollZoom=new Pr(u,this);this._add("scrollZoom",K,["mousePan"]);const q=u.keyboard=new sr;this._add("keyboard",q);for(const H of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])a.interactive&&a[H]&&u[H].enable(a[H])}_add(a,u,g){this._handlers.push({handlerName:a,handler:u,allowed:g}),this._handlersById[a]=u}stop(a){if(!this._updatingCamera){for(const{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},a),this._changes=[]}}isActive(){for(const{handler:a}of this._handlers)if(a.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!lt(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(a,u,g){for(const v in a)if(v!==g&&(!u||u.indexOf(v)<0))return!0;return!1}handleWindowEvent(a){this.handleEvent(a,`${a.type}Window`)}_getMapTouches(a){const u=[];for(const g of a)this._el.contains(g.target)&&u.push(g);return u}handleEvent(a,u){this._updatingCamera=!0;const g="renderFrame"===a.type,v=g?void 0:a,b={needsRenderFrame:!1},D={},I={},M=a.touches?this._getMapTouches(a.touches):void 0,R=M?no(this._el,M):g?void 0:et(this._el,a);for(const{handlerName:$,handler:Z,allowed:W}of this._handlers){if(!Z.isEnabled())continue;let K;this._blockedByActive(I,W,$)?Z.reset():Z[u||a.type]&&(K=Z[u||a.type](a,R,M),this.mergeHandlerResult(b,D,K,$,v),K&&K.needsRenderFrame&&this._triggerRenderFrame()),(K||Z.isActive())&&(I[$]=Z)}const k={};for(const $ in this._previousActiveHandlers)I[$]||(k[$]=v);this._previousActiveHandlers=I,(Object.keys(k).length||Ba(b))&&(this._changes.push([b,D,k]),this._triggerRenderFrame()),(Object.keys(I).length||Ba(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:B}=b;B&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],B(this._map))}mergeHandlerResult(a,u,g,v,b){if(!g)return;d.extend(a,g);const D={handlerName:v,originalEvent:g.originalEvent||b};void 0!==g.zoomDelta&&(u.zoom=D),void 0!==g.panDelta&&(u.drag=D),void 0!==g.pitchDelta&&(u.pitch=D),void 0!==g.bearingDelta&&(u.rotate=D)}_applyChanges(){const a={},u={},g={};for(const[v,b,D]of this._changes)v.panDelta&&(a.panDelta=(a.panDelta||new d.pointGeometry(0,0))._add(v.panDelta)),v.zoomDelta&&(a.zoomDelta=(a.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(a.bearingDelta=(a.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(a.pitchDelta=(a.pitchDelta||0)+v.pitchDelta),void 0!==v.around&&(a.around=v.around),void 0!==v.aroundCoord&&(a.aroundCoord=v.aroundCoord),void 0!==v.pinchAround&&(a.pinchAround=v.pinchAround),v.noInertia&&(a.noInertia=v.noInertia),d.extend(u,b),d.extend(g,D);this._updateMapTransform(a,u,g),this._changes=[]}_updateMapTransform(a,u,g){const v=this._map,b=v.transform,D=J=>[J.x,J.y,J.z];if((J=>{const Q=this._eventsInProgress.drag;return Q&&!this._handlersById[Q.handlerName].isActive()})()&&!Ba(a)){const J=b.zoom;b.cameraElevationReference="sea",b.recenterOnTerrain(),b.cameraElevationReference="ground",J!==b.zoom&&this._map._update(!0)}if(b._isCameraConstrained&&v._stop(!0),!Ba(a))return void this._fireEvents(u,g,!0);let{panDelta:I,zoomDelta:M,bearingDelta:R,pitchDelta:k,around:B,aroundCoord:$,pinchAround:Z}=a;b._isCameraConstrained&&(M>0&&(M=0),b._isCameraConstrained=!1),void 0!==Z&&(B=Z),(J=>u.drag&&!this._eventsInProgress.drag)()&&B&&(this._dragOrigin=D(b.pointCoordinate3D(B)),this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",v._stop(!0),B=B||v.transform.centerPoint,R&&(b.bearing+=R),k&&(b.pitch+=k),b._updateCameraState();const W=[0,0,0];if(I)if("mercator"===b.projection.name){const J=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(B).dir),Q=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(B.sub(I)).dir);W[0]=Q[0]-J[0],W[1]=Q[1]-J[1]}else{const J=b.pointCoordinate(B);if("globe"===b.projection.name){I=I.rotate(-b.angle);const Q=b._pixelsPerMercatorPixel/b.worldSize;W[0]=-I.x*d.mercatorScale(d.latFromMercatorY(J.y))*Q,W[1]=-I.y*d.mercatorScale(b.center.lat)*Q}else{const Q=b.pointCoordinate(B.sub(I));J&&Q&&(W[0]=Q.x-J.x,W[1]=Q.y-J.y)}}const K=b.zoom,q=[0,0,0];if(M){const J=D($||b.pointCoordinate3D(B)),Q={dir:d.normalize([],d.sub([],J,b._camera.position))};if(Q.dir[2]<0){const re=b.zoomDeltaToMovement(J,M);d.scale$2(q,Q.dir,re)}}const H=d.add(W,W,q);b._translateCameraConstrained(H),M&&Math.abs(b.zoom-K)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),a.noInertia||this._inertia.record(a),this._fireEvents(u,g,!0)}_fireEvents(a,u,g){const v=lt(this._eventsInProgress),b=lt(a),D={};for(const k in a){const{originalEvent:B}=a[k];this._eventsInProgress[k]||(D[`${k}start`]=B),this._eventsInProgress[k]=a[k]}!v&&b&&this._fireEvent("movestart",b.originalEvent);for(const k in D)this._fireEvent(k,D[k]);b&&this._fireEvent("move",b.originalEvent);for(const k in a){const{originalEvent:B}=a[k];this._fireEvent(k,B)}const I={};let M;for(const k in this._eventsInProgress){const{handlerName:B,originalEvent:$}=this._eventsInProgress[k];this._handlersById[B].isActive()||(delete this._eventsInProgress[k],M=u[B]||$,I[`${k}end`]=M)}for(const k in I)this._fireEvent(k,I[k]);const R=lt(this._eventsInProgress);if(g&&(v||b)&&!R){this._updatingCamera=!0;const k=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=$=>0!==$&&-this._bearingSnap<$&&$<this._bearingSnap;k?(B(k.bearing||this._map.getBearing())&&(k.bearing=0),this._map.easeTo(k,{originalEvent:M})):(this._map.fire(new d.Event("moveend",{originalEvent:M})),B(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(a,u){this._map.fire(new d.Event(a,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(a=>{this._frameId=void 0,this.handleEvent(new Hf("renderFrame",{timeStamp:a})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Gi="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Yo extends d.Evented{constructor(a,u){super(),this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=u.bearingSnap,d.bindAll(["_renderFrameCallback"],this)}getCenter(){return new d.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(a,u){return this.jumpTo({center:a},u)}panBy(a,u,g){return a=d.pointGeometry.convert(a).mult(-1),this.panTo(this.transform.center,d.extend({offset:a},u),g)}panTo(a,u,g){return this.easeTo(d.extend({center:a},u),g)}getZoom(){return this.transform.zoom}setZoom(a,u){return this.jumpTo({zoom:a},u),this}zoomTo(a,u,g){return this.easeTo(d.extend({zoom:a},u),g)}zoomIn(a,u){return this.zoomTo(this.getZoom()+1,a,u),this}zoomOut(a,u){return this.zoomTo(this.getZoom()-1,a,u),this}getBearing(){return this.transform.bearing}setBearing(a,u){return this.jumpTo({bearing:a},u),this}getPadding(){return this.transform.padding}setPadding(a,u){return this.jumpTo({padding:a},u),this}rotateTo(a,u,g){return this.easeTo(d.extend({bearing:a},u),g)}resetNorth(a,u){return this.rotateTo(0,d.extend({duration:1e3},a),u),this}resetNorthPitch(a,u){return this.easeTo(d.extend({bearing:0,pitch:0,duration:1e3},a),u),this}snapToNorth(a,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,u):this}getPitch(){return this.transform.pitch}setPitch(a,u){return this.jumpTo({pitch:a},u),this}cameraForBounds(a,u){a=d.LngLatBounds.convert(a);const g=u&&u.bearing||0,v=u&&u.pitch||0,b=a.getNorthWest(),D=a.getSouthEast();return this._cameraForBounds(this.transform,b,D,g,v,u)}_extendCameraOptions(a){const u={top:0,bottom:0,right:0,left:0};if("number"==typeof(a=d.extend({padding:u,offset:[0,0],maxZoom:this.transform.maxZoom},a)).padding){const g=a.padding;a.padding={top:g,bottom:g,right:g,left:g}}return a.padding=d.extend(u,a.padding),a}_minimumAABBFrustumDistance(a,u){const g=u.max[0]-u.min[0],v=u.max[1]-u.min[1];return g/v>a.aspect?g/(2*Math.tan(.5*a.fovX)*a.aspect):v/(2*Math.tan(.5*a.fovY)*a.aspect)}_cameraForBoundsOnGlobe(a,u,g,v,b,D){const I=a.clone(),M=this._extendCameraOptions(D);I.bearing=v,I.pitch=b;const R=d.LngLat.convert(u),k=d.LngLat.convert(g),B=.5*(R.lat+k.lat),$=.5*(R.lng+k.lng),Z=d.latLngToECEF(B,$),W=d.normalize([],Z),K=d.normalize([],d.cross([],W,[0,1,0])),q=d.cross([],K,W),H=[K[0],K[1],K[2],0,q[0],q[1],q[2],0,W[0],W[1],W[2],0,0,0,0,1],J=[Z,d.latLngToECEF(R.lat,R.lng),d.latLngToECEF(k.lat,R.lng),d.latLngToECEF(k.lat,k.lng),d.latLngToECEF(R.lat,k.lng),d.latLngToECEF(B,R.lng),d.latLngToECEF(B,k.lng),d.latLngToECEF(R.lat,$),d.latLngToECEF(k.lat,$)];let Q=d.Aabb.fromPoints(J.map(ge=>[d.dot(K,ge),d.dot(q,ge),d.dot(W,ge)]));const re=d.transformMat4([],Q.center,H);0===d.squaredLength(re)&&d.set(re,0,0,1),d.normalize(re,re),d.scale$2(re,re,d.GLOBE_RADIUS),I.center=d.ecefToLatLng(re);const ue=I.getWorldToCameraMatrix(),ce=d.invert(new Float64Array(16),ue);Q=d.Aabb.applyTransform(Q,d.multiply([],ue,H)),d.transformMat4(re,re,ue);const me=.5*(Q.max[2]-Q.min[2]),Se=this._minimumAABBFrustumDistance(I,Q),Te=d.scale$2([],[0,0,1],me),_e=d.add(Te,re,Te),Ze=Se+(0===I.pitch?0:d.distance(re,_e)),xe=I.globeCenterInViewSpace,Le=d.sub([],re,[xe[0],xe[1],xe[2]]);d.normalize(Le,Le),d.scale$2(Le,Le,Ze);const Ce=d.add([],re,Le);d.transformMat4(Ce,Ce,ce);const He=d.earthRadius/d.GLOBE_RADIUS,Pe=d.length(Ce),Fe=d.mercatorZfromAltitude(Pe*He-d.earthRadius,0),Qe=Math.min(I.zoomFromMercatorZAdjusted(Fe),M.maxZoom);return Qe>.5*(d.GLOBE_ZOOM_THRESHOLD_MIN+d.GLOBE_ZOOM_THRESHOLD_MAX)?(I.setProjection({name:"mercator"}),I.zoom=Qe,this._cameraForBounds(I,u,g,v,b,D)):{center:I.center,zoom:Qe,bearing:v,pitch:b}}queryTerrainElevation(a,u){const g=this.transform.elevation;return g?(u=d.extend({},{exaggerated:!0},u),g.getAtPoint(d.MercatorCoordinate.fromLngLat(a),null,u.exaggerated)):null}_cameraForBounds(a,u,g,v,b,D){if("globe"===a.projection.name)return this._cameraForBoundsOnGlobe(a,u,g,v,b,D);const I=a.clone(),M=this._extendCameraOptions(D),R=I.padding;I.bearing=v,I.pitch=b;const k=d.LngLat.convert(u),B=d.LngLat.convert(g),$=new d.LngLat(k.lng,B.lat),Z=new d.LngLat(B.lng,k.lat),W=I.project(k),K=I.project(B),q=this.queryTerrainElevation(k),H=this.queryTerrainElevation(B),J=this.queryTerrainElevation($),Q=this.queryTerrainElevation(Z),re=[[W.x,W.y,Math.min(q||0,H||0,J||0,Q||0)],[K.x,K.y,Math.max(q||0,H||0,J||0,Q||0)]];let ue=d.Aabb.fromPoints(re);const ce=I.getWorldToCameraMatrix(),me=d.invert(new Float64Array(16),ce);ue=d.Aabb.applyTransform(ue,ce);const Se=d.sub([],ue.max,ue.min),Te=R.left||0,_e=R.right||0,Ze=R.bottom||0,xe=R.top||0,{left:Le,right:Ce,top:He,bottom:Pe}=M.padding,Fe=.5*(Te+_e),Qe=.5*(xe+Ze),ge=Math.min(I.scaleZoom(I.scale*Math.min((I.width-(Te+_e+Le+Ce))/Se[0],(I.height-(Ze+xe+Pe+He))/Se[1])),M.maxZoom),Ie=I.scale/I.zoomScale(ge);ue=new d.Aabb([ue.min[0]-(Le+Fe)*Ie,ue.min[1]-(Pe+Qe)*Ie,ue.min[2]],[ue.max[0]+(Ce+Fe)*Ie,ue.max[1]+(He+Qe)*Ie,ue.max[2]]);const ht=.5*Se[2],wt=this._minimumAABBFrustumDistance(I,ue),ft=[0,0,1,0];d.transformMat4$1(ft,ft,ce),d.normalize$2(ft,ft);const It=d.scale$2([],ft,wt+ht),Zt=d.add([],ue.center,It),mt=("number"==typeof M.offset.x&&"number"==typeof M.offset.y?new d.pointGeometry(M.offset.x,M.offset.y):d.pointGeometry.convert(M.offset)).rotate(-d.degToRad(v));ue.center[0]-=mt.x*Ie,ue.center[1]+=mt.y*Ie,d.transformMat4(ue.center,ue.center,me),d.transformMat4(Zt,Zt,me);const ut=[ue.center[0],ue.center[1],Zt[2]*I.pixelsPerMeter];d.scale$2(ut,ut,1/I.worldSize);const xn=d.lngFromMercatorX(ut[0]),pn=d.latFromMercatorY(ut[1]),kn=Math.min(I._zoomFromMercatorZ(ut[2]),M.maxZoom),Cn=new d.LngLat(xn,pn);return I.mercatorFromTransition&&kn<.5*(d.GLOBE_ZOOM_THRESHOLD_MIN+d.GLOBE_ZOOM_THRESHOLD_MAX)?(I.setProjection({name:"globe"}),I.zoom=kn,this._cameraForBounds(I,u,g,v,b,D)):{center:Cn,zoom:kn,bearing:v,pitch:b}}fitBounds(a,u,g){const v=this.cameraForBounds(a,u);return this._fitInternal(v,u,g)}fitScreenCoordinates(a,u,g,v,b){const D=d.pointGeometry.convert(a),I=d.pointGeometry.convert(u),M=new d.pointGeometry(Math.min(D.x,I.x),Math.min(D.y,I.y)),R=new d.pointGeometry(Math.max(D.x,I.x),Math.max(D.y,I.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(D,I))return this;const k=this.transform.pointLocation3D(M),B=this.transform.pointLocation3D(R),$=this.transform.pointLocation3D(new d.pointGeometry(M.x,R.y)),Z=this.transform.pointLocation3D(new d.pointGeometry(R.x,M.y)),W=[Math.min(k.lng,B.lng,$.lng,Z.lng),Math.min(k.lat,B.lat,$.lat,Z.lat)],K=[Math.max(k.lng,B.lng,$.lng,Z.lng),Math.max(k.lat,B.lat,$.lat,Z.lat)],q=v&&v.pitch?v.pitch:this.getPitch(),H=this._cameraForBounds(this.transform,W,K,g,q,v);return this._fitInternal(H,v,b)}_fitInternal(a,u,g){return a?(delete(u=d.extend(a,u)).padding,u.linear?this.easeTo(u,g):this.flyTo(u,g)):this}jumpTo(a,u){this.stop();const g=a.preloadOnly?this.transform.clone():this.transform;let v=!1,b=!1,D=!1;return"zoom"in a&&g.zoom!==+a.zoom&&(v=!0,g.zoom=+a.zoom),void 0!==a.center&&(g.center=d.LngLat.convert(a.center)),"bearing"in a&&g.bearing!==+a.bearing&&(b=!0,g.bearing=+a.bearing),"pitch"in a&&g.pitch!==+a.pitch&&(D=!0,g.pitch=+a.pitch),null==a.padding||g.isPaddingEqual(a.padding)||(g.padding=a.padding),a.preloadOnly?(this._preloadTiles(g),this):(this.fire(new d.Event("movestart",u)).fire(new d.Event("move",u)),v&&this.fire(new d.Event("zoomstart",u)).fire(new d.Event("zoom",u)).fire(new d.Event("zoomend",u)),b&&this.fire(new d.Event("rotatestart",u)).fire(new d.Event("rotate",u)).fire(new d.Event("rotateend",u)),D&&this.fire(new d.Event("pitchstart",u)).fire(new d.Event("pitch",u)).fire(new d.Event("pitchend",u)),this.fire(new d.Event("moveend",u)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||d.warnOnce(Gi),this.transform.getFreeCameraOptions()}setFreeCameraOptions(a,u){const g=this.transform;if(!g.projection.supportsFreeCamera)return d.warnOnce(Gi),this;this.stop();const v=g.zoom,b=g.pitch,D=g.bearing;g.setFreeCameraOptions(a);const I=v!==g.zoom,M=b!==g.pitch,R=D!==g.bearing;return this.fire(new d.Event("movestart",u)).fire(new d.Event("move",u)),I&&this.fire(new d.Event("zoomstart",u)).fire(new d.Event("zoom",u)).fire(new d.Event("zoomend",u)),R&&this.fire(new d.Event("rotatestart",u)).fire(new d.Event("rotate",u)).fire(new d.Event("rotateend",u)),M&&this.fire(new d.Event("pitchstart",u)).fire(new d.Event("pitch",u)).fire(new d.Event("pitchend",u)),this.fire(new d.Event("moveend",u)),this}easeTo(a,u){this._stop(!1,a.easeId),(!1===(a=d.extend({offset:[0,0],duration:500,easing:d.ease},a)).animate||!a.essential&&d.exported.prefersReducedMotion)&&(a.duration=0);const g=this.transform,v=this.getZoom(),b=this.getBearing(),D=this.getPitch(),I=this.getPadding(),M="zoom"in a?+a.zoom:v,R="bearing"in a?this._normalizeBearing(a.bearing,b):b,k="pitch"in a?+a.pitch:D,B="padding"in a?a.padding:g.padding,$=d.pointGeometry.convert(a.offset);let Z,W,K;if("globe"===g.projection.name){const Te=d.MercatorCoordinate.fromLngLat(g.center),_e=$.rotate(-g.angle);Te.x+=_e.x/g.worldSize,Te.y+=_e.y/g.worldSize;const Ze=Te.toLngLat(),xe=d.LngLat.convert(a.center||Ze);this._normalizeCenter(xe),Z=g.centerPoint.add(_e),W=new d.pointGeometry(Te.x,Te.y).mult(g.worldSize),K=new d.pointGeometry(d.mercatorXfromLng(xe.lng),d.mercatorYfromLat(xe.lat)).mult(g.worldSize).sub(W)}else{Z=g.centerPoint.add($);const Te=g.pointLocation(Z),_e=d.LngLat.convert(a.center||Te);this._normalizeCenter(_e),W=g.project(Te),K=g.project(_e).sub(W)}const q=g.zoomScale(M-v);let H,J;a.around&&(H=d.LngLat.convert(a.around),J=g.locationPoint(H));const Q=this._zooming||M!==v,re=this._rotating||b!==R,ue=this._pitching||k!==D,ce=!g.isPaddingEqual(B),me=Te=>_e=>{if(Q&&(Te.zoom=d.number(v,M,_e)),re&&(Te.bearing=d.number(b,R,_e)),ue&&(Te.pitch=d.number(D,k,_e)),ce&&(Te.interpolatePadding(I,B,_e),Z=Te.centerPoint.add($)),H)Te.setLocationAtPoint(H,J);else{const Ze=Te.zoomScale(Te.zoom-v),xe=M>v?Math.min(2,q):Math.max(.5,q),Le=Math.pow(xe,1-_e),Ce=Te.unproject(W.add(K.mult(_e*Le)).mult(Ze));Te.setLocationAtPoint(Te.renderWorldCopies?Ce.wrap():Ce,Z)}return a.preloadOnly||this._fireMoveEvents(u),Te};if(a.preloadOnly){const Te=this._emulate(me,a.duration,g);return this._preloadTiles(Te),this}const Se={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Q,this._rotating=re,this._pitching=ue,this._padding=ce,this._easeId=a.easeId,this._prepareEase(u,a.noMoveStart,Se),this._ease(me(g),Te=>{g.recenterOnTerrain(),this._afterEase(u,Te)},a),this}_prepareEase(a,u,g={}){this._moving=!0,this.transform.cameraElevationReference="sea",u||g.moving||this.fire(new d.Event("movestart",a)),this._zooming&&!g.zooming&&this.fire(new d.Event("zoomstart",a)),this._rotating&&!g.rotating&&this.fire(new d.Event("rotatestart",a)),this._pitching&&!g.pitching&&this.fire(new d.Event("pitchstart",a))}_fireMoveEvents(a){this.fire(new d.Event("move",a)),this._zooming&&this.fire(new d.Event("zoom",a)),this._rotating&&this.fire(new d.Event("rotate",a)),this._pitching&&this.fire(new d.Event("pitch",a))}_afterEase(a,u){if(this._easeId&&u&&this._easeId===u)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const g=this._zooming,v=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new d.Event("zoomend",a)),v&&this.fire(new d.Event("rotateend",a)),b&&this.fire(new d.Event("pitchend",a)),this.fire(new d.Event("moveend",a))}flyTo(a,u){if(!a.essential&&d.exported.prefersReducedMotion){const ge=d.pick(a,["center","zoom","bearing","pitch","around"]);return this.jumpTo(ge,u)}this.stop(),a=d.extend({offset:[0,0],speed:1.2,curve:1.42,easing:d.ease},a);const g=this.transform,v=this.getZoom(),b=this.getBearing(),D=this.getPitch(),I=this.getPadding(),M="zoom"in a?d.clamp(+a.zoom,g.minZoom,g.maxZoom):v,R="bearing"in a?this._normalizeBearing(a.bearing,b):b,k="pitch"in a?+a.pitch:D,B="padding"in a?a.padding:g.padding,$=g.zoomScale(M-v),Z=d.pointGeometry.convert(a.offset);let W=g.centerPoint.add(Z);const K=g.pointLocation(W),q=d.LngLat.convert(a.center||K);this._normalizeCenter(q);const H=g.project(K),J=g.project(q).sub(H);let Q=a.curve;const re=Math.max(g.width,g.height),ue=re/$,ce=J.mag();if("minZoom"in a){const ge=d.clamp(Math.min(a.minZoom,v,M),g.minZoom,g.maxZoom),Ie=re/g.zoomScale(ge-v);Q=Math.sqrt(Ie/ce*2)}const me=Q*Q;function Se(ge){const Ie=(ue*ue-re*re+(ge?-1:1)*me*me*ce*ce)/(2*(ge?ue:re)*me*ce);return Math.log(Math.sqrt(Ie*Ie+1)-Ie)}function Te(ge){return(Math.exp(ge)-Math.exp(-ge))/2}function _e(ge){return(Math.exp(ge)+Math.exp(-ge))/2}const Ze=Se(0);let xe=function(ge){return _e(Ze)/_e(Ze+Q*ge)},Le=function(ge){return re*((_e(Ze)*(Te(Ie=Ze+Q*ge)/_e(Ie))-Te(Ze))/me)/ce;var Ie},Ce=(Se(1)-Ze)/Q;if(Math.abs(ce)<1e-6||!isFinite(Ce)){if(Math.abs(re-ue)<1e-6)return this.easeTo(a,u);const ge=ue<re?-1:1;Ce=Math.abs(Math.log(ue/re))/Q,Le=function(){return 0},xe=function(Ie){return Math.exp(ge*Q*Ie)}}a.duration="duration"in a?+a.duration:1e3*Ce/("screenSpeed"in a?+a.screenSpeed/Q:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0);const He=b!==R,Pe=k!==D,Fe=!g.isPaddingEqual(B),Qe=ge=>Ie=>{const ht=Ie*Ce,wt=1/xe(ht);ge.zoom=1===Ie?M:v+ge.scaleZoom(wt),He&&(ge.bearing=d.number(b,R,Ie)),Pe&&(ge.pitch=d.number(D,k,Ie)),Fe&&(ge.interpolatePadding(I,B,Ie),W=ge.centerPoint.add(Z));const ft=1===Ie?q:ge.unproject(H.add(J.mult(Le(ht))).mult(wt));return ge.setLocationAtPoint(ge.renderWorldCopies?ft.wrap():ft,W),ge._updateCameraOnTerrain(),a.preloadOnly||this._fireMoveEvents(u),ge};if(a.preloadOnly){const ge=this._emulate(Qe,a.duration,g);return this._preloadTiles(ge),this}return this._zooming=!0,this._rotating=He,this._pitching=Pe,this._padding=Fe,this._prepareEase(u,!1),this._ease(Qe(g),()=>this._afterEase(u),a),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(a,u){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const g=this._onEaseEnd;this._onEaseEnd=void 0,g.call(this,u)}if(!a){const g=this.handlers;g&&g.stop(!1)}return this}_ease(a,u,g){!1===g.animate||0===g.duration?(a(1),u()):(this._easeStart=d.exported.now(),this._easeOptions=g,this._onEaseFrame=a,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const a=Math.min((d.exported.now()-this._easeStart)/this._easeOptions.duration,1),u=this._onEaseFrame;u&&u(this._easeOptions.easing(a)),a<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(a,u){a=d.wrap(a,-180,180);const g=Math.abs(a-u);return Math.abs(a-360-u)<g&&(a-=360),Math.abs(a+360-u)<g&&(a+=360),a}_normalizeCenter(a){const u=this.transform;if(!u.renderWorldCopies||u.maxBounds)return;const g=a.lng-u.center.lng;a.lng+=g>180?-360:g<-180?360:0}_emulate(a,u,g){const v=Math.ceil(15*u/1e3),b=[],D=a(g.clone());for(let I=0;I<=v;I++){const M=D(I/v);b.push(M.clone())}return b}}class zu{constructor(a={}){this.options=a,d.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(a){const u=this.options&&this.options.compact;return this._map=a,this._container=Wt("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Wt("button","mapboxgl-ctrl-attrib-button",this._container),Wt("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Wt("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===u&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(a,u){const g=this._map._getUIString(`AttributionControl.${u}`);a.setAttribute("aria-label",g),a.removeAttribute("title"),a.firstElementChild&&a.firstElementChild.setAttribute("title",g)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let a=this._editLink;a||(a=this._editLink=this._container.querySelector(".mapbox-improve-map"));const u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||d.config.ACCESS_TOKEN}];if(a){const g=u.reduce((v,b,D)=>(b.value&&(v+=`${b.key}=${b.value}${D<u.length-1?"&":""}`),v),"?");a.href=`${d.config.FEEDBACK_URL}/${g}#${Kr(this._map,!0)}`,a.rel="noopener nofollow",this._setElementTitle(a,"MapFeedback")}}_updateData(a){!a||"metadata"!==a.sourceDataType&&"visibility"!==a.sourceDataType&&"style"!==a.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let a=[];if(this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const u=this._map.style._sourceCaches;for(const v in u){const b=u[v];if(b.used){const D=b.getSource();D.attribution&&a.indexOf(D.attribution)<0&&a.push(D.attribution)}}a.sort((v,b)=>v.length-b.length),a=a.filter((v,b)=>{for(let D=b+1;D<a.length;D++)if(a[D].indexOf(v)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?a=[...this.options.customAttribution,...a]:a.unshift(this.options.customAttribution));const g=a.join(" | ");g!==this._attribHTML&&(this._attribHTML=g,a.length?(this._innerContainer.innerHTML=g,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class ta{constructor(){d.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(a){this._map=a,this._container=Wt("div","mapboxgl-ctrl");const u=Wt("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(a){a&&"metadata"!==a.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const a=this._map.style._sourceCaches;if(0===Object.entries(a).length)return!0;for(const u in a){const g=a[u].getSource();if(g.hasOwnProperty("mapbox_logo")&&!g.mapbox_logo)return!1}return!0}_updateCompact(){const a=this._container.children;if(a.length){const u=a[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}}}class To{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(a){const u=++this._id;return this._queue.push({callback:a,id:u,cancelled:!1}),u}remove(a){const u=this._currentlyRunning,g=u?this._queue.concat(u):this._queue;for(const v of g)if(v.id===a)return void(v.cancelled=!0)}run(a=0){const u=this._currentlyRunning=this._queue;this._queue=[];for(const g of u)if(!g.cancelled&&(g.callback(a),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Wh(f,a,u){if(f=new d.LngLat(f.lng,f.lat),a){const g=new d.LngLat(f.lng-360,f.lat),v=new d.LngLat(f.lng+360,f.lat),b=360*Math.ceil(Math.abs(f.lng-u.center.lng)/360),D=u.locationPoint(f).distSqr(a),I=a.x<0||a.y<0||a.x>u.width||a.y>u.height;u.locationPoint(g).distSqr(a)<D&&(I||Math.abs(g.lng-u.center.lng)<b)?f=g:u.locationPoint(v).distSqr(a)<D&&(I||Math.abs(v.lng-u.center.lng)<b)&&(f=v)}for(;Math.abs(f.lng-u.center.lng)>180;){const g=u.locationPoint(f);if(g.x>=0&&g.y>=0&&g.x<=u.width&&g.y<=u.height)break;f.lng>u.center.lng?f.lng-=360:f.lng+=360}return f}const Va={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Ic extends d.Evented{constructor(a,u){if(super(),(a instanceof d.window.HTMLElement||u)&&(a=d.extend({element:a},u)),d.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=a&&a.anchor||"center",this._color=a&&a.color||"#3FB1CE",this._scale=a&&a.scale||1,this._draggable=a&&a.draggable||!1,this._clickTolerance=a&&a.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=a&&a.rotation||0,this._rotationAlignment=a&&a.rotationAlignment||"auto",this._pitchAlignment=a&&a.pitchAlignment&&a.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=a&&a.occludedOpacity||.2,a&&a.element)this._element=a.element,this._offset=d.pointGeometry.convert(a&&a.offset||[0,0]);else{this._defaultMarker=!0,this._element=Wt("div");const v=41,b=27,D=xi("svg",{display:"block",height:v*this._scale+"px",width:b*this._scale+"px",viewBox:`0 0 ${b} ${v}`},this._element),I=xi("radialGradient",{id:"shadowGradient"},xi("defs",{},D));xi("stop",{offset:"10%","stop-opacity":.4},I),xi("stop",{offset:"100%","stop-opacity":.05},I),xi("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},D),xi("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},D),xi("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},D),xi("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},D),this._offset=d.pointGeometry.convert(a&&a.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",v=>{v.preventDefault()}),this._element.addEventListener("mousedown",v=>{v.preventDefault()});const g=this._element.classList;for(const v in Va)g.remove(`mapboxgl-marker-anchor-${v}`);g.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(a){return a===this._map||(this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._updateMoving),a.on("moveend",this._update),a.on("remove",this._clearFadeTimer),a._addMarker(this),this.setDraggable(this._draggable),this._update(),a.on("click",this._onMapClick)),this}remove(){const a=this._map;return a&&(a.off("click",this._onMapClick),a.off("move",this._updateMoving),a.off("moveend",this._update),a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler),a.off("mouseup",this._onUp),a.off("touchend",this._onUp),a.off("mousemove",this._onMove),a.off("touchmove",this._onMove),a.off("remove",this._clearFadeTimer),a._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(a){return this._lngLat=d.LngLat.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){const v=Math.sqrt(Math.pow(13.5,2)/2);a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(24.6+v)],"bottom-right":[-v,-1*(24.6+v)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=a,a._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(a){const u=a.code,g=a.charCode||a.keyCode;"Space"!==u&&"Enter"!==u&&32!==g&&13!==g||this.togglePopup()}_onMapClick(a){const u=a.originalEvent.target,g=this._element;this._popup&&(u===g||g.contains(u))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const a=this._popup;return a?(a.isOpen()?(a.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(a.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const a=this._map,u=this._pos;if(!a||!u)return!1;const g=a.unproject(u),v=a.getFreeCameraOptions();if(!v.position)return!1;const b=v.position.toLngLat();return b.distanceTo(g)<.9*b.distanceTo(this._lngLat)}_evaluateOpacity(){const a=this._map;if(!a)return;const u=this._pos;if(!u||u.x<0||u.x>a.transform.width||u.y<0||u.y>a.transform.height)return void this._clearFadeTimer();const g=a.unproject(u);let v;a._showingGlobe()&&d.isLngLatBehindGlobe(a.transform,this._lngLat)?v=0:(v=1-a._queryFogOpacity(g),a.transform._terrainEnabled()&&a.getTerrain()&&this._behindTerrain()&&(v*=this._occludedOpacity)),this._element.style.opacity=`${v}`,this._element.style.pointerEvents=v>0?"auto":"none",this._popup&&this._popup._setOpacity(v),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const a=this._pos;if(!a||!this._map)return;const u=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${a.x}px,${a.y}px)\n            ${Va[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${u.x}px,${u.y}px)\n        `}_calculateXYTransform(){const a=this._pos,u=this._map,g=this.getPitchAlignment();if(!u||!a||"map"!==g)return"";if(!u._showingGlobe()){const M=u.getPitch();return M?`rotateX(${M}deg)`:""}const v=d.radToDeg(d.globeTiltAtLngLat(u.transform,this._lngLat)),b=a.sub(d.globeCenterToScreenPoint(u.transform)),D=Math.abs(b.x)+Math.abs(b.y);if(0===D)return"";const I=v/D;return`rotateX(${-b.y*I}deg) rotateY(${b.x*I}deg)`}_calculateZTransform(){const a=this._pos,u=this._map;if(!u||!a)return"";let g=0;const v=this.getRotationAlignment();if("map"===v)if(u._showingGlobe()){const b=u.project(new d.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),D=u.project(new d.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(b);g=d.radToDeg(Math.atan2(D.y,D.x))-90}else g=-u.getBearing();else if("horizon"===v){const b=d.smoothstep(4,6,u.getZoom()),D=d.globeCenterToScreenPoint(u.transform);D.y+=b*u.transform.height;const I=a.sub(D),M=d.radToDeg(Math.atan2(I.y,I.x));g=(M>90?M-270:M+90)*(1-b)}return g+=this._rotation,g?`rotateZ(${g}deg)`:""}_update(a){d.window.cancelAnimationFrame(this._updateFrameId);const u=this._map;u&&(u.transform.renderWorldCopies&&(this._lngLat=Wh(this._lngLat,this._pos,u.transform)),this._pos=u.project(this._lngLat),!0===a?this._updateFrameId=d.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),u._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(u._showingGlobe()||u.getTerrain()||u.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(a){return this._offset=d.pointGeometry.convert(a),this._update(),this}_onMove(a){const u=this._map;if(!u)return;const g=this._pointerdownPos,v=this._positionDelta;if(g&&v){if(!this._isDragging){const b=this._clickTolerance||u._clickTolerance;if(a.point.dist(g)<b)return;this._isDragging=!0}this._pos=a.point.sub(v),this._lngLat=u.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new d.Event("dragstart"))),this.fire(new d.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const a=this._map;a&&(a.off("mousemove",this._onMove),a.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new d.Event("dragend")),this._state="inactive"}_addDragHandler(a){const u=this._map,g=this._pos;u&&g&&this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(g),this._pointerdownPos=a.point,this._state="pending",u.on("mousemove",this._onMove),u.on("touchmove",this._onMove),u.once("mouseup",this._onUp),u.once("touchend",this._onUp))}setDraggable(a){this._draggable=!!a;const u=this._map;return u&&(a?(u.on("mousedown",this._addDragHandler),u.on("touchstart",this._addDragHandler)):(u.off("mousedown",this._addDragHandler),u.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(a){return this._rotation=a||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(a){return this._rotationAlignment=a||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(a){return this._pitchAlignment=a||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(a){return this._occludedOpacity=a||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Bu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Vu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Sc(f=new d.pointGeometry(0,0),a="bottom"){if("number"==typeof f){const u=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(a){case"top":return new d.pointGeometry(0,f);case"top-left":return new d.pointGeometry(u,u);case"top-right":return new d.pointGeometry(-u,u);case"bottom":return new d.pointGeometry(0,-f);case"bottom-left":return new d.pointGeometry(u,-u);case"bottom-right":return new d.pointGeometry(-u,-u);case"left":return new d.pointGeometry(f,0);case"right":return new d.pointGeometry(-f,0)}return new d.pointGeometry(0,0)}return f instanceof d.pointGeometry||Array.isArray(f)?d.pointGeometry.convert(f):d.pointGeometry.convert(f[a]||[0,0])}class Zh{constructor(a){this.jumpTo(a)}getValue(a){if(a<=this._startTime)return this._start;if(a>=this._endTime)return this._end;const u=d.easeCubicInOut((a-this._startTime)/(this._endTime-this._startTime));return this._start*(1-u)+this._end*u}isEasing(a){return a>=this._startTime&&a<=this._endTime}jumpTo(a){this._startTime=-1/0,this._endTime=-1/0,this._start=a,this._end=a}easeTo(a,u,g){this._start=this.getValue(u),this._end=a,this._startTime=u,this._endTime=u+g}}const ju={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},up={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Xh={showCompass:!0,showZoom:!0,visualizePitch:!1};class Uu{constructor(a,u,g=!1){this._clickTolerance=10,this.element=u,this.mouseRotate=new $h({clickTolerance:a.dragRotate._mouseRotate._clickTolerance}),this.map=a,g&&(this.mousePitch=new Xo({clickTolerance:a.dragRotate._mousePitch._clickTolerance})),d.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),u.addEventListener("mousedown",this.mousedown),u.addEventListener("touchstart",this.touchstart,{passive:!1}),u.addEventListener("touchmove",this.touchmove),u.addEventListener("touchend",this.touchend),u.addEventListener("touchcancel",this.reset)}down(a,u){this.mouseRotate.mousedown(a,u),this.mousePitch&&this.mousePitch.mousedown(a,u),Yl()}move(a,u){const g=this.map,v=this.mouseRotate.mousemoveWindow(a,u),b=v&&v.bearingDelta;if(b&&g.setBearing(g.getBearing()+b),this.mousePitch){const D=this.mousePitch.mousemoveWindow(a,u),I=D&&D.pitchDelta;I&&g.setPitch(g.getPitch()+I)}}off(){const a=this.element;a.removeEventListener("mousedown",this.mousedown),a.removeEventListener("touchstart",this.touchstart,{passive:!1}),a.removeEventListener("touchmove",this.touchmove),a.removeEventListener("touchend",this.touchend),a.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){jo(),d.window.removeEventListener("mousemove",this.mousemove),d.window.removeEventListener("mouseup",this.mouseup)}mousedown(a){this.down(d.extend({},a,{ctrlKey:!0,preventDefault:()=>a.preventDefault()}),et(this.element,a)),d.window.addEventListener("mousemove",this.mousemove),d.window.addEventListener("mouseup",this.mouseup)}mousemove(a){this.move(a,et(this.element,a))}mouseup(a){this.mouseRotate.mouseupWindow(a),this.mousePitch&&this.mousePitch.mouseupWindow(a),this.offTemp()}touchstart(a){1!==a.targetTouches.length?this.reset():(this._startPos=this._lastPos=no(this.element,a.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>a.preventDefault()},this._startPos))}touchmove(a){1!==a.targetTouches.length?this.reset():(this._lastPos=no(this.element,a.targetTouches)[0],this.move({preventDefault:()=>a.preventDefault()},this._lastPos))}touchend(a){0===a.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const $u={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Kh={maxWidth:100,unit:"metric"};function Yh(f,a,u){const g=Gu(a),v=g/a,b={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[u];this._map._requestDomTask(()=>{this._container.style.width=f*v+"px",this._container.innerHTML=`${g}&nbsp;${b}`})}function Gu(f){const a=Math.pow(10,`${Math.floor(f)}`.length-1);let u=f/a;return u=u>=10?10:u>=5?5:u>=3?3:u>=2?2:u>=1?1:function(g){const v=Math.pow(10,Math.ceil(-Math.log(g)/Math.LN10));return Math.round(g*v)/v}(u),a*u}const ja={version:d.version,supported:Bo,setRTLTextPlugin:d.setRTLTextPlugin,getRTLTextPluginStatus:d.getRTLTextPluginStatus,Map:class extends Yo{constructor(f){if(d.LivePerformanceUtils.mark(d.PerformanceMarkers.create),null!=(f=d.extend({},up,f)).minZoom&&null!=f.maxZoom&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=f.minPitch&&null!=f.maxPitch&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=f.minPitch&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=f.maxPitch&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&d.isSafariWithAntialiasingBug(d.window)&&(f.antialias=!1,d.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Na(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),f),this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._collectResourceTiming=f.collectResourceTiming,this._optimizeForTerrain=f.optimizeForTerrain,this._language=this._parseLanguage(f.language),this._worldview=f.worldview,this._renderTaskQueue=new To,this._domRenderTaskQueue=new To,this._controls=[],this._markers=[],this._popups=[],this._mapId=d.uniqueId(),this._locale=d.extend({},ju,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._performanceMetricsCollection=f.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Zh(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new d.RequestManager(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,"string"==typeof f.container){if(this._container=d.window.document.getElementById(f.container),!this._container)throw new Error(`Container '${f.container}' not found.`)}else{if(!(f.container instanceof d.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&d.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),d.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==d.window&&(d.window.addEventListener("online",this._onWindowOnline,!1),d.window.addEventListener("resize",this._onWindowResize,!1),d.window.addEventListener("orientationchange",this._onWindowResize,!1),d.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),d.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Al(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,f.style&&this.setStyle(f.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),this._hash=f.hash&&new at("string"==typeof f.hash&&f.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch}),f.bounds&&(this.resize(),this.fitBounds(f.bounds,d.extend({},f.fitBoundsOptions,{duration:0})))),this.resize(),f.attributionControl&&this.addControl(new zu({customAttribution:f.customAttribution})),this._logoControl=new ta,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",a=>{this._update("style"===a.dataType),this.fire(new d.Event(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new d.Event(`${a.dataType}dataloading`,a))})}_getMapId(){return this._mapId}addControl(f,a){if(void 0===a&&(a=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new d.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const u=f.onAdd(this);this._controls.push(f);const g=this._controlPositions[a];return-1!==a.indexOf("bottom")?g.insertBefore(u,g.firstChild):g.appendChild(u),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new d.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const a=this._controls.indexOf(f);return a>-1&&this._controls.splice(a,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const a=!this._moving;return a&&this.fire(new d.Event("movestart",f)).fire(new d.Event("move",f)),this.fire(new d.Event("resize",f)),a&&this.fire(new d.Event("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(d.LngLatBounds.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new d.Event("zoomstart")).fire(new d.Event("zoom")).fire(new d.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new d.Event("zoomstart")).fire(new d.Event("zoom")).fire(new d.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new d.Event("pitchstart")).fire(new d.Event("pitch")).fire(new d.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new d.Event("pitchstart")).fire(new d.Event("pitch")).fire(new d.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(f){return"auto"===f?d.window.navigator.language:Array.isArray(f)?0===f.length?void 0:f.map(a=>"auto"===a?d.window.navigator.language:a):f}setLanguage(f){const a=this._parseLanguage(f);if(!this.style||a===this._language)return this;this._language=a,this.style._reloadSources();for(const u of this._controls)u._setLanguage&&u._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){return this.style&&f!==this._worldview?(this._worldview=f,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(f){return this._lazyInitEmptyStyle(),f?"string"==typeof f&&(f={name:f}):f=null,this._useExplicitProjection=!!f,this._prioritizeAndUpdateProjection(f,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const f=this.transform,a=f.projection.name;let u;"globe"===a&&f.zoom>=d.GLOBE_ZOOM_THRESHOLD_MAX?(f.setMercatorFromTransition(),u=!0):"mercator"===a&&f.zoom<d.GLOBE_ZOOM_THRESHOLD_MAX&&(f.setProjection({name:"globe"}),u=!0),u&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(f,a){return this._updateProjection(f||a||{name:"mercator"})}_updateProjection(f){let a;if(a="globe"===f.name&&this.transform.zoom>=d.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(f),this.style.applyProjectionUpdate(),a){this.painter.clearBackgroundTiles();for(const u in this.style._sourceCaches)this.style._sourceCaches[u].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(f){return this.transform.locationPoint3D(d.LngLat.convert(f))}unproject(f){return this.transform.pointLocation3D(d.pointGeometry.convert(f))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(f,a,u){if("mouseenter"===f||"mouseover"===f){let g=!1;const v=D=>{const I=a.filter(R=>this.getLayer(R)),M=I.length?this.queryRenderedFeatures(D.point,{layers:I}):[];M.length?g||(g=!0,u.call(this,new Ar(f,this,D.originalEvent,{features:M}))):g=!1},b=()=>{g=!1};return{layers:new Set(a),listener:u,delegates:{mousemove:v,mouseout:b}}}if("mouseleave"===f||"mouseout"===f){let g=!1;const v=D=>{const I=a.filter(M=>this.getLayer(M));(I.length?this.queryRenderedFeatures(D.point,{layers:I}):[]).length?g=!0:g&&(g=!1,u.call(this,new Ar(f,this,D.originalEvent)))},b=D=>{g&&(g=!1,u.call(this,new Ar(f,this,D.originalEvent)))};return{layers:new Set(a),listener:u,delegates:{mousemove:v,mouseout:b}}}{const g=v=>{const b=a.filter(I=>this.getLayer(I)),D=b.length?this.queryRenderedFeatures(v.point,{layers:b}):[];D.length&&(v.features=D,u.call(this,v),delete v.features)};return{layers:new Set(a),listener:u,delegates:{[f]:g}}}}on(f,a,u){if(void 0===u)return super.on(f,a);Array.isArray(a)||(a=[a]);const g=this._createDelegatedListener(f,a,u);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(g);for(const v in g.delegates)this.on(v,g.delegates[v]);return this}once(f,a,u){if(void 0===u)return super.once(f,a);Array.isArray(a)||(a=[a]);const g=this._createDelegatedListener(f,a,u);for(const v in g.delegates)this.once(v,g.delegates[v]);return this}off(f,a,u){if(void 0===u)return super.off(f,a);a=new Set(Array.isArray(a)?a:[a]);const g=(b,D)=>{if(b.size!==D.size)return!1;for(const I of b)if(!D.has(I))return!1;return!0},v=this._delegatedListeners?this._delegatedListeners[f]:void 0;return v&&(b=>{for(let D=0;D<b.length;D++){const I=b[D];if(I.listener===u&&g(I.layers,a)){for(const M in I.delegates)this.off(M,I.delegates[M]);return b.splice(D,1),this}}})(v),this}queryRenderedFeatures(f,a){return this.style?(void 0!==a||void 0===f||f instanceof d.pointGeometry||Array.isArray(f)||(a=f,f=void 0),this.style.queryRenderedFeatures(f=f||[[0,0],[this.transform.width,this.transform.height]],a=a||{},this.transform)):[]}querySourceFeatures(f,a){return this.style.querySourceFeatures(f,a)}setStyle(f,a){return!1!==(a=d.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},a)).diff&&a.localIdeographFontFamily===this._localIdeographFontFamily&&a.localFontFamily===this._localFontFamily&&this.style&&f?(this._diffStyle(f,a),this):(this._localIdeographFontFamily=a.localIdeographFontFamily,this._localFontFamily=a.localFontFamily,this._updateStyle(f,a))}_getUIString(f){const a=this._locale[f];if(null==a)throw new Error(`Missing UI string '${f}'`);return a}_updateStyle(f,a){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f&&(this.style=new Ti(this,a||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof f?this.style.loadURL(f):this.style.loadJSON(f)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ti(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,a){if("string"==typeof f){const u=this._requestManager.normalizeStyleURL(f),g=this._requestManager.transformRequest(u,d.ResourceType.Style);d.getJSON(g,(v,b)=>{v?this.fire(new d.ErrorEvent(v)):b&&this._updateDiff(b,a)})}else"object"==typeof f&&this._updateDiff(f,a)}_updateDiff(f,a){try{this.style.setState(f)&&this._update(!0)}catch(u){d.warnOnce(`Unable to perform style diff: ${u.message||u.error||u}.  Rebuilding the style from scratch.`),this._updateStyle(f,a)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(d.warnOnce("There is no style added to the map."),!1)}addSource(f,a){return this._lazyInitEmptyStyle(),this.style.addSource(f,a),this._update(!0)}isSourceLoaded(f){return!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){const f=this.style&&this.style._sourceCaches;for(const a in f){const u=f[a]._tiles;for(const g in u){const v=u[g];if("loaded"!==v.state&&"errored"!==v.state)return!1}}return!0}addSourceType(f,a,u){this._lazyInitEmptyStyle(),this.style.addSourceType(f,a,u)}removeSource(f){return this.style.removeSource(f),this._updateTerrain(),this._update(!0)}getSource(f){return this.style.getSource(f)}addImage(f,a,{pixelRatio:u=1,sdf:g=!1,stretchX:v,stretchY:b,content:D}={}){if(this._lazyInitEmptyStyle(),a instanceof d.window.HTMLImageElement||d.window.ImageBitmap&&a instanceof d.window.ImageBitmap){const{width:I,height:M,data:R}=d.exported.getImageData(a);this.style.addImage(f,{data:new d.RGBAImage({width:I,height:M},R),pixelRatio:u,stretchX:v,stretchY:b,content:D,sdf:g,version:0})}else if(void 0===a.width||void 0===a.height)this.fire(new d.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:I,height:M}=a,R=a;this.style.addImage(f,{data:new d.RGBAImage({width:I,height:M},new Uint8Array(R.data)),pixelRatio:u,stretchX:v,stretchY:b,content:D,sdf:g,version:0,userImage:R}),R.onAdd&&R.onAdd(this,f)}}updateImage(f,a){const u=this.style.getImage(f);if(!u)return void this.fire(new d.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const g=a instanceof d.window.HTMLImageElement||d.window.ImageBitmap&&a instanceof d.window.ImageBitmap?d.exported.getImageData(a):a,{width:v,height:b}=g;void 0!==v&&void 0!==b?v===u.data.width&&b===u.data.height?(u.data.replace(g.data,!(a instanceof d.window.HTMLImageElement||d.window.ImageBitmap&&a instanceof d.window.ImageBitmap)),this.style.updateImage(f,u)):this.fire(new d.ErrorEvent(new Error(`The width and height of the updated image (${v}, ${b})\n                must be that same as the previous version of the image\n                (${u.data.width}, ${u.data.height})`))):this.fire(new d.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new d.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,a){d.getImage(this._requestManager.transformRequest(f,d.ResourceType.Image),(u,g)=>{a(u,g instanceof d.window.HTMLImageElement?d.exported.getImageData(g):g)})}listImages(){return this.style.listImages()}addLayer(f,a){return this._lazyInitEmptyStyle(),this.style.addLayer(f,a),this._update(!0)}moveLayer(f,a){return this.style.moveLayer(f,a),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}setLayerZoomRange(f,a,u){return this.style.setLayerZoomRange(f,a,u),this._update(!0)}setFilter(f,a,u={}){return this.style.setFilter(f,a,u),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,a,u,g={}){return this.style.setPaintProperty(f,a,u,g),this._update(!0)}getPaintProperty(f,a){return this.style.getPaintProperty(f,a)}setLayoutProperty(f,a,u,g={}){return this.style.setLayoutProperty(f,a,u,g),this._update(!0)}getLayoutProperty(f,a){return this.style.getLayoutProperty(f,a)}setLight(f,a={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,a),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(d.LngLat.convert(f),this.transform):0}setFeatureState(f,a){return this.style.setFeatureState(f,a),this._update()}removeFeatureState(f,a){return this.style.removeFeatureState(f,a),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}_updateContainerDimensions(){if(!this._container)return;const f=this._container.getBoundingClientRect().width||400,a=this._container.getBoundingClientRect().height||300;let u,g,v,b=this._container;for(;b&&(!g||!v);){const D=d.window.getComputedStyle(b).transform;D&&"none"!==D&&(u=D.match(/matrix.*\((.+)\)/)[1].split(", "),u[0]&&"0"!==u[0]&&"1"!==u[0]&&(g=u[0]),u[3]&&"0"!==u[3]&&"1"!==u[3]&&(v=u[3])),b=b.parentElement}this._containerWidth=g?Math.abs(f/g):f,this._containerHeight=v?Math.abs(a/v):a}_detectMissingCSS(){"rgb(250, 128, 114)"!==d.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&d.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=Wt("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const a=this._canvasContainer=Wt("div","mapboxgl-canvas-container",f);this._interactive&&a.classList.add("mapboxgl-interactive"),this._canvas=Wt("canvas","mapboxgl-canvas",a),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const u=this._controlContainer=Wt("div","mapboxgl-control-container",f),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{g[v]=Wt("div",`mapboxgl-ctrl-${v}`,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,a){const u=d.exported.devicePixelRatio||1;this._canvas.width=u*Math.ceil(f),this._canvas.height=u*Math.ceil(a),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${a}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const a=this._markers.indexOf(f);-1!==a&&this._markers.splice(a,1)}_addPopup(f){this._popups.push(f)}_removePopup(f){const a=this._popups.indexOf(f);-1!==a&&this._popups.splice(a,1)}_setupPainter(){const f=d.extend({},Bo.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),a=this._canvas.getContext("webgl",f)||this._canvas.getContext("experimental-webgl",f);a?(d.storeAuthState(a,!0),this.painter=new kg(a,this.transform),this.on("data",u=>{"source"===u.dataType&&this.painter.setTileLoadedFlag(!0)}),d.exported$1.testSupport(a)):this.fire(new d.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new d.Event("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.resize(),this._update(),this.fire(new d.Event("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let a;const u=this.painter.context.extTimerQuery,g=d.exported.now();if(this.listens("gpu-timing-frame")&&(a=u.createQueryEXT(),u.beginQueryEXT(u.TIME_ELAPSED_EXT,a)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],d.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],d.window.performance.now())),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjectionTransition();const v=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const I=this.transform.zoom,M=this.transform.pitch,R=d.exported.now(),k=new d.EvaluationParameters(I,{now:R,fadeDuration:v,pitch:M,transition:this.style.getTransition()});this.style.update(k)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let b=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),b=this._updateAverageElevation(g),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):b=this._updateAverageElevation(g),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,v,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new d.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new d.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),a){const I=d.exported.now()-g;u.endQueryEXT(u.TIME_ELAPSED_EXT,a),setTimeout(()=>{const M=u.getQueryObjectEXT(a,u.QUERY_RESULT_EXT)/1e6;u.deleteQueryEXT(a),this.fire(new d.Event("gpu-timing-frame",{cpuTime:I,gpuTime:M})),d.window.performance.mark("frame-gpu",{startTime:g,detail:{gpuTime:M}})},50)}if(this.listens("gpu-timing-layer")){const I=this.painter.collectGpuTimers();setTimeout(()=>{const M=this.painter.queryGpuTimers(I);this.fire(new d.Event("gpu-timing-layer",{layerTimes:M}))},50)}if(this.listens("gpu-timing-deferred-render")){const I=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const M=this.painter.queryGpuTimeDeferredRender(I);this.fire(new d.Event("gpu-timing-deferred-render",{gpuTime:M}))},50)}const D=this._sourcesDirty||this._styleDirty||this._placementDirty||b;if(D||this._repaint)this.triggerRepaint();else{const I=!this.isMoving()&&this.loaded();if(I&&(b=this._updateAverageElevation(g,!0)),b)this.triggerRepaint();else if(this._triggerFrame(!1),I&&(this.fire(new d.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const M=this._calculateSpeedIndex();this.fire(new d.Event("speedindexcompleted",{speedIndex:M})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||D||(this._fullyLoaded=!0,d.LivePerformanceUtils.mark(d.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&d.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(f){for(const a of this._markers)f&&!this.getRenderWorldCopies()&&(a._lngLat=a._lngLat.wrap()),a._update();for(const a of this._popups)!f||this.getRenderWorldCopies()||a._trackPointer||(a._lngLat=a._lngLat.wrap()),a._update()}_updateAverageElevation(f,a=!1){const u=g=>(this.transform.averageElevation=g,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&u(0);if((a||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const g=this.transform.averageElevation;let v=this.transform.sampleAverageElevation(),b=!1;this.transform.elevation&&(b=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(v)?v=0:this._averageElevationLastSampledAt=f;const D=Math.abs(g-v);if(D>1){if(this._isInitialLoad||b)return this._averageElevation.jumpTo(v),u(v);this._averageElevation.easeTo(v,f,300)}else if(D>1e-4)return this._averageElevation.jumpTo(v),u(v)}return!!this._averageElevation.isEasing(f)&&u(this._averageElevation.getValue(f))}_authenticate(){d.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===d.AUTH_ERR_MSG||401===f.status)){const a=this.painter.context.gl;d.storeAuthState(a,!1),this._logoControl instanceof ta&&this._logoControl._updateLogo(),a&&a.clear(a.DEPTH_BUFFER_BIT|a.COLOR_BUFFER_BIT|a.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new d.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),d.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const f=this._isDragging();this.painter.updateTerrain(this.style,f)}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),a=this.painter.getCanvasCopiesAndTimestamps();a.timeStamps.push(performance.now());const u=this.painter.context.gl,g=u.createFramebuffer();function v(b){u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,b,0);const D=new Uint8Array(u.drawingBufferWidth*u.drawingBufferHeight*4);return u.readPixels(0,0,u.drawingBufferWidth,u.drawingBufferHeight,u.RGBA,u.UNSIGNED_BYTE,D),D}return u.bindFramebuffer(u.FRAMEBUFFER,g),this._canvasPixelComparison(v(f),a.canvasCopies.map(v),a.timeStamps)}_canvasPixelComparison(f,a,u){let g=u[1]-u[0];const v=f.length/4;for(let b=0;b<a.length;b++){const D=a[b];let I=0;for(let M=0;M<D.length;M+=4)D[M]===f[M]&&D[M+1]===f[M+1]&&D[M+2]===f[M+2]&&D[M+3]===f[M+3]&&(I+=1);g+=(u[b+2]-u[b+1])*(1-I/v)}return g}remove(){this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==d.window&&(d.window.removeEventListener("resize",this._onWindowResize,!1),d.window.removeEventListener("orientationchange",this._onWindowResize,!1),d.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),d.window.removeEventListener("online",this._onWindowOnline,!1),d.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),d.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new d.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=d.exported.frame(a=>{const u=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,u&&this._render(a)}))}_preloadTiles(f){const a=this.style?Object.values(this.style._sourceCaches):[];return d.asyncAll(a,(u,g)=>u._preloadTiles(f,g),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}_onVisibilityChange(){"hidden"===d.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(f){this._showTileAABBs!==f&&(this._showTileAABBs=f,f&&this._update())}_setCacheLimits(f,a){d.setCacheLimits(f,a)}get version(){return d.version}},NavigationControl:class{constructor(f){this.options=d.extend({},Xh,f),this._container=Wt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",a=>a.preventDefault()),this.options.showZoom&&(d.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",a=>{this._map&&this._map.zoomIn({},{originalEvent:a})}),Wt("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",a=>{this._map&&this._map.zoomOut({},{originalEvent:a})}),Wt("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(d.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",a=>{const u=this._map;u&&(this.options.visualizePitch?u.resetNorthPitch({},{originalEvent:a}):u.resetNorth({},{originalEvent:a}))}),this._compassIcon=Wt("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const f=this._map;if(!f)return;const a=f.getZoom(),u=a===f.getMaxZoom(),g=a===f.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())}_rotateCompassArrow(){const f=this._map;if(!f)return;const a=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=a)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Uu(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){const f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,a){const u=Wt("button",f,this._container);return u.type="button",u.addEventListener("click",a),u}_setButtonTitle(f,a){if(!this._map)return;const u=this._map._getUIString(`NavigationControl.${a}`);f.setAttribute("aria-label",u),f.firstElementChild&&f.firstElementChild.setAttribute("title",u)}},GeolocateControl:class extends d.Evented{constructor(f){super(),this.options=d.extend({geolocation:d.window.navigator.geolocation},$u,f),d.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Ec(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=Wt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){const a=(u=!!this.options.geolocation)=>{this._supportsGeolocation=u,f(u)};void 0!==this._supportsGeolocation?f(this._supportsGeolocation):void 0!==d.window.navigator.permissions?d.window.navigator.permissions.query({name:"geolocation"}).then(u=>a("denied"!==u.state)).catch(()=>a()):a()}_isOutOfMapMaxBounds(f){const a=this._map.getMaxBounds(),u=f.coords;return!!a&&(u.longitude<a.getWest()||u.longitude>a.getEast()||u.latitude<a.getSouth()||u.latitude>a.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new d.Event("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(f),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(f),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new d.Event("geolocate",f)),this._finish()}}_updateCamera(f){const a=new d.LngLat(f.coords.longitude,f.coords.latitude),u=f.coords.accuracy,g=this._map.getBearing(),v=d.extend({bearing:g},this.options.fitBoundsOptions);this._map.fitBounds(a.toBounds(u),v,{geolocateSource:!0})}_updateMarker(f){if(f){const a=new d.LngLat(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map.transform,a=d.mercatorZfromAltitude(1,f._center.lat)*f.worldSize,u=Math.ceil(2*this._accuracy*a);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(1===f.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===f.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new d.Event("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",a=>a.preventDefault()),this._geolocateButton=Wt("button","mapboxgl-ctrl-geolocate",this._container),Wt("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===f){d.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Wt("div","mapboxgl-user-location"),this._dotElement.appendChild(Wt("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Wt("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Ic({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Wt("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ic({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",a=>{a.geolocateSource||"ACTIVE_LOCK"!==this._watchState||a.originalEvent&&"resize"===a.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new d.Event("trackuserlocationend")))})}}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:!0===f.absolute&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return d.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new d.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new d.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new d.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const f=()=>{d.window.addEventListener("ondeviceorientationabsolute"in d.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==d.window.DeviceMotionEvent&&"function"==typeof d.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(a=>{"granted"===a&&f()}).catch(console.error):f()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),d.window.removeEventListener("deviceorientation",this._onDeviceOrientation),d.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:zu,ScaleControl:class{constructor(f){this.options=d.extend({},Kh,f),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=Yh.bind(this)),d.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const f=this.options.maxWidth||100,a=this._map,u=a._containerHeight/2,g=a._containerWidth/2-f/2,v=a.unproject([g,u]),b=a.unproject([g+f,u]),D=v.distanceTo(b);if("imperial"===this.options.unit){const I=3.2808*D;I>5280?this._setScale(f,I/5280,"mile"):this._setScale(f,I,"foot")}else"nautical"===this.options.unit?this._setScale(f,D/1852,"nautical-mile"):D>=1e3?this._setScale(f,D/1e3,"kilometer"):this._setScale(f,D,"meter")}_setScale(f,a,u){const g=Gu(a),v=g/a;this._map._requestDomTask(()=>{this._container.style.width=f*v+"px",this._container.innerHTML="nautical-mile"!==u?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:u}).format(g):`${g}&nbsp;nm`})}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=Wt("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f){this._fullscreen=!1,f&&f.container&&(f.container instanceof d.window.HTMLElement?this._container=f.container:d.warnOnce("Full screen control 'container' must be a DOM element.")),d.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in d.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in d.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=Wt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",d.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,d.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!d.window.document.fullscreenEnabled&&!d.window.document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=Wt("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Wt("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),d.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(d.window.document.fullscreenElement||d.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?d.window.document.exitFullscreen?d.window.document.exitFullscreen():d.window.document.webkitCancelFullScreen&&d.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends d.Evented{constructor(f){super(),this.options=d.extend(Object.create(Bu),f),d.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),f._addPopup(this),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new d.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),f._canvasContainer&&f._canvasContainer.classList.remove("mapboxgl-track-pointer"),f._removePopup(this),this._map=void 0),this.fire(new d.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=d.LngLat.convert(f),this._pos=null,this._trackPointer=!1,this._update();const a=this._map;return a&&(a.on("move",this._update),a.off("mousemove",this._onMouseEvent),a._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(d.window.document.createTextNode(f))}setHTML(f){const a=d.window.document.createDocumentFragment(),u=d.window.document.createElement("body");let g;for(u.innerHTML=f;g=u.firstChild,g;)a.appendChild(g);return this.setDOMContent(a)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let a=this._content;if(a)for(;a.hasChildNodes();)a.firstChild&&a.removeChild(a.firstChild);else a=this._content=Wt("div","mapboxgl-popup-content",this._container||void 0);if(a.appendChild(f),this.options.closeButton){const u=this._closeButton=Wt("button","mapboxgl-popup-close-button",a);u.type="button",u.setAttribute("aria-label","Close popup"),u.setAttribute("aria-hidden","true"),u.innerHTML="&#215;",u.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let a;return this._classList.delete(f)?a=!1:(this._classList.add(f),a=!0),this._updateClassList(),a}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const a=this._map,u=this._container,g=this._pos;if(!a||!u||!g)return"bottom";const v=u.offsetWidth,b=u.offsetHeight,D=g.x<v/2,I=g.x>a.transform.width-v/2;if(g.y+f<b)return D?"top-left":I?"top-right":"top";if(g.y>a.transform.height-b){if(D)return"bottom-left";if(I)return"bottom-right"}return D?"left":I?"right":"bottom"}_updateClassList(){const f=this._container;if(!f)return;const a=[...this._classList];a.push("mapboxgl-popup"),this._anchor&&a.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&a.push("mapboxgl-popup-track-pointer"),f.className=a.join(" ")}_update(f){const a=this._map,u=this._content;if(!a||!this._lngLat&&!this._trackPointer||!u)return;let g=this._container;if(g||(g=this._container=Wt("div","mapboxgl-popup",a.getContainer()),this._tip=Wt("div","mapboxgl-popup-tip",g),g.appendChild(u)),this.options.maxWidth&&g.style.maxWidth!==this.options.maxWidth&&(g.style.maxWidth=this.options.maxWidth),a.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Wh(this._lngLat,this._pos,a.transform)),!this._trackPointer||f){const v=this._pos=this._trackPointer&&f?f:a.project(this._lngLat),b=Sc(this.options.offset),D=this._anchor=this._getAnchor(b.y),I=Sc(this.options.offset,D),M=v.add(I).round();a._requestDomTask(()=>{this._container&&D&&(this._container.style.transform=`${Va[D]} translate(${M.x}px,${M.y}px)`)})}if(!this._marker&&a._showingGlobe()){const v=d.isLngLatBehindGlobe(a.transform,this._lngLat)?0:1;this._setOpacity(v)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(Vu);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:Ic,Style:Ti,LngLat:d.LngLat,LngLatBounds:d.LngLatBounds,Point:d.pointGeometry,MercatorCoordinate:d.MercatorCoordinate,FreeCameraOptions:Pu,Evented:d.Evented,config:d.config,prewarm:function(){Lt().acquire(Et)},clearPrewarmedResources:function(){const f=gt;f&&(f.isPreloaded()&&1===f.numActive()?(f.release(Et),gt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return d.config.ACCESS_TOKEN},set accessToken(f){d.config.ACCESS_TOKEN=f},get baseApiUrl(){return d.config.API_URL},set baseApiUrl(f){d.config.API_URL=f},get workerCount(){return bt.workerCount},set workerCount(f){bt.workerCount=f},get maxParallelImageRequests(){return d.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){d.config.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){d.clearTileCache(f)},workerUrl:"",workerClass:null,setNow:d.exported.setNow,restoreNow:d.exported.restoreNow};return ja}),gi}()}},Ff=>{Ff(Ff.s=787)}]);